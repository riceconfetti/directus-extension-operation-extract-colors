"use strict";var node_crypto=require("node:crypto"),require$$6=require("fs"),require$$0=require("util"),stream$1=require("stream"),zlib$4=require("zlib"),require$$4=require("assert"),require$$3=require("buffer"),util$6,objectUtil;function getDefaultExportFromCjs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}!function(e){e.assertEqual=e=>e,e.assertIs=function(e){},e.assertNever=function(e){throw new Error},e.arrayToEnum=e=>{const t={};for(const i of e)t[i]=i;return t},e.getValidEnumValues=t=>{const i=e.objectKeys(t).filter((e=>"number"!=typeof t[t[e]])),a={};for(const e of i)a[e]=t[e];return e.objectValues(a)},e.objectValues=t=>e.objectKeys(t).map((function(e){return t[e]})),e.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{const t=[];for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.push(i);return t},e.find=(e,t)=>{for(const i of e)if(t(i))return i},e.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&isFinite(e)&&Math.floor(e)===e,e.joinValues=function(e,t=" | "){return e.map((e=>"string"==typeof e?`'${e}'`:e)).join(t)},e.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t}(util$6||(util$6={})),function(e){e.mergeShapes=(e,t)=>({...e,...t})}(objectUtil||(objectUtil={}));const ZodParsedType=util$6.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),getParsedType=e=>{switch(typeof e){case"undefined":return ZodParsedType.undefined;case"string":return ZodParsedType.string;case"number":return isNaN(e)?ZodParsedType.nan:ZodParsedType.number;case"boolean":return ZodParsedType.boolean;case"function":return ZodParsedType.function;case"bigint":return ZodParsedType.bigint;case"symbol":return ZodParsedType.symbol;case"object":return Array.isArray(e)?ZodParsedType.array:null===e?ZodParsedType.null:e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch?ZodParsedType.promise:"undefined"!=typeof Map&&e instanceof Map?ZodParsedType.map:"undefined"!=typeof Set&&e instanceof Set?ZodParsedType.set:"undefined"!=typeof Date&&e instanceof Date?ZodParsedType.date:ZodParsedType.object;default:return ZodParsedType.unknown}},ZodIssueCode=util$6.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),quotelessJson=e=>JSON.stringify(e,null,2).replace(/"([^"]+)":/g,"$1:");class ZodError extends Error{constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){const t=e||function(e){return e.message},i={_errors:[]},a=e=>{for(const r of e.issues)if("invalid_union"===r.code)r.unionErrors.map(a);else if("invalid_return_type"===r.code)a(r.returnTypeError);else if("invalid_arguments"===r.code)a(r.argumentsError);else if(0===r.path.length)i._errors.push(t(r));else{let e=i,a=0;for(;a<r.path.length;){const i=r.path[a];a===r.path.length-1?(e[i]=e[i]||{_errors:[]},e[i]._errors.push(t(r))):e[i]=e[i]||{_errors:[]},e=e[i],a++}}};return a(this),i}static assert(e){if(!(e instanceof ZodError))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,util$6.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=e=>e.message){const t={},i=[];for(const a of this.issues)a.path.length>0?(t[a.path[0]]=t[a.path[0]]||[],t[a.path[0]].push(e(a))):i.push(e(a));return{formErrors:i,fieldErrors:t}}get formErrors(){return this.flatten()}}ZodError.create=e=>new ZodError(e);const errorMap=(e,t)=>{let i;switch(e.code){case ZodIssueCode.invalid_type:i=e.received===ZodParsedType.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case ZodIssueCode.invalid_literal:i=`Invalid literal value, expected ${JSON.stringify(e.expected,util$6.jsonStringifyReplacer)}`;break;case ZodIssueCode.unrecognized_keys:i=`Unrecognized key(s) in object: ${util$6.joinValues(e.keys,", ")}`;break;case ZodIssueCode.invalid_union:i="Invalid input";break;case ZodIssueCode.invalid_union_discriminator:i=`Invalid discriminator value. Expected ${util$6.joinValues(e.options)}`;break;case ZodIssueCode.invalid_enum_value:i=`Invalid enum value. Expected ${util$6.joinValues(e.options)}, received '${e.received}'`;break;case ZodIssueCode.invalid_arguments:i="Invalid function arguments";break;case ZodIssueCode.invalid_return_type:i="Invalid function return type";break;case ZodIssueCode.invalid_date:i="Invalid date";break;case ZodIssueCode.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(i=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(i=`${i} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?i=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?i=`Invalid input: must end with "${e.validation.endsWith}"`:util$6.assertNever(e.validation):i="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case ZodIssueCode.too_small:i="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case ZodIssueCode.too_big:i="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case ZodIssueCode.custom:i="Invalid input";break;case ZodIssueCode.invalid_intersection_types:i="Intersection results could not be merged";break;case ZodIssueCode.not_multiple_of:i=`Number must be a multiple of ${e.multipleOf}`;break;case ZodIssueCode.not_finite:i="Number must be finite";break;default:i=t.defaultError,util$6.assertNever(e)}return{message:i}};let overrideErrorMap=errorMap;function setErrorMap(e){overrideErrorMap=e}function getErrorMap(){return overrideErrorMap}const makeIssue=e=>{const{data:t,path:i,errorMaps:a,issueData:r}=e,n=[...i,...r.path||[]],s={...r,path:n};if(void 0!==r.message)return{...r,path:n,message:r.message};let o="";const l=a.filter((e=>!!e)).slice().reverse();for(const e of l)o=e(s,{data:t,defaultError:o}).message;return{...r,path:n,message:o}},EMPTY_PATH=[];function addIssueToContext(e,t){const i=getErrorMap(),a=makeIssue({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,i,i===errorMap?void 0:errorMap].filter((e=>!!e))});e.common.issues.push(a)}class ParseStatus{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,t){const i=[];for(const a of t){if("aborted"===a.status)return INVALID;"dirty"===a.status&&e.dirty(),i.push(a.value)}return{status:e.value,value:i}}static async mergeObjectAsync(e,t){const i=[];for(const e of t){const t=await e.key,a=await e.value;i.push({key:t,value:a})}return ParseStatus.mergeObjectSync(e,i)}static mergeObjectSync(e,t){const i={};for(const a of t){const{key:t,value:r}=a;if("aborted"===t.status)return INVALID;if("aborted"===r.status)return INVALID;"dirty"===t.status&&e.dirty(),"dirty"===r.status&&e.dirty(),"__proto__"===t.value||void 0===r.value&&!a.alwaysSet||(i[t.value]=r.value)}return{status:e.value,value:i}}}const INVALID=Object.freeze({status:"aborted"}),DIRTY=e=>({status:"dirty",value:e}),OK=e=>({status:"valid",value:e}),isAborted=e=>"aborted"===e.status,isDirty=e=>"dirty"===e.status,isValid=e=>"valid"===e.status,isAsync=e=>"undefined"!=typeof Promise&&e instanceof Promise;function __classPrivateFieldGet(e,t,i,a){if("a"===i&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?a:"a"===i?a.call(e):a?a.value:t.get(e)}function __classPrivateFieldSet(e,t,i,a,r){if("m"===a)throw new TypeError("Private method is not writable");if("a"===a&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?r.call(e,i):r?r.value=i:t.set(e,i),i}var errorUtil,_ZodEnum_cache,_ZodNativeEnum_cache;"function"==typeof SuppressedError&&SuppressedError,function(e){e.errToObj=e=>"string"==typeof e?{message:e}:e||{},e.toString=e=>"string"==typeof e?e:null==e?void 0:e.message}(errorUtil||(errorUtil={}));class ParseInputLazyPath{constructor(e,t,i,a){this._cachedPath=[],this.parent=e,this.data=t,this._path=i,this._key=a}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const handleResult=(e,t)=>{if(isValid(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new ZodError(e.common.issues);return this._error=t,this._error}}};function processCreateParams(e){if(!e)return{};const{errorMap:t,invalid_type_error:i,required_error:a,description:r}=e;if(t&&(i||a))throw new Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');if(t)return{errorMap:t,description:r};return{errorMap:(t,r)=>{var n,s;const{message:o}=e;return"invalid_enum_value"===t.code?{message:null!=o?o:r.defaultError}:void 0===r.data?{message:null!==(n=null!=o?o:a)&&void 0!==n?n:r.defaultError}:"invalid_type"!==t.code?{message:r.defaultError}:{message:null!==(s=null!=o?o:i)&&void 0!==s?s:r.defaultError}},description:r}}class ZodType{constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(e){return getParsedType(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:getParsedType(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new ParseStatus,ctx:{common:e.parent.common,data:e.data,parsedType:getParsedType(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(isAsync(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const i=this.safeParse(e,t);if(i.success)return i.data;throw i.error}safeParse(e,t){var i;const a={common:{issues:[],async:null!==(i=null==t?void 0:t.async)&&void 0!==i&&i,contextualErrorMap:null==t?void 0:t.errorMap},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:getParsedType(e)},r=this._parseSync({data:e,path:a.path,parent:a});return handleResult(a,r)}async parseAsync(e,t){const i=await this.safeParseAsync(e,t);if(i.success)return i.data;throw i.error}async safeParseAsync(e,t){const i={common:{issues:[],contextualErrorMap:null==t?void 0:t.errorMap,async:!0},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:getParsedType(e)},a=this._parse({data:e,path:i.path,parent:i}),r=await(isAsync(a)?a:Promise.resolve(a));return handleResult(i,r)}refine(e,t){const i=e=>"string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(e):t;return this._refinement(((t,a)=>{const r=e(t),n=()=>a.addIssue({code:ZodIssueCode.custom,...i(t)});return"undefined"!=typeof Promise&&r instanceof Promise?r.then((e=>!!e||(n(),!1))):!!r||(n(),!1)}))}refinement(e,t){return this._refinement(((i,a)=>!!e(i)||(a.addIssue("function"==typeof t?t(i,a):t),!1)))}_refinement(e){return new ZodEffects({schema:this,typeName:ZodFirstPartyTypeKind.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}optional(){return ZodOptional.create(this,this._def)}nullable(){return ZodNullable.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return ZodArray.create(this,this._def)}promise(){return ZodPromise.create(this,this._def)}or(e){return ZodUnion.create([this,e],this._def)}and(e){return ZodIntersection.create(this,e,this._def)}transform(e){return new ZodEffects({...processCreateParams(this._def),schema:this,typeName:ZodFirstPartyTypeKind.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t="function"==typeof e?e:()=>e;return new ZodDefault({...processCreateParams(this._def),innerType:this,defaultValue:t,typeName:ZodFirstPartyTypeKind.ZodDefault})}brand(){return new ZodBranded({typeName:ZodFirstPartyTypeKind.ZodBranded,type:this,...processCreateParams(this._def)})}catch(e){const t="function"==typeof e?e:()=>e;return new ZodCatch({...processCreateParams(this._def),innerType:this,catchValue:t,typeName:ZodFirstPartyTypeKind.ZodCatch})}describe(e){return new(0,this.constructor)({...this._def,description:e})}pipe(e){return ZodPipeline.create(this,e)}readonly(){return ZodReadonly.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const cuidRegex=/^c[^\s-]{8,}$/i,cuid2Regex=/^[0-9a-z]+$/,ulidRegex=/^[0-9A-HJKMNP-TV-Z]{26}$/,uuidRegex=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,nanoidRegex=/^[a-z0-9_-]{21}$/i,durationRegex=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,emailRegex=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,_emojiRegex="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let emojiRegex;const ipv4Regex=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv6Regex=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,base64Regex=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,dateRegexSource="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",dateRegex=new RegExp(`^${dateRegexSource}$`);function timeRegexSource(e){let t="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return e.precision?t=`${t}\\.\\d{${e.precision}}`:null==e.precision&&(t=`${t}(\\.\\d+)?`),t}function timeRegex(e){return new RegExp(`^${timeRegexSource(e)}$`)}function datetimeRegex(e){let t=`${dateRegexSource}T${timeRegexSource(e)}`;const i=[];return i.push(e.local?"Z?":"Z"),e.offset&&i.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${i.join("|")})`,new RegExp(`^${t}$`)}function isValidIP(e,t){return!("v4"!==t&&t||!ipv4Regex.test(e))||!("v6"!==t&&t||!ipv6Regex.test(e))}class ZodString extends ZodType{_parse(e){this._def.coerce&&(e.data=String(e.data));if(this._getType(e)!==ZodParsedType.string){const t=this._getOrReturnCtx(e);return addIssueToContext(t,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.string,received:t.parsedType}),INVALID}const t=new ParseStatus;let i;for(const a of this._def.checks)if("min"===a.kind)e.data.length<a.value&&(i=this._getOrReturnCtx(e,i),addIssueToContext(i,{code:ZodIssueCode.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),t.dirty());else if("max"===a.kind)e.data.length>a.value&&(i=this._getOrReturnCtx(e,i),addIssueToContext(i,{code:ZodIssueCode.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),t.dirty());else if("length"===a.kind){const r=e.data.length>a.value,n=e.data.length<a.value;(r||n)&&(i=this._getOrReturnCtx(e,i),r?addIssueToContext(i,{code:ZodIssueCode.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}):n&&addIssueToContext(i,{code:ZodIssueCode.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}),t.dirty())}else if("email"===a.kind)emailRegex.test(e.data)||(i=this._getOrReturnCtx(e,i),addIssueToContext(i,{validation:"email",code:ZodIssueCode.invalid_string,message:a.message}),t.dirty());else if("emoji"===a.kind)emojiRegex||(emojiRegex=new RegExp(_emojiRegex,"u")),emojiRegex.test(e.data)||(i=this._getOrReturnCtx(e,i),addIssueToContext(i,{validation:"emoji",code:ZodIssueCode.invalid_string,message:a.message}),t.dirty());else if("uuid"===a.kind)uuidRegex.test(e.data)||(i=this._getOrReturnCtx(e,i),addIssueToContext(i,{validation:"uuid",code:ZodIssueCode.invalid_string,message:a.message}),t.dirty());else if("nanoid"===a.kind)nanoidRegex.test(e.data)||(i=this._getOrReturnCtx(e,i),addIssueToContext(i,{validation:"nanoid",code:ZodIssueCode.invalid_string,message:a.message}),t.dirty());else if("cuid"===a.kind)cuidRegex.test(e.data)||(i=this._getOrReturnCtx(e,i),addIssueToContext(i,{validation:"cuid",code:ZodIssueCode.invalid_string,message:a.message}),t.dirty());else if("cuid2"===a.kind)cuid2Regex.test(e.data)||(i=this._getOrReturnCtx(e,i),addIssueToContext(i,{validation:"cuid2",code:ZodIssueCode.invalid_string,message:a.message}),t.dirty());else if("ulid"===a.kind)ulidRegex.test(e.data)||(i=this._getOrReturnCtx(e,i),addIssueToContext(i,{validation:"ulid",code:ZodIssueCode.invalid_string,message:a.message}),t.dirty());else if("url"===a.kind)try{new URL(e.data)}catch(r){i=this._getOrReturnCtx(e,i),addIssueToContext(i,{validation:"url",code:ZodIssueCode.invalid_string,message:a.message}),t.dirty()}else if("regex"===a.kind){a.regex.lastIndex=0;a.regex.test(e.data)||(i=this._getOrReturnCtx(e,i),addIssueToContext(i,{validation:"regex",code:ZodIssueCode.invalid_string,message:a.message}),t.dirty())}else if("trim"===a.kind)e.data=e.data.trim();else if("includes"===a.kind)e.data.includes(a.value,a.position)||(i=this._getOrReturnCtx(e,i),addIssueToContext(i,{code:ZodIssueCode.invalid_string,validation:{includes:a.value,position:a.position},message:a.message}),t.dirty());else if("toLowerCase"===a.kind)e.data=e.data.toLowerCase();else if("toUpperCase"===a.kind)e.data=e.data.toUpperCase();else if("startsWith"===a.kind)e.data.startsWith(a.value)||(i=this._getOrReturnCtx(e,i),addIssueToContext(i,{code:ZodIssueCode.invalid_string,validation:{startsWith:a.value},message:a.message}),t.dirty());else if("endsWith"===a.kind)e.data.endsWith(a.value)||(i=this._getOrReturnCtx(e,i),addIssueToContext(i,{code:ZodIssueCode.invalid_string,validation:{endsWith:a.value},message:a.message}),t.dirty());else if("datetime"===a.kind){datetimeRegex(a).test(e.data)||(i=this._getOrReturnCtx(e,i),addIssueToContext(i,{code:ZodIssueCode.invalid_string,validation:"datetime",message:a.message}),t.dirty())}else if("date"===a.kind){dateRegex.test(e.data)||(i=this._getOrReturnCtx(e,i),addIssueToContext(i,{code:ZodIssueCode.invalid_string,validation:"date",message:a.message}),t.dirty())}else if("time"===a.kind){timeRegex(a).test(e.data)||(i=this._getOrReturnCtx(e,i),addIssueToContext(i,{code:ZodIssueCode.invalid_string,validation:"time",message:a.message}),t.dirty())}else"duration"===a.kind?durationRegex.test(e.data)||(i=this._getOrReturnCtx(e,i),addIssueToContext(i,{validation:"duration",code:ZodIssueCode.invalid_string,message:a.message}),t.dirty()):"ip"===a.kind?isValidIP(e.data,a.version)||(i=this._getOrReturnCtx(e,i),addIssueToContext(i,{validation:"ip",code:ZodIssueCode.invalid_string,message:a.message}),t.dirty()):"base64"===a.kind?base64Regex.test(e.data)||(i=this._getOrReturnCtx(e,i),addIssueToContext(i,{validation:"base64",code:ZodIssueCode.invalid_string,message:a.message}),t.dirty()):util$6.assertNever(a);return{status:t.value,value:e.data}}_regex(e,t,i){return this.refinement((t=>e.test(t)),{validation:t,code:ZodIssueCode.invalid_string,...errorUtil.errToObj(i)})}_addCheck(e){return new ZodString({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...errorUtil.errToObj(e)})}url(e){return this._addCheck({kind:"url",...errorUtil.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...errorUtil.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...errorUtil.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...errorUtil.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...errorUtil.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...errorUtil.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...errorUtil.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...errorUtil.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...errorUtil.errToObj(e)})}datetime(e){var t,i;return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,offset:null!==(t=null==e?void 0:e.offset)&&void 0!==t&&t,local:null!==(i=null==e?void 0:e.local)&&void 0!==i&&i,...errorUtil.errToObj(null==e?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return"string"==typeof e?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,...errorUtil.errToObj(null==e?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...errorUtil.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...errorUtil.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:null==t?void 0:t.position,...errorUtil.errToObj(null==t?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...errorUtil.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...errorUtil.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...errorUtil.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...errorUtil.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...errorUtil.errToObj(t)})}nonempty(e){return this.min(1,errorUtil.errToObj(e))}trim(){return new ZodString({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new ZodString({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new ZodString({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find((e=>"datetime"===e.kind))}get isDate(){return!!this._def.checks.find((e=>"date"===e.kind))}get isTime(){return!!this._def.checks.find((e=>"time"===e.kind))}get isDuration(){return!!this._def.checks.find((e=>"duration"===e.kind))}get isEmail(){return!!this._def.checks.find((e=>"email"===e.kind))}get isURL(){return!!this._def.checks.find((e=>"url"===e.kind))}get isEmoji(){return!!this._def.checks.find((e=>"emoji"===e.kind))}get isUUID(){return!!this._def.checks.find((e=>"uuid"===e.kind))}get isNANOID(){return!!this._def.checks.find((e=>"nanoid"===e.kind))}get isCUID(){return!!this._def.checks.find((e=>"cuid"===e.kind))}get isCUID2(){return!!this._def.checks.find((e=>"cuid2"===e.kind))}get isULID(){return!!this._def.checks.find((e=>"ulid"===e.kind))}get isIP(){return!!this._def.checks.find((e=>"ip"===e.kind))}get isBase64(){return!!this._def.checks.find((e=>"base64"===e.kind))}get minLength(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}function floatSafeRemainder(e,t){const i=(e.toString().split(".")[1]||"").length,a=(t.toString().split(".")[1]||"").length,r=i>a?i:a;return parseInt(e.toFixed(r).replace(".",""))%parseInt(t.toFixed(r).replace(".",""))/Math.pow(10,r)}ZodString.create=e=>{var t;return new ZodString({checks:[],typeName:ZodFirstPartyTypeKind.ZodString,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...processCreateParams(e)})};class ZodNumber extends ZodType{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){this._def.coerce&&(e.data=Number(e.data));if(this._getType(e)!==ZodParsedType.number){const t=this._getOrReturnCtx(e);return addIssueToContext(t,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.number,received:t.parsedType}),INVALID}let t;const i=new ParseStatus;for(const a of this._def.checks)if("int"===a.kind)util$6.isInteger(e.data)||(t=this._getOrReturnCtx(e,t),addIssueToContext(t,{code:ZodIssueCode.invalid_type,expected:"integer",received:"float",message:a.message}),i.dirty());else if("min"===a.kind){(a.inclusive?e.data<a.value:e.data<=a.value)&&(t=this._getOrReturnCtx(e,t),addIssueToContext(t,{code:ZodIssueCode.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),i.dirty())}else if("max"===a.kind){(a.inclusive?e.data>a.value:e.data>=a.value)&&(t=this._getOrReturnCtx(e,t),addIssueToContext(t,{code:ZodIssueCode.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),i.dirty())}else"multipleOf"===a.kind?0!==floatSafeRemainder(e.data,a.value)&&(t=this._getOrReturnCtx(e,t),addIssueToContext(t,{code:ZodIssueCode.not_multiple_of,multipleOf:a.value,message:a.message}),i.dirty()):"finite"===a.kind?Number.isFinite(e.data)||(t=this._getOrReturnCtx(e,t),addIssueToContext(t,{code:ZodIssueCode.not_finite,message:a.message}),i.dirty()):util$6.assertNever(a);return{status:i.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,errorUtil.toString(t))}gt(e,t){return this.setLimit("min",e,!1,errorUtil.toString(t))}lte(e,t){return this.setLimit("max",e,!0,errorUtil.toString(t))}lt(e,t){return this.setLimit("max",e,!1,errorUtil.toString(t))}setLimit(e,t,i,a){return new ZodNumber({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:i,message:errorUtil.toString(a)}]})}_addCheck(e){return new ZodNumber({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:errorUtil.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:errorUtil.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:errorUtil.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:errorUtil.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:errorUtil.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:errorUtil.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:errorUtil.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:errorUtil.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:errorUtil.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find((e=>"int"===e.kind||"multipleOf"===e.kind&&util$6.isInteger(e.value)))}get isFinite(){let e=null,t=null;for(const i of this._def.checks){if("finite"===i.kind||"int"===i.kind||"multipleOf"===i.kind)return!0;"min"===i.kind?(null===t||i.value>t)&&(t=i.value):"max"===i.kind&&(null===e||i.value<e)&&(e=i.value)}return Number.isFinite(t)&&Number.isFinite(e)}}ZodNumber.create=e=>new ZodNumber({checks:[],typeName:ZodFirstPartyTypeKind.ZodNumber,coerce:(null==e?void 0:e.coerce)||!1,...processCreateParams(e)});class ZodBigInt extends ZodType{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){this._def.coerce&&(e.data=BigInt(e.data));if(this._getType(e)!==ZodParsedType.bigint){const t=this._getOrReturnCtx(e);return addIssueToContext(t,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.bigint,received:t.parsedType}),INVALID}let t;const i=new ParseStatus;for(const a of this._def.checks)if("min"===a.kind){(a.inclusive?e.data<a.value:e.data<=a.value)&&(t=this._getOrReturnCtx(e,t),addIssueToContext(t,{code:ZodIssueCode.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),i.dirty())}else if("max"===a.kind){(a.inclusive?e.data>a.value:e.data>=a.value)&&(t=this._getOrReturnCtx(e,t),addIssueToContext(t,{code:ZodIssueCode.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),i.dirty())}else"multipleOf"===a.kind?e.data%a.value!==BigInt(0)&&(t=this._getOrReturnCtx(e,t),addIssueToContext(t,{code:ZodIssueCode.not_multiple_of,multipleOf:a.value,message:a.message}),i.dirty()):util$6.assertNever(a);return{status:i.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,errorUtil.toString(t))}gt(e,t){return this.setLimit("min",e,!1,errorUtil.toString(t))}lte(e,t){return this.setLimit("max",e,!0,errorUtil.toString(t))}lt(e,t){return this.setLimit("max",e,!1,errorUtil.toString(t))}setLimit(e,t,i,a){return new ZodBigInt({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:i,message:errorUtil.toString(a)}]})}_addCheck(e){return new ZodBigInt({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:errorUtil.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:errorUtil.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:errorUtil.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:errorUtil.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:errorUtil.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}ZodBigInt.create=e=>{var t;return new ZodBigInt({checks:[],typeName:ZodFirstPartyTypeKind.ZodBigInt,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...processCreateParams(e)})};class ZodBoolean extends ZodType{_parse(e){this._def.coerce&&(e.data=Boolean(e.data));if(this._getType(e)!==ZodParsedType.boolean){const t=this._getOrReturnCtx(e);return addIssueToContext(t,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.boolean,received:t.parsedType}),INVALID}return OK(e.data)}}ZodBoolean.create=e=>new ZodBoolean({typeName:ZodFirstPartyTypeKind.ZodBoolean,coerce:(null==e?void 0:e.coerce)||!1,...processCreateParams(e)});class ZodDate extends ZodType{_parse(e){this._def.coerce&&(e.data=new Date(e.data));if(this._getType(e)!==ZodParsedType.date){const t=this._getOrReturnCtx(e);return addIssueToContext(t,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.date,received:t.parsedType}),INVALID}if(isNaN(e.data.getTime())){return addIssueToContext(this._getOrReturnCtx(e),{code:ZodIssueCode.invalid_date}),INVALID}const t=new ParseStatus;let i;for(const a of this._def.checks)"min"===a.kind?e.data.getTime()<a.value&&(i=this._getOrReturnCtx(e,i),addIssueToContext(i,{code:ZodIssueCode.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),t.dirty()):"max"===a.kind?e.data.getTime()>a.value&&(i=this._getOrReturnCtx(e,i),addIssueToContext(i,{code:ZodIssueCode.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),t.dirty()):util$6.assertNever(a);return{status:t.value,value:new Date(e.data.getTime())}}_addCheck(e){return new ZodDate({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:errorUtil.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:errorUtil.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}ZodDate.create=e=>new ZodDate({checks:[],coerce:(null==e?void 0:e.coerce)||!1,typeName:ZodFirstPartyTypeKind.ZodDate,...processCreateParams(e)});class ZodSymbol extends ZodType{_parse(e){if(this._getType(e)!==ZodParsedType.symbol){const t=this._getOrReturnCtx(e);return addIssueToContext(t,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.symbol,received:t.parsedType}),INVALID}return OK(e.data)}}ZodSymbol.create=e=>new ZodSymbol({typeName:ZodFirstPartyTypeKind.ZodSymbol,...processCreateParams(e)});class ZodUndefined extends ZodType{_parse(e){if(this._getType(e)!==ZodParsedType.undefined){const t=this._getOrReturnCtx(e);return addIssueToContext(t,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.undefined,received:t.parsedType}),INVALID}return OK(e.data)}}ZodUndefined.create=e=>new ZodUndefined({typeName:ZodFirstPartyTypeKind.ZodUndefined,...processCreateParams(e)});class ZodNull extends ZodType{_parse(e){if(this._getType(e)!==ZodParsedType.null){const t=this._getOrReturnCtx(e);return addIssueToContext(t,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.null,received:t.parsedType}),INVALID}return OK(e.data)}}ZodNull.create=e=>new ZodNull({typeName:ZodFirstPartyTypeKind.ZodNull,...processCreateParams(e)});class ZodAny extends ZodType{constructor(){super(...arguments),this._any=!0}_parse(e){return OK(e.data)}}ZodAny.create=e=>new ZodAny({typeName:ZodFirstPartyTypeKind.ZodAny,...processCreateParams(e)});class ZodUnknown extends ZodType{constructor(){super(...arguments),this._unknown=!0}_parse(e){return OK(e.data)}}ZodUnknown.create=e=>new ZodUnknown({typeName:ZodFirstPartyTypeKind.ZodUnknown,...processCreateParams(e)});class ZodNever extends ZodType{_parse(e){const t=this._getOrReturnCtx(e);return addIssueToContext(t,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.never,received:t.parsedType}),INVALID}}ZodNever.create=e=>new ZodNever({typeName:ZodFirstPartyTypeKind.ZodNever,...processCreateParams(e)});class ZodVoid extends ZodType{_parse(e){if(this._getType(e)!==ZodParsedType.undefined){const t=this._getOrReturnCtx(e);return addIssueToContext(t,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.void,received:t.parsedType}),INVALID}return OK(e.data)}}ZodVoid.create=e=>new ZodVoid({typeName:ZodFirstPartyTypeKind.ZodVoid,...processCreateParams(e)});class ZodArray extends ZodType{_parse(e){const{ctx:t,status:i}=this._processInputParams(e),a=this._def;if(t.parsedType!==ZodParsedType.array)return addIssueToContext(t,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.array,received:t.parsedType}),INVALID;if(null!==a.exactLength){const e=t.data.length>a.exactLength.value,r=t.data.length<a.exactLength.value;(e||r)&&(addIssueToContext(t,{code:e?ZodIssueCode.too_big:ZodIssueCode.too_small,minimum:r?a.exactLength.value:void 0,maximum:e?a.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:a.exactLength.message}),i.dirty())}if(null!==a.minLength&&t.data.length<a.minLength.value&&(addIssueToContext(t,{code:ZodIssueCode.too_small,minimum:a.minLength.value,type:"array",inclusive:!0,exact:!1,message:a.minLength.message}),i.dirty()),null!==a.maxLength&&t.data.length>a.maxLength.value&&(addIssueToContext(t,{code:ZodIssueCode.too_big,maximum:a.maxLength.value,type:"array",inclusive:!0,exact:!1,message:a.maxLength.message}),i.dirty()),t.common.async)return Promise.all([...t.data].map(((e,i)=>a.type._parseAsync(new ParseInputLazyPath(t,e,t.path,i))))).then((e=>ParseStatus.mergeArray(i,e)));const r=[...t.data].map(((e,i)=>a.type._parseSync(new ParseInputLazyPath(t,e,t.path,i))));return ParseStatus.mergeArray(i,r)}get element(){return this._def.type}min(e,t){return new ZodArray({...this._def,minLength:{value:e,message:errorUtil.toString(t)}})}max(e,t){return new ZodArray({...this._def,maxLength:{value:e,message:errorUtil.toString(t)}})}length(e,t){return new ZodArray({...this._def,exactLength:{value:e,message:errorUtil.toString(t)}})}nonempty(e){return this.min(1,e)}}function deepPartialify(e){if(e instanceof ZodObject){const t={};for(const i in e.shape){const a=e.shape[i];t[i]=ZodOptional.create(deepPartialify(a))}return new ZodObject({...e._def,shape:()=>t})}return e instanceof ZodArray?new ZodArray({...e._def,type:deepPartialify(e.element)}):e instanceof ZodOptional?ZodOptional.create(deepPartialify(e.unwrap())):e instanceof ZodNullable?ZodNullable.create(deepPartialify(e.unwrap())):e instanceof ZodTuple?ZodTuple.create(e.items.map((e=>deepPartialify(e)))):e}ZodArray.create=(e,t)=>new ZodArray({type:e,minLength:null,maxLength:null,exactLength:null,typeName:ZodFirstPartyTypeKind.ZodArray,...processCreateParams(t)});class ZodObject extends ZodType{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;const e=this._def.shape(),t=util$6.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==ZodParsedType.object){const t=this._getOrReturnCtx(e);return addIssueToContext(t,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.object,received:t.parsedType}),INVALID}const{status:t,ctx:i}=this._processInputParams(e),{shape:a,keys:r}=this._getCached(),n=[];if(!(this._def.catchall instanceof ZodNever&&"strip"===this._def.unknownKeys))for(const e in i.data)r.includes(e)||n.push(e);const s=[];for(const e of r){const t=a[e],r=i.data[e];s.push({key:{status:"valid",value:e},value:t._parse(new ParseInputLazyPath(i,r,i.path,e)),alwaysSet:e in i.data})}if(this._def.catchall instanceof ZodNever){const e=this._def.unknownKeys;if("passthrough"===e)for(const e of n)s.push({key:{status:"valid",value:e},value:{status:"valid",value:i.data[e]}});else if("strict"===e)n.length>0&&(addIssueToContext(i,{code:ZodIssueCode.unrecognized_keys,keys:n}),t.dirty());else if("strip"!==e)throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const e=this._def.catchall;for(const t of n){const a=i.data[t];s.push({key:{status:"valid",value:t},value:e._parse(new ParseInputLazyPath(i,a,i.path,t)),alwaysSet:t in i.data})}}return i.common.async?Promise.resolve().then((async()=>{const e=[];for(const t of s){const i=await t.key,a=await t.value;e.push({key:i,value:a,alwaysSet:t.alwaysSet})}return e})).then((e=>ParseStatus.mergeObjectSync(t,e))):ParseStatus.mergeObjectSync(t,s)}get shape(){return this._def.shape()}strict(e){return errorUtil.errToObj,new ZodObject({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,i)=>{var a,r,n,s;const o=null!==(n=null===(r=(a=this._def).errorMap)||void 0===r?void 0:r.call(a,t,i).message)&&void 0!==n?n:i.defaultError;return"unrecognized_keys"===t.code?{message:null!==(s=errorUtil.errToObj(e).message)&&void 0!==s?s:o}:{message:o}}}:{}})}strip(){return new ZodObject({...this._def,unknownKeys:"strip"})}passthrough(){return new ZodObject({...this._def,unknownKeys:"passthrough"})}extend(e){return new ZodObject({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new ZodObject({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:ZodFirstPartyTypeKind.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new ZodObject({...this._def,catchall:e})}pick(e){const t={};return util$6.objectKeys(e).forEach((i=>{e[i]&&this.shape[i]&&(t[i]=this.shape[i])})),new ZodObject({...this._def,shape:()=>t})}omit(e){const t={};return util$6.objectKeys(this.shape).forEach((i=>{e[i]||(t[i]=this.shape[i])})),new ZodObject({...this._def,shape:()=>t})}deepPartial(){return deepPartialify(this)}partial(e){const t={};return util$6.objectKeys(this.shape).forEach((i=>{const a=this.shape[i];e&&!e[i]?t[i]=a:t[i]=a.optional()})),new ZodObject({...this._def,shape:()=>t})}required(e){const t={};return util$6.objectKeys(this.shape).forEach((i=>{if(e&&!e[i])t[i]=this.shape[i];else{let e=this.shape[i];for(;e instanceof ZodOptional;)e=e._def.innerType;t[i]=e}})),new ZodObject({...this._def,shape:()=>t})}keyof(){return createZodEnum(util$6.objectKeys(this.shape))}}ZodObject.create=(e,t)=>new ZodObject({shape:()=>e,unknownKeys:"strip",catchall:ZodNever.create(),typeName:ZodFirstPartyTypeKind.ZodObject,...processCreateParams(t)}),ZodObject.strictCreate=(e,t)=>new ZodObject({shape:()=>e,unknownKeys:"strict",catchall:ZodNever.create(),typeName:ZodFirstPartyTypeKind.ZodObject,...processCreateParams(t)}),ZodObject.lazycreate=(e,t)=>new ZodObject({shape:e,unknownKeys:"strip",catchall:ZodNever.create(),typeName:ZodFirstPartyTypeKind.ZodObject,...processCreateParams(t)});class ZodUnion extends ZodType{_parse(e){const{ctx:t}=this._processInputParams(e),i=this._def.options;if(t.common.async)return Promise.all(i.map((async e=>{const i={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:i}),ctx:i}}))).then((function(e){for(const t of e)if("valid"===t.result.status)return t.result;for(const i of e)if("dirty"===i.result.status)return t.common.issues.push(...i.ctx.common.issues),i.result;const i=e.map((e=>new ZodError(e.ctx.common.issues)));return addIssueToContext(t,{code:ZodIssueCode.invalid_union,unionErrors:i}),INVALID}));{let e;const a=[];for(const r of i){const i={...t,common:{...t.common,issues:[]},parent:null},n=r._parseSync({data:t.data,path:t.path,parent:i});if("valid"===n.status)return n;"dirty"!==n.status||e||(e={result:n,ctx:i}),i.common.issues.length&&a.push(i.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;const r=a.map((e=>new ZodError(e)));return addIssueToContext(t,{code:ZodIssueCode.invalid_union,unionErrors:r}),INVALID}}get options(){return this._def.options}}ZodUnion.create=(e,t)=>new ZodUnion({options:e,typeName:ZodFirstPartyTypeKind.ZodUnion,...processCreateParams(t)});const getDiscriminator=e=>e instanceof ZodLazy?getDiscriminator(e.schema):e instanceof ZodEffects?getDiscriminator(e.innerType()):e instanceof ZodLiteral?[e.value]:e instanceof ZodEnum?e.options:e instanceof ZodNativeEnum?util$6.objectValues(e.enum):e instanceof ZodDefault?getDiscriminator(e._def.innerType):e instanceof ZodUndefined?[void 0]:e instanceof ZodNull?[null]:e instanceof ZodOptional?[void 0,...getDiscriminator(e.unwrap())]:e instanceof ZodNullable?[null,...getDiscriminator(e.unwrap())]:e instanceof ZodBranded||e instanceof ZodReadonly?getDiscriminator(e.unwrap()):e instanceof ZodCatch?getDiscriminator(e._def.innerType):[];class ZodDiscriminatedUnion extends ZodType{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==ZodParsedType.object)return addIssueToContext(t,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.object,received:t.parsedType}),INVALID;const i=this.discriminator,a=t.data[i],r=this.optionsMap.get(a);return r?t.common.async?r._parseAsync({data:t.data,path:t.path,parent:t}):r._parseSync({data:t.data,path:t.path,parent:t}):(addIssueToContext(t,{code:ZodIssueCode.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[i]}),INVALID)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,i){const a=new Map;for(const i of t){const t=getDiscriminator(i.shape[e]);if(!t.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const r of t){if(a.has(r))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(r)}`);a.set(r,i)}}return new ZodDiscriminatedUnion({typeName:ZodFirstPartyTypeKind.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:a,...processCreateParams(i)})}}function mergeValues(e,t){const i=getParsedType(e),a=getParsedType(t);if(e===t)return{valid:!0,data:e};if(i===ZodParsedType.object&&a===ZodParsedType.object){const i=util$6.objectKeys(t),a=util$6.objectKeys(e).filter((e=>-1!==i.indexOf(e))),r={...e,...t};for(const i of a){const a=mergeValues(e[i],t[i]);if(!a.valid)return{valid:!1};r[i]=a.data}return{valid:!0,data:r}}if(i===ZodParsedType.array&&a===ZodParsedType.array){if(e.length!==t.length)return{valid:!1};const i=[];for(let a=0;a<e.length;a++){const r=mergeValues(e[a],t[a]);if(!r.valid)return{valid:!1};i.push(r.data)}return{valid:!0,data:i}}return i===ZodParsedType.date&&a===ZodParsedType.date&&+e==+t?{valid:!0,data:e}:{valid:!1}}class ZodIntersection extends ZodType{_parse(e){const{status:t,ctx:i}=this._processInputParams(e),a=(e,a)=>{if(isAborted(e)||isAborted(a))return INVALID;const r=mergeValues(e.value,a.value);return r.valid?((isDirty(e)||isDirty(a))&&t.dirty(),{status:t.value,value:r.data}):(addIssueToContext(i,{code:ZodIssueCode.invalid_intersection_types}),INVALID)};return i.common.async?Promise.all([this._def.left._parseAsync({data:i.data,path:i.path,parent:i}),this._def.right._parseAsync({data:i.data,path:i.path,parent:i})]).then((([e,t])=>a(e,t))):a(this._def.left._parseSync({data:i.data,path:i.path,parent:i}),this._def.right._parseSync({data:i.data,path:i.path,parent:i}))}}ZodIntersection.create=(e,t,i)=>new ZodIntersection({left:e,right:t,typeName:ZodFirstPartyTypeKind.ZodIntersection,...processCreateParams(i)});class ZodTuple extends ZodType{_parse(e){const{status:t,ctx:i}=this._processInputParams(e);if(i.parsedType!==ZodParsedType.array)return addIssueToContext(i,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.array,received:i.parsedType}),INVALID;if(i.data.length<this._def.items.length)return addIssueToContext(i,{code:ZodIssueCode.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),INVALID;!this._def.rest&&i.data.length>this._def.items.length&&(addIssueToContext(i,{code:ZodIssueCode.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const a=[...i.data].map(((e,t)=>{const a=this._def.items[t]||this._def.rest;return a?a._parse(new ParseInputLazyPath(i,e,i.path,t)):null})).filter((e=>!!e));return i.common.async?Promise.all(a).then((e=>ParseStatus.mergeArray(t,e))):ParseStatus.mergeArray(t,a)}get items(){return this._def.items}rest(e){return new ZodTuple({...this._def,rest:e})}}ZodTuple.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new ZodTuple({items:e,typeName:ZodFirstPartyTypeKind.ZodTuple,rest:null,...processCreateParams(t)})};class ZodRecord extends ZodType{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:i}=this._processInputParams(e);if(i.parsedType!==ZodParsedType.object)return addIssueToContext(i,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.object,received:i.parsedType}),INVALID;const a=[],r=this._def.keyType,n=this._def.valueType;for(const e in i.data)a.push({key:r._parse(new ParseInputLazyPath(i,e,i.path,e)),value:n._parse(new ParseInputLazyPath(i,i.data[e],i.path,e)),alwaysSet:e in i.data});return i.common.async?ParseStatus.mergeObjectAsync(t,a):ParseStatus.mergeObjectSync(t,a)}get element(){return this._def.valueType}static create(e,t,i){return new ZodRecord(t instanceof ZodType?{keyType:e,valueType:t,typeName:ZodFirstPartyTypeKind.ZodRecord,...processCreateParams(i)}:{keyType:ZodString.create(),valueType:e,typeName:ZodFirstPartyTypeKind.ZodRecord,...processCreateParams(t)})}}class ZodMap extends ZodType{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:i}=this._processInputParams(e);if(i.parsedType!==ZodParsedType.map)return addIssueToContext(i,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.map,received:i.parsedType}),INVALID;const a=this._def.keyType,r=this._def.valueType,n=[...i.data.entries()].map((([e,t],n)=>({key:a._parse(new ParseInputLazyPath(i,e,i.path,[n,"key"])),value:r._parse(new ParseInputLazyPath(i,t,i.path,[n,"value"]))})));if(i.common.async){const e=new Map;return Promise.resolve().then((async()=>{for(const i of n){const a=await i.key,r=await i.value;if("aborted"===a.status||"aborted"===r.status)return INVALID;"dirty"!==a.status&&"dirty"!==r.status||t.dirty(),e.set(a.value,r.value)}return{status:t.value,value:e}}))}{const e=new Map;for(const i of n){const a=i.key,r=i.value;if("aborted"===a.status||"aborted"===r.status)return INVALID;"dirty"!==a.status&&"dirty"!==r.status||t.dirty(),e.set(a.value,r.value)}return{status:t.value,value:e}}}}ZodMap.create=(e,t,i)=>new ZodMap({valueType:t,keyType:e,typeName:ZodFirstPartyTypeKind.ZodMap,...processCreateParams(i)});class ZodSet extends ZodType{_parse(e){const{status:t,ctx:i}=this._processInputParams(e);if(i.parsedType!==ZodParsedType.set)return addIssueToContext(i,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.set,received:i.parsedType}),INVALID;const a=this._def;null!==a.minSize&&i.data.size<a.minSize.value&&(addIssueToContext(i,{code:ZodIssueCode.too_small,minimum:a.minSize.value,type:"set",inclusive:!0,exact:!1,message:a.minSize.message}),t.dirty()),null!==a.maxSize&&i.data.size>a.maxSize.value&&(addIssueToContext(i,{code:ZodIssueCode.too_big,maximum:a.maxSize.value,type:"set",inclusive:!0,exact:!1,message:a.maxSize.message}),t.dirty());const r=this._def.valueType;function n(e){const i=new Set;for(const a of e){if("aborted"===a.status)return INVALID;"dirty"===a.status&&t.dirty(),i.add(a.value)}return{status:t.value,value:i}}const s=[...i.data.values()].map(((e,t)=>r._parse(new ParseInputLazyPath(i,e,i.path,t))));return i.common.async?Promise.all(s).then((e=>n(e))):n(s)}min(e,t){return new ZodSet({...this._def,minSize:{value:e,message:errorUtil.toString(t)}})}max(e,t){return new ZodSet({...this._def,maxSize:{value:e,message:errorUtil.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}ZodSet.create=(e,t)=>new ZodSet({valueType:e,minSize:null,maxSize:null,typeName:ZodFirstPartyTypeKind.ZodSet,...processCreateParams(t)});class ZodFunction extends ZodType{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==ZodParsedType.function)return addIssueToContext(t,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.function,received:t.parsedType}),INVALID;function i(e,i){return makeIssue({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,getErrorMap(),errorMap].filter((e=>!!e)),issueData:{code:ZodIssueCode.invalid_arguments,argumentsError:i}})}function a(e,i){return makeIssue({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,getErrorMap(),errorMap].filter((e=>!!e)),issueData:{code:ZodIssueCode.invalid_return_type,returnTypeError:i}})}const r={errorMap:t.common.contextualErrorMap},n=t.data;if(this._def.returns instanceof ZodPromise){const e=this;return OK((async function(...t){const s=new ZodError([]),o=await e._def.args.parseAsync(t,r).catch((e=>{throw s.addIssue(i(t,e)),s})),l=await Reflect.apply(n,this,o);return await e._def.returns._def.type.parseAsync(l,r).catch((e=>{throw s.addIssue(a(l,e)),s}))}))}{const e=this;return OK((function(...t){const s=e._def.args.safeParse(t,r);if(!s.success)throw new ZodError([i(t,s.error)]);const o=Reflect.apply(n,this,s.data),l=e._def.returns.safeParse(o,r);if(!l.success)throw new ZodError([a(o,l.error)]);return l.data}))}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new ZodFunction({...this._def,args:ZodTuple.create(e).rest(ZodUnknown.create())})}returns(e){return new ZodFunction({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,i){return new ZodFunction({args:e||ZodTuple.create([]).rest(ZodUnknown.create()),returns:t||ZodUnknown.create(),typeName:ZodFirstPartyTypeKind.ZodFunction,...processCreateParams(i)})}}class ZodLazy extends ZodType{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}ZodLazy.create=(e,t)=>new ZodLazy({getter:e,typeName:ZodFirstPartyTypeKind.ZodLazy,...processCreateParams(t)});class ZodLiteral extends ZodType{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return addIssueToContext(t,{received:t.data,code:ZodIssueCode.invalid_literal,expected:this._def.value}),INVALID}return{status:"valid",value:e.data}}get value(){return this._def.value}}function createZodEnum(e,t){return new ZodEnum({values:e,typeName:ZodFirstPartyTypeKind.ZodEnum,...processCreateParams(t)})}ZodLiteral.create=(e,t)=>new ZodLiteral({value:e,typeName:ZodFirstPartyTypeKind.ZodLiteral,...processCreateParams(t)});class ZodEnum extends ZodType{constructor(){super(...arguments),_ZodEnum_cache.set(this,void 0)}_parse(e){if("string"!=typeof e.data){const t=this._getOrReturnCtx(e),i=this._def.values;return addIssueToContext(t,{expected:util$6.joinValues(i),received:t.parsedType,code:ZodIssueCode.invalid_type}),INVALID}if(__classPrivateFieldGet(this,_ZodEnum_cache,"f")||__classPrivateFieldSet(this,_ZodEnum_cache,new Set(this._def.values),"f"),!__classPrivateFieldGet(this,_ZodEnum_cache,"f").has(e.data)){const t=this._getOrReturnCtx(e),i=this._def.values;return addIssueToContext(t,{received:t.data,code:ZodIssueCode.invalid_enum_value,options:i}),INVALID}return OK(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return ZodEnum.create(e,{...this._def,...t})}exclude(e,t=this._def){return ZodEnum.create(this.options.filter((t=>!e.includes(t))),{...this._def,...t})}}_ZodEnum_cache=new WeakMap,ZodEnum.create=createZodEnum;class ZodNativeEnum extends ZodType{constructor(){super(...arguments),_ZodNativeEnum_cache.set(this,void 0)}_parse(e){const t=util$6.getValidEnumValues(this._def.values),i=this._getOrReturnCtx(e);if(i.parsedType!==ZodParsedType.string&&i.parsedType!==ZodParsedType.number){const e=util$6.objectValues(t);return addIssueToContext(i,{expected:util$6.joinValues(e),received:i.parsedType,code:ZodIssueCode.invalid_type}),INVALID}if(__classPrivateFieldGet(this,_ZodNativeEnum_cache,"f")||__classPrivateFieldSet(this,_ZodNativeEnum_cache,new Set(util$6.getValidEnumValues(this._def.values)),"f"),!__classPrivateFieldGet(this,_ZodNativeEnum_cache,"f").has(e.data)){const e=util$6.objectValues(t);return addIssueToContext(i,{received:i.data,code:ZodIssueCode.invalid_enum_value,options:e}),INVALID}return OK(e.data)}get enum(){return this._def.values}}_ZodNativeEnum_cache=new WeakMap,ZodNativeEnum.create=(e,t)=>new ZodNativeEnum({values:e,typeName:ZodFirstPartyTypeKind.ZodNativeEnum,...processCreateParams(t)});class ZodPromise extends ZodType{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==ZodParsedType.promise&&!1===t.common.async)return addIssueToContext(t,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.promise,received:t.parsedType}),INVALID;const i=t.parsedType===ZodParsedType.promise?t.data:Promise.resolve(t.data);return OK(i.then((e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap}))))}}ZodPromise.create=(e,t)=>new ZodPromise({type:e,typeName:ZodFirstPartyTypeKind.ZodPromise,...processCreateParams(t)});class ZodEffects extends ZodType{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===ZodFirstPartyTypeKind.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:i}=this._processInputParams(e),a=this._def.effect||null,r={addIssue:e=>{addIssueToContext(i,e),e.fatal?t.abort():t.dirty()},get path(){return i.path}};if(r.addIssue=r.addIssue.bind(r),"preprocess"===a.type){const e=a.transform(i.data,r);if(i.common.async)return Promise.resolve(e).then((async e=>{if("aborted"===t.value)return INVALID;const a=await this._def.schema._parseAsync({data:e,path:i.path,parent:i});return"aborted"===a.status?INVALID:"dirty"===a.status||"dirty"===t.value?DIRTY(a.value):a}));{if("aborted"===t.value)return INVALID;const a=this._def.schema._parseSync({data:e,path:i.path,parent:i});return"aborted"===a.status?INVALID:"dirty"===a.status||"dirty"===t.value?DIRTY(a.value):a}}if("refinement"===a.type){const e=e=>{const t=a.refinement(e,r);if(i.common.async)return Promise.resolve(t);if(t instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1===i.common.async){const a=this._def.schema._parseSync({data:i.data,path:i.path,parent:i});return"aborted"===a.status?INVALID:("dirty"===a.status&&t.dirty(),e(a.value),{status:t.value,value:a.value})}return this._def.schema._parseAsync({data:i.data,path:i.path,parent:i}).then((i=>"aborted"===i.status?INVALID:("dirty"===i.status&&t.dirty(),e(i.value).then((()=>({status:t.value,value:i.value}))))))}if("transform"===a.type){if(!1===i.common.async){const e=this._def.schema._parseSync({data:i.data,path:i.path,parent:i});if(!isValid(e))return e;const n=a.transform(e.value,r);if(n instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:n}}return this._def.schema._parseAsync({data:i.data,path:i.path,parent:i}).then((e=>isValid(e)?Promise.resolve(a.transform(e.value,r)).then((e=>({status:t.value,value:e}))):e))}util$6.assertNever(a)}}ZodEffects.create=(e,t,i)=>new ZodEffects({schema:e,typeName:ZodFirstPartyTypeKind.ZodEffects,effect:t,...processCreateParams(i)}),ZodEffects.createWithPreprocess=(e,t,i)=>new ZodEffects({schema:t,effect:{type:"preprocess",transform:e},typeName:ZodFirstPartyTypeKind.ZodEffects,...processCreateParams(i)});class ZodOptional extends ZodType{_parse(e){return this._getType(e)===ZodParsedType.undefined?OK(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}ZodOptional.create=(e,t)=>new ZodOptional({innerType:e,typeName:ZodFirstPartyTypeKind.ZodOptional,...processCreateParams(t)});class ZodNullable extends ZodType{_parse(e){return this._getType(e)===ZodParsedType.null?OK(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}ZodNullable.create=(e,t)=>new ZodNullable({innerType:e,typeName:ZodFirstPartyTypeKind.ZodNullable,...processCreateParams(t)});class ZodDefault extends ZodType{_parse(e){const{ctx:t}=this._processInputParams(e);let i=t.data;return t.parsedType===ZodParsedType.undefined&&(i=this._def.defaultValue()),this._def.innerType._parse({data:i,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}ZodDefault.create=(e,t)=>new ZodDefault({innerType:e,typeName:ZodFirstPartyTypeKind.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...processCreateParams(t)});class ZodCatch extends ZodType{_parse(e){const{ctx:t}=this._processInputParams(e),i={...t,common:{...t.common,issues:[]}},a=this._def.innerType._parse({data:i.data,path:i.path,parent:{...i}});return isAsync(a)?a.then((e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new ZodError(i.common.issues)},input:i.data})}))):{status:"valid",value:"valid"===a.status?a.value:this._def.catchValue({get error(){return new ZodError(i.common.issues)},input:i.data})}}removeCatch(){return this._def.innerType}}ZodCatch.create=(e,t)=>new ZodCatch({innerType:e,typeName:ZodFirstPartyTypeKind.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,...processCreateParams(t)});class ZodNaN extends ZodType{_parse(e){if(this._getType(e)!==ZodParsedType.nan){const t=this._getOrReturnCtx(e);return addIssueToContext(t,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.nan,received:t.parsedType}),INVALID}return{status:"valid",value:e.data}}}ZodNaN.create=e=>new ZodNaN({typeName:ZodFirstPartyTypeKind.ZodNaN,...processCreateParams(e)});const BRAND=Symbol("zod_brand");class ZodBranded extends ZodType{_parse(e){const{ctx:t}=this._processInputParams(e),i=t.data;return this._def.type._parse({data:i,path:t.path,parent:t})}unwrap(){return this._def.type}}class ZodPipeline extends ZodType{_parse(e){const{status:t,ctx:i}=this._processInputParams(e);if(i.common.async){return(async()=>{const e=await this._def.in._parseAsync({data:i.data,path:i.path,parent:i});return"aborted"===e.status?INVALID:"dirty"===e.status?(t.dirty(),DIRTY(e.value)):this._def.out._parseAsync({data:e.value,path:i.path,parent:i})})()}{const e=this._def.in._parseSync({data:i.data,path:i.path,parent:i});return"aborted"===e.status?INVALID:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:i.path,parent:i})}}static create(e,t){return new ZodPipeline({in:e,out:t,typeName:ZodFirstPartyTypeKind.ZodPipeline})}}class ZodReadonly extends ZodType{_parse(e){const t=this._def.innerType._parse(e),i=e=>(isValid(e)&&(e.value=Object.freeze(e.value)),e);return isAsync(t)?t.then((e=>i(e))):i(t)}unwrap(){return this._def.innerType}}function custom(e,t={},i){return e?ZodAny.create().superRefine(((a,r)=>{var n,s;if(!e(a)){const e="function"==typeof t?t(a):"string"==typeof t?{message:t}:t,o=null===(s=null!==(n=e.fatal)&&void 0!==n?n:i)||void 0===s||s,l="string"==typeof e?{message:e}:e;r.addIssue({code:"custom",...l,fatal:o})}})):ZodAny.create()}ZodReadonly.create=(e,t)=>new ZodReadonly({innerType:e,typeName:ZodFirstPartyTypeKind.ZodReadonly,...processCreateParams(t)});const late={object:ZodObject.lazycreate};var ZodFirstPartyTypeKind;!function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"}(ZodFirstPartyTypeKind||(ZodFirstPartyTypeKind={}));const instanceOfType=(e,t={message:`Input not instance of ${e.name}`})=>custom((t=>t instanceof e),t),stringType=ZodString.create,numberType=ZodNumber.create,nanType=ZodNaN.create,bigIntType=ZodBigInt.create,booleanType=ZodBoolean.create,dateType=ZodDate.create,symbolType=ZodSymbol.create,undefinedType=ZodUndefined.create,nullType=ZodNull.create,anyType=ZodAny.create,unknownType=ZodUnknown.create,neverType=ZodNever.create,voidType=ZodVoid.create,arrayType=ZodArray.create,objectType=ZodObject.create,strictObjectType=ZodObject.strictCreate,unionType=ZodUnion.create,discriminatedUnionType=ZodDiscriminatedUnion.create,intersectionType=ZodIntersection.create,tupleType=ZodTuple.create,recordType=ZodRecord.create,mapType=ZodMap.create,setType=ZodSet.create,functionType=ZodFunction.create,lazyType=ZodLazy.create,literalType=ZodLiteral.create,enumType=ZodEnum.create,nativeEnumType=ZodNativeEnum.create,promiseType=ZodPromise.create,effectsType=ZodEffects.create,optionalType=ZodOptional.create,nullableType=ZodNullable.create,preprocessType=ZodEffects.createWithPreprocess,pipelineType=ZodPipeline.create,ostring=()=>stringType().optional(),onumber=()=>numberType().optional(),oboolean=()=>booleanType().optional(),coerce={string:e=>ZodString.create({...e,coerce:!0}),number:e=>ZodNumber.create({...e,coerce:!0}),boolean:e=>ZodBoolean.create({...e,coerce:!0}),bigint:e=>ZodBigInt.create({...e,coerce:!0}),date:e=>ZodDate.create({...e,coerce:!0})},NEVER=INVALID;var z=Object.freeze({__proto__:null,defaultErrorMap:errorMap,setErrorMap:setErrorMap,getErrorMap:getErrorMap,makeIssue:makeIssue,EMPTY_PATH:EMPTY_PATH,addIssueToContext:addIssueToContext,ParseStatus:ParseStatus,INVALID:INVALID,DIRTY:DIRTY,OK:OK,isAborted:isAborted,isDirty:isDirty,isValid:isValid,isAsync:isAsync,get util(){return util$6},get objectUtil(){return objectUtil},ZodParsedType:ZodParsedType,getParsedType:getParsedType,ZodType:ZodType,datetimeRegex:datetimeRegex,ZodString:ZodString,ZodNumber:ZodNumber,ZodBigInt:ZodBigInt,ZodBoolean:ZodBoolean,ZodDate:ZodDate,ZodSymbol:ZodSymbol,ZodUndefined:ZodUndefined,ZodNull:ZodNull,ZodAny:ZodAny,ZodUnknown:ZodUnknown,ZodNever:ZodNever,ZodVoid:ZodVoid,ZodArray:ZodArray,ZodObject:ZodObject,ZodUnion:ZodUnion,ZodDiscriminatedUnion:ZodDiscriminatedUnion,ZodIntersection:ZodIntersection,ZodTuple:ZodTuple,ZodRecord:ZodRecord,ZodMap:ZodMap,ZodSet:ZodSet,ZodFunction:ZodFunction,ZodLazy:ZodLazy,ZodLiteral:ZodLiteral,ZodEnum:ZodEnum,ZodNativeEnum:ZodNativeEnum,ZodPromise:ZodPromise,ZodEffects:ZodEffects,ZodTransformer:ZodEffects,ZodOptional:ZodOptional,ZodNullable:ZodNullable,ZodDefault:ZodDefault,ZodCatch:ZodCatch,ZodNaN:ZodNaN,BRAND:BRAND,ZodBranded:ZodBranded,ZodPipeline:ZodPipeline,ZodReadonly:ZodReadonly,custom:custom,Schema:ZodType,ZodSchema:ZodType,late:late,get ZodFirstPartyTypeKind(){return ZodFirstPartyTypeKind},coerce:coerce,any:anyType,array:arrayType,bigint:bigIntType,boolean:booleanType,date:dateType,discriminatedUnion:discriminatedUnionType,effect:effectsType,enum:enumType,function:functionType,instanceof:instanceOfType,intersection:intersectionType,lazy:lazyType,literal:literalType,map:mapType,nan:nanType,nativeEnum:nativeEnumType,never:neverType,null:nullType,nullable:nullableType,number:numberType,object:objectType,oboolean:oboolean,onumber:onumber,optional:optionalType,ostring:ostring,pipeline:pipelineType,preprocess:preprocessType,promise:promiseType,record:recordType,set:setType,strictObject:strictObjectType,string:stringType,symbol:symbolType,transformer:effectsType,tuple:tupleType,undefined:undefinedType,union:unionType,unknown:unknownType,void:voidType,NEVER:NEVER,ZodIssueCode:ZodIssueCode,quotelessJson:quotelessJson,ZodError:ZodError}),APP_EXTENSION_TYPES=["interface","display","layout","module","panel","theme"],API_EXTENSION_TYPES=["hook","endpoint"],HYBRID_EXTENSION_TYPES=["operation"],BUNDLE_EXTENSION_TYPES=["bundle"],EXTENSION_PKG_KEY="directus:extension",SplitEntrypoint=z.object({app:z.string(),api:z.string()}),ExtensionSandboxRequestedScopes=z.object({request:z.optional(z.object({urls:z.array(z.string()),methods:z.array(z.union([z.literal("GET"),z.literal("POST"),z.literal("PATCH"),z.literal("PUT"),z.literal("DELETE")]))})),log:z.optional(z.object({})),sleep:z.optional(z.object({}))}),ExtensionSandboxOptions=z.optional(z.object({enabled:z.boolean(),requestedScopes:ExtensionSandboxRequestedScopes})),ExtensionOptionsBundleEntry=z.union([z.object({type:z.enum(API_EXTENSION_TYPES),name:z.string(),source:z.string()}),z.object({type:z.enum(APP_EXTENSION_TYPES),name:z.string(),source:z.string()}),z.object({type:z.enum(HYBRID_EXTENSION_TYPES),name:z.string(),source:SplitEntrypoint})]),ExtensionOptionsBase=z.object({host:z.string(),hidden:z.boolean().optional()}),ExtensionOptionsApp=z.object({type:z.enum(APP_EXTENSION_TYPES),path:z.string(),source:z.string()}),ExtensionOptionsApi=z.object({type:z.enum(API_EXTENSION_TYPES),path:z.string(),source:z.string(),sandbox:ExtensionSandboxOptions}),ExtensionOptionsHybrid=z.object({type:z.enum(HYBRID_EXTENSION_TYPES),path:SplitEntrypoint,source:SplitEntrypoint,sandbox:ExtensionSandboxOptions}),ExtensionOptionsBundle=z.object({type:z.literal("bundle"),partial:z.boolean().optional(),path:SplitEntrypoint,entries:z.array(ExtensionOptionsBundleEntry)});z.array(ExtensionOptionsBundleEntry);var ExtensionOptions=ExtensionOptionsBase.and(z.union([ExtensionOptionsApp,ExtensionOptionsApi,ExtensionOptionsHybrid,ExtensionOptionsBundle]));function defineOperationApi(e){return e}z.object({name:z.string(),version:z.string(),type:z.union([z.literal("module"),z.literal("commonjs")]).optional(),description:z.string().optional(),icon:z.string().optional(),dependencies:z.record(z.string()).optional(),devDependencies:z.record(z.string()).optional(),[EXTENSION_PKG_KEY]:ExtensionOptions});const IMGPROXY_KEY="fa370f19b0bf2fb55b52c8264ed52d4c2664f183164c4649ac74971e028746967edc51822a2274dff6b2cd231f2eb2a046a7268cfeeb24e30b277b0fb7442529",IMGPROXY_SALT="8404322f8278302c278400bd95a60c480aca980fa0de5e73f8bb35c3af7cae0b83edaeb615df99397e973906e912a93fa275b2ae5a07ebb699534b390c610c02";class ProxyService{static baseUrl="s3://s3-daily-drip-015812eb-e529-49ee-b23a-d95053fe9ef9";static proxyUrl="https://images.dailydrip.news";static getImage(e,t,i){let a="";t&&t.forEach((e=>{a+=`/${e.key}`,e.params.forEach((e=>{a+=`:${e}`}))}));let r=a+"/"+btoa(this.baseUrl+e);return null!=i&&(r+="."+i),`${ProxyService.proxyUrl}${sign(r)}`}}const hexDecode=e=>Buffer.from(e,"hex");function sign(e){const t=node_crypto.createHmac("sha256",hexDecode(IMGPROXY_KEY));t.update(hexDecode(IMGPROXY_SALT)),t.update(e);return`/${t.digest("base64url")}${e}`}const EXTRACTOR_PIXELS_DEFAULT=64e3,EXTRACTOR_DISTANCE_DEFAULT=.22,AVERAGE_HUE_DEFAULT=1/12,AVERAGE_SATURATION_DEFAULT=.2,AVERAGE_LIGHTNESS_DEFAULT=.2,cleanInputs=({pixels:e=EXTRACTOR_PIXELS_DEFAULT,distance:t=EXTRACTOR_DISTANCE_DEFAULT,colorValidator:i=(e,t,i,a)=>(a??255)>250,hueDistance:a=AVERAGE_HUE_DEFAULT,saturationDistance:r=AVERAGE_LIGHTNESS_DEFAULT,lightnessDistance:n=AVERAGE_SATURATION_DEFAULT,crossOrigin:s="",requestMode:o="cors"}={})=>[Math.max(e,1),Math.min(Math.max(t,0),1),i,Math.min(Math.max(a,0),1),Math.min(Math.max(r,0),1),Math.min(Math.max(n,0),1),s,o];class Color{constructor(e,t,i,a=e<<16|t<<8|i){this._count=1,this.__saturation=-1,this.__hue=-1,this.__lightness=-1,this.__intensity=-1,this._red=e,this._green=t,this._blue=i,this._hex=a}static distance(e,t){return(Math.abs(t._red-e._red)+Math.abs(t._green-e._green)+Math.abs(t._blue-e._blue))/765}clone(){const e=new Color(this._red,this._green,this._blue,this._hex);return e._count=this._count,e}updateHSL(){const e=this._red/255,t=this._green/255,i=this._blue/255,a=Math.max(e,t,i),r=Math.min(e,t,i);if(this.__lightness=(a+r)/2,a===r)this.__hue=0,this.__saturation=0,this.__intensity=0;else{const n=a-r;switch(this.__saturation=this.__lightness>.5?n/(2-a-r):n/(a+r),this.__intensity=this.__saturation*(2*(.5-Math.abs(.5-this.__lightness))),a){case e:this.__hue=((t-i)/n+(t<i?6:0))/6;break;case t:this.__hue=((i-e)/n+2)/6;break;case i:this.__hue=((e-t)/n+4)/6}}}get _hue(){return-1===this.__hue&&this.updateHSL(),this.__hue}get _saturation(){return-1===this.__saturation&&this.updateHSL(),this.__saturation}get _lightness(){return-1===this.__lightness&&this.updateHSL(),this.__lightness}get _intensity(){return-1===this.__intensity&&this.updateHSL(),this.__intensity}}class LeafGroup{constructor(){this._count=0,this._children={}}addColor(e,t,i,a){return this._count++,this._children[e]?this._children[e]._count++:this._children[e]=new Color(t,i,a,e),this._children[e]}getList(){return Object.keys(this._children).map((e=>this._children[e]))}createMainColor(){const e=this.getList().reduce(((e,t)=>e._count>=t._count?e:t)).clone();return e._count=this._count,e}}class RootGroup{constructor(){this._count=0,this._children={}}getList(){return Object.keys(this._children).map((e=>this._children[e]))}addColor(e,t,i){const a=e<<16|t<<8|i,r=(e>>4&15)<<8|(t>>4&15)<<4|i>>4&15;return this._count++,this.getLeafGroup(r).addColor(a,e,t,i)}getLeafGroup(e){return this._children[e]||(this._children[e]=new LeafGroup),this._children[e]}getColors(e){const t=this.getList().map((e=>e.createMainColor()));t.sort(((e,t)=>t._count-e._count));const i=[];for(;t.length;){const a=t.shift();t.filter((t=>Color.distance(a,t)<e)).forEach((e=>{a._count+=e._count;const i=t.findIndex((t=>t===e));t.splice(i,1)})),i.push(a)}return i}}const extractor=({data:e,width:t,height:i},a,r,n)=>{const s=new RootGroup,o=t&&i&&Math.floor(t*i/a)||1;let l=0;for(let t=0;t<e.length;t+=4*o){const i=e[t],a=e[t+1],r=e[t+2];n(i,a,r,e[t+3])?s.addColor(i,a,r):l++}return{colors:s.getColors(r),count:s._count+l}},distance=(e,t)=>Math.abs(e-t),hueDistance=(e,t)=>Math.min(distance(e,t),distance((e+.5)%1,(t+.5)%1));class AverageGroup{constructor(){this.colors=[],this._average=null}addColor(e){this.colors.push(e),this._average=null}isSamePalette(e,t,i,a){for(const r of this.colors){if(!(hueDistance(r._hue,e._hue)<t&&distance(r._saturation,e._saturation)<i&&distance(r._lightness,e._lightness)<a))return!1}return!0}get average(){if(!this._average){const{r:e,g:t,b:i}=this.colors.reduce(((e,t)=>(e.r+=t._red,e.g+=t._green,e.b+=t._blue,e)),{r:0,g:0,b:0}),a=this.colors.reduce(((e,t)=>e+t._count),0);this._average=new Color(Math.round(e/this.colors.length),Math.round(t/this.colors.length),Math.round(i/this.colors.length)),this._average._count=a}return this._average}}class AverageManager{constructor(e,t,i){this._groups=[],this._hue=e,this._saturation=t,this._lightness=i}addColor(e){const t=this._groups.find((t=>t.isSamePalette(e,this._hue,this._saturation,this._lightness)));if(t)t.addColor(e);else{const t=new AverageGroup;t.addColor(e),this._groups.push(t)}}getGroups(){return this._groups.map((e=>e.average))}}const sortColors=(e,t,i,a,r)=>{const n=new AverageManager(i,a,r);e.forEach((e=>n.addColor(e)));const s=n.getGroups();return s.sort(((e,i)=>(i._intensity+.1)*(.9-i._count/t)-(e._intensity+.1)*(.9-e._count/t))),s},createFinalColor=(e,t)=>({hex:`#${"0".repeat(6-e._hex.toString(16).length)}${e._hex.toString(16)}`,red:e._red,green:e._green,blue:e._blue,area:e._count/t,hue:e._hue,saturation:e._saturation,lightness:e._lightness,intensity:e._intensity}),checkIsBrowser=()=>"undefined"!=typeof window&&void 0!==window.document,checkIsWorker=()=>"object"==typeof self&&self.constructor&&"DedicatedWorkerGlobalScope"===self.constructor.name,checkIsNode=()=>"undefined"==typeof window&&"undefined"!=typeof process&&null!=process.versions&&null!=process.versions.node,sortFinalColors=(e,t,i,a,r)=>sortColors(e,t,i,a,r).map((e=>createFinalColor(e,t))),extractImageData=(e,t)=>{const i=e.width*e.height,a=i<t?e.width:Math.round(e.width*Math.sqrt(t/i)),r=i<t?e.height:Math.round(e.height*Math.sqrt(t/i)),n=((e,t)=>{if(checkIsWorker())return new OffscreenCanvas(e,t);const i=document.createElement("canvas");return i.width=e,i.height=t,i})(a,r).getContext("2d");return n.drawImage(e,0,0,e.width,e.height,0,0,a,r),n.getImageData(0,0,a,r)},extractColorsFromImageData=(e,t={})=>{const[i,a,r,n,s,o]=cleanInputs(t),{colors:l,count:u}=extractor(e,i,a,r);return sortFinalColors(l,u,n,s,o)},extractColorsFromImage=async(e,t={})=>{if(checkIsNode())return[];const[i,a,r,n,s,o,l]=cleanInputs(t);return e.crossOrigin=l,new Promise((t=>{const l=e=>{const l=extractImageData(e,i),{colors:u,count:h}=extractor(l,i,a,r);t(sortFinalColors(u,h,n,s,o))};if(e.complete)l(e);else{const t=()=>{e.removeEventListener("load",t),l(e)};e.addEventListener("load",t)}}))},extractColorsFromImageBitmap=async(e,t={})=>{if(checkIsNode())return[];const[i,a,r,n,s,o]=cleanInputs(t),l=extractImageData(e,i),{colors:u,count:h}=extractor(l,i,a,r);return sortFinalColors(u,h,n,s,o)},extractColorsFromSrc=async(e,t={})=>{if(checkIsNode())return[];if(checkIsWorker()){const i=cleanInputs(t),a=await fetch(e,{mode:i[7]}),r=await a.blob(),n=await createImageBitmap(r),s=await extractColorsFromImageBitmap(n,t);return n.close(),s}const i=new Image;return i.src=e,extractColorsFromImage(i,t)},extractColors=(e,t)=>{if(checkIsBrowser()){if(e instanceof Image)return extractColorsFromImage(e,t);if(e instanceof ImageData||e instanceof Object&&e.data)return new Promise((i=>{i(extractColorsFromImageData(e,t))}));if("string"==typeof e)return extractColorsFromSrc(e,t)}if(checkIsWorker()){if(e instanceof ImageData||e instanceof Object&&e.data)return new Promise((i=>{i(extractColorsFromImageData(e,t))}));if("string"==typeof e)return extractColorsFromSrc(e,t);if(e.src)return extractColorsFromSrc(e.src,t)}if(checkIsNode())return new Promise((i=>{i(extractColorsFromImageData(e,t))}));throw new Error("Can not analyse picture")};var HeaderTypes;!function(e){e[e.BITMAP_INFO_HEADER=40]="BITMAP_INFO_HEADER",e[e.BITMAP_V2_INFO_HEADER=52]="BITMAP_V2_INFO_HEADER",e[e.BITMAP_V3_INFO_HEADER=56]="BITMAP_V3_INFO_HEADER",e[e.BITMAP_V4_HEADER=108]="BITMAP_V4_HEADER",e[e.BITMAP_V5_HEADER=124]="BITMAP_V5_HEADER"}(HeaderTypes||(HeaderTypes={}));var HeaderTypes$1=HeaderTypes,BmpCompression;function maskColor(e,t,i,a){const r=1+~e&e,n=1+~t&t,s=1+~i&i,o=1+~a&a,l=e/r+1,u=t/n+1,h=i/s+1,c=a/o+1;return{shiftRed:t=>(t&e)/r*256/l,shiftGreen:e=>(e&t)/n*256/u,shiftBlue:e=>(e&i)/s*256/h,shiftAlpha:0!==a?e=>(e&a)/o*256/c:()=>255}}!function(e){e[e.NONE=0]="NONE",e[e.BI_RLE8=1]="BI_RLE8",e[e.BI_RLE4=2]="BI_RLE4",e[e.BI_BIT_FIELDS=3]="BI_BIT_FIELDS",e[e.BI_ALPHA_BIT_FIELDS=6]="BI_ALPHA_BIT_FIELDS"}(BmpCompression||(BmpCompression={}));class BmpDecoder{flag;fileSize;reserved1;reserved2;offset;headerSize;width;height;planes;bitPP;compression;rawSize;hr;vr;colors;importantColors;palette;data;maskRed;maskGreen;maskBlue;maskAlpha;toRGBA;pos;bottomUp;buffer;locRed;locGreen;locBlue;locAlpha;shiftRed;shiftGreen;shiftBlue;shiftAlpha;constructor(e,{toRGBA:t}={toRGBA:!1}){if(this.buffer=e,this.toRGBA=!!t,this.pos=0,this.bottomUp=!0,this.flag=this.buffer.toString("utf-8",0,this.pos+=2),"BM"!==this.flag)throw new Error("Invalid BMP File");this.locRed=this.toRGBA?0:3,this.locGreen=this.toRGBA?1:2,this.locBlue=this.toRGBA?2:1,this.locAlpha=this.toRGBA?3:0,this.parseHeader(),this.parseRGBA()}parseHeader(){if(this.fileSize=this.readUInt32LE(),this.reserved1=this.buffer.readUInt16LE(this.pos),this.pos+=2,this.reserved2=this.buffer.readUInt16LE(this.pos),this.pos+=2,this.offset=this.readUInt32LE(),this.headerSize=this.readUInt32LE(),!(this.headerSize in HeaderTypes$1))throw new Error(`Unsupported BMP header size ${this.headerSize}`);if(this.width=this.readUInt32LE(),this.height=this.readUInt32LE(),this.height=this.height>2147483647?this.height-4294967296:this.height,this.planes=this.buffer.readUInt16LE(this.pos),this.pos+=2,this.bitPP=this.buffer.readUInt16LE(this.pos),this.pos+=2,this.compression=this.readUInt32LE(),this.rawSize=this.readUInt32LE(),this.hr=this.readUInt32LE(),this.vr=this.readUInt32LE(),this.colors=this.readUInt32LE(),this.importantColors=this.readUInt32LE(),32===this.bitPP?(this.maskAlpha=0,this.maskRed=16711680,this.maskGreen=65280,this.maskBlue=255):16===this.bitPP&&(this.maskAlpha=0,this.maskRed=31744,this.maskGreen=992,this.maskBlue=31),(this.headerSize>HeaderTypes$1.BITMAP_INFO_HEADER||this.compression===BmpCompression.BI_BIT_FIELDS||this.compression===BmpCompression.BI_ALPHA_BIT_FIELDS)&&(this.maskRed=this.readUInt32LE(),this.maskGreen=this.readUInt32LE(),this.maskBlue=this.readUInt32LE()),(this.headerSize>HeaderTypes$1.BITMAP_V2_INFO_HEADER||this.compression===BmpCompression.BI_ALPHA_BIT_FIELDS)&&(this.maskAlpha=this.readUInt32LE()),this.headerSize>HeaderTypes$1.BITMAP_V3_INFO_HEADER&&(this.pos+=HeaderTypes$1.BITMAP_V4_HEADER-HeaderTypes$1.BITMAP_V3_INFO_HEADER),this.headerSize>HeaderTypes$1.BITMAP_V4_HEADER&&(this.pos+=HeaderTypes$1.BITMAP_V5_HEADER-HeaderTypes$1.BITMAP_V4_HEADER),this.bitPP<=8||this.colors>0){const e=0===this.colors?1<<this.bitPP:this.colors;this.palette=new Array(e);for(let t=0;t<e;t++){const e=this.buffer.readUInt8(this.pos++),i=this.buffer.readUInt8(this.pos++),a=this.buffer.readUInt8(this.pos++),r=this.buffer.readUInt8(this.pos++);this.palette[t]={red:a,green:i,blue:e,quad:r}}}this.height<0&&(this.height*=-1,this.bottomUp=!1);const e=maskColor(this.maskRed,this.maskGreen,this.maskBlue,this.maskAlpha);this.shiftRed=e.shiftRed,this.shiftGreen=e.shiftGreen,this.shiftBlue=e.shiftBlue,this.shiftAlpha=e.shiftAlpha}parseRGBA(){switch(this.data=Buffer.alloc(this.width*this.height*4),this.bitPP){case 1:this.bit1();break;case 4:this.bit4();break;case 8:this.bit8();break;case 16:this.bit16();break;case 24:this.bit24();break;default:this.bit32()}}bit1(){const e=Math.ceil(this.width/8),t=e%4,i=0!==t?4-t:0;this.scanImage(i,e,((e,t)=>{const i=this.buffer.readUInt8(this.pos++),a=t*this.width*4+8*e*4;for(let t=0;t<8&&8*e+t<this.width;t++){const e=this.palette[i>>7-t&1];this.data[a+t*this.locAlpha]=0,this.data[a+4*t+this.locBlue]=e.blue,this.data[a+4*t+this.locGreen]=e.green,this.data[a+4*t+this.locRed]=e.red}}))}bit4(){if(this.compression===BmpCompression.BI_RLE4){this.data.fill(0);let e=!1,t=this.bottomUp?this.height-1:0,i=0;for(;i<this.data.length;){const a=this.buffer.readUInt8(this.pos++),r=this.buffer.readUInt8(this.pos++);if(0===a){if(0===r){t+=this.bottomUp?-1:1,i=t*this.width*4,e=!1;continue}if(1===r)break;if(2===r){const e=this.buffer.readUInt8(this.pos++),a=this.buffer.readUInt8(this.pos++);t+=this.bottomUp?-a:a,i+=a*this.width*4+4*e}else{let t=this.buffer.readUInt8(this.pos++);for(let a=0;a<r;a++)i=this.setPixelData(i,e?15&t:(240&t)>>4),1&a&&a+1<r&&(t=this.buffer.readUInt8(this.pos++)),e=!e;1==(r+1>>1&1)&&this.pos++}}else for(let t=0;t<a;t++)i=this.setPixelData(i,e?15&r:(240&r)>>4),e=!e}}else{const e=Math.ceil(this.width/2),t=e%4,i=0!==t?4-t:0;this.scanImage(i,e,((e,t)=>{const i=this.buffer.readUInt8(this.pos++),a=t*this.width*4+2*e*4,r=i>>4;let n=this.palette[r];if(this.data[a]=0,this.data[a+1]=n.blue,this.data[a+2]=n.green,this.data[a+3]=n.red,2*e+1>=this.width)return!1;const s=15&i;n=this.palette[s],this.data[a+4]=0,this.data[a+4+1]=n.blue,this.data[a+4+2]=n.green,this.data[a+4+3]=n.red}))}}bit8(){if(this.compression===BmpCompression.BI_RLE8){this.data.fill(0);let e=this.bottomUp?this.height-1:0,t=0;for(;t<this.data.length;){const i=this.buffer.readUInt8(this.pos++),a=this.buffer.readUInt8(this.pos++);if(0===i){if(0===a){e+=this.bottomUp?-1:1,t=e*this.width*4;continue}if(1===a)break;if(2===a){const i=this.buffer.readUInt8(this.pos++),a=this.buffer.readUInt8(this.pos++);e+=this.bottomUp?-a:a,t+=a*this.width*4+4*i}else{for(let e=0;e<a;e++){const e=this.buffer.readUInt8(this.pos++);t=this.setPixelData(t,e)}!0&a&&this.pos++}}else for(let e=0;e<i;e++)t=this.setPixelData(t,a)}}else{const e=this.width%4,t=0!==e?4-e:0;this.scanImage(t,this.width,((e,t)=>{const i=this.buffer.readUInt8(this.pos++),a=t*this.width*4+4*e;if(i<this.palette.length){const e=this.palette[i];this.data[a]=0,this.data[a+1]=e.blue,this.data[a+2]=e.green,this.data[a+3]=e.red}else this.data[a]=0,this.data[a+1]=255,this.data[a+2]=255,this.data[a+3]=255}))}}bit16(){const e=this.width%2*2;this.scanImage(e,this.width,((e,t)=>{const i=t*this.width*4+4*e,a=this.buffer.readUInt16LE(this.pos);this.pos+=2,this.data[i+this.locRed]=this.shiftRed(a),this.data[i+this.locGreen]=this.shiftGreen(a),this.data[i+this.locBlue]=this.shiftBlue(a),this.data[i+this.locAlpha]=this.shiftAlpha(a)}))}bit24(){const e=this.width%4;this.scanImage(e,this.width,((e,t)=>{const i=t*this.width*4+4*e,a=this.buffer.readUInt8(this.pos++),r=this.buffer.readUInt8(this.pos++),n=this.buffer.readUInt8(this.pos++);this.data[i+this.locRed]=n,this.data[i+this.locGreen]=r,this.data[i+this.locBlue]=a,this.data[i+this.locAlpha]=0}))}bit32(){this.scanImage(0,this.width,((e,t)=>{const i=t*this.width*4+4*e,a=this.readUInt32LE();this.data[i+this.locRed]=this.shiftRed(a),this.data[i+this.locGreen]=this.shiftGreen(a),this.data[i+this.locBlue]=this.shiftBlue(a),this.data[i+this.locAlpha]=this.shiftAlpha(a)}))}scanImage(e=0,t=this.width,i){for(let a=this.height-1;a>=0;a--){const r=this.bottomUp?a:this.height-1-a;for(let e=0;e<t;e++){if(!1===i.call(this,e,r))return}this.pos+=e}}readUInt32LE(){const e=this.buffer.readUInt32LE(this.pos);return this.pos+=4,e}setPixelData(e,t){const{blue:i,green:a,red:r}=this.palette[t];return this.data[e+this.locAlpha]=0,this.data[e+1+this.locBlue]=i,this.data[e+2+this.locGreen]=a,this.data[e+3+this.locRed]=r,e+4}}function createInteger(e){return e.reduce(((e,t)=>e<<1|t),0)}function createColor(e){return e.quad<<24|e.red<<16|e.green<<8|e.blue}class BmpEncoder{fileSize;reserved1;reserved2;offset;width;flag;height;planes;bitPP;compress;hr;vr;colors;importantColors;rawSize;headerSize;data;palette;extraBytes;buffer;bytesInColor;pos;constructor(e){switch(this.buffer=e.data,this.width=e.width,this.height=e.height,this.headerSize=HeaderTypes$1.BITMAP_INFO_HEADER,this.flag="BM",this.bitPP=e.bitPP||24,this.offset=54,this.reserved1=e.reserved1||0,this.reserved2=e.reserved2||0,this.planes=1,this.compress=0,this.hr=e.hr||0,this.vr=e.vr||0,this.importantColors=e.importantColors||0,this.colors=Math.min(2**(this.bitPP-1||1),e.colors||1/0),this.palette=e.palette||[],this.colors&&this.bitPP<16?this.offset+=4*this.colors:this.colors=0,this.bitPP){case 32:this.bytesInColor=4;break;case 16:this.bytesInColor=2;break;case 8:this.bytesInColor=1;break;case 4:this.bytesInColor=.5;break;case 1:this.bytesInColor=1/8;break;default:this.bytesInColor=3,this.bitPP=24}const t=this.width*this.bitPP/32,i=Math.ceil(t);this.extraBytes=4*(i-t),this.rawSize=this.height*i*4+2,this.fileSize=this.rawSize+this.offset,this.data=Buffer.alloc(this.fileSize,1),this.pos=0,this.encode()}encode(){switch(this.pos=0,this.writeHeader(),this.bitPP){case 32:this.bit32();break;case 16:this.bit16();break;case 8:this.bit8();break;case 4:this.bit4();break;case 1:this.bit1();break;default:this.bit24()}}writeHeader(){this.data.write(this.flag,this.pos,2),this.pos+=2,this.writeUInt32LE(this.fileSize),this.writeUInt32LE(this.reserved1<<16|this.reserved2),this.writeUInt32LE(this.offset),this.writeUInt32LE(this.headerSize),this.writeUInt32LE(this.width),this.writeUInt32LE(this.height),this.data.writeUInt16LE(this.planes,this.pos),this.pos+=2,this.data.writeUInt16LE(this.bitPP,this.pos),this.pos+=2,this.writeUInt32LE(this.compress),this.writeUInt32LE(this.rawSize),this.writeUInt32LE(this.hr),this.writeUInt32LE(this.vr),this.writeUInt32LE(this.colors),this.writeUInt32LE(this.importantColors)}bit1(){this.palette.length&&2===this.colors?this.initColors(1):(this.writeUInt32LE(16777215),this.writeUInt32LE(0)),this.pos+=1;let e=[];this.writeImage(((t,i,a)=>{let r=i;r++;const n=this.buffer[r++],s=this.buffer[r++],o=.2126*this.buffer[r++]+.7152*s+.0722*n;return e.push(o>127?0:1),(a+1)%8==0?(this.data[t-1]=createInteger(e),e=[]):a===this.width-1&&e.length>0&&(this.data[t-1]=createInteger(e)<<4,e=[]),r}))}bit4(){const e=this.initColors(4);let t=[];this.writeImage(((i,a,r)=>{let n=a;const s=createColor({quad:this.buffer[n++],blue:this.buffer[n++],green:this.buffer[n++],red:this.buffer[n++]}),o=e.findIndex((e=>e===s));return-1!==o?t.push(o):t.push(0),(r+1)%2==0&&(this.data[i]=t[0]<<4|t[1],t=[]),n}))}bit8(){const e=this.initColors(8);this.writeImage(((t,i)=>{let a=i;const r=createColor({quad:this.buffer[a++],blue:this.buffer[a++],green:this.buffer[a++],red:this.buffer[a++]}),n=e.findIndex((e=>e===r));return this.data[t]=-1!==n?n:0,a}))}bit16(){this.writeImage(((e,t)=>{let i=t+1;const a=this.buffer[i++]/8,r=this.buffer[i++]/8,n=this.buffer[i++]/8<<10|r<<5|a;return this.data[e]=255&n,this.data[e+1]=(65280&n)>>8,i}))}bit24(){this.writeImage(((e,t)=>{let i=t+1;return this.data[e]=this.buffer[i++],this.data[e+1]=this.buffer[i++],this.data[e+2]=this.buffer[i++],i}))}bit32(){this.writeImage(((e,t)=>{let i=t;return this.data[e+3]=this.buffer[i++],this.data[e]=this.buffer[i++],this.data[e+1]=this.buffer[i++],this.data[e+2]=this.buffer[i++],i}))}writeImage(e){const t=this.extraBytes+this.width*this.bytesInColor;let i=0;for(let a=0;a<this.height;a++)for(let r=0;r<this.width;r++){const n=Math.floor(this.pos+(this.height-1-a)*t+r*this.bytesInColor);i=e.call(this,n,i,r,a)}}initColors(e){const t=[];if(!this.palette.length)throw new Error(`To encode ${e}-bit BMPs a pallette is needed. Please choose up to ${this.colors} colors. Colors must be 32-bit integers.`);for(let e=0;e<this.colors;e++){const i=createColor(this.palette[e]);this.writeUInt32LE(i),t.push(i)}return t}writeUInt32LE(e){this.data.writeUInt32LE(e,this.pos),this.pos+=4}}function decode$2(e,t){return new BmpDecoder(e,t)}function encode$2(e){return new BmpEncoder(e)}function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}var trimLeft=/^\s+/,trimRight=/\s+$/;function tinycolor(e,t){if(t=t||{},(e=e||"")instanceof tinycolor)return e;if(!(this instanceof tinycolor))return new tinycolor(e,t);var i=inputToRGB(e);this._originalInput=e,this._r=i.r,this._g=i.g,this._b=i.b,this._a=i.a,this._roundA=Math.round(100*this._a)/100,this._format=t.format||i.format,this._gradientType=t.gradientType,this._r<1&&(this._r=Math.round(this._r)),this._g<1&&(this._g=Math.round(this._g)),this._b<1&&(this._b=Math.round(this._b)),this._ok=i.ok}function inputToRGB(e){var t={r:0,g:0,b:0},i=1,a=null,r=null,n=null,s=!1,o=!1;return"string"==typeof e&&(e=stringInputToObject(e)),"object"==_typeof(e)&&(isValidCSSUnit(e.r)&&isValidCSSUnit(e.g)&&isValidCSSUnit(e.b)?(t=rgbToRgb(e.r,e.g,e.b),s=!0,o="%"===String(e.r).substr(-1)?"prgb":"rgb"):isValidCSSUnit(e.h)&&isValidCSSUnit(e.s)&&isValidCSSUnit(e.v)?(a=convertToPercentage(e.s),r=convertToPercentage(e.v),t=hsvToRgb(e.h,a,r),s=!0,o="hsv"):isValidCSSUnit(e.h)&&isValidCSSUnit(e.s)&&isValidCSSUnit(e.l)&&(a=convertToPercentage(e.s),n=convertToPercentage(e.l),t=hslToRgb(e.h,a,n),s=!0,o="hsl"),e.hasOwnProperty("a")&&(i=e.a)),i=boundAlpha(i),{ok:s,format:e.format||o,r:Math.min(255,Math.max(t.r,0)),g:Math.min(255,Math.max(t.g,0)),b:Math.min(255,Math.max(t.b,0)),a:i}}function rgbToRgb(e,t,i){return{r:255*bound01(e,255),g:255*bound01(t,255),b:255*bound01(i,255)}}function rgbToHsl(e,t,i){e=bound01(e,255),t=bound01(t,255),i=bound01(i,255);var a,r,n=Math.max(e,t,i),s=Math.min(e,t,i),o=(n+s)/2;if(n==s)a=r=0;else{var l=n-s;switch(r=o>.5?l/(2-n-s):l/(n+s),n){case e:a=(t-i)/l+(t<i?6:0);break;case t:a=(i-e)/l+2;break;case i:a=(e-t)/l+4}a/=6}return{h:a,s:r,l:o}}function hslToRgb(e,t,i){var a,r,n;function s(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+(t-e)*(2/3-i)*6:e}if(e=bound01(e,360),t=bound01(t,100),i=bound01(i,100),0===t)a=r=n=i;else{var o=i<.5?i*(1+t):i+t-i*t,l=2*i-o;a=s(l,o,e+1/3),r=s(l,o,e),n=s(l,o,e-1/3)}return{r:255*a,g:255*r,b:255*n}}function rgbToHsv(e,t,i){e=bound01(e,255),t=bound01(t,255),i=bound01(i,255);var a,r,n=Math.max(e,t,i),s=Math.min(e,t,i),o=n,l=n-s;if(r=0===n?0:l/n,n==s)a=0;else{switch(n){case e:a=(t-i)/l+(t<i?6:0);break;case t:a=(i-e)/l+2;break;case i:a=(e-t)/l+4}a/=6}return{h:a,s:r,v:o}}function hsvToRgb(e,t,i){e=6*bound01(e,360),t=bound01(t,100),i=bound01(i,100);var a=Math.floor(e),r=e-a,n=i*(1-t),s=i*(1-r*t),o=i*(1-(1-r)*t),l=a%6;return{r:255*[i,s,n,n,o,i][l],g:255*[o,i,i,s,n,n][l],b:255*[n,n,o,i,i,s][l]}}function rgbToHex(e,t,i,a){var r=[pad2(Math.round(e).toString(16)),pad2(Math.round(t).toString(16)),pad2(Math.round(i).toString(16))];return a&&r[0].charAt(0)==r[0].charAt(1)&&r[1].charAt(0)==r[1].charAt(1)&&r[2].charAt(0)==r[2].charAt(1)?r[0].charAt(0)+r[1].charAt(0)+r[2].charAt(0):r.join("")}function rgbaToHex(e,t,i,a,r){var n=[pad2(Math.round(e).toString(16)),pad2(Math.round(t).toString(16)),pad2(Math.round(i).toString(16)),pad2(convertDecimalToHex(a))];return r&&n[0].charAt(0)==n[0].charAt(1)&&n[1].charAt(0)==n[1].charAt(1)&&n[2].charAt(0)==n[2].charAt(1)&&n[3].charAt(0)==n[3].charAt(1)?n[0].charAt(0)+n[1].charAt(0)+n[2].charAt(0)+n[3].charAt(0):n.join("")}function rgbaToArgbHex(e,t,i,a){return[pad2(convertDecimalToHex(a)),pad2(Math.round(e).toString(16)),pad2(Math.round(t).toString(16)),pad2(Math.round(i).toString(16))].join("")}function _desaturate(e,t){t=0===t?0:t||10;var i=tinycolor(e).toHsl();return i.s-=t/100,i.s=clamp01(i.s),tinycolor(i)}function _saturate(e,t){t=0===t?0:t||10;var i=tinycolor(e).toHsl();return i.s+=t/100,i.s=clamp01(i.s),tinycolor(i)}function _greyscale(e){return tinycolor(e).desaturate(100)}function _lighten(e,t){t=0===t?0:t||10;var i=tinycolor(e).toHsl();return i.l+=t/100,i.l=clamp01(i.l),tinycolor(i)}function _brighten(e,t){t=0===t?0:t||10;var i=tinycolor(e).toRgb();return i.r=Math.max(0,Math.min(255,i.r-Math.round(-t/100*255))),i.g=Math.max(0,Math.min(255,i.g-Math.round(-t/100*255))),i.b=Math.max(0,Math.min(255,i.b-Math.round(-t/100*255))),tinycolor(i)}function _darken(e,t){t=0===t?0:t||10;var i=tinycolor(e).toHsl();return i.l-=t/100,i.l=clamp01(i.l),tinycolor(i)}function _spin(e,t){var i=tinycolor(e).toHsl(),a=(i.h+t)%360;return i.h=a<0?360+a:a,tinycolor(i)}function _complement(e){var t=tinycolor(e).toHsl();return t.h=(t.h+180)%360,tinycolor(t)}function polyad(e,t){if(isNaN(t)||t<=0)throw new Error("Argument to polyad must be a positive number");for(var i=tinycolor(e).toHsl(),a=[tinycolor(e)],r=360/t,n=1;n<t;n++)a.push(tinycolor({h:(i.h+n*r)%360,s:i.s,l:i.l}));return a}function _splitcomplement(e){var t=tinycolor(e).toHsl(),i=t.h;return[tinycolor(e),tinycolor({h:(i+72)%360,s:t.s,l:t.l}),tinycolor({h:(i+216)%360,s:t.s,l:t.l})]}function _analogous(e,t,i){t=t||6,i=i||30;var a=tinycolor(e).toHsl(),r=360/i,n=[tinycolor(e)];for(a.h=(a.h-(r*t>>1)+720)%360;--t;)a.h=(a.h+r)%360,n.push(tinycolor(a));return n}function _monochromatic(e,t){t=t||6;for(var i=tinycolor(e).toHsv(),a=i.h,r=i.s,n=i.v,s=[],o=1/t;t--;)s.push(tinycolor({h:a,s:r,v:n})),n=(n+o)%1;return s}tinycolor.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var e=this.toRgb();return(299*e.r+587*e.g+114*e.b)/1e3},getLuminance:function(){var e,t,i,a=this.toRgb();return e=a.r/255,t=a.g/255,i=a.b/255,.2126*(e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4))+.7152*(t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4))+.0722*(i<=.03928?i/12.92:Math.pow((i+.055)/1.055,2.4))},setAlpha:function(e){return this._a=boundAlpha(e),this._roundA=Math.round(100*this._a)/100,this},toHsv:function(){var e=rgbToHsv(this._r,this._g,this._b);return{h:360*e.h,s:e.s,v:e.v,a:this._a}},toHsvString:function(){var e=rgbToHsv(this._r,this._g,this._b),t=Math.round(360*e.h),i=Math.round(100*e.s),a=Math.round(100*e.v);return 1==this._a?"hsv("+t+", "+i+"%, "+a+"%)":"hsva("+t+", "+i+"%, "+a+"%, "+this._roundA+")"},toHsl:function(){var e=rgbToHsl(this._r,this._g,this._b);return{h:360*e.h,s:e.s,l:e.l,a:this._a}},toHslString:function(){var e=rgbToHsl(this._r,this._g,this._b),t=Math.round(360*e.h),i=Math.round(100*e.s),a=Math.round(100*e.l);return 1==this._a?"hsl("+t+", "+i+"%, "+a+"%)":"hsla("+t+", "+i+"%, "+a+"%, "+this._roundA+")"},toHex:function(e){return rgbToHex(this._r,this._g,this._b,e)},toHexString:function(e){return"#"+this.toHex(e)},toHex8:function(e){return rgbaToHex(this._r,this._g,this._b,this._a,e)},toHex8String:function(e){return"#"+this.toHex8(e)},toRgb:function(){return{r:Math.round(this._r),g:Math.round(this._g),b:Math.round(this._b),a:this._a}},toRgbString:function(){return 1==this._a?"rgb("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+")":"rgba("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:Math.round(100*bound01(this._r,255))+"%",g:Math.round(100*bound01(this._g,255))+"%",b:Math.round(100*bound01(this._b,255))+"%",a:this._a}},toPercentageRgbString:function(){return 1==this._a?"rgb("+Math.round(100*bound01(this._r,255))+"%, "+Math.round(100*bound01(this._g,255))+"%, "+Math.round(100*bound01(this._b,255))+"%)":"rgba("+Math.round(100*bound01(this._r,255))+"%, "+Math.round(100*bound01(this._g,255))+"%, "+Math.round(100*bound01(this._b,255))+"%, "+this._roundA+")"},toName:function(){return 0===this._a?"transparent":!(this._a<1)&&(hexNames[rgbToHex(this._r,this._g,this._b,!0)]||!1)},toFilter:function(e){var t="#"+rgbaToArgbHex(this._r,this._g,this._b,this._a),i=t,a=this._gradientType?"GradientType = 1, ":"";if(e){var r=tinycolor(e);i="#"+rgbaToArgbHex(r._r,r._g,r._b,r._a)}return"progid:DXImageTransform.Microsoft.gradient("+a+"startColorstr="+t+",endColorstr="+i+")"},toString:function(e){var t=!!e;e=e||this._format;var i=!1,a=this._a<1&&this._a>=0;return t||!a||"hex"!==e&&"hex6"!==e&&"hex3"!==e&&"hex4"!==e&&"hex8"!==e&&"name"!==e?("rgb"===e&&(i=this.toRgbString()),"prgb"===e&&(i=this.toPercentageRgbString()),"hex"!==e&&"hex6"!==e||(i=this.toHexString()),"hex3"===e&&(i=this.toHexString(!0)),"hex4"===e&&(i=this.toHex8String(!0)),"hex8"===e&&(i=this.toHex8String()),"name"===e&&(i=this.toName()),"hsl"===e&&(i=this.toHslString()),"hsv"===e&&(i=this.toHsvString()),i||this.toHexString()):"name"===e&&0===this._a?this.toName():this.toRgbString()},clone:function(){return tinycolor(this.toString())},_applyModification:function(e,t){var i=e.apply(null,[this].concat([].slice.call(t)));return this._r=i._r,this._g=i._g,this._b=i._b,this.setAlpha(i._a),this},lighten:function(){return this._applyModification(_lighten,arguments)},brighten:function(){return this._applyModification(_brighten,arguments)},darken:function(){return this._applyModification(_darken,arguments)},desaturate:function(){return this._applyModification(_desaturate,arguments)},saturate:function(){return this._applyModification(_saturate,arguments)},greyscale:function(){return this._applyModification(_greyscale,arguments)},spin:function(){return this._applyModification(_spin,arguments)},_applyCombination:function(e,t){return e.apply(null,[this].concat([].slice.call(t)))},analogous:function(){return this._applyCombination(_analogous,arguments)},complement:function(){return this._applyCombination(_complement,arguments)},monochromatic:function(){return this._applyCombination(_monochromatic,arguments)},splitcomplement:function(){return this._applyCombination(_splitcomplement,arguments)},triad:function(){return this._applyCombination(polyad,[3])},tetrad:function(){return this._applyCombination(polyad,[4])}},tinycolor.fromRatio=function(e,t){if("object"==_typeof(e)){var i={};for(var a in e)e.hasOwnProperty(a)&&(i[a]="a"===a?e[a]:convertToPercentage(e[a]));e=i}return tinycolor(e,t)},tinycolor.equals=function(e,t){return!(!e||!t)&&tinycolor(e).toRgbString()==tinycolor(t).toRgbString()},tinycolor.random=function(){return tinycolor.fromRatio({r:Math.random(),g:Math.random(),b:Math.random()})},tinycolor.mix=function(e,t,i){i=0===i?0:i||50;var a=tinycolor(e).toRgb(),r=tinycolor(t).toRgb(),n=i/100;return tinycolor({r:(r.r-a.r)*n+a.r,g:(r.g-a.g)*n+a.g,b:(r.b-a.b)*n+a.b,a:(r.a-a.a)*n+a.a})},tinycolor.readability=function(e,t){var i=tinycolor(e),a=tinycolor(t);return(Math.max(i.getLuminance(),a.getLuminance())+.05)/(Math.min(i.getLuminance(),a.getLuminance())+.05)},tinycolor.isReadable=function(e,t,i){var a,r,n=tinycolor.readability(e,t);switch(r=!1,(a=validateWCAG2Parms(i)).level+a.size){case"AAsmall":case"AAAlarge":r=n>=4.5;break;case"AAlarge":r=n>=3;break;case"AAAsmall":r=n>=7}return r},tinycolor.mostReadable=function(e,t,i){var a,r,n,s,o=null,l=0;r=(i=i||{}).includeFallbackColors,n=i.level,s=i.size;for(var u=0;u<t.length;u++)(a=tinycolor.readability(e,t[u]))>l&&(l=a,o=tinycolor(t[u]));return tinycolor.isReadable(e,o,{level:n,size:s})||!r?o:(i.includeFallbackColors=!1,tinycolor.mostReadable(e,["#fff","#000"],i))};var names$1=tinycolor.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},hexNames=tinycolor.hexNames=flip(names$1);function flip(e){var t={};for(var i in e)e.hasOwnProperty(i)&&(t[e[i]]=i);return t}function boundAlpha(e){return e=parseFloat(e),(isNaN(e)||e<0||e>1)&&(e=1),e}function bound01(e,t){isOnePointZero(e)&&(e="100%");var i=isPercentage(e);return e=Math.min(t,Math.max(0,parseFloat(e))),i&&(e=parseInt(e*t,10)/100),Math.abs(e-t)<1e-6?1:e%t/parseFloat(t)}function clamp01(e){return Math.min(1,Math.max(0,e))}function parseIntFromHex(e){return parseInt(e,16)}function isOnePointZero(e){return"string"==typeof e&&-1!=e.indexOf(".")&&1===parseFloat(e)}function isPercentage(e){return"string"==typeof e&&-1!=e.indexOf("%")}function pad2(e){return 1==e.length?"0"+e:""+e}function convertToPercentage(e){return e<=1&&(e=100*e+"%"),e}function convertDecimalToHex(e){return Math.round(255*parseFloat(e)).toString(16)}function convertHexToDecimal(e){return parseIntFromHex(e)/255}var matchers=(CSS_UNIT="(?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?)",PERMISSIVE_MATCH3="[\\s|\\(]+("+CSS_UNIT+")[,|\\s]+("+CSS_UNIT+")[,|\\s]+("+CSS_UNIT+")\\s*\\)?",PERMISSIVE_MATCH4="[\\s|\\(]+("+CSS_UNIT+")[,|\\s]+("+CSS_UNIT+")[,|\\s]+("+CSS_UNIT+")[,|\\s]+("+CSS_UNIT+")\\s*\\)?",{CSS_UNIT:new RegExp(CSS_UNIT),rgb:new RegExp("rgb"+PERMISSIVE_MATCH3),rgba:new RegExp("rgba"+PERMISSIVE_MATCH4),hsl:new RegExp("hsl"+PERMISSIVE_MATCH3),hsla:new RegExp("hsla"+PERMISSIVE_MATCH4),hsv:new RegExp("hsv"+PERMISSIVE_MATCH3),hsva:new RegExp("hsva"+PERMISSIVE_MATCH4),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}),CSS_UNIT,PERMISSIVE_MATCH3,PERMISSIVE_MATCH4;function isValidCSSUnit(e){return!!matchers.CSS_UNIT.exec(e)}function stringInputToObject(e){e=e.replace(trimLeft,"").replace(trimRight,"").toLowerCase();var t,i=!1;if(names$1[e])e=names$1[e],i=!0;else if("transparent"==e)return{r:0,g:0,b:0,a:0,format:"name"};return(t=matchers.rgb.exec(e))?{r:t[1],g:t[2],b:t[3]}:(t=matchers.rgba.exec(e))?{r:t[1],g:t[2],b:t[3],a:t[4]}:(t=matchers.hsl.exec(e))?{h:t[1],s:t[2],l:t[3]}:(t=matchers.hsla.exec(e))?{h:t[1],s:t[2],l:t[3],a:t[4]}:(t=matchers.hsv.exec(e))?{h:t[1],s:t[2],v:t[3]}:(t=matchers.hsva.exec(e))?{h:t[1],s:t[2],v:t[3],a:t[4]}:(t=matchers.hex8.exec(e))?{r:parseIntFromHex(t[1]),g:parseIntFromHex(t[2]),b:parseIntFromHex(t[3]),a:convertHexToDecimal(t[4]),format:i?"name":"hex8"}:(t=matchers.hex6.exec(e))?{r:parseIntFromHex(t[1]),g:parseIntFromHex(t[2]),b:parseIntFromHex(t[3]),format:i?"name":"hex"}:(t=matchers.hex4.exec(e))?{r:parseIntFromHex(t[1]+""+t[1]),g:parseIntFromHex(t[2]+""+t[2]),b:parseIntFromHex(t[3]+""+t[3]),a:convertHexToDecimal(t[4]+""+t[4]),format:i?"name":"hex8"}:!!(t=matchers.hex3.exec(e))&&{r:parseIntFromHex(t[1]+""+t[1]),g:parseIntFromHex(t[2]+""+t[2]),b:parseIntFromHex(t[3]+""+t[3]),format:i?"name":"hex"}}function validateWCAG2Parms(e){var t,i;return"AA"!==(t=((e=e||{level:"AA",size:"small"}).level||"AA").toUpperCase())&&"AAA"!==t&&(t="AA"),"small"!==(i=(e.size||"small").toLowerCase())&&"large"!==i&&(i="small"),{level:t,size:i}}function clone(e){const t={width:e.bitmap.width,height:e.bitmap.height,data:Buffer.from(e.bitmap.data)};return new e.constructor(t)}function scan(e,t,i,a,r,n){let s,o,l,u,h;if("function"==typeof t)h=t,s=0,o=0,l=e.bitmap.width,u=e.bitmap.height;else{if(s=t,"number"!=typeof i)throw new Error("y must be a number");if(o=i,"number"!=typeof a)throw new Error("w must be a number");if(l=a,"number"!=typeof r)throw new Error("h must be a number");if(u=r,"function"!=typeof n)throw new Error("cb must be a function");h=n}s=Math.round(s),o=Math.round(o),l=Math.round(l),u=Math.round(u);const c=h.bind(e);for(let t=o;t<o+u;t++)for(let i=s;i<s+l;i++){c(i,t,e.bitmap.width*t+i<<2)}return e}function*scanIterator(e,t,i,a,r){t=Math.round(t),i=Math.round(i),a=Math.round(a),r=Math.round(r);for(let n=i;n<i+r;n++)for(let i=t;i<t+a;i++){const t=e.bitmap.width*n+i<<2;yield{x:i,y:n,idx:t,image:e}}}function intToRGBA$1(e){if("number"!=typeof e)throw new Error("i must be a number");const t={r:0,g:0,b:0,a:0};return t.r=Math.floor(e/Math.pow(256,3)),t.g=Math.floor((e-t.r*Math.pow(256,3))/Math.pow(256,2)),t.b=Math.floor((e-t.r*Math.pow(256,3)-t.g*Math.pow(256,2))/Math.pow(256,1)),t.a=Math.floor((e-t.r*Math.pow(256,3)-t.g*Math.pow(256,2)-t.b*Math.pow(256,1))/Math.pow(256,0)),t}function colorDiff(e,t){const i=e=>Math.pow(e,2),{max:a}=Math,r="a"in e?e.a:255,n="a"in t?t.a:255;return(a(i(e.r-t.r),i(e.r-t.r-r+n))+a(i(e.g-t.g),i(e.g-t.g-r+n))+a(i(e.b-t.b),i(e.b-t.b-r+n)))/195075}function limit255(e){return e=Math.max(e,0),e=Math.min(e,255)}function cssColorToHex(e){return"number"==typeof e?e:parseInt(tinycolor(e).toHex8(),16)}function encode$1(e,t={}){return scan({bitmap:e},0,0,e.width,e.height,(function(t,i,a){const r=e.data[a+0],n=e.data[a+1],s=e.data[a+2],o=e.data[a+3];e.data[a+0]=o,e.data[a+1]=s,e.data[a+2]=n,e.data[a+3]=r})),encode$2({...e,...t}).data}function decode$1(e,t){const i=decode$2(e,t);return scan({bitmap:i},0,0,i.width,i.height,(function(e,t,a){const r=i.data[a+1],n=i.data[a+2],s=i.data[a+3];i.data[a+0]=s,i.data[a+1]=n,i.data[a+2]=r,i.data[a+3]=255})),i}function msBmp(){return{mime:"image/x-ms-bmp",encode:encode$1,decode:decode$1}}function bmp(){return{mime:"image/bmp",encode:encode$1,decode:decode$1}}var omggif={},GifReader_1,GifWriter_1;function GifWriter(e,t,i,a){var r=0,n=void 0===(a=void 0===a?{}:a).loop?null:a.loop,s=void 0===a.palette?null:a.palette;if(t<=0||i<=0||t>65535||i>65535)throw new Error("Width/Height invalid.");function o(e){var t=e.length;if(t<2||t>256||t&t-1)throw new Error("Invalid code/color length, must be power of 2 and 2 .. 256.");return t}e[r++]=71,e[r++]=73,e[r++]=70,e[r++]=56,e[r++]=57,e[r++]=97;var l=0,u=0;if(null!==s){for(var h=o(s);h>>=1;)++l;if(h=1<<l,--l,void 0!==a.background){if((u=a.background)>=h)throw new Error("Background index out of range.");if(0===u)throw new Error("Background index explicitly passed as 0.")}}if(e[r++]=255&t,e[r++]=t>>8&255,e[r++]=255&i,e[r++]=i>>8&255,e[r++]=(null!==s?128:0)|l,e[r++]=u,e[r++]=0,null!==s)for(var c=0,d=s.length;c<d;++c){var f=s[c];e[r++]=f>>16&255,e[r++]=f>>8&255,e[r++]=255&f}if(null!==n){if(n<0||n>65535)throw new Error("Loop count invalid.");e[r++]=33,e[r++]=255,e[r++]=11,e[r++]=78,e[r++]=69,e[r++]=84,e[r++]=83,e[r++]=67,e[r++]=65,e[r++]=80,e[r++]=69,e[r++]=50,e[r++]=46,e[r++]=48,e[r++]=3,e[r++]=1,e[r++]=255&n,e[r++]=n>>8&255,e[r++]=0}var m=!1;this.addFrame=function(t,i,a,n,l,u){if(!0===m&&(--r,m=!1),u=void 0===u?{}:u,t<0||i<0||t>65535||i>65535)throw new Error("x/y invalid.");if(a<=0||n<=0||a>65535||n>65535)throw new Error("Width/Height invalid.");if(l.length<a*n)throw new Error("Not enough pixels for the frame size.");var h=!0,c=u.palette;if(null==c&&(h=!1,c=s),null==c)throw new Error("Must supply either a local or global palette.");for(var d=o(c),f=0;d>>=1;)++f;d=1<<f;var p=void 0===u.delay?0:u.delay,_=void 0===u.disposal?0:u.disposal;if(_<0||_>3)throw new Error("Disposal out of range.");var g=!1,b=0;if(void 0!==u.transparent&&null!==u.transparent&&(g=!0,(b=u.transparent)<0||b>=d))throw new Error("Transparent color index.");if((0!==_||g||0!==p)&&(e[r++]=33,e[r++]=249,e[r++]=4,e[r++]=_<<2|(!0===g?1:0),e[r++]=255&p,e[r++]=p>>8&255,e[r++]=b,e[r++]=0),e[r++]=44,e[r++]=255&t,e[r++]=t>>8&255,e[r++]=255&i,e[r++]=i>>8&255,e[r++]=255&a,e[r++]=a>>8&255,e[r++]=255&n,e[r++]=n>>8&255,e[r++]=!0===h?128|f-1:0,!0===h)for(var y=0,x=c.length;y<x;++y){var w=c[y];e[r++]=w>>16&255,e[r++]=w>>8&255,e[r++]=255&w}return r=GifWriterOutputLZWCodeStream(e,r,f<2?2:f,l)},this.end=function(){return!1===m&&(e[r++]=59,m=!0),r},this.getOutputBuffer=function(){return e},this.setOutputBuffer=function(t){e=t},this.getOutputBufferPosition=function(){return r},this.setOutputBufferPosition=function(e){r=e}}function GifWriterOutputLZWCodeStream(e,t,i,a){e[t++]=i;var r=t++,n=1<<i,s=n-1,o=n+1,l=o+1,u=i+1,h=0,c=0;function d(i){for(;h>=i;)e[t++]=255&c,c>>=8,h-=8,t===r+256&&(e[r]=255,r=t++)}function f(e){c|=e<<h,h+=u,d(8)}var m=a[0]&s,p={};f(n);for(var _=1,g=a.length;_<g;++_){var b=a[_]&s,y=m<<8|b,x=p[y];if(void 0===x){for(c|=m<<h,h+=u;h>=8;)e[t++]=255&c,c>>=8,h-=8,t===r+256&&(e[r]=255,r=t++);4096===l?(f(n),l=o+1,u=i+1,p={}):(l>=1<<u&&++u,p[y]=l++),m=b}else m=x}return f(m),f(o),d(1),r+1===t?e[r]=0:(e[r]=t-r-1,e[t++]=0),t}function GifReader(e){var t=0;if(71!==e[t++]||73!==e[t++]||70!==e[t++]||56!==e[t++]||56!=(e[t++]+1&253)||97!==e[t++])throw new Error("Invalid GIF 87a/89a header.");var i=e[t++]|e[t++]<<8,a=e[t++]|e[t++]<<8,r=e[t++],n=r>>7,s=1<<(7&r)+1;e[t++],e[t++];var o=null,l=null;n&&(o=t,l=s,t+=3*s);var u=!0,h=[],c=0,d=null,f=0,m=null;for(this.width=i,this.height=a;u&&t<e.length;)switch(e[t++]){case 33:switch(e[t++]){case 255:if(11!==e[t]||78==e[t+1]&&69==e[t+2]&&84==e[t+3]&&83==e[t+4]&&67==e[t+5]&&65==e[t+6]&&80==e[t+7]&&69==e[t+8]&&50==e[t+9]&&46==e[t+10]&&48==e[t+11]&&3==e[t+12]&&1==e[t+13]&&0==e[t+16])t+=14,m=e[t++]|e[t++]<<8,t++;else for(t+=12;;){if(!((S=e[t++])>=0))throw Error("Invalid block size");if(0===S)break;t+=S}break;case 249:if(4!==e[t++]||0!==e[t+4])throw new Error("Invalid graphics extension block.");var p=e[t++];c=e[t++]|e[t++]<<8,d=e[t++],1&p||(d=null),f=p>>2&7,t++;break;case 254:for(;;){if(!((S=e[t++])>=0))throw Error("Invalid block size");if(0===S)break;t+=S}break;default:throw new Error("Unknown graphic control label: 0x"+e[t-1].toString(16))}break;case 44:var _=e[t++]|e[t++]<<8,g=e[t++]|e[t++]<<8,b=e[t++]|e[t++]<<8,y=e[t++]|e[t++]<<8,x=e[t++],w=x>>6&1,v=1<<(7&x)+1,k=o,M=l,I=!1;if(x>>7){I=!0;k=t,M=v,t+=3*v}var E=t;for(t++;;){var S;if(!((S=e[t++])>=0))throw Error("Invalid block size");if(0===S)break;t+=S}h.push({x:_,y:g,width:b,height:y,has_local_palette:I,palette_offset:k,palette_size:M,data_offset:E,data_length:t-E,transparent_index:d,interlaced:!!w,delay:c,disposal:f});break;case 59:u=!1;break;default:throw new Error("Unknown gif block: 0x"+e[t-1].toString(16))}this.numFrames=function(){return h.length},this.loopCount=function(){return m},this.frameInfo=function(e){if(e<0||e>=h.length)throw new Error("Frame index out of range.");return h[e]},this.decodeAndBlitFrameBGRA=function(t,a){var r=this.frameInfo(t),n=r.width*r.height,s=new Uint8Array(n);GifReaderLZWOutputIndexStream(e,r.data_offset,s,n);var o=r.palette_offset,l=r.transparent_index;null===l&&(l=256);var u=r.width,h=i-u,c=u,d=4*(r.y*i+r.x),f=4*((r.y+r.height)*i+r.x),m=d,p=4*h;!0===r.interlaced&&(p+=4*i*7);for(var _=8,g=0,b=s.length;g<b;++g){var y=s[g];if(0===c&&(c=u,(m+=p)>=f&&(p=4*h+4*i*(_-1),m=d+(u+h)*(_<<1),_>>=1)),y===l)m+=4;else{var x=e[o+3*y],w=e[o+3*y+1],v=e[o+3*y+2];a[m++]=v,a[m++]=w,a[m++]=x,a[m++]=255}--c}},this.decodeAndBlitFrameRGBA=function(t,a){var r=this.frameInfo(t),n=r.width*r.height,s=new Uint8Array(n);GifReaderLZWOutputIndexStream(e,r.data_offset,s,n);var o=r.palette_offset,l=r.transparent_index;null===l&&(l=256);var u=r.width,h=i-u,c=u,d=4*(r.y*i+r.x),f=4*((r.y+r.height)*i+r.x),m=d,p=4*h;!0===r.interlaced&&(p+=4*i*7);for(var _=8,g=0,b=s.length;g<b;++g){var y=s[g];if(0===c&&(c=u,(m+=p)>=f&&(p=4*h+4*i*(_-1),m=d+(u+h)*(_<<1),_>>=1)),y===l)m+=4;else{var x=e[o+3*y],w=e[o+3*y+1],v=e[o+3*y+2];a[m++]=x,a[m++]=w,a[m++]=v,a[m++]=255}--c}}}function GifReaderLZWOutputIndexStream(e,t,i,a){for(var r=e[t++],n=1<<r,s=n+1,o=s+1,l=r+1,u=(1<<l)-1,h=0,c=0,d=0,f=e[t++],m=new Int32Array(4096),p=null;;){for(;h<16&&0!==f;)c|=e[t++]<<h,h+=8,1===f?f=e[t++]:--f;if(h<l)break;var _=c&u;if(c>>=l,h-=l,_!==n){if(_===s)break;for(var g=_<o?_:p,b=0,y=g;y>n;)y=m[y]>>8,++b;var x=y;if(d+b+(g!==_?1:0)>a)return void console.log("Warning, gif stream longer than expected.");i[d++]=x;var w=d+=b;for(g!==_&&(i[d++]=x),y=g;b--;)y=m[y],i[--w]=255&y,y>>=8;null!==p&&o<4096&&(m[o++]=p<<8|x,o>=u+1&&l<12&&(++l,u=u<<1|1)),p=_}else o=s+1,u=(1<<(l=r+1))-1,p=null}return d!==a&&console.log("Warning, gif stream shorter than expected."),i}try{GifWriter_1=omggif.GifWriter=GifWriter,GifReader_1=omggif.GifReader=GifReader}catch(e){}let BitmapImage$2=class e{constructor(...t){if(0===t.length)throw new Error("constructor requires parameters");const i=t[0];if(null!==i&&"object"==typeof i)if(i instanceof e){const e=i.bitmap;this.bitmap={width:e.width,height:e.height,data:new Buffer(e.width*e.height*4)},e.data.copy(this.bitmap.data)}else{if(!(i.width&&i.height&&i.data))throw new Error("unrecognized constructor parameters");this.bitmap=i}else{if("number"!=typeof i||"number"!=typeof t[1])throw new Error("unrecognized constructor parameters");{const e=i,a=t[1],r=t[2];this.bitmap={width:e,height:a},Buffer.isBuffer(r)?this.bitmap.data=r:(this.bitmap.data=new Buffer(e*a*4),"number"==typeof r&&this.fillRGBA(r))}}}blit(e,t,i,a,r,n,s){if(a+n>this.bitmap.width)throw new Error("copy exceeds width of source bitmap");if(t+n>e.bitmap.width)throw new Error("copy exceeds width of target bitmap");if(r+s>this.bitmap.height)throw new Error("copy exceeds height of source bitmap");if(i+s>e.bitmap.height)throw new Erro("copy exceeds height of target bitmap");const o=this.bitmap.data,l=e.bitmap.data,u=4*this.bitmap.width,h=4*e.bitmap.width,c=4*n;let d=r*u+4*a,f=i*h+4*t;for(;--s>=0;)o.copy(l,f,d,d+c),d+=u,f+=h;return this}fillRGBA(e){const t=this.bitmap.data,i=4*this.bitmap.height;let a=0;for(;a<i;)t.writeUInt32BE(e,a),a+=4;for(;a<t.length;)t.copy(t,a,0,i),a+=i;return this}getRGBA(e,t){const i=4*(t*this.bitmap.width+e);return this.bitmap.data.readUInt32BE(i)}getRGBASet(){const e=new Set,t=this.bitmap.data;for(let i=0;i<t.length;i+=4)e.add(t.readUInt32BE(i,!0));return e}greyscale(){const e=this.bitmap.data;return this.scan(0,0,this.bitmap.width,this.bitmap.height,((t,i,a)=>{const r=Math.round(.299*e[a]+.587*e[a+1]+.114*e[a+2]);e[a]=r,e[a+1]=r,e[a+2]=r})),this}reframe(t,i,a,r,n){const s=t<0?0:t,o=i<0?0:i,l=a+s>this.bitmap.width?this.bitmap.width-s:a,u=r+o>this.bitmap.height?this.bitmap.height-o:r,h=t<0?-t:0,c=i<0?-i:0;let d;if(void 0===n){if(s!==t||o!=i||l!==a||u!==r)throw new GifError("fillRGBA required for this reframing");d=new e(a,r)}else d=new e(a,r,n);return this.blit(d,h,c,s,o,l,u),this.bitmap=d.bitmap,this}scale(e){if(1===e)return;if(!Number.isInteger(e)||e<1)throw new Error("the scale must be an integer >= 1");const t=this.bitmap.width,i=this.bitmap.height,a=t*e*4,r=this.bitmap.data,n=new Buffer(i*a*e);let s,o=0,l=0;for(let u=0;u<i;++u){s=l;for(let i=0;i<t;++i){const t=r.readUInt32BE(o,!0);for(let i=0;i<e;++i)n.writeUInt32BE(t,l),l+=4;o+=4}for(let t=1;t<e;++t)n.copy(n,l,s,l),l+=a,s+=a}return this.bitmap={width:t*e,height:i*e,data:n},this}scanAllCoords(e){const t=this.bitmap.width,i=this.bitmap.data.length;let a=0,r=0;for(let n=0;n<i;n+=4)e(a,r,n),++a===t&&(a=0,++r)}scanAllIndexes(e){const t=this.bitmap.data.length;for(let i=0;i<t;i+=4)e(i)}};var bitmapimage=BitmapImage$2,gif$1={};let Gif$1=class{constructor(e,t,i){this.width=i.width,this.height=i.height,this.loops=i.loops,this.usesTransparency=i.usesTransparency,this.colorScope=i.colorScope,this.frames=t,this.buffer=e}};Gif$1.GlobalColorsPreferred=0,Gif$1.GlobalColorsOnly=1,Gif$1.LocalColorsOnly=2;let GifError$2=class extends Error{constructor(e){super(e),e instanceof Error&&(this.stack="Gif"+e.stack)}};gif$1.Gif=Gif$1,gif$1.GifError=GifError$2;var gifcodec={},gifutil={},__defProp$1=Object.defineProperty,__getOwnPropDesc=Object.getOwnPropertyDescriptor,__getOwnPropNames=Object.getOwnPropertyNames,__hasOwnProp=Object.prototype.hasOwnProperty,__defNormalProp$1=(e,t,i)=>t in e?__defProp$1(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,__markAsModule=e=>__defProp$1(e,"__esModule",{value:!0}),__export$1=(e,t)=>{for(var i in t)__defProp$1(e,i,{get:t[i],enumerable:!0})},__reExport=(e,t,i,a)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of __getOwnPropNames(t))__hasOwnProp.call(e,r)||!i&&"default"===r||__defProp$1(e,r,{get:()=>t[r],enumerable:!(a=__getOwnPropDesc(t,r))||a.enumerable});return e},__toCommonJS=(e=>(t,i)=>e&&e.get(t)||(i=__reExport(__markAsModule({}),t,1),e&&e.set(t,i),i))("undefined"!=typeof WeakMap?new WeakMap:0),__publicField$1=(e,t,i)=>(__defNormalProp$1(e,"symbol"!=typeof t?t+"":t,i),i),src_exports={};__export$1(src_exports,{applyPalette:()=>applyPalette,applyPaletteSync:()=>applyPaletteSync$1,buildPalette:()=>buildPalette,buildPaletteSync:()=>buildPaletteSync$1,constants:()=>constants_exports$1,conversion:()=>conversion_exports$1,distance:()=>distance_exports$1,image:()=>image_exports$1,palette:()=>palette_exports$1,quality:()=>quality_exports$1,utils:()=>utils_exports$1});var constants_exports$1={};__export$1(constants_exports$1,{bt709:()=>bt709_exports$1});var bt709_exports$1={};__export$1(bt709_exports$1,{Y:()=>Y$1,x:()=>x$1,y:()=>y$1});var Y$1=(e=>(e[e.RED=.2126]="RED",e[e.GREEN=.7152]="GREEN",e[e.BLUE=.0722]="BLUE",e[e.WHITE=1]="WHITE",e))(Y$1||{}),x$1=(e=>(e[e.RED=.64]="RED",e[e.GREEN=.3]="GREEN",e[e.BLUE=.15]="BLUE",e[e.WHITE=.3127]="WHITE",e))(x$1||{}),y$1=(e=>(e[e.RED=.33]="RED",e[e.GREEN=.6]="GREEN",e[e.BLUE=.06]="BLUE",e[e.WHITE=.329]="WHITE",e))(y$1||{}),conversion_exports$1={};function correctGamma$1(e){return e>.04045?((e+.055)/1.055)**2.4:e/12.92}function rgb2xyz$1(e,t,i){return{x:.4124*(e=correctGamma$1(e/255))+.3576*(t=correctGamma$1(t/255))+.1805*(i=correctGamma$1(i/255)),y:.2126*e+.7152*t+.0722*i,z:.0193*e+.1192*t+.9505*i}}__export$1(conversion_exports$1,{lab2rgb:()=>lab2rgb$1,lab2xyz:()=>lab2xyz$1,rgb2hsl:()=>rgb2hsl$1,rgb2lab:()=>rgb2lab$1,rgb2xyz:()=>rgb2xyz$1,xyz2lab:()=>xyz2lab$1,xyz2rgb:()=>xyz2rgb$1});var arithmetic_exports$1={};function degrees2radians$1(e){return e*(Math.PI/180)}function max3$1(e,t,i){let a=e;return a<t&&(a=t),a<i&&(a=i),a}function min3$1(e,t,i){let a=e;return a>t&&(a=t),a>i&&(a=i),a}function intInRange$1(e,t,i){return e>i&&(e=i),e<t&&(e=t),0|e}function inRange0to255Rounded$1(e){return(e=Math.round(e))>255?e=255:e<0&&(e=0),e}function inRange0to255$1(e){return e>255?e=255:e<0&&(e=0),e}function stableSort$1(e,t){const i=typeof e[0];let a;if("number"===i||"string"===i){const i=Object.create(null);for(let t=0,a=e.length;t<a;t++){const a=e[t];i[a]||0===i[a]||(i[a]=t)}a=e.sort(((e,a)=>t(e,a)||i[e]-i[a]))}else{const i=e.slice(0);a=e.sort(((e,a)=>t(e,a)||i.indexOf(e)-i.indexOf(a)))}return a}function rgb2hsl$1(e,t,i){const a=min3$1(e,t,i),r=max3$1(e,t,i),n=r-a,s=(a+r)/510;let o=0;s>0&&s<1&&(o=n/(s<.5?r+a:510-r-a));let l=0;return n>0&&(l=r===e?(t-i)/n:r===t?2+(i-e)/n:4+(e-t)/n,l*=60,l<0&&(l+=360)),{h:l,s:o,l:s}}__export$1(arithmetic_exports$1,{degrees2radians:()=>degrees2radians$1,inRange0to255:()=>inRange0to255$1,inRange0to255Rounded:()=>inRange0to255Rounded$1,intInRange:()=>intInRange$1,max3:()=>max3$1,min3:()=>min3$1,stableSort:()=>stableSort$1});var refX$1=.95047,refY$1=1,refZ$1=1.08883;function pivot$1(e){return e>.008856?e**(1/3):7.787*e+16/116}function xyz2lab$1(e,t,i){if(e=pivot$1(e/refX$1),t=pivot$1(t/refY$1),i=pivot$1(i/refZ$1),116*t-16<0)throw new Error("xxx");return{L:Math.max(0,116*t-16),a:500*(e-t),b:200*(t-i)}}function rgb2lab$1(e,t,i){const a=rgb2xyz$1(e,t,i);return xyz2lab$1(a.x,a.y,a.z)}var refX2$1=.95047,refY2$1=1,refZ2$1=1.08883;function pivot2$1(e){return e>.206893034?e**3:(e-16/116)/7.787}function lab2xyz$1(e,t,i){const a=(e+16)/116,r=a-i/200;return{x:refX2$1*pivot2$1(t/500+a),y:refY2$1*pivot2$1(a),z:refZ2$1*pivot2$1(r)}}function correctGamma2$1(e){return e>.0031308?1.055*e**(1/2.4)-.055:12.92*e}function xyz2rgb$1(e,t,i){const a=correctGamma2$1(3.2406*e+-1.5372*t+-.4986*i),r=correctGamma2$1(-.9689*e+1.8758*t+.0415*i),n=correctGamma2$1(.0557*e+-.204*t+1.057*i);return{r:inRange0to255Rounded$1(255*a),g:inRange0to255Rounded$1(255*r),b:inRange0to255Rounded$1(255*n)}}function lab2rgb$1(e,t,i){const a=lab2xyz$1(e,t,i);return xyz2rgb$1(a.x,a.y,a.z)}var distance_exports$1={};__export$1(distance_exports$1,{AbstractDistanceCalculator:()=>AbstractDistanceCalculator$1,AbstractEuclidean:()=>AbstractEuclidean$1,AbstractManhattan:()=>AbstractManhattan$1,CIE94GraphicArts:()=>CIE94GraphicArts$1,CIE94Textiles:()=>CIE94Textiles$1,CIEDE2000:()=>CIEDE2000$1,CMetric:()=>CMetric$1,Euclidean:()=>Euclidean$1,EuclideanBT709:()=>EuclideanBT709$1,EuclideanBT709NoAlpha:()=>EuclideanBT709NoAlpha$1,Manhattan:()=>Manhattan$1,ManhattanBT709:()=>ManhattanBT709$1,ManhattanNommyde:()=>ManhattanNommyde$1,PNGQuant:()=>PNGQuant$1});var AbstractDistanceCalculator$1=class{constructor(){__publicField$1(this,"_maxDistance"),__publicField$1(this,"_whitePoint"),this._setDefaults(),this.setWhitePoint(255,255,255,255)}setWhitePoint(e,t,i,a){this._whitePoint={r:e>0?255/e:0,g:t>0?255/t:0,b:i>0?255/i:0,a:a>0?255/a:0},this._maxDistance=this.calculateRaw(e,t,i,a,0,0,0,0)}calculateNormalized(e,t){return this.calculateRaw(e.r,e.g,e.b,e.a,t.r,t.g,t.b,t.a)/this._maxDistance}},AbstractCIE94$1=class extends AbstractDistanceCalculator$1{calculateRaw(e,t,i,a,r,n,s,o){const l=rgb2lab$1(inRange0to255$1(e*this._whitePoint.r),inRange0to255$1(t*this._whitePoint.g),inRange0to255$1(i*this._whitePoint.b)),u=rgb2lab$1(inRange0to255$1(r*this._whitePoint.r),inRange0to255$1(n*this._whitePoint.g),inRange0to255$1(s*this._whitePoint.b)),h=l.L-u.L,c=l.a-u.a,d=l.b-u.b,f=Math.sqrt(l.a*l.a+l.b*l.b),m=f-Math.sqrt(u.a*u.a+u.b*u.b);let p=c*c+d*d-m*m;p=p<0?0:Math.sqrt(p);const _=(o-a)*this._whitePoint.a*this._kA;return Math.sqrt((h/this._Kl)**2+(m/(1+this._K1*f))**2+(p/(1+this._K2*f))**2+_**2)}},CIE94Textiles$1=class extends AbstractCIE94$1{_setDefaults(){this._Kl=2,this._K1=.048,this._K2=.014,this._kA=12.5/255}},CIE94GraphicArts$1=class extends AbstractCIE94$1{_setDefaults(){this._Kl=1,this._K1=.045,this._K2=.015,this._kA=25/255}},_CIEDE2000$1=class extends AbstractDistanceCalculator$1{_setDefaults(){}static _calculatehp(e,t){const i=Math.atan2(e,t);return i>=0?i:i+_CIEDE2000$1._deg360InRad}static _calculateRT(e,t){const i=t**7,a=2*Math.sqrt(i/(i+_CIEDE2000$1._pow25to7)),r=_CIEDE2000$1._deg30InRad*Math.exp(-(((e-_CIEDE2000$1._deg275InRad)/_CIEDE2000$1._deg25InRad)**2));return-Math.sin(2*r)*a}static _calculateT(e){return 1-.17*Math.cos(e-_CIEDE2000$1._deg30InRad)+.24*Math.cos(2*e)+.32*Math.cos(3*e+_CIEDE2000$1._deg6InRad)-.2*Math.cos(4*e-_CIEDE2000$1._deg63InRad)}static _calculate_ahp(e,t,i,a){const r=i+a;return 0===e?r:t<=_CIEDE2000$1._deg180InRad?r/2:r<_CIEDE2000$1._deg360InRad?(r+_CIEDE2000$1._deg360InRad)/2:(r-_CIEDE2000$1._deg360InRad)/2}static _calculate_dHp(e,t,i,a){let r;return r=0===e?0:t<=_CIEDE2000$1._deg180InRad?i-a:i<=a?i-a+_CIEDE2000$1._deg360InRad:i-a-_CIEDE2000$1._deg360InRad,2*Math.sqrt(e)*Math.sin(r/2)}calculateRaw(e,t,i,a,r,n,s,o){const l=rgb2lab$1(inRange0to255$1(e*this._whitePoint.r),inRange0to255$1(t*this._whitePoint.g),inRange0to255$1(i*this._whitePoint.b)),u=rgb2lab$1(inRange0to255$1(r*this._whitePoint.r),inRange0to255$1(n*this._whitePoint.g),inRange0to255$1(s*this._whitePoint.b)),h=(o-a)*this._whitePoint.a*_CIEDE2000$1._kA,c=this.calculateRawInLab(l,u);return Math.sqrt(c+h*h)}calculateRawInLab(e,t){const i=e.L,a=e.a,r=e.b,n=t.L,s=t.a,o=t.b,l=((Math.sqrt(a*a+r*r)+Math.sqrt(s*s+o*o))/2)**7,u=.5*(1-Math.sqrt(l/(l+_CIEDE2000$1._pow25to7))),h=(1+u)*a,c=(1+u)*s,d=Math.sqrt(h*h+r*r),f=Math.sqrt(c*c+o*o),m=d*f,p=_CIEDE2000$1._calculatehp(r,h),_=_CIEDE2000$1._calculatehp(o,c),g=Math.abs(p-_),b=n-i,y=f-d,x=_CIEDE2000$1._calculate_dHp(m,g,_,p),w=_CIEDE2000$1._calculate_ahp(m,g,p,_),v=(d+f)/2,k=((i+n)/2-50)**2,M=y/(1+.045*v),I=x/(1+.015*_CIEDE2000$1._calculateT(w)*v);return(b/(1+.015*k/Math.sqrt(20+k)))**2+M**2+I**2+_CIEDE2000$1._calculateRT(w,v)*M*I}},CIEDE2000$1=_CIEDE2000$1;__publicField$1(CIEDE2000$1,"_kA",25/255),__publicField$1(CIEDE2000$1,"_pow25to7",25**7),__publicField$1(CIEDE2000$1,"_deg360InRad",degrees2radians$1(360)),__publicField$1(CIEDE2000$1,"_deg180InRad",degrees2radians$1(180)),__publicField$1(CIEDE2000$1,"_deg30InRad",degrees2radians$1(30)),__publicField$1(CIEDE2000$1,"_deg6InRad",degrees2radians$1(6)),__publicField$1(CIEDE2000$1,"_deg63InRad",degrees2radians$1(63)),__publicField$1(CIEDE2000$1,"_deg275InRad",degrees2radians$1(275)),__publicField$1(CIEDE2000$1,"_deg25InRad",degrees2radians$1(25));var CMetric$1=class extends AbstractDistanceCalculator$1{calculateRaw(e,t,i,a,r,n,s,o){const l=(e+r)/2*this._whitePoint.r,u=(e-r)*this._whitePoint.r,h=(t-n)*this._whitePoint.g,c=(i-s)*this._whitePoint.b,d=((512+l)*u*u>>8)+4*h*h+((767-l)*c*c>>8),f=(o-a)*this._whitePoint.a;return Math.sqrt(d+f*f)}_setDefaults(){}},AbstractEuclidean$1=class extends AbstractDistanceCalculator$1{calculateRaw(e,t,i,a,r,n,s,o){const l=r-e,u=n-t,h=s-i,c=o-a;return Math.sqrt(this._kR*l*l+this._kG*u*u+this._kB*h*h+this._kA*c*c)}},Euclidean$1=class extends AbstractEuclidean$1{_setDefaults(){this._kR=1,this._kG=1,this._kB=1,this._kA=1}},EuclideanBT709$1=class extends AbstractEuclidean$1{_setDefaults(){this._kR=.2126,this._kG=.7152,this._kB=.0722,this._kA=1}},EuclideanBT709NoAlpha$1=class extends AbstractEuclidean$1{_setDefaults(){this._kR=.2126,this._kG=.7152,this._kB=.0722,this._kA=0}},AbstractManhattan$1=class extends AbstractDistanceCalculator$1{calculateRaw(e,t,i,a,r,n,s,o){let l=r-e,u=n-t,h=s-i,c=o-a;return l<0&&(l=0-l),u<0&&(u=0-u),h<0&&(h=0-h),c<0&&(c=0-c),this._kR*l+this._kG*u+this._kB*h+this._kA*c}},Manhattan$1=class extends AbstractManhattan$1{_setDefaults(){this._kR=1,this._kG=1,this._kB=1,this._kA=1}},ManhattanNommyde$1=class extends AbstractManhattan$1{_setDefaults(){this._kR=.4984,this._kG=.8625,this._kB=.2979,this._kA=1}},ManhattanBT709$1=class extends AbstractManhattan$1{_setDefaults(){this._kR=.2126,this._kG=.7152,this._kB=.0722,this._kA=1}},PNGQuant$1=class extends AbstractDistanceCalculator$1{calculateRaw(e,t,i,a,r,n,s,o){const l=(o-a)*this._whitePoint.a;return this._colordifferenceCh(e*this._whitePoint.r,r*this._whitePoint.r,l)+this._colordifferenceCh(t*this._whitePoint.g,n*this._whitePoint.g,l)+this._colordifferenceCh(i*this._whitePoint.b,s*this._whitePoint.b,l)}_colordifferenceCh(e,t,i){const a=e-t,r=a+i;return a*a+r*r}_setDefaults(){}},palette_exports$1={};__export$1(palette_exports$1,{AbstractPaletteQuantizer:()=>AbstractPaletteQuantizer$1,ColorHistogram:()=>ColorHistogram$1,NeuQuant:()=>NeuQuant$1,NeuQuantFloat:()=>NeuQuantFloat$1,RGBQuant:()=>RGBQuant$1,WuColorCube:()=>WuColorCube$1,WuQuant:()=>WuQuant$1});var AbstractPaletteQuantizer$1=class{quantizeSync(){for(const e of this.quantize())if(e.palette)return e.palette;throw new Error("unreachable")}},Point$1=class{constructor(){__publicField$1(this,"r"),__publicField$1(this,"g"),__publicField$1(this,"b"),__publicField$1(this,"a"),__publicField$1(this,"uint32"),__publicField$1(this,"rgba"),this.uint32=-1>>>0,this.r=this.g=this.b=this.a=0,this.rgba=new Array(4),this.rgba[0]=0,this.rgba[1]=0,this.rgba[2]=0,this.rgba[3]=0}static createByQuadruplet(e){const t=new Point$1;return t.r=0|e[0],t.g=0|e[1],t.b=0|e[2],t.a=0|e[3],t._loadUINT32(),t._loadQuadruplet(),t}static createByRGBA(e,t,i,a){const r=new Point$1;return r.r=0|e,r.g=0|t,r.b=0|i,r.a=0|a,r._loadUINT32(),r._loadQuadruplet(),r}static createByUint32(e){const t=new Point$1;return t.uint32=e>>>0,t._loadRGBA(),t._loadQuadruplet(),t}from(e){this.r=e.r,this.g=e.g,this.b=e.b,this.a=e.a,this.uint32=e.uint32,this.rgba[0]=e.r,this.rgba[1]=e.g,this.rgba[2]=e.b,this.rgba[3]=e.a}getLuminosity(e){let t=this.r,i=this.g,a=this.b;return e&&(t=Math.min(255,255-this.a+this.a*t/255),i=Math.min(255,255-this.a+this.a*i/255),a=Math.min(255,255-this.a+this.a*a/255)),.2126*t+.7152*i+.0722*a}_loadUINT32(){this.uint32=(this.a<<24|this.b<<16|this.g<<8|this.r)>>>0}_loadRGBA(){this.r=255&this.uint32,this.g=this.uint32>>>8&255,this.b=this.uint32>>>16&255,this.a=this.uint32>>>24&255}_loadQuadruplet(){this.rgba[0]=this.r,this.rgba[1]=this.g,this.rgba[2]=this.b,this.rgba[3]=this.a}},PointContainer$1=class{constructor(){__publicField$1(this,"_pointArray"),__publicField$1(this,"_width"),__publicField$1(this,"_height"),this._width=0,this._height=0,this._pointArray=[]}getWidth(){return this._width}getHeight(){return this._height}setWidth(e){this._width=e}setHeight(e){this._height=e}getPointArray(){return this._pointArray}clone(){const e=new PointContainer$1;e._width=this._width,e._height=this._height;for(let t=0,i=this._pointArray.length;t<i;t++)e._pointArray[t]=Point$1.createByUint32(0|this._pointArray[t].uint32);return e}toUint32Array(){const e=this._pointArray.length,t=new Uint32Array(e);for(let i=0;i<e;i++)t[i]=this._pointArray[i].uint32;return t}toUint8Array(){return new Uint8Array(this.toUint32Array().buffer)}static fromHTMLImageElement(e){const t=e.naturalWidth,i=e.naturalHeight,a=document.createElement("canvas");a.width=t,a.height=i;return a.getContext("2d").drawImage(e,0,0,t,i,0,0,t,i),PointContainer$1.fromHTMLCanvasElement(a)}static fromHTMLCanvasElement(e){const t=e.width,i=e.height,a=e.getContext("2d").getImageData(0,0,t,i);return PointContainer$1.fromImageData(a)}static fromImageData(e){const t=e.width,i=e.height;return PointContainer$1.fromUint8Array(e.data,t,i)}static fromUint8Array(e,t,i){switch(Object.prototype.toString.call(e)){case"[object Uint8ClampedArray]":case"[object Uint8Array]":break;default:e=new Uint8Array(e)}const a=new Uint32Array(e.buffer);return PointContainer$1.fromUint32Array(a,t,i)}static fromUint32Array(e,t,i){const a=new PointContainer$1;a._width=t,a._height=i;for(let t=0,i=e.length;t<i;t++)a._pointArray[t]=Point$1.createByUint32(0|e[t]);return a}static fromBuffer(e,t,i){const a=new Uint32Array(e.buffer,e.byteOffset,e.byteLength/Uint32Array.BYTES_PER_ELEMENT);return PointContainer$1.fromUint32Array(a,t,i)}},hueGroups$1=10;function hueGroup$1(e,t){const i=360/t;for(let a=1,r=i-i/2;a<t;a++,r+=i)if(e>=r&&e<r+i)return a;return 0}var Palette$1=class{constructor(){__publicField$1(this,"_pointContainer"),__publicField$1(this,"_pointArray",[]),__publicField$1(this,"_i32idx",{}),this._pointContainer=new PointContainer$1,this._pointContainer.setHeight(1),this._pointArray=this._pointContainer.getPointArray()}add(e){this._pointArray.push(e),this._pointContainer.setWidth(this._pointArray.length)}has(e){for(let t=this._pointArray.length-1;t>=0;t--)if(e.uint32===this._pointArray[t].uint32)return!0;return!1}getNearestColor(e,t){return this._pointArray[0|this._getNearestIndex(e,t)]}getPointContainer(){return this._pointContainer}_nearestPointFromCache(e){return"number"==typeof this._i32idx[e]?this._i32idx[e]:-1}_getNearestIndex(e,t){let i=this._nearestPointFromCache(""+t.uint32);if(i>=0)return i;let a=Number.MAX_VALUE;i=0;for(let r=0,n=this._pointArray.length;r<n;r++){const n=this._pointArray[r],s=e.calculateRaw(t.r,t.g,t.b,t.a,n.r,n.g,n.b,n.a);s<a&&(a=s,i=r)}return this._i32idx[t.uint32]=i,i}sort(){this._i32idx={},this._pointArray.sort(((e,t)=>{const i=rgb2hsl$1(e.r,e.g,e.b),a=rgb2hsl$1(t.r,t.g,t.b),r=e.r===e.g&&e.g===e.b?0:1+hueGroup$1(i.h,hueGroups$1),n=(t.r===t.g&&t.g===t.b?0:1+hueGroup$1(a.h,hueGroups$1))-r;if(n)return-n;const s=e.getLuminosity(!0),o=t.getLuminosity(!0);if(o-s!=0)return o-s;const l=(100*a.s|0)-(100*i.s|0);return l?-l:0}))}},utils_exports$1={};__export$1(utils_exports$1,{HueStatistics:()=>HueStatistics$1,Palette:()=>Palette$1,Point:()=>Point$1,PointContainer:()=>PointContainer$1,ProgressTracker:()=>ProgressTracker$1,arithmetic:()=>arithmetic_exports$1});var HueGroup$1=class{constructor(){__publicField$1(this,"num",0),__publicField$1(this,"cols",[])}},HueStatistics$1=class{constructor(e,t){__publicField$1(this,"_numGroups"),__publicField$1(this,"_minCols"),__publicField$1(this,"_stats"),__publicField$1(this,"_groupsFull"),this._numGroups=e,this._minCols=t,this._stats=[];for(let t=0;t<=e;t++)this._stats[t]=new HueGroup$1;this._groupsFull=0}check(e){this._groupsFull===this._numGroups+1&&(this.check=()=>{});const t=255&e,i=e>>>8&255,a=e>>>16&255,r=t===i&&i===a?0:1+hueGroup$1(rgb2hsl$1(t,i,a).h,this._numGroups),n=this._stats[r],s=this._minCols;n.num++,n.num>s||(n.num===s&&this._groupsFull++,n.num<=s&&this._stats[r].cols.push(e))}injectIntoDictionary(e){for(let t=0;t<=this._numGroups;t++)this._stats[t].num<=this._minCols&&this._stats[t].cols.forEach((t=>{e[t]?e[t]++:e[t]=1}))}injectIntoArray(e){for(let t=0;t<=this._numGroups;t++)this._stats[t].num<=this._minCols&&this._stats[t].cols.forEach((t=>{-1===e.indexOf(t)&&e.push(t)}))}},_ProgressTracker$1=class{constructor(e,t){__publicField$1(this,"progress"),__publicField$1(this,"_step"),__publicField$1(this,"_range"),__publicField$1(this,"_last"),__publicField$1(this,"_progressRange"),this._range=e,this._progressRange=t,this._step=Math.max(1,this._range/(_ProgressTracker$1.steps+1)|0),this._last=-this._step,this.progress=0}shouldNotify(e){return e-this._last>=this._step&&(this._last=e,this.progress=Math.min(this._progressRange*this._last/this._range,this._progressRange),!0)}},ProgressTracker$1=_ProgressTracker$1;__publicField$1(ProgressTracker$1,"steps",100);var networkBiasShift$1=3,Neuron$1=class{constructor(e){__publicField$1(this,"r"),__publicField$1(this,"g"),__publicField$1(this,"b"),__publicField$1(this,"a"),this.r=this.g=this.b=this.a=e}toPoint(){return Point$1.createByRGBA(this.r>>networkBiasShift$1,this.g>>networkBiasShift$1,this.b>>networkBiasShift$1,this.a>>networkBiasShift$1)}subtract(e,t,i,a){this.r-=0|e,this.g-=0|t,this.b-=0|i,this.a-=0|a}},_NeuQuant$1=class extends AbstractPaletteQuantizer$1{constructor(e,t=256){super(),__publicField$1(this,"_pointArray"),__publicField$1(this,"_networkSize"),__publicField$1(this,"_network"),__publicField$1(this,"_sampleFactor"),__publicField$1(this,"_radPower"),__publicField$1(this,"_freq"),__publicField$1(this,"_bias"),__publicField$1(this,"_distance"),this._distance=e,this._pointArray=[],this._sampleFactor=1,this._networkSize=t,this._distance.setWhitePoint(255<<networkBiasShift$1,255<<networkBiasShift$1,255<<networkBiasShift$1,255<<networkBiasShift$1)}sample(e){this._pointArray=this._pointArray.concat(e.getPointArray())}*quantize(){this._init(),yield*this._learn(),yield{palette:this._buildPalette(),progress:100}}_init(){this._freq=[],this._bias=[],this._radPower=[],this._network=[];for(let e=0;e<this._networkSize;e++)this._network[e]=new Neuron$1((e<<networkBiasShift$1+8)/this._networkSize|0),this._freq[e]=_NeuQuant$1._initialBias/this._networkSize|0,this._bias[e]=0}*_learn(){let e=this._sampleFactor;const t=this._pointArray.length;t<_NeuQuant$1._minpicturebytes&&(e=1);const i=30+(e-1)/3|0,a=t/e|0;let r,n=a/_NeuQuant$1._nCycles|0,s=_NeuQuant$1._initAlpha,o=(this._networkSize>>3)*_NeuQuant$1._radiusBias,l=o>>_NeuQuant$1._radiusBiasShift;l<=1&&(l=0);for(let e=0;e<l;e++)this._radPower[e]=s*((l*l-e*e)*_NeuQuant$1._radBias/(l*l))>>>0;r=t<_NeuQuant$1._minpicturebytes?1:t%_NeuQuant$1._prime1!=0?_NeuQuant$1._prime1:t%_NeuQuant$1._prime2!=0?_NeuQuant$1._prime2:t%_NeuQuant$1._prime3!=0?_NeuQuant$1._prime3:_NeuQuant$1._prime4;const u=new ProgressTracker$1(a,99);for(let e=0,h=0;e<a;){u.shouldNotify(e)&&(yield{progress:u.progress});const a=this._pointArray[h],c=a.b<<networkBiasShift$1,d=a.g<<networkBiasShift$1,f=a.r<<networkBiasShift$1,m=a.a<<networkBiasShift$1,p=this._contest(c,d,f,m);if(this._alterSingle(s,p,c,d,f,m),0!==l&&this._alterNeighbour(l,p,c,d,f,m),h+=r,h>=t&&(h-=t),e++,0===n&&(n=1),e%n==0){s-=s/i|0,o-=o/_NeuQuant$1._radiusDecrease|0,l=o>>_NeuQuant$1._radiusBiasShift,l<=1&&(l=0);for(let e=0;e<l;e++)this._radPower[e]=s*((l*l-e*e)*_NeuQuant$1._radBias/(l*l))>>>0}}}_buildPalette(){const e=new Palette$1;return this._network.forEach((t=>{e.add(t.toPoint())})),e.sort(),e}_alterNeighbour(e,t,i,a,r,n){let s=t-e;s<-1&&(s=-1);let o=t+e;o>this._networkSize&&(o=this._networkSize);let l=t+1,u=t-1,h=1;for(;l<o||u>s;){const e=this._radPower[h++]/_NeuQuant$1._alphaRadBias;if(l<o){const t=this._network[l++];t.subtract(e*(t.r-r),e*(t.g-a),e*(t.b-i),e*(t.a-n))}if(u>s){const t=this._network[u--];t.subtract(e*(t.r-r),e*(t.g-a),e*(t.b-i),e*(t.a-n))}}}_alterSingle(e,t,i,a,r,n){e/=_NeuQuant$1._initAlpha;const s=this._network[t];s.subtract(e*(s.r-r),e*(s.g-a),e*(s.b-i),e*(s.a-n))}_contest(e,t,i,a){const r=1020<<networkBiasShift$1;let n=~(1<<31),s=n,o=-1,l=o;for(let u=0;u<this._networkSize;u++){const h=this._network[u],c=this._distance.calculateNormalized(h,{r:i,g:t,b:e,a:a})*r|0;c<n&&(n=c,o=u);const d=c-(this._bias[u]>>_NeuQuant$1._initialBiasShift-networkBiasShift$1);d<s&&(s=d,l=u);const f=this._freq[u]>>_NeuQuant$1._betaShift;this._freq[u]-=f,this._bias[u]+=f<<_NeuQuant$1._gammaShift}return this._freq[o]+=_NeuQuant$1._beta,this._bias[o]-=_NeuQuant$1._betaGamma,l}},NeuQuant$1=_NeuQuant$1;__publicField$1(NeuQuant$1,"_prime1",499),__publicField$1(NeuQuant$1,"_prime2",491),__publicField$1(NeuQuant$1,"_prime3",487),__publicField$1(NeuQuant$1,"_prime4",503),__publicField$1(NeuQuant$1,"_minpicturebytes",_NeuQuant$1._prime4),__publicField$1(NeuQuant$1,"_nCycles",100),__publicField$1(NeuQuant$1,"_initialBiasShift",16),__publicField$1(NeuQuant$1,"_initialBias",1<<_NeuQuant$1._initialBiasShift),__publicField$1(NeuQuant$1,"_gammaShift",10),__publicField$1(NeuQuant$1,"_betaShift",10),__publicField$1(NeuQuant$1,"_beta",_NeuQuant$1._initialBias>>_NeuQuant$1._betaShift),__publicField$1(NeuQuant$1,"_betaGamma",_NeuQuant$1._initialBias<<_NeuQuant$1._gammaShift-_NeuQuant$1._betaShift),__publicField$1(NeuQuant$1,"_radiusBiasShift",6),__publicField$1(NeuQuant$1,"_radiusBias",1<<_NeuQuant$1._radiusBiasShift),__publicField$1(NeuQuant$1,"_radiusDecrease",30),__publicField$1(NeuQuant$1,"_alphaBiasShift",10),__publicField$1(NeuQuant$1,"_initAlpha",1<<_NeuQuant$1._alphaBiasShift),__publicField$1(NeuQuant$1,"_radBiasShift",8),__publicField$1(NeuQuant$1,"_radBias",1<<_NeuQuant$1._radBiasShift),__publicField$1(NeuQuant$1,"_alphaRadBiasShift",_NeuQuant$1._alphaBiasShift+_NeuQuant$1._radBiasShift),__publicField$1(NeuQuant$1,"_alphaRadBias",1<<_NeuQuant$1._alphaRadBiasShift);var networkBiasShift2$1=3,NeuronFloat$1=class{constructor(e){__publicField$1(this,"r"),__publicField$1(this,"g"),__publicField$1(this,"b"),__publicField$1(this,"a"),this.r=this.g=this.b=this.a=e}toPoint(){return Point$1.createByRGBA(this.r>>networkBiasShift2$1,this.g>>networkBiasShift2$1,this.b>>networkBiasShift2$1,this.a>>networkBiasShift2$1)}subtract(e,t,i,a){this.r-=e,this.g-=t,this.b-=i,this.a-=a}},_NeuQuantFloat$1=class extends AbstractPaletteQuantizer$1{constructor(e,t=256){super(),__publicField$1(this,"_pointArray"),__publicField$1(this,"_networkSize"),__publicField$1(this,"_network"),__publicField$1(this,"_sampleFactor"),__publicField$1(this,"_radPower"),__publicField$1(this,"_freq"),__publicField$1(this,"_bias"),__publicField$1(this,"_distance"),this._distance=e,this._pointArray=[],this._sampleFactor=1,this._networkSize=t,this._distance.setWhitePoint(255<<networkBiasShift2$1,255<<networkBiasShift2$1,255<<networkBiasShift2$1,255<<networkBiasShift2$1)}sample(e){this._pointArray=this._pointArray.concat(e.getPointArray())}*quantize(){this._init(),yield*this._learn(),yield{palette:this._buildPalette(),progress:100}}_init(){this._freq=[],this._bias=[],this._radPower=[],this._network=[];for(let e=0;e<this._networkSize;e++)this._network[e]=new NeuronFloat$1((e<<networkBiasShift2$1+8)/this._networkSize),this._freq[e]=_NeuQuantFloat$1._initialBias/this._networkSize,this._bias[e]=0}*_learn(){let e=this._sampleFactor;const t=this._pointArray.length;t<_NeuQuantFloat$1._minpicturebytes&&(e=1);const i=30+(e-1)/3,a=t/e;let r,n=a/_NeuQuantFloat$1._nCycles|0,s=_NeuQuantFloat$1._initAlpha,o=(this._networkSize>>3)*_NeuQuantFloat$1._radiusBias,l=o>>_NeuQuantFloat$1._radiusBiasShift;l<=1&&(l=0);for(let e=0;e<l;e++)this._radPower[e]=s*((l*l-e*e)*_NeuQuantFloat$1._radBias/(l*l));r=t<_NeuQuantFloat$1._minpicturebytes?1:t%_NeuQuantFloat$1._prime1!=0?_NeuQuantFloat$1._prime1:t%_NeuQuantFloat$1._prime2!=0?_NeuQuantFloat$1._prime2:t%_NeuQuantFloat$1._prime3!=0?_NeuQuantFloat$1._prime3:_NeuQuantFloat$1._prime4;const u=new ProgressTracker$1(a,99);for(let e=0,h=0;e<a;){u.shouldNotify(e)&&(yield{progress:u.progress});const a=this._pointArray[h],c=a.b<<networkBiasShift2$1,d=a.g<<networkBiasShift2$1,f=a.r<<networkBiasShift2$1,m=a.a<<networkBiasShift2$1,p=this._contest(c,d,f,m);if(this._alterSingle(s,p,c,d,f,m),0!==l&&this._alterNeighbour(l,p,c,d,f,m),h+=r,h>=t&&(h-=t),e++,0===n&&(n=1),e%n==0){s-=s/i,o-=o/_NeuQuantFloat$1._radiusDecrease,l=o>>_NeuQuantFloat$1._radiusBiasShift,l<=1&&(l=0);for(let e=0;e<l;e++)this._radPower[e]=s*((l*l-e*e)*_NeuQuantFloat$1._radBias/(l*l))}}}_buildPalette(){const e=new Palette$1;return this._network.forEach((t=>{e.add(t.toPoint())})),e.sort(),e}_alterNeighbour(e,t,i,a,r,n){let s=t-e;s<-1&&(s=-1);let o=t+e;o>this._networkSize&&(o=this._networkSize);let l=t+1,u=t-1,h=1;for(;l<o||u>s;){const e=this._radPower[h++]/_NeuQuantFloat$1._alphaRadBias;if(l<o){const t=this._network[l++];t.subtract(e*(t.r-r),e*(t.g-a),e*(t.b-i),e*(t.a-n))}if(u>s){const t=this._network[u--];t.subtract(e*(t.r-r),e*(t.g-a),e*(t.b-i),e*(t.a-n))}}}_alterSingle(e,t,i,a,r,n){e/=_NeuQuantFloat$1._initAlpha;const s=this._network[t];s.subtract(e*(s.r-r),e*(s.g-a),e*(s.b-i),e*(s.a-n))}_contest(e,t,i,a){const r=1020<<networkBiasShift2$1;let n=~(1<<31),s=n,o=-1,l=o;for(let u=0;u<this._networkSize;u++){const h=this._network[u],c=this._distance.calculateNormalized(h,{r:i,g:t,b:e,a:a})*r;c<n&&(n=c,o=u);const d=c-(this._bias[u]>>_NeuQuantFloat$1._initialBiasShift-networkBiasShift2$1);d<s&&(s=d,l=u);const f=this._freq[u]>>_NeuQuantFloat$1._betaShift;this._freq[u]-=f,this._bias[u]+=f<<_NeuQuantFloat$1._gammaShift}return this._freq[o]+=_NeuQuantFloat$1._beta,this._bias[o]-=_NeuQuantFloat$1._betaGamma,l}},NeuQuantFloat$1=_NeuQuantFloat$1;__publicField$1(NeuQuantFloat$1,"_prime1",499),__publicField$1(NeuQuantFloat$1,"_prime2",491),__publicField$1(NeuQuantFloat$1,"_prime3",487),__publicField$1(NeuQuantFloat$1,"_prime4",503),__publicField$1(NeuQuantFloat$1,"_minpicturebytes",_NeuQuantFloat$1._prime4),__publicField$1(NeuQuantFloat$1,"_nCycles",100),__publicField$1(NeuQuantFloat$1,"_initialBiasShift",16),__publicField$1(NeuQuantFloat$1,"_initialBias",1<<_NeuQuantFloat$1._initialBiasShift),__publicField$1(NeuQuantFloat$1,"_gammaShift",10),__publicField$1(NeuQuantFloat$1,"_betaShift",10),__publicField$1(NeuQuantFloat$1,"_beta",_NeuQuantFloat$1._initialBias>>_NeuQuantFloat$1._betaShift),__publicField$1(NeuQuantFloat$1,"_betaGamma",_NeuQuantFloat$1._initialBias<<_NeuQuantFloat$1._gammaShift-_NeuQuantFloat$1._betaShift),__publicField$1(NeuQuantFloat$1,"_radiusBiasShift",6),__publicField$1(NeuQuantFloat$1,"_radiusBias",1<<_NeuQuantFloat$1._radiusBiasShift),__publicField$1(NeuQuantFloat$1,"_radiusDecrease",30),__publicField$1(NeuQuantFloat$1,"_alphaBiasShift",10),__publicField$1(NeuQuantFloat$1,"_initAlpha",1<<_NeuQuantFloat$1._alphaBiasShift),__publicField$1(NeuQuantFloat$1,"_radBiasShift",8),__publicField$1(NeuQuantFloat$1,"_radBias",1<<_NeuQuantFloat$1._radBiasShift),__publicField$1(NeuQuantFloat$1,"_alphaRadBiasShift",_NeuQuantFloat$1._alphaBiasShift+_NeuQuantFloat$1._radBiasShift),__publicField$1(NeuQuantFloat$1,"_alphaRadBias",1<<_NeuQuantFloat$1._alphaRadBiasShift);var _ColorHistogram$1=class{constructor(e,t){__publicField$1(this,"_method"),__publicField$1(this,"_hueStats"),__publicField$1(this,"_histogram"),__publicField$1(this,"_initColors"),__publicField$1(this,"_minHueCols"),this._method=e,this._minHueCols=t<<2,this._initColors=t<<2,this._hueStats=new HueStatistics$1(_ColorHistogram$1._hueGroups,this._minHueCols),this._histogram=Object.create(null)}sample(e){switch(this._method){case 1:this._colorStats1D(e);break;case 2:this._colorStats2D(e)}}getImportanceSortedColorsIDXI32(){const e=stableSort$1(Object.keys(this._histogram),((e,t)=>this._histogram[t]-this._histogram[e]));if(0===e.length)return[];let t;switch(this._method){case 1:const i=Math.min(e.length,this._initColors),a=e[i-1],r=this._histogram[a];t=e.slice(0,i);let n=i;const s=e.length;for(;n<s&&this._histogram[e[n]]===r;)t.push(e[n++]);this._hueStats.injectIntoArray(t);break;case 2:t=e;break;default:throw new Error("Incorrect method")}return t.map((e=>+e))}_colorStats1D(e){const t=this._histogram,i=e.getPointArray(),a=i.length;for(let e=0;e<a;e++){const a=i[e].uint32;this._hueStats.check(a),a in t?t[a]++:t[a]=1}}_colorStats2D(e){const t=e.getWidth(),i=e.getHeight(),a=e.getPointArray(),r=_ColorHistogram$1._boxSize[0],n=_ColorHistogram$1._boxSize[1],s=r*n,o=this._makeBoxes(t,i,r,n),l=this._histogram;o.forEach((e=>{let i=Math.round(e.w*e.h/s)*_ColorHistogram$1._boxPixels;i<2&&(i=2);const r={};this._iterateBox(e,t,(e=>{const t=a[e].uint32;this._hueStats.check(t),t in l?l[t]++:t in r?++r[t]>=i&&(l[t]=r[t]):r[t]=1}))})),this._hueStats.injectIntoDictionary(l)}_iterateBox(e,t,i){const a=e,r=a.y*t+a.x,n=(a.y+a.h-1)*t+(a.x+a.w-1),s=t-a.w+1;let o=0,l=r;do{i.call(this,l),l+=++o%a.w==0?s:1}while(l<=n)}_makeBoxes(e,t,i,a){const r=e%i,n=t%a,s=e-r,o=t-n,l=[];for(let u=0;u<t;u+=a)for(let t=0;t<e;t+=i)l.push({x:t,y:u,w:t===s?r:i,h:u===o?n:a});return l}},ColorHistogram$1=_ColorHistogram$1;__publicField$1(ColorHistogram$1,"_boxSize",[64,64]),__publicField$1(ColorHistogram$1,"_boxPixels",2),__publicField$1(ColorHistogram$1,"_hueGroups",10);var RemovedColor$1=class{constructor(e,t,i){__publicField$1(this,"index"),__publicField$1(this,"color"),__publicField$1(this,"distance"),this.index=e,this.color=t,this.distance=i}},RGBQuant$1=class extends AbstractPaletteQuantizer$1{constructor(e,t=256,i=2){super(),__publicField$1(this,"_colors"),__publicField$1(this,"_initialDistance"),__publicField$1(this,"_distanceIncrement"),__publicField$1(this,"_histogram"),__publicField$1(this,"_distance"),this._distance=e,this._colors=t,this._histogram=new ColorHistogram$1(i,t),this._initialDistance=.01,this._distanceIncrement=.005}sample(e){this._histogram.sample(e)}*quantize(){const e=this._histogram.getImportanceSortedColorsIDXI32();if(0===e.length)throw new Error("No colors in image");yield*this._buildPalette(e)}*_buildPalette(e){const t=new Palette$1,i=t.getPointContainer().getPointArray(),a=new Array(e.length);for(let t=0;t<e.length;t++)i.push(Point$1.createByUint32(e[t])),a[t]=1;const r=i.length,n=[];let s=r,o=this._initialDistance;const l=new ProgressTracker$1(s-this._colors,99);for(;s>this._colors;){n.length=0;for(let e=0;e<r;e++){if(l.shouldNotify(r-s)&&(yield{progress:l.progress}),0===a[e])continue;const t=i[e];for(let l=e+1;l<r;l++){if(0===a[l])continue;const e=i[l],r=this._distance.calculateNormalized(t,e);r<o&&(n.push(new RemovedColor$1(l,e,r)),a[l]=0,s--)}}o+=s>3*this._colors?this._initialDistance:this._distanceIncrement}if(s<this._colors){stableSort$1(n,((e,t)=>t.distance-e.distance));let e=0;for(;s<this._colors&&e<n.length;){a[n[e].index]=1,s++,e++}}let u=i.length;for(let e=u-1;e>=0;e--)0===a[e]&&(e!==u-1&&(i[e]=i[u-1]),--u);i.length=u,t.sort(),yield{palette:t,progress:100}}};function createArray1D$1(e){const t=[];for(let i=0;i<e;i++)t[i]=0;return t}function createArray4D$1(e,t,i,a){const r=new Array(e);for(let n=0;n<e;n++){r[n]=new Array(t);for(let e=0;e<t;e++){r[n][e]=new Array(i);for(let t=0;t<i;t++){r[n][e][t]=new Array(a);for(let i=0;i<a;i++)r[n][e][t][i]=0}}}return r}function createArray3D$1(e,t,i){const a=new Array(e);for(let r=0;r<e;r++){a[r]=new Array(t);for(let e=0;e<t;e++){a[r][e]=new Array(i);for(let t=0;t<i;t++)a[r][e][t]=0}}return a}function fillArray3D$1(e,t,i,a,r){for(let n=0;n<t;n++){e[n]=[];for(let t=0;t<i;t++){e[n][t]=[];for(let i=0;i<a;i++)e[n][t][i]=r}}}function fillArray1D$1(e,t,i){for(let a=0;a<t;a++)e[a]=i}var WuColorCube$1=class{constructor(){__publicField$1(this,"redMinimum"),__publicField$1(this,"redMaximum"),__publicField$1(this,"greenMinimum"),__publicField$1(this,"greenMaximum"),__publicField$1(this,"blueMinimum"),__publicField$1(this,"blueMaximum"),__publicField$1(this,"volume"),__publicField$1(this,"alphaMinimum"),__publicField$1(this,"alphaMaximum")}},_WuQuant$1=class extends AbstractPaletteQuantizer$1{constructor(e,t=256,i=5){super(),__publicField$1(this,"_reds"),__publicField$1(this,"_greens"),__publicField$1(this,"_blues"),__publicField$1(this,"_alphas"),__publicField$1(this,"_sums"),__publicField$1(this,"_weights"),__publicField$1(this,"_momentsRed"),__publicField$1(this,"_momentsGreen"),__publicField$1(this,"_momentsBlue"),__publicField$1(this,"_momentsAlpha"),__publicField$1(this,"_moments"),__publicField$1(this,"_table"),__publicField$1(this,"_pixels"),__publicField$1(this,"_cubes"),__publicField$1(this,"_colors"),__publicField$1(this,"_significantBitsPerChannel"),__publicField$1(this,"_maxSideIndex"),__publicField$1(this,"_alphaMaxSideIndex"),__publicField$1(this,"_sideSize"),__publicField$1(this,"_alphaSideSize"),__publicField$1(this,"_distance"),this._distance=e,this._setQuality(i),this._initialize(t)}sample(e){const t=e.getPointArray();for(let e=0,i=t.length;e<i;e++)this._addColor(t[e]);this._pixels=this._pixels.concat(t)}*quantize(){yield*this._preparePalette();const e=new Palette$1;for(let t=0;t<this._colors;t++)if(this._sums[t]>0){const i=this._sums[t],a=this._reds[t]/i,r=this._greens[t]/i,n=this._blues[t]/i,s=this._alphas[t]/i,o=Point$1.createByRGBA(0|a,0|r,0|n,0|s);e.add(o)}e.sort(),yield{palette:e,progress:100}}*_preparePalette(){yield*this._calculateMoments();let e=0;const t=createArray1D$1(this._colors);for(let i=1;i<this._colors;++i){this._cut(this._cubes[e],this._cubes[i])?(t[e]=this._cubes[e].volume>1?this._calculateVariance(this._cubes[e]):0,t[i]=this._cubes[i].volume>1?this._calculateVariance(this._cubes[i]):0):(t[e]=0,i--),e=0;let a=t[0];for(let r=1;r<=i;++r)t[r]>a&&(a=t[r],e=r);if(a<=0){this._colors=i+1;break}}const i=[],a=[],r=[],n=[];for(let e=0;e<this._colors;++e){const t=_WuQuant$1._volume(this._cubes[e],this._weights);t>0?(i[e]=_WuQuant$1._volume(this._cubes[e],this._momentsRed)/t|0,a[e]=_WuQuant$1._volume(this._cubes[e],this._momentsGreen)/t|0,r[e]=_WuQuant$1._volume(this._cubes[e],this._momentsBlue)/t|0,n[e]=_WuQuant$1._volume(this._cubes[e],this._momentsAlpha)/t|0):(i[e]=0,a[e]=0,r[e]=0,n[e]=0)}this._reds=createArray1D$1(this._colors+1),this._greens=createArray1D$1(this._colors+1),this._blues=createArray1D$1(this._colors+1),this._alphas=createArray1D$1(this._colors+1),this._sums=createArray1D$1(this._colors+1);for(let e=0,t=this._pixels.length;e<t;e++){const t=this._pixels[e];let s=-1,o=Number.MAX_VALUE;for(let e=0;e<this._colors;e++){const l=i[e],u=a[e],h=r[e],c=n[e],d=this._distance.calculateRaw(l,u,h,c,t.r,t.g,t.b,t.a);d<o&&(o=d,s=e)}this._reds[s]+=t.r,this._greens[s]+=t.g,this._blues[s]+=t.b,this._alphas[s]+=t.a,this._sums[s]++}}_addColor(e){const t=8-this._significantBitsPerChannel,i=1+(e.r>>t),a=1+(e.g>>t),r=1+(e.b>>t),n=1+(e.a>>t);this._weights[n][i][a][r]++,this._momentsRed[n][i][a][r]+=e.r,this._momentsGreen[n][i][a][r]+=e.g,this._momentsBlue[n][i][a][r]+=e.b,this._momentsAlpha[n][i][a][r]+=e.a,this._moments[n][i][a][r]+=this._table[e.r]+this._table[e.g]+this._table[e.b]+this._table[e.a]}*_calculateMoments(){const e=[],t=[],i=[],a=[],r=[],n=[],s=createArray3D$1(this._sideSize,this._sideSize,this._sideSize),o=createArray3D$1(this._sideSize,this._sideSize,this._sideSize),l=createArray3D$1(this._sideSize,this._sideSize,this._sideSize),u=createArray3D$1(this._sideSize,this._sideSize,this._sideSize),h=createArray3D$1(this._sideSize,this._sideSize,this._sideSize),c=createArray3D$1(this._sideSize,this._sideSize,this._sideSize);let d=0;const f=new ProgressTracker$1(this._alphaMaxSideIndex*this._maxSideIndex,99);for(let m=1;m<=this._alphaMaxSideIndex;++m){fillArray3D$1(s,this._sideSize,this._sideSize,this._sideSize,0),fillArray3D$1(o,this._sideSize,this._sideSize,this._sideSize,0),fillArray3D$1(l,this._sideSize,this._sideSize,this._sideSize,0),fillArray3D$1(u,this._sideSize,this._sideSize,this._sideSize,0),fillArray3D$1(h,this._sideSize,this._sideSize,this._sideSize,0),fillArray3D$1(c,this._sideSize,this._sideSize,this._sideSize,0);for(let p=1;p<=this._maxSideIndex;++p,++d){f.shouldNotify(d)&&(yield{progress:f.progress}),fillArray1D$1(e,this._sideSize,0),fillArray1D$1(t,this._sideSize,0),fillArray1D$1(i,this._sideSize,0),fillArray1D$1(a,this._sideSize,0),fillArray1D$1(r,this._sideSize,0),fillArray1D$1(n,this._sideSize,0);for(let d=1;d<=this._maxSideIndex;++d){let f=0,_=0,g=0,b=0,y=0,x=0;for(let w=1;w<=this._maxSideIndex;++w)f+=this._weights[m][p][d][w],_+=this._momentsRed[m][p][d][w],g+=this._momentsGreen[m][p][d][w],b+=this._momentsBlue[m][p][d][w],y+=this._momentsAlpha[m][p][d][w],x+=this._moments[m][p][d][w],e[w]+=f,t[w]+=_,i[w]+=g,a[w]+=b,r[w]+=y,n[w]+=x,s[p][d][w]=s[p-1][d][w]+e[w],o[p][d][w]=o[p-1][d][w]+t[w],l[p][d][w]=l[p-1][d][w]+i[w],u[p][d][w]=u[p-1][d][w]+a[w],h[p][d][w]=h[p-1][d][w]+r[w],c[p][d][w]=c[p-1][d][w]+n[w],this._weights[m][p][d][w]=this._weights[m-1][p][d][w]+s[p][d][w],this._momentsRed[m][p][d][w]=this._momentsRed[m-1][p][d][w]+o[p][d][w],this._momentsGreen[m][p][d][w]=this._momentsGreen[m-1][p][d][w]+l[p][d][w],this._momentsBlue[m][p][d][w]=this._momentsBlue[m-1][p][d][w]+u[p][d][w],this._momentsAlpha[m][p][d][w]=this._momentsAlpha[m-1][p][d][w]+h[p][d][w],this._moments[m][p][d][w]=this._moments[m-1][p][d][w]+c[p][d][w]}}}}static _volumeFloat(e,t){return t[e.alphaMaximum][e.redMaximum][e.greenMaximum][e.blueMaximum]-t[e.alphaMaximum][e.redMaximum][e.greenMinimum][e.blueMaximum]-t[e.alphaMaximum][e.redMinimum][e.greenMaximum][e.blueMaximum]+t[e.alphaMaximum][e.redMinimum][e.greenMinimum][e.blueMaximum]-t[e.alphaMinimum][e.redMaximum][e.greenMaximum][e.blueMaximum]+t[e.alphaMinimum][e.redMaximum][e.greenMinimum][e.blueMaximum]+t[e.alphaMinimum][e.redMinimum][e.greenMaximum][e.blueMaximum]-t[e.alphaMinimum][e.redMinimum][e.greenMinimum][e.blueMaximum]-(t[e.alphaMaximum][e.redMaximum][e.greenMaximum][e.blueMinimum]-t[e.alphaMinimum][e.redMaximum][e.greenMaximum][e.blueMinimum]-t[e.alphaMaximum][e.redMaximum][e.greenMinimum][e.blueMinimum]+t[e.alphaMinimum][e.redMaximum][e.greenMinimum][e.blueMinimum]-t[e.alphaMaximum][e.redMinimum][e.greenMaximum][e.blueMinimum]+t[e.alphaMinimum][e.redMinimum][e.greenMaximum][e.blueMinimum]+t[e.alphaMaximum][e.redMinimum][e.greenMinimum][e.blueMinimum]-t[e.alphaMinimum][e.redMinimum][e.greenMinimum][e.blueMinimum])}static _volume(e,t){return 0|_WuQuant$1._volumeFloat(e,t)}static _top(e,t,i,a){let r;switch(t){case _WuQuant$1._alpha:r=a[i][e.redMaximum][e.greenMaximum][e.blueMaximum]-a[i][e.redMaximum][e.greenMinimum][e.blueMaximum]-a[i][e.redMinimum][e.greenMaximum][e.blueMaximum]+a[i][e.redMinimum][e.greenMinimum][e.blueMaximum]-(a[i][e.redMaximum][e.greenMaximum][e.blueMinimum]-a[i][e.redMaximum][e.greenMinimum][e.blueMinimum]-a[i][e.redMinimum][e.greenMaximum][e.blueMinimum]+a[i][e.redMinimum][e.greenMinimum][e.blueMinimum]);break;case _WuQuant$1._red:r=a[e.alphaMaximum][i][e.greenMaximum][e.blueMaximum]-a[e.alphaMaximum][i][e.greenMinimum][e.blueMaximum]-a[e.alphaMinimum][i][e.greenMaximum][e.blueMaximum]+a[e.alphaMinimum][i][e.greenMinimum][e.blueMaximum]-(a[e.alphaMaximum][i][e.greenMaximum][e.blueMinimum]-a[e.alphaMaximum][i][e.greenMinimum][e.blueMinimum]-a[e.alphaMinimum][i][e.greenMaximum][e.blueMinimum]+a[e.alphaMinimum][i][e.greenMinimum][e.blueMinimum]);break;case _WuQuant$1._green:r=a[e.alphaMaximum][e.redMaximum][i][e.blueMaximum]-a[e.alphaMaximum][e.redMinimum][i][e.blueMaximum]-a[e.alphaMinimum][e.redMaximum][i][e.blueMaximum]+a[e.alphaMinimum][e.redMinimum][i][e.blueMaximum]-(a[e.alphaMaximum][e.redMaximum][i][e.blueMinimum]-a[e.alphaMaximum][e.redMinimum][i][e.blueMinimum]-a[e.alphaMinimum][e.redMaximum][i][e.blueMinimum]+a[e.alphaMinimum][e.redMinimum][i][e.blueMinimum]);break;case _WuQuant$1._blue:r=a[e.alphaMaximum][e.redMaximum][e.greenMaximum][i]-a[e.alphaMaximum][e.redMaximum][e.greenMinimum][i]-a[e.alphaMaximum][e.redMinimum][e.greenMaximum][i]+a[e.alphaMaximum][e.redMinimum][e.greenMinimum][i]-(a[e.alphaMinimum][e.redMaximum][e.greenMaximum][i]-a[e.alphaMinimum][e.redMaximum][e.greenMinimum][i]-a[e.alphaMinimum][e.redMinimum][e.greenMaximum][i]+a[e.alphaMinimum][e.redMinimum][e.greenMinimum][i]);break;default:throw new Error("impossible")}return 0|r}static _bottom(e,t,i){switch(t){case _WuQuant$1._alpha:return-i[e.alphaMinimum][e.redMaximum][e.greenMaximum][e.blueMaximum]+i[e.alphaMinimum][e.redMaximum][e.greenMinimum][e.blueMaximum]+i[e.alphaMinimum][e.redMinimum][e.greenMaximum][e.blueMaximum]-i[e.alphaMinimum][e.redMinimum][e.greenMinimum][e.blueMaximum]-(-i[e.alphaMinimum][e.redMaximum][e.greenMaximum][e.blueMinimum]+i[e.alphaMinimum][e.redMaximum][e.greenMinimum][e.blueMinimum]+i[e.alphaMinimum][e.redMinimum][e.greenMaximum][e.blueMinimum]-i[e.alphaMinimum][e.redMinimum][e.greenMinimum][e.blueMinimum]);case _WuQuant$1._red:return-i[e.alphaMaximum][e.redMinimum][e.greenMaximum][e.blueMaximum]+i[e.alphaMaximum][e.redMinimum][e.greenMinimum][e.blueMaximum]+i[e.alphaMinimum][e.redMinimum][e.greenMaximum][e.blueMaximum]-i[e.alphaMinimum][e.redMinimum][e.greenMinimum][e.blueMaximum]-(-i[e.alphaMaximum][e.redMinimum][e.greenMaximum][e.blueMinimum]+i[e.alphaMaximum][e.redMinimum][e.greenMinimum][e.blueMinimum]+i[e.alphaMinimum][e.redMinimum][e.greenMaximum][e.blueMinimum]-i[e.alphaMinimum][e.redMinimum][e.greenMinimum][e.blueMinimum]);case _WuQuant$1._green:return-i[e.alphaMaximum][e.redMaximum][e.greenMinimum][e.blueMaximum]+i[e.alphaMaximum][e.redMinimum][e.greenMinimum][e.blueMaximum]+i[e.alphaMinimum][e.redMaximum][e.greenMinimum][e.blueMaximum]-i[e.alphaMinimum][e.redMinimum][e.greenMinimum][e.blueMaximum]-(-i[e.alphaMaximum][e.redMaximum][e.greenMinimum][e.blueMinimum]+i[e.alphaMaximum][e.redMinimum][e.greenMinimum][e.blueMinimum]+i[e.alphaMinimum][e.redMaximum][e.greenMinimum][e.blueMinimum]-i[e.alphaMinimum][e.redMinimum][e.greenMinimum][e.blueMinimum]);case _WuQuant$1._blue:return-i[e.alphaMaximum][e.redMaximum][e.greenMaximum][e.blueMinimum]+i[e.alphaMaximum][e.redMaximum][e.greenMinimum][e.blueMinimum]+i[e.alphaMaximum][e.redMinimum][e.greenMaximum][e.blueMinimum]-i[e.alphaMaximum][e.redMinimum][e.greenMinimum][e.blueMinimum]-(-i[e.alphaMinimum][e.redMaximum][e.greenMaximum][e.blueMinimum]+i[e.alphaMinimum][e.redMaximum][e.greenMinimum][e.blueMinimum]+i[e.alphaMinimum][e.redMinimum][e.greenMaximum][e.blueMinimum]-i[e.alphaMinimum][e.redMinimum][e.greenMinimum][e.blueMinimum]);default:return 0}}_calculateVariance(e){const t=_WuQuant$1._volume(e,this._momentsRed),i=_WuQuant$1._volume(e,this._momentsGreen),a=_WuQuant$1._volume(e,this._momentsBlue),r=_WuQuant$1._volume(e,this._momentsAlpha);return _WuQuant$1._volumeFloat(e,this._moments)-(t*t+i*i+a*a+r*r)/_WuQuant$1._volume(e,this._weights)}_maximize(e,t,i,a,r,n,s,o,l){const u=0|_WuQuant$1._bottom(e,t,this._momentsRed),h=0|_WuQuant$1._bottom(e,t,this._momentsGreen),c=0|_WuQuant$1._bottom(e,t,this._momentsBlue),d=0|_WuQuant$1._bottom(e,t,this._momentsAlpha),f=0|_WuQuant$1._bottom(e,t,this._weights);let m=0,p=-1;for(let _=i;_<a;++_){let i=u+_WuQuant$1._top(e,t,_,this._momentsRed),a=h+_WuQuant$1._top(e,t,_,this._momentsGreen),g=c+_WuQuant$1._top(e,t,_,this._momentsBlue),b=d+_WuQuant$1._top(e,t,_,this._momentsAlpha),y=f+_WuQuant$1._top(e,t,_,this._weights);if(0!==y){let e=i*i+a*a+g*g+b*b,t=e/y;i=r-i,a=n-a,g=s-g,b=o-b,y=l-y,0!==y&&(e=i*i+a*a+g*g+b*b,t+=e/y,t>m&&(m=t,p=_))}}return{max:m,position:p}}_cut(e,t){let i;const a=_WuQuant$1._volume(e,this._momentsRed),r=_WuQuant$1._volume(e,this._momentsGreen),n=_WuQuant$1._volume(e,this._momentsBlue),s=_WuQuant$1._volume(e,this._momentsAlpha),o=_WuQuant$1._volume(e,this._weights),l=this._maximize(e,_WuQuant$1._red,e.redMinimum+1,e.redMaximum,a,r,n,s,o),u=this._maximize(e,_WuQuant$1._green,e.greenMinimum+1,e.greenMaximum,a,r,n,s,o),h=this._maximize(e,_WuQuant$1._blue,e.blueMinimum+1,e.blueMaximum,a,r,n,s,o),c=this._maximize(e,_WuQuant$1._alpha,e.alphaMinimum+1,e.alphaMaximum,a,r,n,s,o);if(c.max>=l.max&&c.max>=u.max&&c.max>=h.max){if(i=_WuQuant$1._alpha,c.position<0)return!1}else i=l.max>=c.max&&l.max>=u.max&&l.max>=h.max?_WuQuant$1._red:u.max>=c.max&&u.max>=l.max&&u.max>=h.max?_WuQuant$1._green:_WuQuant$1._blue;switch(t.redMaximum=e.redMaximum,t.greenMaximum=e.greenMaximum,t.blueMaximum=e.blueMaximum,t.alphaMaximum=e.alphaMaximum,i){case _WuQuant$1._red:t.redMinimum=e.redMaximum=l.position,t.greenMinimum=e.greenMinimum,t.blueMinimum=e.blueMinimum,t.alphaMinimum=e.alphaMinimum;break;case _WuQuant$1._green:t.greenMinimum=e.greenMaximum=u.position,t.redMinimum=e.redMinimum,t.blueMinimum=e.blueMinimum,t.alphaMinimum=e.alphaMinimum;break;case _WuQuant$1._blue:t.blueMinimum=e.blueMaximum=h.position,t.redMinimum=e.redMinimum,t.greenMinimum=e.greenMinimum,t.alphaMinimum=e.alphaMinimum;break;case _WuQuant$1._alpha:t.alphaMinimum=e.alphaMaximum=c.position,t.blueMinimum=e.blueMinimum,t.redMinimum=e.redMinimum,t.greenMinimum=e.greenMinimum}return e.volume=(e.redMaximum-e.redMinimum)*(e.greenMaximum-e.greenMinimum)*(e.blueMaximum-e.blueMinimum)*(e.alphaMaximum-e.alphaMinimum),t.volume=(t.redMaximum-t.redMinimum)*(t.greenMaximum-t.greenMinimum)*(t.blueMaximum-t.blueMinimum)*(t.alphaMaximum-t.alphaMinimum),!0}_initialize(e){this._colors=e,this._cubes=[];for(let t=0;t<e;t++)this._cubes[t]=new WuColorCube$1;this._cubes[0].redMinimum=0,this._cubes[0].greenMinimum=0,this._cubes[0].blueMinimum=0,this._cubes[0].alphaMinimum=0,this._cubes[0].redMaximum=this._maxSideIndex,this._cubes[0].greenMaximum=this._maxSideIndex,this._cubes[0].blueMaximum=this._maxSideIndex,this._cubes[0].alphaMaximum=this._alphaMaxSideIndex,this._weights=createArray4D$1(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._momentsRed=createArray4D$1(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._momentsGreen=createArray4D$1(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._momentsBlue=createArray4D$1(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._momentsAlpha=createArray4D$1(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._moments=createArray4D$1(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._table=[];for(let e=0;e<256;++e)this._table[e]=e*e;this._pixels=[]}_setQuality(e=5){this._significantBitsPerChannel=e,this._maxSideIndex=1<<this._significantBitsPerChannel,this._alphaMaxSideIndex=this._maxSideIndex,this._sideSize=this._maxSideIndex+1,this._alphaSideSize=this._alphaMaxSideIndex+1}},WuQuant$1=_WuQuant$1;__publicField$1(WuQuant$1,"_alpha",3),__publicField$1(WuQuant$1,"_red",2),__publicField$1(WuQuant$1,"_green",1),__publicField$1(WuQuant$1,"_blue",0);var image_exports$1={};__export$1(image_exports$1,{AbstractImageQuantizer:()=>AbstractImageQuantizer$1,ErrorDiffusionArray:()=>ErrorDiffusionArray$1,ErrorDiffusionArrayKernel:()=>ErrorDiffusionArrayKernel$1,ErrorDiffusionRiemersma:()=>ErrorDiffusionRiemersma$1,NearestColor:()=>NearestColor$1});var AbstractImageQuantizer$1=class{quantizeSync(e,t){for(const i of this.quantize(e,t))if(i.pointContainer)return i.pointContainer;throw new Error("unreachable")}},NearestColor$1=class extends AbstractImageQuantizer$1{constructor(e){super(),__publicField$1(this,"_distance"),this._distance=e}*quantize(e,t){const i=e.getPointArray(),a=e.getWidth(),r=e.getHeight(),n=new ProgressTracker$1(r,99);for(let e=0;e<r;e++){n.shouldNotify(e)&&(yield{progress:n.progress});for(let r=0,n=e*a;r<a;r++,n++){const e=i[n];e.from(t.getNearestColor(this._distance,e))}}yield{pointContainer:e,progress:100}}},ErrorDiffusionArrayKernel$1=(e=>(e[e.FloydSteinberg=0]="FloydSteinberg",e[e.FalseFloydSteinberg=1]="FalseFloydSteinberg",e[e.Stucki=2]="Stucki",e[e.Atkinson=3]="Atkinson",e[e.Jarvis=4]="Jarvis",e[e.Burkes=5]="Burkes",e[e.Sierra=6]="Sierra",e[e.TwoSierra=7]="TwoSierra",e[e.SierraLite=8]="SierraLite",e))(ErrorDiffusionArrayKernel$1||{}),ErrorDiffusionArray$1=class extends AbstractImageQuantizer$1{constructor(e,t,i=!0,a=0,r=!1){super(),__publicField$1(this,"_minColorDistance"),__publicField$1(this,"_serpentine"),__publicField$1(this,"_kernel"),__publicField$1(this,"_calculateErrorLikeGIMP"),__publicField$1(this,"_distance"),this._setKernel(t),this._distance=e,this._minColorDistance=a,this._serpentine=i,this._calculateErrorLikeGIMP=r}*quantize(e,t){const i=e.getPointArray(),a=new Point$1,r=e.getWidth(),n=e.getHeight(),s=[];let o=1,l=1;for(const e of this._kernel){const t=e[2]+1;l<t&&(l=t)}for(let e=0;e<l;e++)this._fillErrorLine(s[e]=[],r);const u=new ProgressTracker$1(n,99);for(let e=0;e<n;e++){u.shouldNotify(e)&&(yield{progress:u.progress}),this._serpentine&&(o*=-1);const l=e*r,h=1===o?0:r-1,c=1===o?r:-1;this._fillErrorLine(s[0],r),s.push(s.shift());const d=s[0];for(let u=h,f=l+h;u!==c;u+=o,f+=o){const l=i[f],h=d[u];a.from(l);const c=Point$1.createByRGBA(inRange0to255Rounded$1(l.r+h[0]),inRange0to255Rounded$1(l.g+h[1]),inRange0to255Rounded$1(l.b+h[2]),inRange0to255Rounded$1(l.a+h[3])),m=t.getNearestColor(this._distance,c);if(l.from(m),this._minColorDistance){if(this._distance.calculateNormalized(a,m)<this._minColorDistance)continue}let p,_,g,b;this._calculateErrorLikeGIMP?(p=c.r-m.r,_=c.g-m.g,g=c.b-m.b,b=c.a-m.a):(p=a.r-m.r,_=a.g-m.g,g=a.b-m.b,b=a.a-m.a);const y=1===o?0:this._kernel.length-1,x=1===o?this._kernel.length:-1;for(let t=y;t!==x;t+=o){const i=this._kernel[t][1]*o,a=this._kernel[t][2];if(i+u>=0&&i+u<r&&a+e>=0&&a+e<n){const e=this._kernel[t][0],r=s[a][i+u];r[0]+=p*e,r[1]+=_*e,r[2]+=g*e,r[3]+=b*e}}}}yield{pointContainer:e,progress:100}}_fillErrorLine(e,t){e.length>t&&(e.length=t);const i=e.length;for(let t=0;t<i;t++){const i=e[t];i[0]=i[1]=i[2]=i[3]=0}for(let a=i;a<t;a++)e[a]=[0,0,0,0]}_setKernel(e){switch(e){case 0:this._kernel=[[7/16,1,0],[3/16,-1,1],[5/16,0,1],[1/16,1,1]];break;case 1:this._kernel=[[3/8,1,0],[3/8,0,1],[2/8,1,1]];break;case 2:this._kernel=[[8/42,1,0],[4/42,2,0],[2/42,-2,1],[4/42,-1,1],[8/42,0,1],[4/42,1,1],[2/42,2,1],[1/42,-2,2],[2/42,-1,2],[4/42,0,2],[2/42,1,2],[1/42,2,2]];break;case 3:this._kernel=[[1/8,1,0],[1/8,2,0],[1/8,-1,1],[1/8,0,1],[1/8,1,1],[1/8,0,2]];break;case 4:this._kernel=[[7/48,1,0],[5/48,2,0],[3/48,-2,1],[5/48,-1,1],[7/48,0,1],[5/48,1,1],[3/48,2,1],[1/48,-2,2],[3/48,-1,2],[5/48,0,2],[3/48,1,2],[1/48,2,2]];break;case 5:this._kernel=[[.25,1,0],[4/32,2,0],[2/32,-2,1],[4/32,-1,1],[.25,0,1],[4/32,1,1],[2/32,2,1]];break;case 6:this._kernel=[[5/32,1,0],[3/32,2,0],[2/32,-2,1],[4/32,-1,1],[5/32,0,1],[4/32,1,1],[2/32,2,1],[2/32,-1,2],[3/32,0,2],[2/32,1,2]];break;case 7:this._kernel=[[.25,1,0],[3/16,2,0],[1/16,-2,1],[2/16,-1,1],[3/16,0,1],[2/16,1,1],[1/16,2,1]];break;case 8:this._kernel=[[.5,1,0],[1/4,-1,1],[1/4,0,1]];break;default:throw new Error(`ErrorDiffusionArray: unknown kernel = ${e}`)}}};function*hilbertCurve$1(e,t,i){const a=Math.max(e,t),r={width:e,height:t,level:Math.floor(Math.log(a)/Math.log(2)+1),callback:i,tracker:new ProgressTracker$1(e*t,99),index:0,x:0,y:0};yield*walkHilbert$1(r,1),visit$1(r,0)}function*walkHilbert$1(e,t){if(!(e.level<1)){switch(e.tracker.shouldNotify(e.index)&&(yield{progress:e.tracker.progress}),e.level--,t){case 2:yield*walkHilbert$1(e,1),visit$1(e,3),yield*walkHilbert$1(e,2),visit$1(e,4),yield*walkHilbert$1(e,2),visit$1(e,2),yield*walkHilbert$1(e,4);break;case 3:yield*walkHilbert$1(e,4),visit$1(e,2),yield*walkHilbert$1(e,3),visit$1(e,1),yield*walkHilbert$1(e,3),visit$1(e,3),yield*walkHilbert$1(e,1);break;case 1:yield*walkHilbert$1(e,2),visit$1(e,4),yield*walkHilbert$1(e,1),visit$1(e,3),yield*walkHilbert$1(e,1),visit$1(e,1),yield*walkHilbert$1(e,3);break;case 4:yield*walkHilbert$1(e,3),visit$1(e,1),yield*walkHilbert$1(e,4),visit$1(e,2),yield*walkHilbert$1(e,4),visit$1(e,4),yield*walkHilbert$1(e,2)}e.level++}}function visit$1(e,t){switch(e.x>=0&&e.x<e.width&&e.y>=0&&e.y<e.height&&(e.callback(e.x,e.y),e.index++),t){case 2:e.x--;break;case 3:e.x++;break;case 1:e.y--;break;case 4:e.y++}}var ErrorDiffusionRiemersma$1=class extends AbstractImageQuantizer$1{constructor(e,t=16,i=1){super(),__publicField$1(this,"_distance"),__publicField$1(this,"_weights"),__publicField$1(this,"_errorQueueSize"),this._distance=e,this._errorQueueSize=t,this._weights=ErrorDiffusionRiemersma$1._createWeights(i,t)}*quantize(e,t){const i=e.getPointArray(),a=e.getWidth(),r=e.getHeight(),n=[];let s=0;for(let e=0;e<this._errorQueueSize;e++)n[e]={r:0,g:0,b:0,a:0};yield*hilbertCurve$1(a,r,((e,r)=>{const o=i[e+r*a];let{r:l,g:u,b:h,a:c}=o;for(let e=0;e<this._errorQueueSize;e++){const t=this._weights[e],i=n[(e+s)%this._errorQueueSize];l+=i.r*t,u+=i.g*t,h+=i.b*t,c+=i.a*t}const d=Point$1.createByRGBA(inRange0to255Rounded$1(l),inRange0to255Rounded$1(u),inRange0to255Rounded$1(h),inRange0to255Rounded$1(c)),f=t.getNearestColor(this._distance,d);s=(s+1)%this._errorQueueSize;const m=(s+this._errorQueueSize-1)%this._errorQueueSize;n[m].r=o.r-f.r,n[m].g=o.g-f.g,n[m].b=o.b-f.b,n[m].a=o.a-f.a,o.from(f)})),yield{pointContainer:e,progress:100}}static _createWeights(e,t){const i=[],a=Math.exp(Math.log(t)/(t-1));for(let r=0,n=1;r<t;r++)i[r]=(n+.5|0)/t*e,n*=a;return i}},quality_exports$1={};__export$1(quality_exports$1,{ssim:()=>ssim$1});var K1$1=.01,K2$1=.03;function ssim$1(e,t){if(e.getHeight()!==t.getHeight()||e.getWidth()!==t.getWidth())throw new Error("Images have different sizes!");const i=(255*K1$1)**2,a=(255*K2$1)**2;let r=0,n=0;return iterate$1(e,t,((e,t,s,o)=>{let l=0,u=0,h=0;for(let i=0;i<e.length;i++)u+=(e[i]-s)**2,h+=(t[i]-o)**2,l+=(e[i]-s)*(t[i]-o);const c=e.length-1;u/=c,h/=c,l/=c;n+=(2*s*o+i)*(2*l+a)/((s**2+o**2+i)*(u+h+a)),r++})),n/r}function iterate$1(e,t,i){const a=e.getWidth(),r=e.getHeight();for(let n=0;n<r;n+=8)for(let s=0;s<a;s+=8){const o=Math.min(8,a-s),l=Math.min(8,r-n),u=calculateLumaValuesForWindow$1(e,s,n,o,l),h=calculateLumaValuesForWindow$1(t,s,n,o,l);i(u,h,calculateAverageLuma$1(u),calculateAverageLuma$1(h))}}function calculateLumaValuesForWindow$1(e,t,i,a,r){const n=e.getPointArray(),s=[];let o=0;for(let l=i;l<i+r;l++){const i=l*e.getWidth();for(let e=t;e<t+a;e++){const t=n[i+e];s[o]=.2126*t.r+.7152*t.g+.0722*t.b,o++}}return s}function calculateAverageLuma$1(e){let t=0;for(const i of e)t+=i;return t/e.length}var setImmediateImpl="function"==typeof setImmediate?setImmediate:"undefined"!=typeof process&&"function"==typeof(null==process?void 0:process.nextTick)?e=>process.nextTick(e):e=>setTimeout(e,0);function buildPaletteSync$1(e,{colorDistanceFormula:t,paletteQuantization:i,colors:a}={}){const r=paletteQuantizationToPaletteQuantizer$1(colorDistanceFormulaToColorDistance$1(t),i,a);return e.forEach((e=>r.sample(e))),r.quantizeSync()}async function buildPalette(e,{colorDistanceFormula:t,paletteQuantization:i,colors:a,onProgress:r}={}){return new Promise(((n,s)=>{const o=paletteQuantizationToPaletteQuantizer$1(colorDistanceFormulaToColorDistance$1(t),i,a);let l;e.forEach((e=>o.sample(e)));const u=o.quantize(),h=()=>{try{const e=u.next();e.done?n(l):(e.value.palette&&(l=e.value.palette),r&&r(e.value.progress),setImmediateImpl(h))}catch(e){s(e)}};setImmediateImpl(h)}))}function applyPaletteSync$1(e,t,{colorDistanceFormula:i,imageQuantization:a}={}){return imageQuantizationToImageQuantizer$1(colorDistanceFormulaToColorDistance$1(i),a).quantizeSync(e,t)}async function applyPalette(e,t,{colorDistanceFormula:i,imageQuantization:a,onProgress:r}={}){return new Promise(((n,s)=>{let o;const l=imageQuantizationToImageQuantizer$1(colorDistanceFormulaToColorDistance$1(i),a).quantize(e,t),u=()=>{try{const e=l.next();e.done?n(o):(e.value.pointContainer&&(o=e.value.pointContainer),r&&r(e.value.progress),setImmediateImpl(u))}catch(e){s(e)}};setImmediateImpl(u)}))}function colorDistanceFormulaToColorDistance$1(e="euclidean-bt709"){switch(e){case"cie94-graphic-arts":return new CIE94GraphicArts$1;case"cie94-textiles":return new CIE94Textiles$1;case"ciede2000":return new CIEDE2000$1;case"color-metric":return new CMetric$1;case"euclidean":return new Euclidean$1;case"euclidean-bt709":return new EuclideanBT709$1;case"euclidean-bt709-noalpha":return new EuclideanBT709NoAlpha$1;case"manhattan":return new Manhattan$1;case"manhattan-bt709":return new ManhattanBT709$1;case"manhattan-nommyde":return new ManhattanNommyde$1;case"pngquant":return new PNGQuant$1;default:throw new Error(`Unknown colorDistanceFormula ${e}`)}}function imageQuantizationToImageQuantizer$1(e,t="floyd-steinberg"){switch(t){case"nearest":return new NearestColor$1(e);case"riemersma":return new ErrorDiffusionRiemersma$1(e);case"floyd-steinberg":return new ErrorDiffusionArray$1(e,0);case"false-floyd-steinberg":return new ErrorDiffusionArray$1(e,1);case"stucki":return new ErrorDiffusionArray$1(e,2);case"atkinson":return new ErrorDiffusionArray$1(e,3);case"jarvis":return new ErrorDiffusionArray$1(e,4);case"burkes":return new ErrorDiffusionArray$1(e,5);case"sierra":return new ErrorDiffusionArray$1(e,6);case"two-sierra":return new ErrorDiffusionArray$1(e,7);case"sierra-lite":return new ErrorDiffusionArray$1(e,8);default:throw new Error(`Unknown imageQuantization ${t}`)}}function paletteQuantizationToPaletteQuantizer$1(e,t="wuquant",i=256){switch(t){case"neuquant":return new NeuQuant$1(e,i);case"rgbquant":return new RGBQuant$1(e,i);case"wuquant":return new WuQuant$1(e,i);case"neuquant-float":return new NeuQuantFloat$1(e,i);default:throw new Error(`Unknown paletteQuantization ${t}`)}}var imageQ=__toCommonJS(src_exports),gifframe={};const BitmapImage$1=bitmapimage;let GifFrame$1=class e extends BitmapImage$1{constructor(...t){if(super(...t),t[0]instanceof e){const e=t[0];this.xOffset=e.xOffset,this.yOffset=e.yOffset,this.disposalMethod=e.disposalMethod,this.delayCentisecs=e.delayCentisecs,this.interlaced=e.interlaced}else{const i=t[t.length-1];let a={};"object"!=typeof i||i instanceof BitmapImage$1||(a=i),this.xOffset=a.xOffset||0,this.yOffset=a.yOffset||0,this.disposalMethod=void 0!==a.disposalMethod?a.disposalMethod:e.DisposeToBackgroundColor,this.delayCentisecs=a.delayCentisecs||8,this.interlaced=a.interlaced||!1}}getPalette(){const e=new Set,t=this.bitmap.data;let i=0,a=!1;for(;i<t.length;){if(0===t[i+3])a=!0;else{const a=t.readUInt32BE(i,!0)>>8&16777215;e.add(a)}i+=4}const r=new Array(e.size),n=e.values();for(i=0;i<r.length;++i)r[i]=n.next().value;r.sort(((e,t)=>e-t));let s=r.length;return a&&++s,{colors:r,usesTransparency:a,indexCount:s}}};var hasRequiredGifutil,hasRequiredGifcodec;function requireGifutil(){return hasRequiredGifutil||(hasRequiredGifutil=1,function(e){const t=require$$6,i=imageQ,a=bitmapimage,{GifFrame:r}=gifframe,{GifError:n}=gif$1,{GifCodec:s}=requireGifcodec(),o=[".jpg",".jpeg",".png",".bmp"],l=new s;function u(e,t,a,r,n){const s=Array.isArray(e)?e:[e];if(n){if(["FloydSteinberg","FalseFloydSteinberg","Stucki","Atkinson","Jarvis","Burkes","Sierra","TwoSierra","SierraLite"].indexOf(n.ditherAlgorithm)<0)throw new Error(`Invalid ditherAlgorithm '${n.ditherAlgorithm}'`);void 0===n.serpentine&&(n.serpentine=!0),void 0===n.minimumColorDistanceToDither&&(n.minimumColorDistanceToDither=0),void 0===n.calculateErrorLikeGIMP&&(n.calculateErrorLikeGIMP=!1)}const o=new i.distance.Euclidean,l=new i.palette[t](o,a,r);let u;u=n?new i.image.ErrorDiffusionArray(o,i.image.ErrorDiffusionArrayKernel[n.ditherAlgorithm],n.serpentine,n.minimumColorDistanceToDither,n.calculateErrorLikeGIMP):new i.image.NearestColor(o);const h=[];s.forEach((e=>{const t=e.bitmap.data,a=new ArrayBuffer(t.length),r=new Uint32Array(a);for(let e=0,i=0;e<t.length;e+=4,++i)r[i]=t.readUInt32LE(e,!0);const n=i.utils.PointContainer.fromUint32Array(r,e.bitmap.width,e.bitmap.height);l.sample(n),h.push(n)}));const c=l.quantizeSync();for(let e=0;e<s.length;++e){const t=s[e].bitmap.data,i=u.quantizeSync(h[e],c).toUint32Array();for(let e=0,a=0;e<t.length;e+=4,++a)t.writeUInt32LE(i[a],e)}}e.cloneFrames=function(e){let t=[];return e.forEach((e=>{t.push(new r(e))})),t},e.getColorInfo=function(e,t){let i=!1;const a=[];for(let t=0;t<e.length;++t){let r=e[t].getPalette();if(r.usesTransparency&&(i=!0),r.indexCount>256)throw new n(`Frame ${t} uses more than 256 color indexes`);a.push(r)}if(0===t)return{usesTransparency:i,palettes:a};const r=new Set;a.forEach((e=>{e.colors.forEach((e=>{r.add(e)}))}));let s=r.size;if(i&&++s,t&&s>t)return{usesTransparency:i,palettes:a};const o=new Array(r.size),l=r.values();for(let e=0;e<o.length;++e)o[e]=l.next().value;return o.sort(((e,t)=>e-t)),{colors:o,indexCount:s,usesTransparency:i,palettes:a}},e.copyAsJimp=function(t,i){return e.shareAsJimp(t,new a(i))},e.getMaxDimensions=function(e){let t=0,i=0;return e.forEach((e=>{const a=e.xOffset+e.bitmap.width;a>t&&(t=a);const r=e.yOffset+e.bitmap.height;r>i&&(i=r)})),{maxWidth:t,maxHeight:i}},e.quantizeDekker=function(e,t,i){u(e,"NeuQuantFloat",t=t||256,0,i)},e.quantizeSorokin=function(e,t,i,a){let r;switch(t=t||256,i=i||"min-pop"){case"min-pop":r=2;break;case"top-pop":r=1;break;default:throw new Error(`Invalid quantizeSorokin histogram '${i}'`)}u(e,"RGBQuant",t,r,a)},e.quantizeWu=function(e,t,i,a){if(t=t||256,(i=i||5)<1||i>8)throw new Error("Invalid quantization quality");u(e,"WuQuant",t,i,a)},e.read=function(e,i){return i=i||l,Buffer.isBuffer(e)?i.decodeGif(e):(a=e,new Promise(((e,i)=>{t.readFile(a,((t,a)=>t?i(t):e(a)))}))).then((e=>i.decodeGif(e)));var a},e.shareAsJimp=function(e,t){const i=new e(t.bitmap.width,t.bitmap.height,0);return i.bitmap.data=t.bitmap.data,i},e.write=function(e,i,a,r){r=r||l;const n=e.match(/\.[a-zA-Z]+$/);if(null!==n&&o.includes(n[0].toLowerCase()))throw new Error(`GIF '${e}' has an unexpected suffix`);return r.encodeGif(i,a).then((i=>function(e,i){return new Promise(((a,r)=>{t.writeFile(e,i,(e=>e?r(e):a()))}))}(e,i.buffer).then((()=>i))))}}(gifutil)),gifutil}function requireGifcodec(){if(hasRequiredGifcodec)return gifcodec;hasRequiredGifcodec=1;const e=omggif,{Gif:t,GifError:i}=gif$1;function a(){const e=requireGifutil();return a=function(){return e},e}const{GifFrame:r}=gifframe;function n(e,t){const i=e.indexOf(t);return-1===i?null:i}function s(e,t){for(var i,a=0,r=e.length-1;a<=r;)if(e[i=Math.floor((a+r)/2)]>t)r=i-1;else{if(!(e[i]<t))return i;a=i+1}return null}function o(e){const t=e.colors;e.usesTransparency&&t.push(0);const i=t.length;let a=2;for(;i>a;)a<<=1;t.length=a,t.fill(0,i)}function l(e,t){let i=e.bitmap.width*e.bitmap.height;return i=Math.ceil(i*t/8),i+=Math.ceil(i/255),100+i+768}function u(e){let t=e.indexCount,i=0;for(--t;t;)++i,t>>=1;return i>0?i:1}function h(e,t,a,r,l){if(a.interlaced)throw new i("writing interlaced GIFs is not supported");const u=function(e,t,a){const r=a.colors,o=r.length<=8?n:s,l=t.bitmap.data,u=new Buffer(l.length/4);let h=r.length,c=0,d=0;for(;c<l.length;){if(0!==l[c+3]){const e=l.readUInt32BE(c,!0)>>8&16777215;u[d]=o(r,e)}else u[d]=h;c+=4,++d}if(a.usesTransparency){if(256===h)throw new i(`Frame ${e} already has 256 colorsand so can't use transparency`)}else h=null;return{buffer:u,transparentIndex:h}}(t,a,r),h={delay:a.delayCentisecs,disposal:a.disposalMethod,transparent:u.transparentIndex};l&&(o(r),h.palette=r.colors);try{let t,i=e.getOutputBuffer(),r=e.getOutputBufferPosition(),n=!0;for(;n;)if(t=e.addFrame(a.xOffset,a.yOffset,a.bitmap.width,a.bitmap.height,u.buffer,h),n=!1,t>=i.length-1){const t=new Buffer(1.5*i.length);i.copy(t),e.setOutputBuffer(t),e.setOutputBufferPosition(r),i=t,n=!0}return i}catch(e){throw new i(e)}}return gifcodec.GifCodec=class{constructor(e={}){this._transparentRGB=null,"number"==typeof e.transparentRGB&&0!==e.transparentRGB&&(this._transparentRGBA=256*e.transparentRGB),this._testInitialBufferSize=0}decodeGif(a){try{let r;try{r=new e.GifReader(a)}catch(e){throw new i(e)}const n=r.numFrames(),s=[],o={width:r.width,height:r.height,loops:r.loopCount(),usesTransparency:!1};for(let e=0;e<n;++e){const t=this._decodeFrame(r,e,o.usesTransparency);s.push(t.frame),t.usesTransparency&&(o.usesTransparency=!0)}return Promise.resolve(new t(a,s,o))}catch(e){return Promise.reject(e)}}encodeGif(e,r={}){try{if(null===e||0===e.length)throw new i("there are no frames");const n=a().getMaxDimensions(e);return(r=Object.assign({},r)).width=n.maxWidth,r.height=n.maxHeight,void 0===r.loops&&(r.loops=0),r.colorScope=r.colorScope||t.GlobalColorsPreferred,Promise.resolve(this._encodeGif(e,r))}catch(e){return Promise.reject(e)}}_decodeFrame(e,t,a){let n,s;try{if(n=e.frameInfo(t),s=new Buffer(e.width*e.height*4),e.decodeAndBlitFrameRGBA(t,s),n.width!==e.width||n.height!==e.height){if(n.y&&(s=s.slice(n.y*e.width*4)),e.width>n.width)for(let t=0;t<n.height;++t)s.copy(s,t*n.width*4,4*(n.x+t*e.width),4*(n.x+t*e.width)+4*n.width);s=s.slice(0,n.width*n.height*4)}}catch(e){throw new i(e)}let o=!1;if(null===this._transparentRGBA){if(!a)for(let e=3;e<s.length;e+=4)0===s[e]&&(o=!0,e=s.length)}else for(let e=3;e<s.length;e+=4)0===s[e]&&(s.writeUInt32BE(this._transparentRGBA,e-3),o=!0);return{frame:new r(n.width,n.height,s,{xOffset:n.x,yOffset:n.y,disposalMethod:n.disposal,interlaced:n.interlaced,delayCentisecs:n.delay}),usesTransparency:o}}_encodeGif(r,n){let s;if(n.colorScope===t.LocalColorsOnly)s=a().getColorInfo(r,0);else if(s=a().getColorInfo(r,256),!s.colors){if(n.colorScope===t.GlobalColorsOnly)throw new i("Too many color indexes for global color table");n.colorScope=t.LocalColorsOnly}n.usesTransparency=s.usesTransparency;const l=s.palettes;if(n.colorScope===t.LocalColorsOnly){return function(a,r,n,s){const o={loop:r.loops};let l,u=new Buffer(n);try{l=new e.GifWriter(u,r.width,r.height,o)}catch(e){throw new i(e)}for(let e=0;e<a.length;++e)u=h(l,e,a[e],s[e],!0);return new t(u.slice(0,l.end()),a,r)}(r,n,2e3,l)}return function(a,r,n,s){const l={colors:s.colors.slice(),usesTransparency:s.usesTransparency};o(l);const u={palette:l.colors,loop:r.loops};let c,d=new Buffer(n);try{c=new e.GifWriter(d,r.width,r.height,u)}catch(e){throw new i(e)}for(let e=0;e<a.length;++e)d=h(c,e,a[e],s,!1);return new t(d.slice(0,c.end()),a,r)}(r,n,2e3,s)}_getSizeEstimateGlobal(e,t){if(this._testInitialBufferSize>0)return this._testInitialBufferSize;let i=968;const a=u(e);return t.forEach((e=>{i+=l(e,a)})),i}_getSizeEstimateLocal(e,t){if(this._testInitialBufferSize>0)return this._testInitialBufferSize;let i=200;for(let a=0;a<t.length;++a){const r=u(e[a]);i+=l(t[a],r)}return i}},gifcodec}GifFrame$1.DisposeToAnything=0,GifFrame$1.DisposeNothing=1,GifFrame$1.DisposeToBackgroundColor=2,GifFrame$1.DisposeToPrevious=3,gifframe.GifFrame=GifFrame$1;const BitmapImage=bitmapimage,{Gif:Gif,GifError:GifError$1}=gif$1,{GifCodec:GifCodec}=requireGifcodec(),{GifFrame:GifFrame}=gifframe,GifUtil=requireGifutil();var src={BitmapImage:BitmapImage,Gif:Gif,GifCodec:GifCodec,GifFrame:GifFrame,GifUtil:GifUtil,GifError:GifError$1};function gif(){return{mime:"image/gif",encode:async e=>{const t=new src.BitmapImage(e);src.GifUtil.quantizeDekker(t,256);const i=new src.GifFrame(e),a=new src.GifCodec;return(await a.encodeGif([i],{})).buffer},decode:e=>{const t=new omggif.GifReader(e),i=Buffer.alloc(t.width*t.height*4);return t.decodeAndBlitFrameRGBA(0,i),{data:i,width:t.width,height:t.height}}}}var encoder={exports:{}};!function(e){function t(e){var t,i,a,r,n,s=Math.floor,o=new Array(64),l=new Array(64),u=new Array(64),h=new Array(64),c=new Array(65535),d=new Array(65535),f=new Array(64),m=new Array(64),p=[],_=0,g=7,b=new Array(64),y=new Array(64),x=new Array(64),w=new Array(256),v=new Array(2048),k=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],M=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],I=[0,1,2,3,4,5,6,7,8,9,10,11],E=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],S=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],P=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],T=[0,1,2,3,4,5,6,7,8,9,10,11],C=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],A=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function $(e,t){for(var i=0,a=0,r=new Array,n=1;n<=16;n++){for(var s=1;s<=e[n];s++)r[t[a]]=[],r[t[a]][0]=i,r[t[a]][1]=n,a++,i++;i*=2}return r}function z(e){for(var t=e[0],i=e[1]-1;i>=0;)t&1<<i&&(_|=1<<g),i--,--g<0&&(255==_?(B(255),B(0)):B(_),g=7,_=0)}function B(e){p.push(e)}function F(e){B(e>>8&255),B(255&e)}function R(e,t,i,a,r){for(var n,s=r[0],o=r[240],l=function(e,t){var i,a,r,n,s,o,l,u,h,c,d=0;for(h=0;h<8;++h){i=e[d],a=e[d+1],r=e[d+2],n=e[d+3],s=e[d+4],o=e[d+5],l=e[d+6];var m=i+(u=e[d+7]),p=i-u,_=a+l,g=a-l,b=r+o,y=r-o,x=n+s,w=n-s,v=m+x,k=m-x,M=_+b,I=_-b;e[d]=v+M,e[d+4]=v-M;var E=.707106781*(I+k);e[d+2]=k+E,e[d+6]=k-E;var S=.382683433*((v=w+y)-(I=g+p)),P=.5411961*v+S,T=1.306562965*I+S,C=.707106781*(M=y+g),A=p+C,$=p-C;e[d+5]=$+P,e[d+3]=$-P,e[d+1]=A+T,e[d+7]=A-T,d+=8}for(d=0,h=0;h<8;++h){i=e[d],a=e[d+8],r=e[d+16],n=e[d+24],s=e[d+32],o=e[d+40],l=e[d+48];var z=i+(u=e[d+56]),B=i-u,F=a+l,R=a-l,D=r+o,N=r-o,Z=n+s,O=n-s,L=z+Z,U=z-Z,G=F+D,Q=F-D;e[d]=L+G,e[d+32]=L-G;var j=.707106781*(Q+U);e[d+16]=U+j,e[d+48]=U-j;var H=.382683433*((L=O+N)-(Q=R+B)),W=.5411961*L+H,q=1.306562965*Q+H,V=.707106781*(G=N+R),K=B+V,Y=B-V;e[d+40]=Y+W,e[d+24]=Y-W,e[d+8]=K+q,e[d+56]=K-q,d++}for(h=0;h<64;++h)c=e[h]*t[h],f[h]=c>0?c+.5|0:c-.5|0;return f}(e,t),u=0;u<64;++u)m[k[u]]=l[u];var h=m[0]-i;i=m[0],0==h?z(a[0]):(z(a[d[n=32767+h]]),z(c[n]));for(var p=63;p>0&&0==m[p];p--);if(0==p)return z(s),i;for(var _,g=1;g<=p;){for(var b=g;0==m[g]&&g<=p;++g);var y=g-b;if(y>=16){_=y>>4;for(var x=1;x<=_;++x)z(o);y&=15}n=32767+m[g],z(r[(y<<4)+d[n]]),z(c[n]),g++}return 63!=p&&z(s),i}function D(e){if(e<=0&&(e=1),e>100&&(e=100),n!=e){(function(e){for(var t=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],i=0;i<64;i++){var a=s((t[i]*e+50)/100);a<1?a=1:a>255&&(a=255),o[k[i]]=a}for(var r=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],n=0;n<64;n++){var c=s((r[n]*e+50)/100);c<1?c=1:c>255&&(c=255),l[k[n]]=c}for(var d=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],f=0,m=0;m<8;m++)for(var p=0;p<8;p++)u[f]=1/(o[k[f]]*d[m]*d[p]*8),h[f]=1/(l[k[f]]*d[m]*d[p]*8),f++})(e<50?Math.floor(5e3/e):Math.floor(200-2*e)),n=e}}this.encode=function(e,n){var s;(new Date).getTime(),n&&D(n),p=new Array,_=0,g=7,F(65496),F(65504),F(16),B(74),B(70),B(73),B(70),B(0),B(1),B(1),B(0),F(1),F(1),B(0),B(0),void 0!==(s=e.comments)&&s.constructor===Array&&s.forEach((e=>{if("string"==typeof e){F(65534);var t,i=e.length;for(F(i+2),t=0;t<i;t++)B(e.charCodeAt(t))}})),function(e){if(e){F(65505),69===e[0]&&120===e[1]&&105===e[2]&&102===e[3]?F(e.length+2):(F(e.length+5+2),B(69),B(120),B(105),B(102),B(0));for(var t=0;t<e.length;t++)B(e[t])}}(e.exifBuffer),function(){F(65499),F(132),B(0);for(var e=0;e<64;e++)B(o[e]);B(1);for(var t=0;t<64;t++)B(l[t])}(),function(e,t){F(65472),F(17),B(8),F(t),F(e),B(3),B(1),B(17),B(0),B(2),B(17),B(1),B(3),B(17),B(1)}(e.width,e.height),function(){F(65476),F(418),B(0);for(var e=0;e<16;e++)B(M[e+1]);for(var t=0;t<=11;t++)B(I[t]);B(16);for(var i=0;i<16;i++)B(E[i+1]);for(var a=0;a<=161;a++)B(S[a]);B(1);for(var r=0;r<16;r++)B(P[r+1]);for(var n=0;n<=11;n++)B(T[n]);B(17);for(var s=0;s<16;s++)B(C[s+1]);for(var o=0;o<=161;o++)B(A[o])}(),F(65498),F(12),B(3),B(1),B(0),B(2),B(17),B(3),B(17),B(0),B(63),B(0);var c=0,d=0,f=0;_=0,g=7,this.encode.displayName="_encode_";for(var m,w,k,$,N,Z,O,L,U,G=e.data,Q=e.width,j=e.height,H=4*Q,W=0;W<j;){for(m=0;m<H;){for(Z=N=H*W+m,O=-1,L=0,U=0;U<64;U++)Z=N+(L=U>>3)*H+(O=4*(7&U)),W+L>=j&&(Z-=H*(W+1+L-j)),m+O>=H&&(Z-=m+O-H+4),w=G[Z++],k=G[Z++],$=G[Z++],b[U]=(v[w]+v[k+256|0]+v[$+512|0]>>16)-128,y[U]=(v[w+768|0]+v[k+1024|0]+v[$+1280|0]>>16)-128,x[U]=(v[w+1280|0]+v[k+1536|0]+v[$+1792|0]>>16)-128;c=R(b,u,c,t,a),d=R(y,h,d,i,r),f=R(x,h,f,i,r),m+=32}W+=8}if(g>=0){var q=[];q[1]=g+1,q[0]=(1<<g+1)-1,z(q)}return F(65497),Buffer.from(p)},(new Date).getTime(),e||(e=50),function(){for(var e=String.fromCharCode,t=0;t<256;t++)w[t]=e(t)}(),t=$(M,I),i=$(P,T),a=$(E,S),r=$(C,A),function(){for(var e=1,t=2,i=1;i<=15;i++){for(var a=e;a<t;a++)d[32767+a]=i,c[32767+a]=[],c[32767+a][1]=i,c[32767+a][0]=a;for(var r=-(t-1);r<=-e;r++)d[32767+r]=i,c[32767+r]=[],c[32767+r][1]=i,c[32767+r][0]=t-1+r;e<<=1,t<<=1}}(),function(){for(var e=0;e<256;e++)v[e]=19595*e,v[e+256|0]=38470*e,v[e+512|0]=7471*e+32768,v[e+768|0]=-11059*e,v[e+1024|0]=-21709*e,v[e+1280|0]=32768*e+8421375,v[e+1536|0]=-27439*e,v[e+1792|0]=-5329*e}(),D(e),(new Date).getTime()}encoder.exports=function(e,i){void 0===i&&(i=50);var a=new t(i),r=a.encode(e,i);return{data:r,width:e.width,height:e.height}}}();var encoderExports=encoder.exports,decoder={exports:{}};!function(e){var t=function(){var e=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),t=4017,i=799,a=3406,r=2276,n=1567,s=3784,o=5793,l=2896;function u(){}function h(e,t){for(var i,a,r=0,n=[],s=16;s>0&&!e[s-1];)s--;n.push({children:[],index:0});var o,l=n[0];for(i=0;i<s;i++){for(a=0;a<e[i];a++){for((l=n.pop()).children[l.index]=t[r];l.index>0;){if(0===n.length)throw new Error("Could not recreate Huffman Table");l=n.pop()}for(l.index++,n.push(l);n.length<=i;)n.push(o={children:[],index:0}),l.children[l.index]=o.children,l=o;r++}i+1<s&&(n.push(o={children:[],index:0}),l.children[l.index]=o.children,l=o)}return n[0].children}function c(t,i,a,r,n,s,o,l,u,h){a.precision,a.samplesPerLine,a.scanLines;var c=a.mcusPerLine,d=a.progressive;a.maxH,a.maxV;var f=i,m=0,p=0;function _(){if(p>0)return p--,m>>p&1;if(255==(m=t[i++])){var e=t[i++];if(e)throw new Error("unexpected marker: "+(m<<8|e).toString(16))}return p=7,m>>>7}function g(e){for(var t,i=e;null!==(t=_());){if("number"==typeof(i=i[t]))return i;if("object"!=typeof i)throw new Error("invalid huffman sequence")}return null}function b(e){for(var t=0;e>0;){var i=_();if(null===i)return;t=t<<1|i,e--}return t}function y(e){var t=b(e);return t>=1<<e-1?t:t+(-1<<e)+1}var x=0;var w,v=0;function k(e,t,i,a,r){var n=i%c,s=(i/c|0)*e.v+a,o=n*e.h+r;void 0===e.blocks[s]&&h.tolerantDecoding||t(e,e.blocks[s][o])}function M(e,t,i){var a=i/e.blocksPerLine|0,r=i%e.blocksPerLine;void 0===e.blocks[a]&&h.tolerantDecoding||t(e,e.blocks[a][r])}var I,E,S,P,T,C,A=r.length;C=d?0===s?0===l?function(e,t){var i=g(e.huffmanTableDC),a=0===i?0:y(i)<<u;t[0]=e.pred+=a}:function(e,t){t[0]|=_()<<u}:0===l?function(t,i){if(x>0)x--;else for(var a=s,r=o;a<=r;){var n=g(t.huffmanTableAC),l=15&n,h=n>>4;if(0!==l)i[e[a+=h]]=y(l)*(1<<u),a++;else{if(h<15){x=b(h)+(1<<h)-1;break}a+=16}}}:function(t,i){for(var a=s,r=o,n=0;a<=r;){var l=e[a],h=i[l]<0?-1:1;switch(v){case 0:var c=g(t.huffmanTableAC),d=15&c;if(n=c>>4,0===d)n<15?(x=b(n)+(1<<n),v=4):(n=16,v=1);else{if(1!==d)throw new Error("invalid ACn encoding");w=y(d),v=n?2:3}continue;case 1:case 2:i[l]?i[l]+=(_()<<u)*h:0==--n&&(v=2==v?3:0);break;case 3:i[l]?i[l]+=(_()<<u)*h:(i[l]=w<<u,v=0);break;case 4:i[l]&&(i[l]+=(_()<<u)*h)}a++}4===v&&0==--x&&(v=0)}:function(t,i){var a=g(t.huffmanTableDC),r=0===a?0:y(a);i[0]=t.pred+=r;for(var n=1;n<64;){var s=g(t.huffmanTableAC),o=15&s,l=s>>4;if(0!==o)i[e[n+=l]]=y(o),n++;else{if(l<15)break;n+=16}}};var $,z,B,F,R=0;for(z=1==A?r[0].blocksPerLine*r[0].blocksPerColumn:c*a.mcusPerColumn,n||(n=z);R<z;){for(E=0;E<A;E++)r[E].pred=0;if(x=0,1==A)for(I=r[0],T=0;T<n;T++)M(I,C,R),R++;else for(T=0;T<n;T++){for(E=0;E<A;E++)for(B=(I=r[E]).h,F=I.v,S=0;S<F;S++)for(P=0;P<B;P++)k(I,C,R,S,P);if(++R===z)break}if(R===z)do{if(255===t[i]&&0!==t[i+1])break;i+=1}while(i<t.length-2);if(p=0,($=t[i]<<8|t[i+1])<65280)throw new Error("marker was not found");if(!($>=65488&&$<=65495))break;i+=2}return i-f}function d(e,u){var h,c,d=[],f=u.blocksPerLine,m=u.blocksPerColumn,p=f<<3,g=new Int32Array(64),b=new Uint8Array(64);function y(e,h,c){var d,f,m,p,_,g,b,y,x,w,v=u.quantizationTable,k=c;for(w=0;w<64;w++)k[w]=e[w]*v[w];for(w=0;w<8;++w){var M=8*w;0!=k[1+M]||0!=k[2+M]||0!=k[3+M]||0!=k[4+M]||0!=k[5+M]||0!=k[6+M]||0!=k[7+M]?(d=o*k[0+M]+128>>8,f=o*k[4+M]+128>>8,m=k[2+M],p=k[6+M],_=l*(k[1+M]-k[7+M])+128>>8,y=l*(k[1+M]+k[7+M])+128>>8,g=k[3+M]<<4,b=k[5+M]<<4,x=d-f+1>>1,d=d+f+1>>1,f=x,x=m*s+p*n+128>>8,m=m*n-p*s+128>>8,p=x,x=_-b+1>>1,_=_+b+1>>1,b=x,x=y+g+1>>1,g=y-g+1>>1,y=x,x=d-p+1>>1,d=d+p+1>>1,p=x,x=f-m+1>>1,f=f+m+1>>1,m=x,x=_*r+y*a+2048>>12,_=_*a-y*r+2048>>12,y=x,x=g*i+b*t+2048>>12,g=g*t-b*i+2048>>12,b=x,k[0+M]=d+y,k[7+M]=d-y,k[1+M]=f+b,k[6+M]=f-b,k[2+M]=m+g,k[5+M]=m-g,k[3+M]=p+_,k[4+M]=p-_):(x=o*k[0+M]+512>>10,k[0+M]=x,k[1+M]=x,k[2+M]=x,k[3+M]=x,k[4+M]=x,k[5+M]=x,k[6+M]=x,k[7+M]=x)}for(w=0;w<8;++w){var I=w;0!=k[8+I]||0!=k[16+I]||0!=k[24+I]||0!=k[32+I]||0!=k[40+I]||0!=k[48+I]||0!=k[56+I]?(d=o*k[0+I]+2048>>12,f=o*k[32+I]+2048>>12,m=k[16+I],p=k[48+I],_=l*(k[8+I]-k[56+I])+2048>>12,y=l*(k[8+I]+k[56+I])+2048>>12,g=k[24+I],b=k[40+I],x=d-f+1>>1,d=d+f+1>>1,f=x,x=m*s+p*n+2048>>12,m=m*n-p*s+2048>>12,p=x,x=_-b+1>>1,_=_+b+1>>1,b=x,x=y+g+1>>1,g=y-g+1>>1,y=x,x=d-p+1>>1,d=d+p+1>>1,p=x,x=f-m+1>>1,f=f+m+1>>1,m=x,x=_*r+y*a+2048>>12,_=_*a-y*r+2048>>12,y=x,x=g*i+b*t+2048>>12,g=g*t-b*i+2048>>12,b=x,k[0+I]=d+y,k[56+I]=d-y,k[8+I]=f+b,k[48+I]=f-b,k[16+I]=m+g,k[40+I]=m-g,k[24+I]=p+_,k[32+I]=p-_):(x=o*c[w+0]+8192>>14,k[0+I]=x,k[8+I]=x,k[16+I]=x,k[24+I]=x,k[32+I]=x,k[40+I]=x,k[48+I]=x,k[56+I]=x)}for(w=0;w<64;++w){var E=128+(k[w]+8>>4);h[w]=E<0?0:E>255?255:E}}_(p*m*8);for(var x=0;x<m;x++){var w=x<<3;for(h=0;h<8;h++)d.push(new Uint8Array(p));for(var v=0;v<f;v++){y(u.blocks[x][v],b,g);var k=0,M=v<<3;for(c=0;c<8;c++){var I=d[w+c];for(h=0;h<8;h++)I[M+h]=b[k++]}}}return d}function f(e){return e<0?0:e>255?255:e}u.prototype={load:function(e){var t=new XMLHttpRequest;t.open("GET",e,!0),t.responseType="arraybuffer",t.onload=function(){var e=new Uint8Array(t.response||t.mozResponseArrayBuffer);this.parse(e),this.onload&&this.onload()}.bind(this),t.send(null)},parse:function(t){var i=1e3*this.opts.maxResolutionInMP*1e3,a=0;function r(){var e=t[a]<<8|t[a+1];return a+=2,e}function n(e){var t,i,a=1,r=1;for(i in e.components)e.components.hasOwnProperty(i)&&(a<(t=e.components[i]).h&&(a=t.h),r<t.v&&(r=t.v));var n=Math.ceil(e.samplesPerLine/8/a),s=Math.ceil(e.scanLines/8/r);for(i in e.components)if(e.components.hasOwnProperty(i)){t=e.components[i];var o=Math.ceil(Math.ceil(e.samplesPerLine/8)*t.h/a),l=Math.ceil(Math.ceil(e.scanLines/8)*t.v/r),u=n*t.h,h=s*t.v,c=[];_(256*(h*u));for(var d=0;d<h;d++){for(var f=[],m=0;m<u;m++)f.push(new Int32Array(64));c.push(f)}t.blocksPerLine=o,t.blocksPerColumn=l,t.blocks=c}e.maxH=a,e.maxV=r,e.mcusPerLine=n,e.mcusPerColumn=s}t.length;var s,o,l,u,f=null,m=null,p=[],g=[],b=[],y=[],x=r(),w=-1;if(this.comments=[],65496!=x)throw new Error("SOI not found");for(x=r();65497!=x;){switch(x){case 65280:break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var v=(l=void 0,u=void 0,l=r(),u=t.subarray(a,a+l-2),a+=u.length,u);if(65534===x){var k=String.fromCharCode.apply(null,v);this.comments.push(k)}65504===x&&74===v[0]&&70===v[1]&&73===v[2]&&70===v[3]&&0===v[4]&&(f={version:{major:v[5],minor:v[6]},densityUnits:v[7],xDensity:v[8]<<8|v[9],yDensity:v[10]<<8|v[11],thumbWidth:v[12],thumbHeight:v[13],thumbData:v.subarray(14,14+3*v[12]*v[13])}),65505===x&&69===v[0]&&120===v[1]&&105===v[2]&&102===v[3]&&0===v[4]&&(this.exifBuffer=v.subarray(5,v.length)),65518===x&&65===v[0]&&100===v[1]&&111===v[2]&&98===v[3]&&101===v[4]&&0===v[5]&&(m={version:v[6],flags0:v[7]<<8|v[8],flags1:v[9]<<8|v[10],transformCode:v[11]});break;case 65499:for(var M=r()+a-2;a<M;){var I=t[a++];_(256);var E=new Int32Array(64);if(I>>4){if(I>>4!=1)throw new Error("DQT: invalid table spec");for(q=0;q<64;q++){E[e[q]]=r()}}else for(q=0;q<64;q++){E[e[q]]=t[a++]}p[15&I]=E}break;case 65472:case 65473:case 65474:r(),(s={}).extended=65473===x,s.progressive=65474===x,s.precision=t[a++],s.scanLines=r(),s.samplesPerLine=r(),s.components={},s.componentsOrder=[];var S=s.scanLines*s.samplesPerLine;if(S>i){var P=Math.ceil((S-i)/1e6);throw new Error(`maxResolutionInMP limit exceeded by ${P}MP`)}var T,C=t[a++];for(H=0;H<C;H++){T=t[a];var A=t[a+1]>>4,$=15&t[a+1],z=t[a+2];if(A<=0||$<=0)throw new Error("Invalid sampling factor, expected values above 0");s.componentsOrder.push(T),s.components[T]={h:A,v:$,quantizationIdx:z},a+=3}n(s),g.push(s);break;case 65476:var B=r();for(H=2;H<B;){var F=t[a++],R=new Uint8Array(16),D=0;for(q=0;q<16;q++,a++)D+=R[q]=t[a];_(16+D);var N=new Uint8Array(D);for(q=0;q<D;q++,a++)N[q]=t[a];H+=17+D,(F>>4?b:y)[15&F]=h(R,N)}break;case 65501:r(),o=r();break;case 65500:r(),r();break;case 65498:r();var Z=t[a++],O=[];for(H=0;H<Z;H++){V=s.components[t[a++]];var L=t[a++];V.huffmanTableDC=y[L>>4],V.huffmanTableAC=b[15&L],O.push(V)}var U=t[a++],G=t[a++],Q=t[a++],j=c(t,a,s,O,o,U,G,Q>>4,15&Q,this.opts);a+=j;break;case 65535:255!==t[a]&&a--;break;default:if(255==t[a-3]&&t[a-2]>=192&&t[a-2]<=254){a-=3;break}if(224===x||225==x){if(-1!==w)throw new Error(`first unknown JPEG marker at offset ${w.toString(16)}, second unknown JPEG marker ${x.toString(16)} at offset ${(a-1).toString(16)}`);w=a-1;const e=r();if(255===t[a+e-2]){a+=e-2;break}}throw new Error("unknown JPEG marker "+x.toString(16))}x=r()}if(1!=g.length)throw new Error("only single frame JPEGs supported");for(var H=0;H<g.length;H++){var W=g[H].components;for(var q in W)W[q].quantizationTable=p[W[q].quantizationIdx],delete W[q].quantizationIdx}this.width=s.samplesPerLine,this.height=s.scanLines,this.jfif=f,this.adobe=m,this.components=[];for(H=0;H<s.componentsOrder.length;H++){var V=s.components[s.componentsOrder[H]];this.components.push({lines:d(0,V),scaleX:V.h/s.maxH,scaleY:V.v/s.maxV})}},getData:function(e,t){var i,a,r,n,s,o,l,u,h,c,d,m,p,g,b,y,x,w,v,k,M,I=this.width/e,E=this.height/t,S=0,P=e*t*this.components.length;_(P);var T=new Uint8Array(P);switch(this.components.length){case 1:for(i=this.components[0],c=0;c<t;c++)for(s=i.lines[0|c*i.scaleY*E],h=0;h<e;h++)d=s[0|h*i.scaleX*I],T[S++]=d;break;case 2:for(i=this.components[0],a=this.components[1],c=0;c<t;c++)for(s=i.lines[0|c*i.scaleY*E],o=a.lines[0|c*a.scaleY*E],h=0;h<e;h++)d=s[0|h*i.scaleX*I],T[S++]=d,d=o[0|h*a.scaleX*I],T[S++]=d;break;case 3:for(M=!0,this.adobe&&this.adobe.transformCode?M=!0:void 0!==this.opts.colorTransform&&(M=!!this.opts.colorTransform),i=this.components[0],a=this.components[1],r=this.components[2],c=0;c<t;c++)for(s=i.lines[0|c*i.scaleY*E],o=a.lines[0|c*a.scaleY*E],l=r.lines[0|c*r.scaleY*E],h=0;h<e;h++)M?(d=s[0|h*i.scaleX*I],m=o[0|h*a.scaleX*I],w=f(d+1.402*((p=l[0|h*r.scaleX*I])-128)),v=f(d-.3441363*(m-128)-.71413636*(p-128)),k=f(d+1.772*(m-128))):(w=s[0|h*i.scaleX*I],v=o[0|h*a.scaleX*I],k=l[0|h*r.scaleX*I]),T[S++]=w,T[S++]=v,T[S++]=k;break;case 4:if(!this.adobe)throw new Error("Unsupported color mode (4 components)");for(M=!1,this.adobe&&this.adobe.transformCode?M=!0:void 0!==this.opts.colorTransform&&(M=!!this.opts.colorTransform),i=this.components[0],a=this.components[1],r=this.components[2],n=this.components[3],c=0;c<t;c++)for(s=i.lines[0|c*i.scaleY*E],o=a.lines[0|c*a.scaleY*E],l=r.lines[0|c*r.scaleY*E],u=n.lines[0|c*n.scaleY*E],h=0;h<e;h++)M?(d=s[0|h*i.scaleX*I],m=o[0|h*a.scaleX*I],p=l[0|h*r.scaleX*I],g=u[0|h*n.scaleX*I],b=255-f(d+1.402*(p-128)),y=255-f(d-.3441363*(m-128)-.71413636*(p-128)),x=255-f(d+1.772*(m-128))):(b=s[0|h*i.scaleX*I],y=o[0|h*a.scaleX*I],x=l[0|h*r.scaleX*I],g=u[0|h*n.scaleX*I]),T[S++]=255-b,T[S++]=255-y,T[S++]=255-x,T[S++]=255-g;break;default:throw new Error("Unsupported color mode")}return T},copyToImageData:function(e,t){var i,a,r,n,s,o,l,u,h,c=e.width,d=e.height,m=e.data,p=this.getData(c,d),_=0,g=0;switch(this.components.length){case 1:for(a=0;a<d;a++)for(i=0;i<c;i++)r=p[_++],m[g++]=r,m[g++]=r,m[g++]=r,t&&(m[g++]=255);break;case 3:for(a=0;a<d;a++)for(i=0;i<c;i++)l=p[_++],u=p[_++],h=p[_++],m[g++]=l,m[g++]=u,m[g++]=h,t&&(m[g++]=255);break;case 4:for(a=0;a<d;a++)for(i=0;i<c;i++)s=p[_++],o=p[_++],r=p[_++],l=255-f(s*(1-(n=p[_++])/255)+n),u=255-f(o*(1-n/255)+n),h=255-f(r*(1-n/255)+n),m[g++]=l,m[g++]=u,m[g++]=h,t&&(m[g++]=255);break;default:throw new Error("Unsupported color mode")}}};var m=0,p=0;function _(e=0){var t=m+e;if(t>p){var i=Math.ceil((t-p)/1024/1024);throw new Error(`maxMemoryUsageInMB limit exceeded by at least ${i}MB`)}m=t}return u.resetMaxMemoryUsage=function(e){m=0,p=e},u.getBytesAllocated=function(){return m},u.requestMemoryAllocation=_,u}();e.exports=function(e,i={}){var a={colorTransform:void 0,useTArray:!1,formatAsRGBA:!0,tolerantDecoding:!0,maxResolutionInMP:100,maxMemoryUsageInMB:512,...i},r=new Uint8Array(e),n=new t;n.opts=a,t.resetMaxMemoryUsage(1024*a.maxMemoryUsageInMB*1024),n.parse(r);var s=a.formatAsRGBA?4:3,o=n.width*n.height*s;try{t.requestMemoryAllocation(o);var l={width:n.width,height:n.height,exifBuffer:n.exifBuffer,data:a.useTArray?new Uint8Array(o):Buffer.alloc(o)};n.comments.length>0&&(l.comments=n.comments)}catch(e){if(e instanceof RangeError)throw new Error("Could not allocate enough memory for the image. Required: "+o);if(e instanceof ReferenceError&&"Buffer is not defined"===e.message)throw new Error("Buffer is not globally defined in this environment. Consider setting useTArray to true");throw e}return n.copyToImageData(l,a.formatAsRGBA),l}}(decoder);var decoderExports=decoder.exports,encode=encoderExports,decode=decoderExports,jpegJs={encode:encode,decode:decode},JPEG=getDefaultExportFromCjs(jpegJs);function jpeg$2(){return{mime:"image/jpeg",encode:(e,{quality:t=100}={})=>JPEG.encode(e,t).data,decode:(e,t)=>JPEG.decode(e,t)}}var parserAsync={exports:{}},chunkstream={exports:{}};let util$5=require$$0,Stream$2=stream$1,ChunkStream$2=chunkstream.exports=function(){Stream$2.call(this),this._buffers=[],this._buffered=0,this._reads=[],this._paused=!1,this._encoding="utf8",this.writable=!0};util$5.inherits(ChunkStream$2,Stream$2),ChunkStream$2.prototype.read=function(e,t){this._reads.push({length:Math.abs(e),allowLess:e<0,func:t}),process.nextTick(function(){this._process(),this._paused&&this._reads&&this._reads.length>0&&(this._paused=!1,this.emit("drain"))}.bind(this))},ChunkStream$2.prototype.write=function(e,t){if(!this.writable)return this.emit("error",new Error("Stream not writable")),!1;let i;return i=Buffer.isBuffer(e)?e:Buffer.from(e,t||this._encoding),this._buffers.push(i),this._buffered+=i.length,this._process(),this._reads&&0===this._reads.length&&(this._paused=!0),this.writable&&!this._paused},ChunkStream$2.prototype.end=function(e,t){e&&this.write(e,t),this.writable=!1,this._buffers&&(0===this._buffers.length?this._end():(this._buffers.push(null),this._process()))},ChunkStream$2.prototype.destroySoon=ChunkStream$2.prototype.end,ChunkStream$2.prototype._end=function(){this._reads.length>0&&this.emit("error",new Error("Unexpected end of input")),this.destroy()},ChunkStream$2.prototype.destroy=function(){this._buffers&&(this.writable=!1,this._reads=null,this._buffers=null,this.emit("close"))},ChunkStream$2.prototype._processReadAllowingLess=function(e){this._reads.shift();let t=this._buffers[0];t.length>e.length?(this._buffered-=e.length,this._buffers[0]=t.slice(e.length),e.func.call(this,t.slice(0,e.length))):(this._buffered-=t.length,this._buffers.shift(),e.func.call(this,t))},ChunkStream$2.prototype._processRead=function(e){this._reads.shift();let t=0,i=0,a=Buffer.alloc(e.length);for(;t<e.length;){let r=this._buffers[i++],n=Math.min(r.length,e.length-t);r.copy(a,t,0,n),t+=n,n!==r.length&&(this._buffers[--i]=r.slice(n))}i>0&&this._buffers.splice(0,i),this._buffered-=e.length,e.func.call(this,a)},ChunkStream$2.prototype._process=function(){try{for(;this._buffered>0&&this._reads&&this._reads.length>0;){let e=this._reads[0];if(e.allowLess)this._processReadAllowingLess(e);else{if(!(this._buffered>=e.length))break;this._processRead(e)}}this._buffers&&!this.writable&&this._end()}catch(e){this.emit("error",e)}};var chunkstreamExports=chunkstream.exports,filterParseAsync={exports:{}},filterParse={exports:{}},interlace={};let imagePasses=[{x:[0],y:[0]},{x:[4],y:[0]},{x:[0,4],y:[4]},{x:[2,6],y:[0,4]},{x:[0,2,4,6],y:[2,6]},{x:[1,3,5,7],y:[0,2,4,6]},{x:[0,1,2,3,4,5,6,7],y:[1,3,5,7]}];interlace.getImagePasses=function(e,t){let i=[],a=e%8,r=t%8,n=(e-a)/8,s=(t-r)/8;for(let e=0;e<imagePasses.length;e++){let t=imagePasses[e],o=n*t.x.length,l=s*t.y.length;for(let e=0;e<t.x.length&&t.x[e]<a;e++)o++;for(let e=0;e<t.y.length&&t.y[e]<r;e++)l++;o>0&&l>0&&i.push({width:o,height:l,index:e})}return i},interlace.getInterlaceIterator=function(e){return function(t,i,a){let r=t%imagePasses[a].x.length,n=(t-r)/imagePasses[a].x.length*8+imagePasses[a].x[r],s=i%imagePasses[a].y.length;return 4*n+((i-s)/imagePasses[a].y.length*8+imagePasses[a].y[s])*e*4}};var paethPredictor$2=function(e,t,i){let a=e+t-i,r=Math.abs(a-e),n=Math.abs(a-t),s=Math.abs(a-i);return r<=n&&r<=s?e:n<=s?t:i};let interlaceUtils$1=interlace,paethPredictor$1=paethPredictor$2;function getByteWidth(e,t,i){let a=e*t;return 8!==i&&(a=Math.ceil(a/(8/i))),a}let Filter$2=filterParse.exports=function(e,t){let i=e.width,a=e.height,r=e.interlace,n=e.bpp,s=e.depth;if(this.read=t.read,this.write=t.write,this.complete=t.complete,this._imageIndex=0,this._images=[],r){let e=interlaceUtils$1.getImagePasses(i,a);for(let t=0;t<e.length;t++)this._images.push({byteWidth:getByteWidth(e[t].width,n,s),height:e[t].height,lineIndex:0})}else this._images.push({byteWidth:getByteWidth(i,n,s),height:a,lineIndex:0});this._xComparison=8===s?n:16===s?2*n:1};Filter$2.prototype.start=function(){this.read(this._images[this._imageIndex].byteWidth+1,this._reverseFilterLine.bind(this))},Filter$2.prototype._unFilterType1=function(e,t,i){let a=this._xComparison,r=a-1;for(let n=0;n<i;n++){let i=e[1+n],s=n>r?t[n-a]:0;t[n]=i+s}},Filter$2.prototype._unFilterType2=function(e,t,i){let a=this._lastLine;for(let r=0;r<i;r++){let i=e[1+r],n=a?a[r]:0;t[r]=i+n}},Filter$2.prototype._unFilterType3=function(e,t,i){let a=this._xComparison,r=a-1,n=this._lastLine;for(let s=0;s<i;s++){let i=e[1+s],o=n?n[s]:0,l=s>r?t[s-a]:0,u=Math.floor((l+o)/2);t[s]=i+u}},Filter$2.prototype._unFilterType4=function(e,t,i){let a=this._xComparison,r=a-1,n=this._lastLine;for(let s=0;s<i;s++){let i=e[1+s],o=n?n[s]:0,l=s>r?t[s-a]:0,u=s>r&&n?n[s-a]:0,h=paethPredictor$1(l,o,u);t[s]=i+h}},Filter$2.prototype._reverseFilterLine=function(e){let t,i=e[0],a=this._images[this._imageIndex],r=a.byteWidth;if(0===i)t=e.slice(1,r+1);else switch(t=Buffer.alloc(r),i){case 1:this._unFilterType1(e,t,r);break;case 2:this._unFilterType2(e,t,r);break;case 3:this._unFilterType3(e,t,r);break;case 4:this._unFilterType4(e,t,r);break;default:throw new Error("Unrecognised filter type - "+i)}this.write(t),a.lineIndex++,a.lineIndex>=a.height?(this._lastLine=null,this._imageIndex++,a=this._images[this._imageIndex]):this._lastLine=t,a?this.read(a.byteWidth+1,this._reverseFilterLine.bind(this)):(this._lastLine=null,this.complete())};var filterParseExports=filterParse.exports;let util$4=require$$0,ChunkStream$1=chunkstreamExports,Filter$1=filterParseExports,FilterAsync$1=filterParseAsync.exports=function(e){ChunkStream$1.call(this);let t=[],i=this;this._filter=new Filter$1(e,{read:this.read.bind(this),write:function(e){t.push(e)},complete:function(){i.emit("complete",Buffer.concat(t))}}),this._filter.start()};util$4.inherits(FilterAsync$1,ChunkStream$1);var filterParseAsyncExports=filterParseAsync.exports,parser$1={exports:{}},constants$6={PNG_SIGNATURE:[137,80,78,71,13,10,26,10],TYPE_IHDR:1229472850,TYPE_IEND:1229278788,TYPE_IDAT:1229209940,TYPE_PLTE:1347179589,TYPE_tRNS:1951551059,TYPE_gAMA:1732332865,COLORTYPE_GRAYSCALE:0,COLORTYPE_PALETTE:1,COLORTYPE_COLOR:2,COLORTYPE_ALPHA:4,COLORTYPE_PALETTE_COLOR:3,COLORTYPE_COLOR_ALPHA:6,COLORTYPE_TO_BPP_MAP:{0:1,2:3,3:1,4:2,6:4},GAMMA_DIVISION:1e5},crc={exports:{}};let crcTable=[];!function(){for(let e=0;e<256;e++){let t=e;for(let e=0;e<8;e++)1&t?t=3988292384^t>>>1:t>>>=1;crcTable[e]=t}}();let CrcCalculator$1=crc.exports=function(){this._crc=-1};CrcCalculator$1.prototype.write=function(e){for(let t=0;t<e.length;t++)this._crc=crcTable[255&(this._crc^e[t])]^this._crc>>>8;return!0},CrcCalculator$1.prototype.crc32=function(){return~this._crc},CrcCalculator$1.crc32=function(e){let t=-1;for(let i=0;i<e.length;i++)t=crcTable[255&(t^e[i])]^t>>>8;return~t};var crcExports=crc.exports;let constants$5=constants$6,CrcCalculator=crcExports,Parser$5=parser$1.exports=function(e,t){this._options=e,e.checkCRC=!1!==e.checkCRC,this._hasIHDR=!1,this._hasIEND=!1,this._emittedHeadersFinished=!1,this._palette=[],this._colorType=0,this._chunks={},this._chunks[constants$5.TYPE_IHDR]=this._handleIHDR.bind(this),this._chunks[constants$5.TYPE_IEND]=this._handleIEND.bind(this),this._chunks[constants$5.TYPE_IDAT]=this._handleIDAT.bind(this),this._chunks[constants$5.TYPE_PLTE]=this._handlePLTE.bind(this),this._chunks[constants$5.TYPE_tRNS]=this._handleTRNS.bind(this),this._chunks[constants$5.TYPE_gAMA]=this._handleGAMA.bind(this),this.read=t.read,this.error=t.error,this.metadata=t.metadata,this.gamma=t.gamma,this.transColor=t.transColor,this.palette=t.palette,this.parsed=t.parsed,this.inflateData=t.inflateData,this.finished=t.finished,this.simpleTransparency=t.simpleTransparency,this.headersFinished=t.headersFinished||function(){}};Parser$5.prototype.start=function(){this.read(constants$5.PNG_SIGNATURE.length,this._parseSignature.bind(this))},Parser$5.prototype._parseSignature=function(e){let t=constants$5.PNG_SIGNATURE;for(let i=0;i<t.length;i++)if(e[i]!==t[i])return void this.error(new Error("Invalid file signature"));this.read(8,this._parseChunkBegin.bind(this))},Parser$5.prototype._parseChunkBegin=function(e){let t=e.readUInt32BE(0),i=e.readUInt32BE(4),a="";for(let t=4;t<8;t++)a+=String.fromCharCode(e[t]);let r=Boolean(32&e[4]);if(this._hasIHDR||i===constants$5.TYPE_IHDR){if(this._crc=new CrcCalculator,this._crc.write(Buffer.from(a)),this._chunks[i])return this._chunks[i](t);r?this.read(t+4,this._skipChunk.bind(this)):this.error(new Error("Unsupported critical chunk type "+a))}else this.error(new Error("Expected IHDR on beggining"))},Parser$5.prototype._skipChunk=function(){this.read(8,this._parseChunkBegin.bind(this))},Parser$5.prototype._handleChunkEnd=function(){this.read(4,this._parseChunkEnd.bind(this))},Parser$5.prototype._parseChunkEnd=function(e){let t=e.readInt32BE(0),i=this._crc.crc32();this._options.checkCRC&&i!==t?this.error(new Error("Crc error - "+t+" - "+i)):this._hasIEND||this.read(8,this._parseChunkBegin.bind(this))},Parser$5.prototype._handleIHDR=function(e){this.read(e,this._parseIHDR.bind(this))},Parser$5.prototype._parseIHDR=function(e){this._crc.write(e);let t=e.readUInt32BE(0),i=e.readUInt32BE(4),a=e[8],r=e[9],n=e[10],s=e[11],o=e[12];if(8!==a&&4!==a&&2!==a&&1!==a&&16!==a)return void this.error(new Error("Unsupported bit depth "+a));if(!(r in constants$5.COLORTYPE_TO_BPP_MAP))return void this.error(new Error("Unsupported color type"));if(0!==n)return void this.error(new Error("Unsupported compression method"));if(0!==s)return void this.error(new Error("Unsupported filter method"));if(0!==o&&1!==o)return void this.error(new Error("Unsupported interlace method"));this._colorType=r;let l=constants$5.COLORTYPE_TO_BPP_MAP[this._colorType];this._hasIHDR=!0,this.metadata({width:t,height:i,depth:a,interlace:Boolean(o),palette:Boolean(r&constants$5.COLORTYPE_PALETTE),color:Boolean(r&constants$5.COLORTYPE_COLOR),alpha:Boolean(r&constants$5.COLORTYPE_ALPHA),bpp:l,colorType:r}),this._handleChunkEnd()},Parser$5.prototype._handlePLTE=function(e){this.read(e,this._parsePLTE.bind(this))},Parser$5.prototype._parsePLTE=function(e){this._crc.write(e);let t=Math.floor(e.length/3);for(let i=0;i<t;i++)this._palette.push([e[3*i],e[3*i+1],e[3*i+2],255]);this.palette(this._palette),this._handleChunkEnd()},Parser$5.prototype._handleTRNS=function(e){this.simpleTransparency(),this.read(e,this._parseTRNS.bind(this))},Parser$5.prototype._parseTRNS=function(e){if(this._crc.write(e),this._colorType===constants$5.COLORTYPE_PALETTE_COLOR){if(0===this._palette.length)return void this.error(new Error("Transparency chunk must be after palette"));if(e.length>this._palette.length)return void this.error(new Error("More transparent colors than palette size"));for(let t=0;t<e.length;t++)this._palette[t][3]=e[t];this.palette(this._palette)}this._colorType===constants$5.COLORTYPE_GRAYSCALE&&this.transColor([e.readUInt16BE(0)]),this._colorType===constants$5.COLORTYPE_COLOR&&this.transColor([e.readUInt16BE(0),e.readUInt16BE(2),e.readUInt16BE(4)]),this._handleChunkEnd()},Parser$5.prototype._handleGAMA=function(e){this.read(e,this._parseGAMA.bind(this))},Parser$5.prototype._parseGAMA=function(e){this._crc.write(e),this.gamma(e.readUInt32BE(0)/constants$5.GAMMA_DIVISION),this._handleChunkEnd()},Parser$5.prototype._handleIDAT=function(e){this._emittedHeadersFinished||(this._emittedHeadersFinished=!0,this.headersFinished()),this.read(-e,this._parseIDAT.bind(this,e))},Parser$5.prototype._parseIDAT=function(e,t){if(this._crc.write(t),this._colorType===constants$5.COLORTYPE_PALETTE_COLOR&&0===this._palette.length)throw new Error("Expected palette not found");this.inflateData(t);let i=e-t.length;i>0?this._handleIDAT(i):this._handleChunkEnd()},Parser$5.prototype._handleIEND=function(e){this.read(e,this._parseIEND.bind(this))},Parser$5.prototype._parseIEND=function(e){this._crc.write(e),this._hasIEND=!0,this._handleChunkEnd(),this.finished&&this.finished()};var parserExports=parser$1.exports,bitmapper$2={};let interlaceUtils=interlace,pixelBppMapper=[function(){},function(e,t,i,a){if(a===t.length)throw new Error("Ran out of data");let r=t[a];e[i]=r,e[i+1]=r,e[i+2]=r,e[i+3]=255},function(e,t,i,a){if(a+1>=t.length)throw new Error("Ran out of data");let r=t[a];e[i]=r,e[i+1]=r,e[i+2]=r,e[i+3]=t[a+1]},function(e,t,i,a){if(a+2>=t.length)throw new Error("Ran out of data");e[i]=t[a],e[i+1]=t[a+1],e[i+2]=t[a+2],e[i+3]=255},function(e,t,i,a){if(a+3>=t.length)throw new Error("Ran out of data");e[i]=t[a],e[i+1]=t[a+1],e[i+2]=t[a+2],e[i+3]=t[a+3]}],pixelBppCustomMapper=[function(){},function(e,t,i,a){let r=t[0];e[i]=r,e[i+1]=r,e[i+2]=r,e[i+3]=a},function(e,t,i){let a=t[0];e[i]=a,e[i+1]=a,e[i+2]=a,e[i+3]=t[1]},function(e,t,i,a){e[i]=t[0],e[i+1]=t[1],e[i+2]=t[2],e[i+3]=a},function(e,t,i){e[i]=t[0],e[i+1]=t[1],e[i+2]=t[2],e[i+3]=t[3]}];function bitRetriever(e,t){let i=[],a=0;function r(){if(a===e.length)throw new Error("Ran out of data");let r,n,s,o,l,u,h,c,d=e[a];switch(a++,t){default:throw new Error("unrecognised depth");case 16:h=e[a],a++,i.push((d<<8)+h);break;case 4:h=15&d,c=d>>4,i.push(c,h);break;case 2:l=3&d,u=d>>2&3,h=d>>4&3,c=d>>6&3,i.push(c,h,u,l);break;case 1:r=1&d,n=d>>1&1,s=d>>2&1,o=d>>3&1,l=d>>4&1,u=d>>5&1,h=d>>6&1,c=d>>7&1,i.push(c,h,u,l,o,s,n,r)}}return{get:function(e){for(;i.length<e;)r();let t=i.slice(0,e);return i=i.slice(e),t},resetAfterLine:function(){i.length=0},end:function(){if(a!==e.length)throw new Error("extra data found")}}}function mapImage8Bit(e,t,i,a,r,n){let s=e.width,o=e.height,l=e.index;for(let e=0;e<o;e++)for(let o=0;o<s;o++){let s=i(o,e,l);pixelBppMapper[a](t,r,s,n),n+=a}return n}function mapImageCustomBit(e,t,i,a,r,n){let s=e.width,o=e.height,l=e.index;for(let e=0;e<o;e++){for(let o=0;o<s;o++){let s=r.get(a),u=i(o,e,l);pixelBppCustomMapper[a](t,s,u,n)}r.resetAfterLine()}}function dePalette(e,t,i,a,r){let n=0;for(let s=0;s<a;s++)for(let a=0;a<i;a++){let i=r[e[n]];if(!i)throw new Error("index "+e[n]+" not in palette");for(let e=0;e<4;e++)t[n+e]=i[e];n+=4}}function replaceTransparentColor(e,t,i,a,r){let n=0;for(let s=0;s<a;s++)for(let a=0;a<i;a++){let i=!1;if(1===r.length?r[0]===e[n]&&(i=!0):r[0]===e[n]&&r[1]===e[n+1]&&r[2]===e[n+2]&&(i=!0),i)for(let e=0;e<4;e++)t[n+e]=0;n+=4}}function scaleDepth(e,t,i,a,r){let n=Math.pow(2,r)-1,s=0;for(let r=0;r<a;r++)for(let a=0;a<i;a++){for(let i=0;i<4;i++)t[s+i]=Math.floor(255*e[s+i]/n+.5);s+=4}}bitmapper$2.dataToBitMap=function(e,t){let i,a,r=t.width,n=t.height,s=t.depth,o=t.bpp,l=t.interlace;8!==s&&(i=bitRetriever(e,s)),a=s<=8?Buffer.alloc(r*n*4):new Uint16Array(r*n*4);let u,h,c=Math.pow(2,s)-1,d=0;if(l)u=interlaceUtils.getImagePasses(r,n),h=interlaceUtils.getInterlaceIterator(r,n);else{let e=0;h=function(){let t=e;return e+=4,t},u=[{width:r,height:n}]}for(let t=0;t<u.length;t++)8===s?d=mapImage8Bit(u[t],a,h,o,e,d):mapImageCustomBit(u[t],a,h,o,i,c);if(8===s){if(d!==e.length)throw new Error("extra data found")}else i.end();return a};var formatNormaliser$2=function(e,t,i=!1){let a=t.depth,r=t.width,n=t.height,s=t.colorType,o=t.transColor,l=t.palette,u=e;return 3===s?dePalette(e,u,r,n,l):(o&&replaceTransparentColor(e,u,r,n,o),8===a||i||(16===a&&(u=Buffer.alloc(r*n*4)),scaleDepth(e,u,r,n,a))),u};let util$3=require$$0,zlib$3=zlib$4,ChunkStream=chunkstreamExports,FilterAsync=filterParseAsyncExports,Parser$4=parserExports,bitmapper$1=bitmapper$2,formatNormaliser$1=formatNormaliser$2,ParserAsync=parserAsync.exports=function(e){ChunkStream.call(this),this._parser=new Parser$4(e,{read:this.read.bind(this),error:this._handleError.bind(this),metadata:this._handleMetaData.bind(this),gamma:this.emit.bind(this,"gamma"),palette:this._handlePalette.bind(this),transColor:this._handleTransColor.bind(this),finished:this._finished.bind(this),inflateData:this._inflateData.bind(this),simpleTransparency:this._simpleTransparency.bind(this),headersFinished:this._headersFinished.bind(this)}),this._options=e,this.writable=!0,this._parser.start()};util$3.inherits(ParserAsync,ChunkStream),ParserAsync.prototype._handleError=function(e){this.emit("error",e),this.writable=!1,this.destroy(),this._inflate&&this._inflate.destroy&&this._inflate.destroy(),this._filter&&(this._filter.destroy(),this._filter.on("error",(function(){}))),this.errord=!0},ParserAsync.prototype._inflateData=function(e){if(!this._inflate)if(this._bitmapInfo.interlace)this._inflate=zlib$3.createInflate(),this._inflate.on("error",this.emit.bind(this,"error")),this._filter.on("complete",this._complete.bind(this)),this._inflate.pipe(this._filter);else{let e=(1+(this._bitmapInfo.width*this._bitmapInfo.bpp*this._bitmapInfo.depth+7>>3))*this._bitmapInfo.height,t=Math.max(e,zlib$3.Z_MIN_CHUNK);this._inflate=zlib$3.createInflate({chunkSize:t});let i=e,a=this.emit.bind(this,"error");this._inflate.on("error",(function(e){i&&a(e)})),this._filter.on("complete",this._complete.bind(this));let r=this._filter.write.bind(this._filter);this._inflate.on("data",(function(e){i&&(e.length>i&&(e=e.slice(0,i)),i-=e.length,r(e))})),this._inflate.on("end",this._filter.end.bind(this._filter))}this._inflate.write(e)},ParserAsync.prototype._handleMetaData=function(e){this._metaData=e,this._bitmapInfo=Object.create(e),this._filter=new FilterAsync(this._bitmapInfo)},ParserAsync.prototype._handleTransColor=function(e){this._bitmapInfo.transColor=e},ParserAsync.prototype._handlePalette=function(e){this._bitmapInfo.palette=e},ParserAsync.prototype._simpleTransparency=function(){this._metaData.alpha=!0},ParserAsync.prototype._headersFinished=function(){this.emit("metadata",this._metaData)},ParserAsync.prototype._finished=function(){this.errord||(this._inflate?this._inflate.end():this.emit("error","No Inflate block"))},ParserAsync.prototype._complete=function(e){if(this.errord)return;let t;try{let i=bitmapper$1.dataToBitMap(e,this._bitmapInfo);t=formatNormaliser$1(i,this._bitmapInfo,this._options.skipRescale),i=null}catch(e){return void this._handleError(e)}this.emit("parsed",t)};var parserAsyncExports=parserAsync.exports,packerAsync={exports:{}},packer={exports:{}};let constants$4=constants$6;var bitpacker=function(e,t,i,a){let r=-1!==[constants$4.COLORTYPE_COLOR_ALPHA,constants$4.COLORTYPE_ALPHA].indexOf(a.colorType);if(a.colorType===a.inputColorType){let t=function(){let e=new ArrayBuffer(2);return new DataView(e).setInt16(0,256,!0),256!==new Int16Array(e)[0]}();if(8===a.bitDepth||16===a.bitDepth&&t)return e}let n=16!==a.bitDepth?e:new Uint16Array(e.buffer),s=255,o=constants$4.COLORTYPE_TO_BPP_MAP[a.inputColorType];4!==o||a.inputHasAlpha||(o=3);let l=constants$4.COLORTYPE_TO_BPP_MAP[a.colorType];16===a.bitDepth&&(s=65535,l*=2);let u=Buffer.alloc(t*i*l),h=0,c=0,d=a.bgColor||{};function f(){let e,t,i,o=s;switch(a.inputColorType){case constants$4.COLORTYPE_COLOR_ALPHA:o=n[h+3],e=n[h],t=n[h+1],i=n[h+2];break;case constants$4.COLORTYPE_COLOR:e=n[h],t=n[h+1],i=n[h+2];break;case constants$4.COLORTYPE_ALPHA:o=n[h+1],e=n[h],t=e,i=e;break;case constants$4.COLORTYPE_GRAYSCALE:e=n[h],t=e,i=e;break;default:throw new Error("input color type:"+a.inputColorType+" is not supported at present")}return a.inputHasAlpha&&(r||(o/=s,e=Math.min(Math.max(Math.round((1-o)*d.red+o*e),0),s),t=Math.min(Math.max(Math.round((1-o)*d.green+o*t),0),s),i=Math.min(Math.max(Math.round((1-o)*d.blue+o*i),0),s))),{red:e,green:t,blue:i,alpha:o}}void 0===d.red&&(d.red=s),void 0===d.green&&(d.green=s),void 0===d.blue&&(d.blue=s);for(let e=0;e<i;e++)for(let e=0;e<t;e++){let e=f();switch(a.colorType){case constants$4.COLORTYPE_COLOR_ALPHA:case constants$4.COLORTYPE_COLOR:8===a.bitDepth?(u[c]=e.red,u[c+1]=e.green,u[c+2]=e.blue,r&&(u[c+3]=e.alpha)):(u.writeUInt16BE(e.red,c),u.writeUInt16BE(e.green,c+2),u.writeUInt16BE(e.blue,c+4),r&&u.writeUInt16BE(e.alpha,c+6));break;case constants$4.COLORTYPE_ALPHA:case constants$4.COLORTYPE_GRAYSCALE:{let t=(e.red+e.green+e.blue)/3;8===a.bitDepth?(u[c]=t,r&&(u[c+1]=e.alpha)):(u.writeUInt16BE(t,c),r&&u.writeUInt16BE(e.alpha,c+2));break}default:throw new Error("unrecognised color Type "+a.colorType)}h+=o,c+=l}return u};let paethPredictor=paethPredictor$2;function filterNone(e,t,i,a,r){for(let n=0;n<i;n++)a[r+n]=e[t+n]}function filterSumNone(e,t,i){let a=0,r=t+i;for(let i=t;i<r;i++)a+=Math.abs(e[i]);return a}function filterSub(e,t,i,a,r,n){for(let s=0;s<i;s++){let i=s>=n?e[t+s-n]:0,o=e[t+s]-i;a[r+s]=o}}function filterSumSub(e,t,i,a){let r=0;for(let n=0;n<i;n++){let i=n>=a?e[t+n-a]:0,s=e[t+n]-i;r+=Math.abs(s)}return r}function filterUp(e,t,i,a,r){for(let n=0;n<i;n++){let s=t>0?e[t+n-i]:0,o=e[t+n]-s;a[r+n]=o}}function filterSumUp(e,t,i){let a=0,r=t+i;for(let n=t;n<r;n++){let r=t>0?e[n-i]:0,s=e[n]-r;a+=Math.abs(s)}return a}function filterAvg(e,t,i,a,r,n){for(let s=0;s<i;s++){let o=s>=n?e[t+s-n]:0,l=t>0?e[t+s-i]:0,u=e[t+s]-(o+l>>1);a[r+s]=u}}function filterSumAvg(e,t,i,a){let r=0;for(let n=0;n<i;n++){let s=n>=a?e[t+n-a]:0,o=t>0?e[t+n-i]:0,l=e[t+n]-(s+o>>1);r+=Math.abs(l)}return r}function filterPaeth(e,t,i,a,r,n){for(let s=0;s<i;s++){let o=s>=n?e[t+s-n]:0,l=t>0?e[t+s-i]:0,u=t>0&&s>=n?e[t+s-(i+n)]:0,h=e[t+s]-paethPredictor(o,l,u);a[r+s]=h}}function filterSumPaeth(e,t,i,a){let r=0;for(let n=0;n<i;n++){let s=n>=a?e[t+n-a]:0,o=t>0?e[t+n-i]:0,l=t>0&&n>=a?e[t+n-(i+a)]:0,u=e[t+n]-paethPredictor(s,o,l);r+=Math.abs(u)}return r}let filters={0:filterNone,1:filterSub,2:filterUp,3:filterAvg,4:filterPaeth},filterSums={0:filterSumNone,1:filterSumSub,2:filterSumUp,3:filterSumAvg,4:filterSumPaeth};var filterPack=function(e,t,i,a,r){let n;if("filterType"in a&&-1!==a.filterType){if("number"!=typeof a.filterType)throw new Error("unrecognised filter types");n=[a.filterType]}else n=[0,1,2,3,4];16===a.bitDepth&&(r*=2);let s=t*r,o=0,l=0,u=Buffer.alloc((s+1)*i),h=n[0];for(let t=0;t<i;t++){if(n.length>1){let t=1/0;for(let i=0;i<n.length;i++){let a=filterSums[n[i]](e,l,s,r);a<t&&(h=n[i],t=a)}}u[o]=h,o++,filters[h](e,l,s,u,o,r),o+=s,l+=s}return u};let constants$3=constants$6,CrcStream=crcExports,bitPacker=bitpacker,filter=filterPack,zlib$2=zlib$4,Packer$3=packer.exports=function(e){if(this._options=e,e.deflateChunkSize=e.deflateChunkSize||32768,e.deflateLevel=null!=e.deflateLevel?e.deflateLevel:9,e.deflateStrategy=null!=e.deflateStrategy?e.deflateStrategy:3,e.inputHasAlpha=null==e.inputHasAlpha||e.inputHasAlpha,e.deflateFactory=e.deflateFactory||zlib$2.createDeflate,e.bitDepth=e.bitDepth||8,e.colorType="number"==typeof e.colorType?e.colorType:constants$3.COLORTYPE_COLOR_ALPHA,e.inputColorType="number"==typeof e.inputColorType?e.inputColorType:constants$3.COLORTYPE_COLOR_ALPHA,-1===[constants$3.COLORTYPE_GRAYSCALE,constants$3.COLORTYPE_COLOR,constants$3.COLORTYPE_COLOR_ALPHA,constants$3.COLORTYPE_ALPHA].indexOf(e.colorType))throw new Error("option color type:"+e.colorType+" is not supported at present");if(-1===[constants$3.COLORTYPE_GRAYSCALE,constants$3.COLORTYPE_COLOR,constants$3.COLORTYPE_COLOR_ALPHA,constants$3.COLORTYPE_ALPHA].indexOf(e.inputColorType))throw new Error("option input color type:"+e.inputColorType+" is not supported at present");if(8!==e.bitDepth&&16!==e.bitDepth)throw new Error("option bit depth:"+e.bitDepth+" is not supported at present")};Packer$3.prototype.getDeflateOptions=function(){return{chunkSize:this._options.deflateChunkSize,level:this._options.deflateLevel,strategy:this._options.deflateStrategy}},Packer$3.prototype.createDeflate=function(){return this._options.deflateFactory(this.getDeflateOptions())},Packer$3.prototype.filterData=function(e,t,i){let a=bitPacker(e,t,i,this._options),r=constants$3.COLORTYPE_TO_BPP_MAP[this._options.colorType];return filter(a,t,i,this._options,r)},Packer$3.prototype._packChunk=function(e,t){let i=t?t.length:0,a=Buffer.alloc(i+12);return a.writeUInt32BE(i,0),a.writeUInt32BE(e,4),t&&t.copy(a,8),a.writeInt32BE(CrcStream.crc32(a.slice(4,a.length-4)),a.length-4),a},Packer$3.prototype.packGAMA=function(e){let t=Buffer.alloc(4);return t.writeUInt32BE(Math.floor(e*constants$3.GAMMA_DIVISION),0),this._packChunk(constants$3.TYPE_gAMA,t)},Packer$3.prototype.packIHDR=function(e,t){let i=Buffer.alloc(13);return i.writeUInt32BE(e,0),i.writeUInt32BE(t,4),i[8]=this._options.bitDepth,i[9]=this._options.colorType,i[10]=0,i[11]=0,i[12]=0,this._packChunk(constants$3.TYPE_IHDR,i)},Packer$3.prototype.packIDAT=function(e){return this._packChunk(constants$3.TYPE_IDAT,e)},Packer$3.prototype.packIEND=function(){return this._packChunk(constants$3.TYPE_IEND,null)};var packerExports=packer.exports;let util$2=require$$0,Stream$1=stream$1,constants$2=constants$6,Packer$2=packerExports,PackerAsync=packerAsync.exports=function(e){Stream$1.call(this);let t=e||{};this._packer=new Packer$2(t),this._deflate=this._packer.createDeflate(),this.readable=!0};util$2.inherits(PackerAsync,Stream$1),PackerAsync.prototype.pack=function(e,t,i,a){this.emit("data",Buffer.from(constants$2.PNG_SIGNATURE)),this.emit("data",this._packer.packIHDR(t,i)),a&&this.emit("data",this._packer.packGAMA(a));let r=this._packer.filterData(e,t,i);this._deflate.on("error",this.emit.bind(this,"error")),this._deflate.on("data",function(e){this.emit("data",this._packer.packIDAT(e))}.bind(this)),this._deflate.on("end",function(){this.emit("data",this._packer.packIEND()),this.emit("end")}.bind(this)),this._deflate.end(r)};var packerAsyncExports=packerAsync.exports,pngSync={},syncInflate={exports:{}};!function(e,t){let i=require$$4.ok,a=zlib$4,r=require$$0,n=require$$3.kMaxLength;function s(e){if(!(this instanceof s))return new s(e);e&&e.chunkSize<a.Z_MIN_CHUNK&&(e.chunkSize=a.Z_MIN_CHUNK),a.Inflate.call(this,e),this._offset=void 0===this._offset?this._outOffset:this._offset,this._buffer=this._buffer||this._outBuffer,e&&null!=e.maxLength&&(this._maxLength=e.maxLength)}function o(e,t){t&&process.nextTick(t),e._handle&&(e._handle.close(),e._handle=null)}function l(e,t){return function(e,t){if("string"==typeof t&&(t=Buffer.from(t)),!(t instanceof Buffer))throw new TypeError("Not a string or buffer");let i=e._finishFlushFlag;return null==i&&(i=a.Z_FINISH),e._processChunk(t,i)}(new s(t),e)}s.prototype._processChunk=function(e,t,r){if("function"==typeof r)return a.Inflate._processChunk.call(this,e,t,r);let s,l,u=this,h=e&&e.length,c=this._chunkSize-this._offset,d=this._maxLength,f=0,m=[],p=0;function _(e,t){if(u._hadError)return;let a=c-t;if(i(a>=0,"have should not go down"),a>0){let e=u._buffer.slice(u._offset,u._offset+a);if(u._offset+=a,e.length>d&&(e=e.slice(0,d)),m.push(e),p+=e.length,d-=e.length,0===d)return!1}return(0===t||u._offset>=u._chunkSize)&&(c=u._chunkSize,u._offset=0,u._buffer=Buffer.allocUnsafe(u._chunkSize)),0===t&&(f+=h-e,h=e,!0)}this.on("error",(function(e){s=e})),i(this._handle,"zlib binding closed");do{l=this._handle.writeSync(t,e,f,h,this._buffer,this._offset,c),l=l||this._writeState}while(!this._hadError&&_(l[0],l[1]));if(this._hadError)throw s;if(p>=n)throw o(this),new RangeError("Cannot create final Buffer. It would be larger than 0x"+n.toString(16)+" bytes");let g=Buffer.concat(m,p);return o(this),g},r.inherits(s,a.Inflate),e.exports=t=l,t.Inflate=s,t.createInflate=function(e){return new s(e)},t.inflateSync=l}(syncInflate,syncInflate.exports);var syncInflateExports=syncInflate.exports,syncReader={exports:{}};let SyncReader$2=syncReader.exports=function(e){this._buffer=e,this._reads=[]};SyncReader$2.prototype.read=function(e,t){this._reads.push({length:Math.abs(e),allowLess:e<0,func:t})},SyncReader$2.prototype.process=function(){for(;this._reads.length>0&&this._buffer.length;){let e=this._reads[0];if(!this._buffer.length||!(this._buffer.length>=e.length||e.allowLess))break;{this._reads.shift();let t=this._buffer;this._buffer=t.slice(e.length),e.func.call(this,t.slice(0,e.length))}}if(this._reads.length>0)throw new Error("There are some read requests waitng on finished stream");if(this._buffer.length>0)throw new Error("unrecognised content at end of stream")};var syncReaderExports=syncReader.exports,filterParseSync={};let SyncReader$1=syncReaderExports,Filter=filterParseExports;filterParseSync.process=function(e,t){let i=[],a=new SyncReader$1(e);return new Filter(t,{read:a.read.bind(a),write:function(e){i.push(e)},complete:function(){}}).start(),a.process(),Buffer.concat(i)};let hasSyncZlib$1=!0,zlib$1=zlib$4,inflateSync=syncInflateExports;zlib$1.deflateSync||(hasSyncZlib$1=!1);let SyncReader=syncReaderExports,FilterSync=filterParseSync,Parser$3=parserExports,bitmapper=bitmapper$2,formatNormaliser=formatNormaliser$2;var parserSync=function(e,t){if(!hasSyncZlib$1)throw new Error("To use the sync capability of this library in old node versions, please pin pngjs to v2.3.0");let i,a,r;let n=[];let s=new SyncReader(e),o=new Parser$3(t,{read:s.read.bind(s),error:function(e){i=e},metadata:function(e){a=e},gamma:function(e){r=e},palette:function(e){a.palette=e},transColor:function(e){a.transColor=e},inflateData:function(e){n.push(e)},simpleTransparency:function(){a.alpha=!0}});if(o.start(),s.process(),i)throw i;let l,u=Buffer.concat(n);if(n.length=0,a.interlace)l=zlib$1.inflateSync(u);else{let e=(1+(a.width*a.bpp*a.depth+7>>3))*a.height;l=inflateSync(u,{chunkSize:e,maxLength:e})}if(u=null,!l||!l.length)throw new Error("bad png - invalid inflate data response");let h=FilterSync.process(l,a);u=null;let c=bitmapper.dataToBitMap(h,a);h=null;let d=formatNormaliser(c,a,t.skipRescale);return a.data=d,a.gamma=r||0,a};let hasSyncZlib=!0,zlib=zlib$4;zlib.deflateSync||(hasSyncZlib=!1);let constants$1=constants$6,Packer$1=packerExports;var packerSync=function(e,t){if(!hasSyncZlib)throw new Error("To use the sync capability of this library in old node versions, please pin pngjs to v2.3.0");let i=new Packer$1(t||{}),a=[];a.push(Buffer.from(constants$1.PNG_SIGNATURE)),a.push(i.packIHDR(e.width,e.height)),e.gamma&&a.push(i.packGAMA(e.gamma));let r=i.filterData(e.data,e.width,e.height),n=zlib.deflateSync(r,i.getDeflateOptions());if(r=null,!n||!n.length)throw new Error("bad png - invalid compressed data response");return a.push(i.packIDAT(n)),a.push(i.packIEND()),Buffer.concat(a)};let parse=parserSync,pack=packerSync;var PNG_1;pngSync.read=function(e,t){return parse(e,t||{})},pngSync.write=function(e,t){return pack(e,t)};let util$1=require$$0,Stream=stream$1,Parser$2=parserAsyncExports,Packer=packerAsyncExports,PNGSync=pngSync,PNG=PNG_1=function(e){Stream.call(this),e=e||{},this.width=0|e.width,this.height=0|e.height,this.data=this.width>0&&this.height>0?Buffer.alloc(4*this.width*this.height):null,e.fill&&this.data&&this.data.fill(0),this.gamma=0,this.readable=this.writable=!0,this._parser=new Parser$2(e),this._parser.on("error",this.emit.bind(this,"error")),this._parser.on("close",this._handleClose.bind(this)),this._parser.on("metadata",this._metadata.bind(this)),this._parser.on("gamma",this._gamma.bind(this)),this._parser.on("parsed",function(e){this.data=e,this.emit("parsed",e)}.bind(this)),this._packer=new Packer(e),this._packer.on("data",this.emit.bind(this,"data")),this._packer.on("end",this.emit.bind(this,"end")),this._parser.on("close",this._handleClose.bind(this)),this._packer.on("error",this.emit.bind(this,"error"))};var PNGFilterType,PNGColorType;function png(){return{mime:"image/png",hasAlpha:!0,encode:(e,{deflateLevel:t=9,deflateStrategy:i=3,filterType:a=PNGFilterType.AUTO,colorType:r,inputHasAlpha:n=!0,...s}={})=>{const o=new PNG_1({width:e.width,height:e.height});return o.data=e.data,PNG_1.sync.write(o,{...s,deflateLevel:t,deflateStrategy:i,filterType:a,colorType:void 0!==r?r:n?PNGColorType.COLOR_ALPHA:PNGColorType.COLOR,inputHasAlpha:n})},decode:(e,t)=>{const i=PNG_1.sync.read(e,t);return{data:i.data,width:i.width,height:i.height}}}}function commonjsRequire(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}util$1.inherits(PNG,Stream),PNG.sync=PNGSync,PNG.prototype.pack=function(){return this.data&&this.data.length?(process.nextTick(function(){this._packer.pack(this.data,this.width,this.height,this.gamma)}.bind(this)),this):(this.emit("error","No data provided"),this)},PNG.prototype.parse=function(e,t){if(t){let e,i;e=function(e){this.removeListener("error",i),this.data=e,t(null,this)}.bind(this),i=function(i){this.removeListener("parsed",e),t(i,null)}.bind(this),this.once("parsed",e),this.once("error",i)}return this.end(e),this},PNG.prototype.write=function(e){return this._parser.write(e),!0},PNG.prototype.end=function(e){this._parser.end(e)},PNG.prototype._metadata=function(e){this.width=e.width,this.height=e.height,this.emit("metadata",e)},PNG.prototype._gamma=function(e){this.gamma=e},PNG.prototype._handleClose=function(){this._parser.writable||this._packer.readable||this.emit("close")},PNG.bitblt=function(e,t,i,a,r,n,s,o){if(a|=0,r|=0,n|=0,s|=0,o|=0,(i|=0)>e.width||a>e.height||i+r>e.width||a+n>e.height)throw new Error("bitblt reading outside image");if(s>t.width||o>t.height||s+r>t.width||o+n>t.height)throw new Error("bitblt writing outside image");for(let l=0;l<n;l++)e.data.copy(t.data,(o+l)*t.width+s<<2,(a+l)*e.width+i<<2,(a+l)*e.width+i+r<<2)},PNG.prototype.bitblt=function(e,t,i,a,r,n,s){return PNG.bitblt(this,e,t,i,a,r,n,s),this},PNG.adjustGamma=function(e){if(e.gamma){for(let t=0;t<e.height;t++)for(let i=0;i<e.width;i++){let a=e.width*t+i<<2;for(let t=0;t<3;t++){let i=e.data[a+t]/255;i=Math.pow(i,1/2.2/e.gamma),e.data[a+t]=Math.round(255*i)}}e.gamma=0}},PNG.prototype.adjustGamma=function(){PNG.adjustGamma(this)},function(e){e[e.AUTO=-1]="AUTO",e[e.NONE=0]="NONE",e[e.SUB=1]="SUB",e[e.UP=2]="UP",e[e.AVERAGE=3]="AVERAGE",e[e.PATH=4]="PATH"}(PNGFilterType||(PNGFilterType={})),function(e){e[e.GRAYSCALE=0]="GRAYSCALE",e[e.COLOR=2]="COLOR",e[e.GRAYSCALE_ALPHA=4]="GRAYSCALE_ALPHA",e[e.COLOR_ALPHA=6]="COLOR_ALPHA"}(PNGColorType||(PNGColorType={}));var UTIF={exports:{}},common={},hasRequiredCommon;function requireCommon(){return hasRequiredCommon||(hasRequiredCommon=1,function(e){var t="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function i(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var a=t.shift();if(a){if("object"!=typeof a)throw new TypeError(a+"must be non-object");for(var r in a)i(a,r)&&(e[r]=a[r])}}return e},e.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var a={arraySet:function(e,t,i,a,r){if(t.subarray&&e.subarray)e.set(t.subarray(i,i+a),r);else for(var n=0;n<a;n++)e[r+n]=t[i+n]},flattenChunks:function(e){var t,i,a,r,n,s;for(a=0,t=0,i=e.length;t<i;t++)a+=e[t].length;for(s=new Uint8Array(a),r=0,t=0,i=e.length;t<i;t++)n=e[t],s.set(n,r),r+=n.length;return s}},r={arraySet:function(e,t,i,a,r){for(var n=0;n<a;n++)e[r+n]=t[i+n]},flattenChunks:function(e){return[].concat.apply([],e)}};e.setTyped=function(t){t?(e.Buf8=Uint8Array,e.Buf16=Uint16Array,e.Buf32=Int32Array,e.assign(e,a)):(e.Buf8=Array,e.Buf16=Array,e.Buf32=Array,e.assign(e,r))},e.setTyped(t)}(common)),common}var deflate$1={},deflate={},trees={},hasRequiredTrees,adler32_1,hasRequiredAdler32,crc32_1,hasRequiredCrc32,messages,hasRequiredMessages,hasRequiredDeflate$1;function requireTrees(){if(hasRequiredTrees)return trees;hasRequiredTrees=1;var e=requireCommon();function t(e){for(var t=e.length;--t>=0;)e[t]=0}var i=256,a=286,r=30,n=15,s=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],o=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],l=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],u=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],h=new Array(576);t(h);var c=new Array(60);t(c);var d=new Array(512);t(d);var f=new Array(256);t(f);var m=new Array(29);t(m);var p,_,g,b=new Array(r);function y(e,t,i,a,r){this.static_tree=e,this.extra_bits=t,this.extra_base=i,this.elems=a,this.max_length=r,this.has_stree=e&&e.length}function x(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function w(e){return e<256?d[e]:d[256+(e>>>7)]}function v(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function k(e,t,i){e.bi_valid>16-i?(e.bi_buf|=t<<e.bi_valid&65535,v(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=i-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=i)}function M(e,t,i){k(e,i[2*t],i[2*t+1])}function I(e,t){var i=0;do{i|=1&e,e>>>=1,i<<=1}while(--t>0);return i>>>1}function E(e,t,i){var a,r,s=new Array(16),o=0;for(a=1;a<=n;a++)s[a]=o=o+i[a-1]<<1;for(r=0;r<=t;r++){var l=e[2*r+1];0!==l&&(e[2*r]=I(s[l]++,l))}}function S(e){var t;for(t=0;t<a;t++)e.dyn_ltree[2*t]=0;for(t=0;t<r;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function P(e){e.bi_valid>8?v(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function T(e,t,i,a){var r=2*t,n=2*i;return e[r]<e[n]||e[r]===e[n]&&a[t]<=a[i]}function C(e,t,i){for(var a=e.heap[i],r=i<<1;r<=e.heap_len&&(r<e.heap_len&&T(t,e.heap[r+1],e.heap[r],e.depth)&&r++,!T(t,a,e.heap[r],e.depth));)e.heap[i]=e.heap[r],i=r,r<<=1;e.heap[i]=a}function A(e,t,a){var r,n,l,u,h=0;if(0!==e.last_lit)do{r=e.pending_buf[e.d_buf+2*h]<<8|e.pending_buf[e.d_buf+2*h+1],n=e.pending_buf[e.l_buf+h],h++,0===r?M(e,n,t):(M(e,(l=f[n])+i+1,t),0!==(u=s[l])&&k(e,n-=m[l],u),M(e,l=w(--r),a),0!==(u=o[l])&&k(e,r-=b[l],u))}while(h<e.last_lit);M(e,256,t)}function $(e,t){var i,a,r,s=t.dyn_tree,o=t.stat_desc.static_tree,l=t.stat_desc.has_stree,u=t.stat_desc.elems,h=-1;for(e.heap_len=0,e.heap_max=573,i=0;i<u;i++)0!==s[2*i]?(e.heap[++e.heap_len]=h=i,e.depth[i]=0):s[2*i+1]=0;for(;e.heap_len<2;)s[2*(r=e.heap[++e.heap_len]=h<2?++h:0)]=1,e.depth[r]=0,e.opt_len--,l&&(e.static_len-=o[2*r+1]);for(t.max_code=h,i=e.heap_len>>1;i>=1;i--)C(e,s,i);r=u;do{i=e.heap[1],e.heap[1]=e.heap[e.heap_len--],C(e,s,1),a=e.heap[1],e.heap[--e.heap_max]=i,e.heap[--e.heap_max]=a,s[2*r]=s[2*i]+s[2*a],e.depth[r]=(e.depth[i]>=e.depth[a]?e.depth[i]:e.depth[a])+1,s[2*i+1]=s[2*a+1]=r,e.heap[1]=r++,C(e,s,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var i,a,r,s,o,l,u=t.dyn_tree,h=t.max_code,c=t.stat_desc.static_tree,d=t.stat_desc.has_stree,f=t.stat_desc.extra_bits,m=t.stat_desc.extra_base,p=t.stat_desc.max_length,_=0;for(s=0;s<=n;s++)e.bl_count[s]=0;for(u[2*e.heap[e.heap_max]+1]=0,i=e.heap_max+1;i<573;i++)(s=u[2*u[2*(a=e.heap[i])+1]+1]+1)>p&&(s=p,_++),u[2*a+1]=s,a>h||(e.bl_count[s]++,o=0,a>=m&&(o=f[a-m]),l=u[2*a],e.opt_len+=l*(s+o),d&&(e.static_len+=l*(c[2*a+1]+o)));if(0!==_){do{for(s=p-1;0===e.bl_count[s];)s--;e.bl_count[s]--,e.bl_count[s+1]+=2,e.bl_count[p]--,_-=2}while(_>0);for(s=p;0!==s;s--)for(a=e.bl_count[s];0!==a;)(r=e.heap[--i])>h||(u[2*r+1]!==s&&(e.opt_len+=(s-u[2*r+1])*u[2*r],u[2*r+1]=s),a--)}}(e,t),E(s,h,e.bl_count)}function z(e,t,i){var a,r,n=-1,s=t[1],o=0,l=7,u=4;for(0===s&&(l=138,u=3),t[2*(i+1)+1]=65535,a=0;a<=i;a++)r=s,s=t[2*(a+1)+1],++o<l&&r===s||(o<u?e.bl_tree[2*r]+=o:0!==r?(r!==n&&e.bl_tree[2*r]++,e.bl_tree[32]++):o<=10?e.bl_tree[34]++:e.bl_tree[36]++,o=0,n=r,0===s?(l=138,u=3):r===s?(l=6,u=3):(l=7,u=4))}function B(e,t,i){var a,r,n=-1,s=t[1],o=0,l=7,u=4;for(0===s&&(l=138,u=3),a=0;a<=i;a++)if(r=s,s=t[2*(a+1)+1],!(++o<l&&r===s)){if(o<u)do{M(e,r,e.bl_tree)}while(0!=--o);else 0!==r?(r!==n&&(M(e,r,e.bl_tree),o--),M(e,16,e.bl_tree),k(e,o-3,2)):o<=10?(M(e,17,e.bl_tree),k(e,o-3,3)):(M(e,18,e.bl_tree),k(e,o-11,7));o=0,n=r,0===s?(l=138,u=3):r===s?(l=6,u=3):(l=7,u=4)}}t(b);var F=!1;function R(t,i,a,r){k(t,0+(r?1:0),3),function(t,i,a,r){P(t),r&&(v(t,a),v(t,~a)),e.arraySet(t.pending_buf,t.window,i,a,t.pending),t.pending+=a}(t,i,a,!0)}return trees._tr_init=function(e){F||(!function(){var e,t,i,u,x,w=new Array(16);for(i=0,u=0;u<28;u++)for(m[u]=i,e=0;e<1<<s[u];e++)f[i++]=u;for(f[i-1]=u,x=0,u=0;u<16;u++)for(b[u]=x,e=0;e<1<<o[u];e++)d[x++]=u;for(x>>=7;u<r;u++)for(b[u]=x<<7,e=0;e<1<<o[u]-7;e++)d[256+x++]=u;for(t=0;t<=n;t++)w[t]=0;for(e=0;e<=143;)h[2*e+1]=8,e++,w[8]++;for(;e<=255;)h[2*e+1]=9,e++,w[9]++;for(;e<=279;)h[2*e+1]=7,e++,w[7]++;for(;e<=287;)h[2*e+1]=8,e++,w[8]++;for(E(h,287,w),e=0;e<r;e++)c[2*e+1]=5,c[2*e]=I(e,5);p=new y(h,s,257,a,n),_=new y(c,o,0,r,n),g=new y(new Array(0),l,0,19,7)}(),F=!0),e.l_desc=new x(e.dyn_ltree,p),e.d_desc=new x(e.dyn_dtree,_),e.bl_desc=new x(e.bl_tree,g),e.bi_buf=0,e.bi_valid=0,S(e)},trees._tr_stored_block=R,trees._tr_flush_block=function(e,t,a,r){var n,s,o=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,a=4093624447;for(t=0;t<=31;t++,a>>>=1)if(1&a&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<i;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),$(e,e.l_desc),$(e,e.d_desc),o=function(e){var t;for(z(e,e.dyn_ltree,e.l_desc.max_code),z(e,e.dyn_dtree,e.d_desc.max_code),$(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*u[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),n=e.opt_len+3+7>>>3,(s=e.static_len+3+7>>>3)<=n&&(n=s)):n=s=a+5,a+4<=n&&-1!==t?R(e,t,a,r):4===e.strategy||s===n?(k(e,2+(r?1:0),3),A(e,h,c)):(k(e,4+(r?1:0),3),function(e,t,i,a){var r;for(k(e,t-257,5),k(e,i-1,5),k(e,a-4,4),r=0;r<a;r++)k(e,e.bl_tree[2*u[r]+1],3);B(e,e.dyn_ltree,t-1),B(e,e.dyn_dtree,i-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),A(e,e.dyn_ltree,e.dyn_dtree)),S(e),r&&P(e)},trees._tr_tally=function(e,t,a){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&a,e.last_lit++,0===t?e.dyn_ltree[2*a]++:(e.matches++,t--,e.dyn_ltree[2*(f[a]+i+1)]++,e.dyn_dtree[2*w(t)]++),e.last_lit===e.lit_bufsize-1},trees._tr_align=function(e){k(e,2,3),M(e,256,h),function(e){16===e.bi_valid?(v(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)},trees}function requireAdler32(){if(hasRequiredAdler32)return adler32_1;return hasRequiredAdler32=1,adler32_1=function(e,t,i,a){for(var r=65535&e,n=e>>>16&65535,s=0;0!==i;){i-=s=i>2e3?2e3:i;do{n=n+(r=r+t[a++]|0)|0}while(--s);r%=65521,n%=65521}return r|n<<16}}function requireCrc32(){if(hasRequiredCrc32)return crc32_1;hasRequiredCrc32=1;var e=function(){for(var e,t=[],i=0;i<256;i++){e=i;for(var a=0;a<8;a++)e=1&e?3988292384^e>>>1:e>>>1;t[i]=e}return t}();return crc32_1=function(t,i,a,r){var n=e,s=r+a;t^=-1;for(var o=r;o<s;o++)t=t>>>8^n[255&(t^i[o])];return~t},crc32_1}function requireMessages(){return hasRequiredMessages?messages:(hasRequiredMessages=1,messages={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"})}function requireDeflate$1(){if(hasRequiredDeflate$1)return deflate;hasRequiredDeflate$1=1;var e,t=requireCommon(),i=requireTrees(),a=requireAdler32(),r=requireCrc32(),n=requireMessages(),s=-2,o=258,l=262,u=103,h=113,c=666;function d(e,t){return e.msg=n[t],t}function f(e){return(e<<1)-(e>4?9:0)}function m(e){for(var t=e.length;--t>=0;)e[t]=0}function p(e){var i=e.state,a=i.pending;a>e.avail_out&&(a=e.avail_out),0!==a&&(t.arraySet(e.output,i.pending_buf,i.pending_out,a,e.next_out),e.next_out+=a,i.pending_out+=a,e.total_out+=a,e.avail_out-=a,i.pending-=a,0===i.pending&&(i.pending_out=0))}function _(e,t){i._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,p(e.strm)}function g(e,t){e.pending_buf[e.pending++]=t}function b(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function y(e,t){var i,a,r=e.max_chain_length,n=e.strstart,s=e.prev_length,u=e.nice_match,h=e.strstart>e.w_size-l?e.strstart-(e.w_size-l):0,c=e.window,d=e.w_mask,f=e.prev,m=e.strstart+o,p=c[n+s-1],_=c[n+s];e.prev_length>=e.good_match&&(r>>=2),u>e.lookahead&&(u=e.lookahead);do{if(c[(i=t)+s]===_&&c[i+s-1]===p&&c[i]===c[n]&&c[++i]===c[n+1]){n+=2,i++;do{}while(c[++n]===c[++i]&&c[++n]===c[++i]&&c[++n]===c[++i]&&c[++n]===c[++i]&&c[++n]===c[++i]&&c[++n]===c[++i]&&c[++n]===c[++i]&&c[++n]===c[++i]&&n<m);if(a=o-(m-n),n=m-o,a>s){if(e.match_start=t,s=a,a>=u)break;p=c[n+s-1],_=c[n+s]}}}while((t=f[t&d])>h&&0!=--r);return s<=e.lookahead?s:e.lookahead}function x(e){var i,n,s,o,u,h,c,d,f,m,p=e.w_size;do{if(o=e.window_size-e.lookahead-e.strstart,e.strstart>=p+(p-l)){t.arraySet(e.window,e.window,p,p,0),e.match_start-=p,e.strstart-=p,e.block_start-=p,i=n=e.hash_size;do{s=e.head[--i],e.head[i]=s>=p?s-p:0}while(--n);i=n=p;do{s=e.prev[--i],e.prev[i]=s>=p?s-p:0}while(--n);o+=p}if(0===e.strm.avail_in)break;if(h=e.strm,c=e.window,d=e.strstart+e.lookahead,f=o,m=void 0,(m=h.avail_in)>f&&(m=f),n=0===m?0:(h.avail_in-=m,t.arraySet(c,h.input,h.next_in,m,d),1===h.state.wrap?h.adler=a(h.adler,c,m,d):2===h.state.wrap&&(h.adler=r(h.adler,c,m,d)),h.next_in+=m,h.total_in+=m,m),e.lookahead+=n,e.lookahead+e.insert>=3)for(u=e.strstart-e.insert,e.ins_h=e.window[u],e.ins_h=(e.ins_h<<e.hash_shift^e.window[u+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[u+3-1])&e.hash_mask,e.prev[u&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=u,u++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<l&&0!==e.strm.avail_in)}function w(e,t){for(var a,r;;){if(e.lookahead<l){if(x(e),e.lookahead<l&&0===t)return 1;if(0===e.lookahead)break}if(a=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,a=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==a&&e.strstart-a<=e.w_size-l&&(e.match_length=y(e,a)),e.match_length>=3)if(r=i._tr_tally(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,a=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else r=i._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(_(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,4===t?(_(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(_(e,!1),0===e.strm.avail_out)?1:2}function v(e,t){for(var a,r,n;;){if(e.lookahead<l){if(x(e),e.lookahead<l&&0===t)return 1;if(0===e.lookahead)break}if(a=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,a=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==a&&e.prev_length<e.max_lazy_match&&e.strstart-a<=e.w_size-l&&(e.match_length=y(e,a),e.match_length<=5&&(1===e.strategy||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){n=e.strstart+e.lookahead-3,r=i._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=n&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,a=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,r&&(_(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((r=i._tr_tally(e,0,e.window[e.strstart-1]))&&_(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=i._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,4===t?(_(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(_(e,!1),0===e.strm.avail_out)?1:2}function k(e,t,i,a,r){this.good_length=e,this.max_lazy=t,this.nice_length=i,this.max_chain=a,this.func=r}function M(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new t.Buf16(1146),this.dyn_dtree=new t.Buf16(122),this.bl_tree=new t.Buf16(78),m(this.dyn_ltree),m(this.dyn_dtree),m(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new t.Buf16(16),this.heap=new t.Buf16(573),m(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new t.Buf16(573),m(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function I(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=2,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?42:h,e.adler=2===t.wrap?0:1,t.last_flush=0,i._tr_init(t),0):d(e,s)}function E(t){var i,a=I(t);return 0===a&&((i=t.state).window_size=2*i.w_size,m(i.head),i.max_lazy_match=e[i.level].max_lazy,i.good_match=e[i.level].good_length,i.nice_match=e[i.level].nice_length,i.max_chain_length=e[i.level].max_chain,i.strstart=0,i.block_start=0,i.lookahead=0,i.insert=0,i.match_length=i.prev_length=2,i.match_available=0,i.ins_h=0),a}function S(e,i,a,r,n,o){if(!e)return s;var l=1;if(-1===i&&(i=6),r<0?(l=0,r=-r):r>15&&(l=2,r-=16),n<1||n>9||8!==a||r<8||r>15||i<0||i>9||o<0||o>4)return d(e,s);8===r&&(r=9);var u=new M;return e.state=u,u.strm=e,u.wrap=l,u.gzhead=null,u.w_bits=r,u.w_size=1<<u.w_bits,u.w_mask=u.w_size-1,u.hash_bits=n+7,u.hash_size=1<<u.hash_bits,u.hash_mask=u.hash_size-1,u.hash_shift=~~((u.hash_bits+3-1)/3),u.window=new t.Buf8(2*u.w_size),u.head=new t.Buf16(u.hash_size),u.prev=new t.Buf16(u.w_size),u.lit_bufsize=1<<n+6,u.pending_buf_size=4*u.lit_bufsize,u.pending_buf=new t.Buf8(u.pending_buf_size),u.d_buf=1*u.lit_bufsize,u.l_buf=3*u.lit_bufsize,u.level=i,u.strategy=o,u.method=a,E(e)}return e=[new k(0,0,0,0,(function(e,t){var i=65535;for(i>e.pending_buf_size-5&&(i=e.pending_buf_size-5);;){if(e.lookahead<=1){if(x(e),0===e.lookahead&&0===t)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var a=e.block_start+i;if((0===e.strstart||e.strstart>=a)&&(e.lookahead=e.strstart-a,e.strstart=a,_(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-l&&(_(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(_(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(_(e,!1),e.strm.avail_out),1)})),new k(4,4,8,4,w),new k(4,5,16,8,w),new k(4,6,32,32,w),new k(4,4,16,16,v),new k(8,16,32,32,v),new k(8,16,128,128,v),new k(8,32,128,256,v),new k(32,128,258,1024,v),new k(32,258,258,4096,v)],deflate.deflateInit=function(e,t){return S(e,t,8,15,8,0)},deflate.deflateInit2=S,deflate.deflateReset=E,deflate.deflateResetKeep=I,deflate.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?s:(e.state.gzhead=t,0):s},deflate.deflate=function(t,a){var n,l,y,w;if(!t||!t.state||a>5||a<0)return t?d(t,s):s;if(l=t.state,!t.output||!t.input&&0!==t.avail_in||l.status===c&&4!==a)return d(t,0===t.avail_out?-5:s);if(l.strm=t,n=l.last_flush,l.last_flush=a,42===l.status)if(2===l.wrap)t.adler=0,g(l,31),g(l,139),g(l,8),l.gzhead?(g(l,(l.gzhead.text?1:0)+(l.gzhead.hcrc?2:0)+(l.gzhead.extra?4:0)+(l.gzhead.name?8:0)+(l.gzhead.comment?16:0)),g(l,255&l.gzhead.time),g(l,l.gzhead.time>>8&255),g(l,l.gzhead.time>>16&255),g(l,l.gzhead.time>>24&255),g(l,9===l.level?2:l.strategy>=2||l.level<2?4:0),g(l,255&l.gzhead.os),l.gzhead.extra&&l.gzhead.extra.length&&(g(l,255&l.gzhead.extra.length),g(l,l.gzhead.extra.length>>8&255)),l.gzhead.hcrc&&(t.adler=r(t.adler,l.pending_buf,l.pending,0)),l.gzindex=0,l.status=69):(g(l,0),g(l,0),g(l,0),g(l,0),g(l,0),g(l,9===l.level?2:l.strategy>=2||l.level<2?4:0),g(l,3),l.status=h);else{var v=8+(l.w_bits-8<<4)<<8;v|=(l.strategy>=2||l.level<2?0:l.level<6?1:6===l.level?2:3)<<6,0!==l.strstart&&(v|=32),v+=31-v%31,l.status=h,b(l,v),0!==l.strstart&&(b(l,t.adler>>>16),b(l,65535&t.adler)),t.adler=1}if(69===l.status)if(l.gzhead.extra){for(y=l.pending;l.gzindex<(65535&l.gzhead.extra.length)&&(l.pending!==l.pending_buf_size||(l.gzhead.hcrc&&l.pending>y&&(t.adler=r(t.adler,l.pending_buf,l.pending-y,y)),p(t),y=l.pending,l.pending!==l.pending_buf_size));)g(l,255&l.gzhead.extra[l.gzindex]),l.gzindex++;l.gzhead.hcrc&&l.pending>y&&(t.adler=r(t.adler,l.pending_buf,l.pending-y,y)),l.gzindex===l.gzhead.extra.length&&(l.gzindex=0,l.status=73)}else l.status=73;if(73===l.status)if(l.gzhead.name){y=l.pending;do{if(l.pending===l.pending_buf_size&&(l.gzhead.hcrc&&l.pending>y&&(t.adler=r(t.adler,l.pending_buf,l.pending-y,y)),p(t),y=l.pending,l.pending===l.pending_buf_size)){w=1;break}w=l.gzindex<l.gzhead.name.length?255&l.gzhead.name.charCodeAt(l.gzindex++):0,g(l,w)}while(0!==w);l.gzhead.hcrc&&l.pending>y&&(t.adler=r(t.adler,l.pending_buf,l.pending-y,y)),0===w&&(l.gzindex=0,l.status=91)}else l.status=91;if(91===l.status)if(l.gzhead.comment){y=l.pending;do{if(l.pending===l.pending_buf_size&&(l.gzhead.hcrc&&l.pending>y&&(t.adler=r(t.adler,l.pending_buf,l.pending-y,y)),p(t),y=l.pending,l.pending===l.pending_buf_size)){w=1;break}w=l.gzindex<l.gzhead.comment.length?255&l.gzhead.comment.charCodeAt(l.gzindex++):0,g(l,w)}while(0!==w);l.gzhead.hcrc&&l.pending>y&&(t.adler=r(t.adler,l.pending_buf,l.pending-y,y)),0===w&&(l.status=u)}else l.status=u;if(l.status===u&&(l.gzhead.hcrc?(l.pending+2>l.pending_buf_size&&p(t),l.pending+2<=l.pending_buf_size&&(g(l,255&t.adler),g(l,t.adler>>8&255),t.adler=0,l.status=h)):l.status=h),0!==l.pending){if(p(t),0===t.avail_out)return l.last_flush=-1,0}else if(0===t.avail_in&&f(a)<=f(n)&&4!==a)return d(t,-5);if(l.status===c&&0!==t.avail_in)return d(t,-5);if(0!==t.avail_in||0!==l.lookahead||0!==a&&l.status!==c){var k=2===l.strategy?function(e,t){for(var a;;){if(0===e.lookahead&&(x(e),0===e.lookahead)){if(0===t)return 1;break}if(e.match_length=0,a=i._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,a&&(_(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(_(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(_(e,!1),0===e.strm.avail_out)?1:2}(l,a):3===l.strategy?function(e,t){for(var a,r,n,s,l=e.window;;){if(e.lookahead<=o){if(x(e),e.lookahead<=o&&0===t)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(r=l[n=e.strstart-1])===l[++n]&&r===l[++n]&&r===l[++n]){s=e.strstart+o;do{}while(r===l[++n]&&r===l[++n]&&r===l[++n]&&r===l[++n]&&r===l[++n]&&r===l[++n]&&r===l[++n]&&r===l[++n]&&n<s);e.match_length=o-(s-n),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(a=i._tr_tally(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(a=i._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),a&&(_(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(_(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(_(e,!1),0===e.strm.avail_out)?1:2}(l,a):e[l.level].func(l,a);if(3!==k&&4!==k||(l.status=c),1===k||3===k)return 0===t.avail_out&&(l.last_flush=-1),0;if(2===k&&(1===a?i._tr_align(l):5!==a&&(i._tr_stored_block(l,0,0,!1),3===a&&(m(l.head),0===l.lookahead&&(l.strstart=0,l.block_start=0,l.insert=0))),p(t),0===t.avail_out))return l.last_flush=-1,0}return 4!==a?0:l.wrap<=0?1:(2===l.wrap?(g(l,255&t.adler),g(l,t.adler>>8&255),g(l,t.adler>>16&255),g(l,t.adler>>24&255),g(l,255&t.total_in),g(l,t.total_in>>8&255),g(l,t.total_in>>16&255),g(l,t.total_in>>24&255)):(b(l,t.adler>>>16),b(l,65535&t.adler)),p(t),l.wrap>0&&(l.wrap=-l.wrap),0!==l.pending?0:1)},deflate.deflateEnd=function(e){var t;return e&&e.state?42!==(t=e.state.status)&&69!==t&&73!==t&&91!==t&&t!==u&&t!==h&&t!==c?d(e,s):(e.state=null,t===h?d(e,-3):0):s},deflate.deflateSetDictionary=function(e,i){var r,n,o,l,u,h,c,d,f=i.length;if(!e||!e.state)return s;if(2===(l=(r=e.state).wrap)||1===l&&42!==r.status||r.lookahead)return s;for(1===l&&(e.adler=a(e.adler,i,f,0)),r.wrap=0,f>=r.w_size&&(0===l&&(m(r.head),r.strstart=0,r.block_start=0,r.insert=0),d=new t.Buf8(r.w_size),t.arraySet(d,i,f-r.w_size,r.w_size,0),i=d,f=r.w_size),u=e.avail_in,h=e.next_in,c=e.input,e.avail_in=f,e.next_in=0,e.input=i,x(r);r.lookahead>=3;){n=r.strstart,o=r.lookahead-2;do{r.ins_h=(r.ins_h<<r.hash_shift^r.window[n+3-1])&r.hash_mask,r.prev[n&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=n,n++}while(--o);r.strstart=n,r.lookahead=2,x(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,e.next_in=h,e.input=c,e.avail_in=u,r.wrap=l,0},deflate.deflateInfo="pako deflate (from Nodeca project)",deflate}var strings={},hasRequiredStrings,zstream,hasRequiredZstream,hasRequiredDeflate;function requireStrings(){if(hasRequiredStrings)return strings;hasRequiredStrings=1;var e=requireCommon(),t=!0,i=!0;try{String.fromCharCode.apply(null,[0])}catch(e){t=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){i=!1}for(var a=new e.Buf8(256),r=0;r<256;r++)a[r]=r>=252?6:r>=248?5:r>=240?4:r>=224?3:r>=192?2:1;function n(a,r){if(r<65534&&(a.subarray&&i||!a.subarray&&t))return String.fromCharCode.apply(null,e.shrinkBuf(a,r));for(var n="",s=0;s<r;s++)n+=String.fromCharCode(a[s]);return n}return a[254]=a[254]=1,strings.string2buf=function(t){var i,a,r,n,s,o=t.length,l=0;for(n=0;n<o;n++)55296==(64512&(a=t.charCodeAt(n)))&&n+1<o&&56320==(64512&(r=t.charCodeAt(n+1)))&&(a=65536+(a-55296<<10)+(r-56320),n++),l+=a<128?1:a<2048?2:a<65536?3:4;for(i=new e.Buf8(l),s=0,n=0;s<l;n++)55296==(64512&(a=t.charCodeAt(n)))&&n+1<o&&56320==(64512&(r=t.charCodeAt(n+1)))&&(a=65536+(a-55296<<10)+(r-56320),n++),a<128?i[s++]=a:a<2048?(i[s++]=192|a>>>6,i[s++]=128|63&a):a<65536?(i[s++]=224|a>>>12,i[s++]=128|a>>>6&63,i[s++]=128|63&a):(i[s++]=240|a>>>18,i[s++]=128|a>>>12&63,i[s++]=128|a>>>6&63,i[s++]=128|63&a);return i},strings.buf2binstring=function(e){return n(e,e.length)},strings.binstring2buf=function(t){for(var i=new e.Buf8(t.length),a=0,r=i.length;a<r;a++)i[a]=t.charCodeAt(a);return i},strings.buf2string=function(e,t){var i,r,s,o,l=t||e.length,u=new Array(2*l);for(r=0,i=0;i<l;)if((s=e[i++])<128)u[r++]=s;else if((o=a[s])>4)u[r++]=65533,i+=o-1;else{for(s&=2===o?31:3===o?15:7;o>1&&i<l;)s=s<<6|63&e[i++],o--;o>1?u[r++]=65533:s<65536?u[r++]=s:(s-=65536,u[r++]=55296|s>>10&1023,u[r++]=56320|1023&s)}return n(u,r)},strings.utf8border=function(e,t){var i;for((t=t||e.length)>e.length&&(t=e.length),i=t-1;i>=0&&128==(192&e[i]);)i--;return i<0||0===i?t:i+a[e[i]]>t?i:t},strings}function requireZstream(){if(hasRequiredZstream)return zstream;return hasRequiredZstream=1,zstream=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}}function requireDeflate(){if(hasRequiredDeflate)return deflate$1;hasRequiredDeflate=1;var e=requireDeflate$1(),t=requireCommon(),i=requireStrings(),a=requireMessages(),r=requireZstream(),n=Object.prototype.toString;function s(o){if(!(this instanceof s))return new s(o);this.options=t.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},o||{});var l=this.options;l.raw&&l.windowBits>0?l.windowBits=-l.windowBits:l.gzip&&l.windowBits>0&&l.windowBits<16&&(l.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new r,this.strm.avail_out=0;var u=e.deflateInit2(this.strm,l.level,l.method,l.windowBits,l.memLevel,l.strategy);if(0!==u)throw new Error(a[u]);if(l.header&&e.deflateSetHeader(this.strm,l.header),l.dictionary){var h;if(h="string"==typeof l.dictionary?i.string2buf(l.dictionary):"[object ArrayBuffer]"===n.call(l.dictionary)?new Uint8Array(l.dictionary):l.dictionary,0!==(u=e.deflateSetDictionary(this.strm,h)))throw new Error(a[u]);this._dict_set=!0}}function o(e,t){var i=new s(t);if(i.push(e,!0),i.err)throw i.msg||a[i.err];return i.result}return s.prototype.push=function(a,r){var s,o,l=this.strm,u=this.options.chunkSize;if(this.ended)return!1;o=r===~~r?r:!0===r?4:0,"string"==typeof a?l.input=i.string2buf(a):"[object ArrayBuffer]"===n.call(a)?l.input=new Uint8Array(a):l.input=a,l.next_in=0,l.avail_in=l.input.length;do{if(0===l.avail_out&&(l.output=new t.Buf8(u),l.next_out=0,l.avail_out=u),1!==(s=e.deflate(l,o))&&0!==s)return this.onEnd(s),this.ended=!0,!1;0!==l.avail_out&&(0!==l.avail_in||4!==o&&2!==o)||("string"===this.options.to?this.onData(i.buf2binstring(t.shrinkBuf(l.output,l.next_out))):this.onData(t.shrinkBuf(l.output,l.next_out)))}while((l.avail_in>0||0===l.avail_out)&&1!==s);return 4===o?(s=e.deflateEnd(this.strm),this.onEnd(s),this.ended=!0,0===s):2!==o||(this.onEnd(0),l.avail_out=0,!0)},s.prototype.onData=function(e){this.chunks.push(e)},s.prototype.onEnd=function(e){0===e&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=t.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},deflate$1.Deflate=s,deflate$1.deflate=o,deflate$1.deflateRaw=function(e,t){return(t=t||{}).raw=!0,o(e,t)},deflate$1.gzip=function(e,t){return(t=t||{}).gzip=!0,o(e,t)},deflate$1}var inflate$1={},inflate={},inffast,hasRequiredInffast,inftrees,hasRequiredInftrees,hasRequiredInflate$1,constants,hasRequiredConstants,gzheader,hasRequiredGzheader,hasRequiredInflate,pako_1,hasRequiredPako;function requireInffast(){if(hasRequiredInffast)return inffast;hasRequiredInffast=1;return inffast=function(e,t){var i,a,r,n,s,o,l,u,h,c,d,f,m,p,_,g,b,y,x,w,v,k,M,I,E;i=e.state,a=e.next_in,I=e.input,r=a+(e.avail_in-5),n=e.next_out,E=e.output,s=n-(t-e.avail_out),o=n+(e.avail_out-257),l=i.dmax,u=i.wsize,h=i.whave,c=i.wnext,d=i.window,f=i.hold,m=i.bits,p=i.lencode,_=i.distcode,g=(1<<i.lenbits)-1,b=(1<<i.distbits)-1;e:do{m<15&&(f+=I[a++]<<m,m+=8,f+=I[a++]<<m,m+=8),y=p[f&g];t:for(;;){if(f>>>=x=y>>>24,m-=x,0===(x=y>>>16&255))E[n++]=65535&y;else{if(!(16&x)){if(64&x){if(32&x){i.mode=12;break e}e.msg="invalid literal/length code",i.mode=30;break e}y=p[(65535&y)+(f&(1<<x)-1)];continue t}for(w=65535&y,(x&=15)&&(m<x&&(f+=I[a++]<<m,m+=8),w+=f&(1<<x)-1,f>>>=x,m-=x),m<15&&(f+=I[a++]<<m,m+=8,f+=I[a++]<<m,m+=8),y=_[f&b];;){if(f>>>=x=y>>>24,m-=x,16&(x=y>>>16&255)){if(v=65535&y,m<(x&=15)&&(f+=I[a++]<<m,(m+=8)<x&&(f+=I[a++]<<m,m+=8)),(v+=f&(1<<x)-1)>l){e.msg="invalid distance too far back",i.mode=30;break e}if(f>>>=x,m-=x,v>(x=n-s)){if((x=v-x)>h&&i.sane){e.msg="invalid distance too far back",i.mode=30;break e}if(k=0,M=d,0===c){if(k+=u-x,x<w){w-=x;do{E[n++]=d[k++]}while(--x);k=n-v,M=E}}else if(c<x){if(k+=u+c-x,(x-=c)<w){w-=x;do{E[n++]=d[k++]}while(--x);if(k=0,c<w){w-=x=c;do{E[n++]=d[k++]}while(--x);k=n-v,M=E}}}else if(k+=c-x,x<w){w-=x;do{E[n++]=d[k++]}while(--x);k=n-v,M=E}for(;w>2;)E[n++]=M[k++],E[n++]=M[k++],E[n++]=M[k++],w-=3;w&&(E[n++]=M[k++],w>1&&(E[n++]=M[k++]))}else{k=n-v;do{E[n++]=E[k++],E[n++]=E[k++],E[n++]=E[k++],w-=3}while(w>2);w&&(E[n++]=E[k++],w>1&&(E[n++]=E[k++]))}break}if(64&x){e.msg="invalid distance code",i.mode=30;break e}y=_[(65535&y)+(f&(1<<x)-1)]}}break}}while(a<r&&n<o);a-=w=m>>3,f&=(1<<(m-=w<<3))-1,e.next_in=a,e.next_out=n,e.avail_in=a<r?r-a+5:5-(a-r),e.avail_out=n<o?o-n+257:257-(n-o),i.hold=f,i.bits=m}}function requireInftrees(){if(hasRequiredInftrees)return inftrees;hasRequiredInftrees=1;var e=requireCommon(),t=15,i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],r=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],n=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];return inftrees=function(s,o,l,u,h,c,d,f){var m,p,_,g,b,y,x,w,v,k=f.bits,M=0,I=0,E=0,S=0,P=0,T=0,C=0,A=0,$=0,z=0,B=null,F=0,R=new e.Buf16(16),D=new e.Buf16(16),N=null,Z=0;for(M=0;M<=t;M++)R[M]=0;for(I=0;I<u;I++)R[o[l+I]]++;for(P=k,S=t;S>=1&&0===R[S];S--);if(P>S&&(P=S),0===S)return h[c++]=20971520,h[c++]=20971520,f.bits=1,0;for(E=1;E<S&&0===R[E];E++);for(P<E&&(P=E),A=1,M=1;M<=t;M++)if(A<<=1,(A-=R[M])<0)return-1;if(A>0&&(0===s||1!==S))return-1;for(D[1]=0,M=1;M<t;M++)D[M+1]=D[M]+R[M];for(I=0;I<u;I++)0!==o[l+I]&&(d[D[o[l+I]]++]=I);if(0===s?(B=N=d,y=19):1===s?(B=i,F-=257,N=a,Z-=257,y=256):(B=r,N=n,y=-1),z=0,I=0,M=E,b=c,T=P,C=0,_=-1,g=($=1<<P)-1,1===s&&$>852||2===s&&$>592)return 1;for(;;){x=M-C,d[I]<y?(w=0,v=d[I]):d[I]>y?(w=N[Z+d[I]],v=B[F+d[I]]):(w=96,v=0),m=1<<M-C,E=p=1<<T;do{h[b+(z>>C)+(p-=m)]=x<<24|w<<16|v}while(0!==p);for(m=1<<M-1;z&m;)m>>=1;if(0!==m?(z&=m-1,z+=m):z=0,I++,0==--R[M]){if(M===S)break;M=o[l+d[I]]}if(M>P&&(z&g)!==_){for(0===C&&(C=P),b+=E,A=1<<(T=M-C);T+C<S&&!((A-=R[T+C])<=0);)T++,A<<=1;if($+=1<<T,1===s&&$>852||2===s&&$>592)return 1;h[_=z&g]=P<<24|T<<16|b-c}}return 0!==z&&(h[b+z]=M-C<<24|64<<16),f.bits=P,0}}function requireInflate$1(){if(hasRequiredInflate$1)return inflate;hasRequiredInflate$1=1;var e=requireCommon(),t=requireAdler32(),i=requireCrc32(),a=requireInffast(),r=requireInftrees(),n=-2,s=12,o=30;function l(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function u(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new e.Buf16(320),this.work=new e.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function h(t){var i;return t&&t.state?(i=t.state,t.total_in=t.total_out=i.total=0,t.msg="",i.wrap&&(t.adler=1&i.wrap),i.mode=1,i.last=0,i.havedict=0,i.dmax=32768,i.head=null,i.hold=0,i.bits=0,i.lencode=i.lendyn=new e.Buf32(852),i.distcode=i.distdyn=new e.Buf32(592),i.sane=1,i.back=-1,0):n}function c(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,h(e)):n}function d(e,t){var i,a;return e&&e.state?(a=e.state,t<0?(i=0,t=-t):(i=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?n:(null!==a.window&&a.wbits!==t&&(a.window=null),a.wrap=i,a.wbits=t,c(e))):n}function f(e,t){var i,a;return e?(a=new u,e.state=a,a.window=null,0!==(i=d(e,t))&&(e.state=null),i):n}var m,p,_=!0;function g(t){if(_){var i;for(m=new e.Buf32(512),p=new e.Buf32(32),i=0;i<144;)t.lens[i++]=8;for(;i<256;)t.lens[i++]=9;for(;i<280;)t.lens[i++]=7;for(;i<288;)t.lens[i++]=8;for(r(1,t.lens,0,288,m,0,t.work,{bits:9}),i=0;i<32;)t.lens[i++]=5;r(2,t.lens,0,32,p,0,t.work,{bits:5}),_=!1}t.lencode=m,t.lenbits=9,t.distcode=p,t.distbits=5}function b(t,i,a,r){var n,s=t.state;return null===s.window&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new e.Buf8(s.wsize)),r>=s.wsize?(e.arraySet(s.window,i,a-s.wsize,s.wsize,0),s.wnext=0,s.whave=s.wsize):((n=s.wsize-s.wnext)>r&&(n=r),e.arraySet(s.window,i,a-r,n,s.wnext),(r-=n)?(e.arraySet(s.window,i,a-r,r,0),s.wnext=r,s.whave=s.wsize):(s.wnext+=n,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=n))),0}return inflate.inflateReset=c,inflate.inflateReset2=d,inflate.inflateResetKeep=h,inflate.inflateInit=function(e){return f(e,15)},inflate.inflateInit2=f,inflate.inflate=function(u,h){var c,d,f,m,p,_,y,x,w,v,k,M,I,E,S,P,T,C,A,$,z,B,F,R,D=0,N=new e.Buf8(4),Z=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!u||!u.state||!u.output||!u.input&&0!==u.avail_in)return n;(c=u.state).mode===s&&(c.mode=13),p=u.next_out,f=u.output,y=u.avail_out,m=u.next_in,d=u.input,_=u.avail_in,x=c.hold,w=c.bits,v=_,k=y,B=0;e:for(;;)switch(c.mode){case 1:if(0===c.wrap){c.mode=13;break}for(;w<16;){if(0===_)break e;_--,x+=d[m++]<<w,w+=8}if(2&c.wrap&&35615===x){c.check=0,N[0]=255&x,N[1]=x>>>8&255,c.check=i(c.check,N,2,0),x=0,w=0,c.mode=2;break}if(c.flags=0,c.head&&(c.head.done=!1),!(1&c.wrap)||(((255&x)<<8)+(x>>8))%31){u.msg="incorrect header check",c.mode=o;break}if(8!=(15&x)){u.msg="unknown compression method",c.mode=o;break}if(w-=4,z=8+(15&(x>>>=4)),0===c.wbits)c.wbits=z;else if(z>c.wbits){u.msg="invalid window size",c.mode=o;break}c.dmax=1<<z,u.adler=c.check=1,c.mode=512&x?10:s,x=0,w=0;break;case 2:for(;w<16;){if(0===_)break e;_--,x+=d[m++]<<w,w+=8}if(c.flags=x,8!=(255&c.flags)){u.msg="unknown compression method",c.mode=o;break}if(57344&c.flags){u.msg="unknown header flags set",c.mode=o;break}c.head&&(c.head.text=x>>8&1),512&c.flags&&(N[0]=255&x,N[1]=x>>>8&255,c.check=i(c.check,N,2,0)),x=0,w=0,c.mode=3;case 3:for(;w<32;){if(0===_)break e;_--,x+=d[m++]<<w,w+=8}c.head&&(c.head.time=x),512&c.flags&&(N[0]=255&x,N[1]=x>>>8&255,N[2]=x>>>16&255,N[3]=x>>>24&255,c.check=i(c.check,N,4,0)),x=0,w=0,c.mode=4;case 4:for(;w<16;){if(0===_)break e;_--,x+=d[m++]<<w,w+=8}c.head&&(c.head.xflags=255&x,c.head.os=x>>8),512&c.flags&&(N[0]=255&x,N[1]=x>>>8&255,c.check=i(c.check,N,2,0)),x=0,w=0,c.mode=5;case 5:if(1024&c.flags){for(;w<16;){if(0===_)break e;_--,x+=d[m++]<<w,w+=8}c.length=x,c.head&&(c.head.extra_len=x),512&c.flags&&(N[0]=255&x,N[1]=x>>>8&255,c.check=i(c.check,N,2,0)),x=0,w=0}else c.head&&(c.head.extra=null);c.mode=6;case 6:if(1024&c.flags&&((M=c.length)>_&&(M=_),M&&(c.head&&(z=c.head.extra_len-c.length,c.head.extra||(c.head.extra=new Array(c.head.extra_len)),e.arraySet(c.head.extra,d,m,M,z)),512&c.flags&&(c.check=i(c.check,d,M,m)),_-=M,m+=M,c.length-=M),c.length))break e;c.length=0,c.mode=7;case 7:if(2048&c.flags){if(0===_)break e;M=0;do{z=d[m+M++],c.head&&z&&c.length<65536&&(c.head.name+=String.fromCharCode(z))}while(z&&M<_);if(512&c.flags&&(c.check=i(c.check,d,M,m)),_-=M,m+=M,z)break e}else c.head&&(c.head.name=null);c.length=0,c.mode=8;case 8:if(4096&c.flags){if(0===_)break e;M=0;do{z=d[m+M++],c.head&&z&&c.length<65536&&(c.head.comment+=String.fromCharCode(z))}while(z&&M<_);if(512&c.flags&&(c.check=i(c.check,d,M,m)),_-=M,m+=M,z)break e}else c.head&&(c.head.comment=null);c.mode=9;case 9:if(512&c.flags){for(;w<16;){if(0===_)break e;_--,x+=d[m++]<<w,w+=8}if(x!==(65535&c.check)){u.msg="header crc mismatch",c.mode=o;break}x=0,w=0}c.head&&(c.head.hcrc=c.flags>>9&1,c.head.done=!0),u.adler=c.check=0,c.mode=s;break;case 10:for(;w<32;){if(0===_)break e;_--,x+=d[m++]<<w,w+=8}u.adler=c.check=l(x),x=0,w=0,c.mode=11;case 11:if(0===c.havedict)return u.next_out=p,u.avail_out=y,u.next_in=m,u.avail_in=_,c.hold=x,c.bits=w,2;u.adler=c.check=1,c.mode=s;case s:if(5===h||6===h)break e;case 13:if(c.last){x>>>=7&w,w-=7&w,c.mode=27;break}for(;w<3;){if(0===_)break e;_--,x+=d[m++]<<w,w+=8}switch(c.last=1&x,w-=1,3&(x>>>=1)){case 0:c.mode=14;break;case 1:if(g(c),c.mode=20,6===h){x>>>=2,w-=2;break e}break;case 2:c.mode=17;break;case 3:u.msg="invalid block type",c.mode=o}x>>>=2,w-=2;break;case 14:for(x>>>=7&w,w-=7&w;w<32;){if(0===_)break e;_--,x+=d[m++]<<w,w+=8}if((65535&x)!=(x>>>16^65535)){u.msg="invalid stored block lengths",c.mode=o;break}if(c.length=65535&x,x=0,w=0,c.mode=15,6===h)break e;case 15:c.mode=16;case 16:if(M=c.length){if(M>_&&(M=_),M>y&&(M=y),0===M)break e;e.arraySet(f,d,m,M,p),_-=M,m+=M,y-=M,p+=M,c.length-=M;break}c.mode=s;break;case 17:for(;w<14;){if(0===_)break e;_--,x+=d[m++]<<w,w+=8}if(c.nlen=257+(31&x),x>>>=5,w-=5,c.ndist=1+(31&x),x>>>=5,w-=5,c.ncode=4+(15&x),x>>>=4,w-=4,c.nlen>286||c.ndist>30){u.msg="too many length or distance symbols",c.mode=o;break}c.have=0,c.mode=18;case 18:for(;c.have<c.ncode;){for(;w<3;){if(0===_)break e;_--,x+=d[m++]<<w,w+=8}c.lens[Z[c.have++]]=7&x,x>>>=3,w-=3}for(;c.have<19;)c.lens[Z[c.have++]]=0;if(c.lencode=c.lendyn,c.lenbits=7,F={bits:c.lenbits},B=r(0,c.lens,0,19,c.lencode,0,c.work,F),c.lenbits=F.bits,B){u.msg="invalid code lengths set",c.mode=o;break}c.have=0,c.mode=19;case 19:for(;c.have<c.nlen+c.ndist;){for(;P=(D=c.lencode[x&(1<<c.lenbits)-1])>>>16&255,T=65535&D,!((S=D>>>24)<=w);){if(0===_)break e;_--,x+=d[m++]<<w,w+=8}if(T<16)x>>>=S,w-=S,c.lens[c.have++]=T;else{if(16===T){for(R=S+2;w<R;){if(0===_)break e;_--,x+=d[m++]<<w,w+=8}if(x>>>=S,w-=S,0===c.have){u.msg="invalid bit length repeat",c.mode=o;break}z=c.lens[c.have-1],M=3+(3&x),x>>>=2,w-=2}else if(17===T){for(R=S+3;w<R;){if(0===_)break e;_--,x+=d[m++]<<w,w+=8}w-=S,z=0,M=3+(7&(x>>>=S)),x>>>=3,w-=3}else{for(R=S+7;w<R;){if(0===_)break e;_--,x+=d[m++]<<w,w+=8}w-=S,z=0,M=11+(127&(x>>>=S)),x>>>=7,w-=7}if(c.have+M>c.nlen+c.ndist){u.msg="invalid bit length repeat",c.mode=o;break}for(;M--;)c.lens[c.have++]=z}}if(c.mode===o)break;if(0===c.lens[256]){u.msg="invalid code -- missing end-of-block",c.mode=o;break}if(c.lenbits=9,F={bits:c.lenbits},B=r(1,c.lens,0,c.nlen,c.lencode,0,c.work,F),c.lenbits=F.bits,B){u.msg="invalid literal/lengths set",c.mode=o;break}if(c.distbits=6,c.distcode=c.distdyn,F={bits:c.distbits},B=r(2,c.lens,c.nlen,c.ndist,c.distcode,0,c.work,F),c.distbits=F.bits,B){u.msg="invalid distances set",c.mode=o;break}if(c.mode=20,6===h)break e;case 20:c.mode=21;case 21:if(_>=6&&y>=258){u.next_out=p,u.avail_out=y,u.next_in=m,u.avail_in=_,c.hold=x,c.bits=w,a(u,k),p=u.next_out,f=u.output,y=u.avail_out,m=u.next_in,d=u.input,_=u.avail_in,x=c.hold,w=c.bits,c.mode===s&&(c.back=-1);break}for(c.back=0;P=(D=c.lencode[x&(1<<c.lenbits)-1])>>>16&255,T=65535&D,!((S=D>>>24)<=w);){if(0===_)break e;_--,x+=d[m++]<<w,w+=8}if(P&&!(240&P)){for(C=S,A=P,$=T;P=(D=c.lencode[$+((x&(1<<C+A)-1)>>C)])>>>16&255,T=65535&D,!(C+(S=D>>>24)<=w);){if(0===_)break e;_--,x+=d[m++]<<w,w+=8}x>>>=C,w-=C,c.back+=C}if(x>>>=S,w-=S,c.back+=S,c.length=T,0===P){c.mode=26;break}if(32&P){c.back=-1,c.mode=s;break}if(64&P){u.msg="invalid literal/length code",c.mode=o;break}c.extra=15&P,c.mode=22;case 22:if(c.extra){for(R=c.extra;w<R;){if(0===_)break e;_--,x+=d[m++]<<w,w+=8}c.length+=x&(1<<c.extra)-1,x>>>=c.extra,w-=c.extra,c.back+=c.extra}c.was=c.length,c.mode=23;case 23:for(;P=(D=c.distcode[x&(1<<c.distbits)-1])>>>16&255,T=65535&D,!((S=D>>>24)<=w);){if(0===_)break e;_--,x+=d[m++]<<w,w+=8}if(!(240&P)){for(C=S,A=P,$=T;P=(D=c.distcode[$+((x&(1<<C+A)-1)>>C)])>>>16&255,T=65535&D,!(C+(S=D>>>24)<=w);){if(0===_)break e;_--,x+=d[m++]<<w,w+=8}x>>>=C,w-=C,c.back+=C}if(x>>>=S,w-=S,c.back+=S,64&P){u.msg="invalid distance code",c.mode=o;break}c.offset=T,c.extra=15&P,c.mode=24;case 24:if(c.extra){for(R=c.extra;w<R;){if(0===_)break e;_--,x+=d[m++]<<w,w+=8}c.offset+=x&(1<<c.extra)-1,x>>>=c.extra,w-=c.extra,c.back+=c.extra}if(c.offset>c.dmax){u.msg="invalid distance too far back",c.mode=o;break}c.mode=25;case 25:if(0===y)break e;if(M=k-y,c.offset>M){if((M=c.offset-M)>c.whave&&c.sane){u.msg="invalid distance too far back",c.mode=o;break}M>c.wnext?(M-=c.wnext,I=c.wsize-M):I=c.wnext-M,M>c.length&&(M=c.length),E=c.window}else E=f,I=p-c.offset,M=c.length;M>y&&(M=y),y-=M,c.length-=M;do{f[p++]=E[I++]}while(--M);0===c.length&&(c.mode=21);break;case 26:if(0===y)break e;f[p++]=c.length,y--,c.mode=21;break;case 27:if(c.wrap){for(;w<32;){if(0===_)break e;_--,x|=d[m++]<<w,w+=8}if(k-=y,u.total_out+=k,c.total+=k,k&&(u.adler=c.check=c.flags?i(c.check,f,k,p-k):t(c.check,f,k,p-k)),k=y,(c.flags?x:l(x))!==c.check){u.msg="incorrect data check",c.mode=o;break}x=0,w=0}c.mode=28;case 28:if(c.wrap&&c.flags){for(;w<32;){if(0===_)break e;_--,x+=d[m++]<<w,w+=8}if(x!==(4294967295&c.total)){u.msg="incorrect length check",c.mode=o;break}x=0,w=0}c.mode=29;case 29:B=1;break e;case o:B=-3;break e;case 31:return-4;default:return n}return u.next_out=p,u.avail_out=y,u.next_in=m,u.avail_in=_,c.hold=x,c.bits=w,(c.wsize||k!==u.avail_out&&c.mode<o&&(c.mode<27||4!==h))&&b(u,u.output,u.next_out,k-u.avail_out),v-=u.avail_in,k-=u.avail_out,u.total_in+=v,u.total_out+=k,c.total+=k,c.wrap&&k&&(u.adler=c.check=c.flags?i(c.check,f,k,u.next_out-k):t(c.check,f,k,u.next_out-k)),u.data_type=c.bits+(c.last?64:0)+(c.mode===s?128:0)+(20===c.mode||15===c.mode?256:0),(0===v&&0===k||4===h)&&0===B&&(B=-5),B},inflate.inflateEnd=function(e){if(!e||!e.state)return n;var t=e.state;return t.window&&(t.window=null),e.state=null,0},inflate.inflateGetHeader=function(e,t){var i;return e&&e.state&&2&(i=e.state).wrap?(i.head=t,t.done=!1,0):n},inflate.inflateSetDictionary=function(e,i){var a,r=i.length;return e&&e.state?0!==(a=e.state).wrap&&11!==a.mode?n:11===a.mode&&t(1,i,r,0)!==a.check?-3:b(e,i,r,r)?(a.mode=31,-4):(a.havedict=1,0):n},inflate.inflateInfo="pako inflate (from Nodeca project)",inflate}function requireConstants(){return hasRequiredConstants?constants:(hasRequiredConstants=1,constants={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8})}function requireGzheader(){if(hasRequiredGzheader)return gzheader;return hasRequiredGzheader=1,gzheader=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}}function requireInflate(){if(hasRequiredInflate)return inflate$1;hasRequiredInflate=1;var e=requireInflate$1(),t=requireCommon(),i=requireStrings(),a=requireConstants(),r=requireMessages(),n=requireZstream(),s=requireGzheader(),o=Object.prototype.toString;function l(u){if(!(this instanceof l))return new l(u);this.options=t.assign({chunkSize:16384,windowBits:0,to:""},u||{});var h=this.options;h.raw&&h.windowBits>=0&&h.windowBits<16&&(h.windowBits=-h.windowBits,0===h.windowBits&&(h.windowBits=-15)),!(h.windowBits>=0&&h.windowBits<16)||u&&u.windowBits||(h.windowBits+=32),h.windowBits>15&&h.windowBits<48&&(15&h.windowBits||(h.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new n,this.strm.avail_out=0;var c=e.inflateInit2(this.strm,h.windowBits);if(c!==a.Z_OK)throw new Error(r[c]);if(this.header=new s,e.inflateGetHeader(this.strm,this.header),h.dictionary&&("string"==typeof h.dictionary?h.dictionary=i.string2buf(h.dictionary):"[object ArrayBuffer]"===o.call(h.dictionary)&&(h.dictionary=new Uint8Array(h.dictionary)),h.raw&&(c=e.inflateSetDictionary(this.strm,h.dictionary))!==a.Z_OK))throw new Error(r[c])}function u(e,t){var i=new l(t);if(i.push(e,!0),i.err)throw i.msg||r[i.err];return i.result}return l.prototype.push=function(r,n){var s,l,u,h,c,d=this.strm,f=this.options.chunkSize,m=this.options.dictionary,p=!1;if(this.ended)return!1;l=n===~~n?n:!0===n?a.Z_FINISH:a.Z_NO_FLUSH,"string"==typeof r?d.input=i.binstring2buf(r):"[object ArrayBuffer]"===o.call(r)?d.input=new Uint8Array(r):d.input=r,d.next_in=0,d.avail_in=d.input.length;do{if(0===d.avail_out&&(d.output=new t.Buf8(f),d.next_out=0,d.avail_out=f),(s=e.inflate(d,a.Z_NO_FLUSH))===a.Z_NEED_DICT&&m&&(s=e.inflateSetDictionary(this.strm,m)),s===a.Z_BUF_ERROR&&!0===p&&(s=a.Z_OK,p=!1),s!==a.Z_STREAM_END&&s!==a.Z_OK)return this.onEnd(s),this.ended=!0,!1;d.next_out&&(0!==d.avail_out&&s!==a.Z_STREAM_END&&(0!==d.avail_in||l!==a.Z_FINISH&&l!==a.Z_SYNC_FLUSH)||("string"===this.options.to?(u=i.utf8border(d.output,d.next_out),h=d.next_out-u,c=i.buf2string(d.output,u),d.next_out=h,d.avail_out=f-h,h&&t.arraySet(d.output,d.output,u,h,0),this.onData(c)):this.onData(t.shrinkBuf(d.output,d.next_out)))),0===d.avail_in&&0===d.avail_out&&(p=!0)}while((d.avail_in>0||0===d.avail_out)&&s!==a.Z_STREAM_END);return s===a.Z_STREAM_END&&(l=a.Z_FINISH),l===a.Z_FINISH?(s=e.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,s===a.Z_OK):l!==a.Z_SYNC_FLUSH||(this.onEnd(a.Z_OK),d.avail_out=0,!0)},l.prototype.onData=function(e){this.chunks.push(e)},l.prototype.onEnd=function(e){e===a.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=t.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},inflate$1.Inflate=l,inflate$1.inflate=u,inflate$1.inflateRaw=function(e,t){return(t=t||{}).raw=!0,u(e,t)},inflate$1.ungzip=u,inflate$1}function requirePako(){if(hasRequiredPako)return pako_1;hasRequiredPako=1;var e={};return(0,requireCommon().assign)(e,requireDeflate(),requireInflate(),requireConstants()),pako_1=e}!function(e){!function(){var t={};function i(){"undefined"==typeof process&&console.log.apply(console,arguments)}e.exports=t,function(e,t){var a,r,n,s,o,l,u,h,c,d,f,m,p,_;!function(){var t=function(){function e(e){this.message="JPEG error: "+e}return e.prototype=new Error,e.prototype.name="JpegError",e.constructor=e,e}(),i=function(){var e=new Uint8Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),i=4017,r=799,n=3406,s=2276,o=1567,l=3784,u=5793,h=2896;function c(e){null==e&&(e={}),null==e.w&&(e.w=-1),this.V=e.n,this.N=e.w}function d(e,t){for(var i,a,r,n=0,s=[],o=16;o>0&&!e[o-1];)o--;s.push({children:[],index:0});var l=s[0];for(i=0;i<o;i++){for(a=0;a<e[i];a++){for((l=s.pop()).children[l.index]=t[n];l.index>0;)l=s.pop();for(l.index++,s.push(l);s.length<=i;)s.push(r={children:[],index:0}),l.children[l.index]=r.children,l=r;n++}i+1<o&&(s.push(r={children:[],index:0}),l.children[l.index]=r.children,l=r)}return s[0].children}function f(e,t,i){return 64*((e.P+1)*t+i)}function m(i,r,n,s,o,l,u,h,c,d){null==d&&(d=!1);var m,p,_,b,y,x,w,v,k,M,I,E=n.m,S=n.Z,P=r,T=0,C=0,A=0,$=0,z=0,B=0;function F(){if(C>0)return C--,T>>C&1;if(255===(T=i[r++])){var e=i[r++];if(e){if(220===e&&d){var s=a(i,r+=2);if(r+=2,s>0&&s!==n.s)throw new DNLMarkerError("Found DNL marker (0xFFDC) while parsing scan data",s)}else if(217===e){if(d){var o=8*z;if(o>0&&o<n.s/10)throw new DNLMarkerError("Found EOI marker (0xFFD9) while parsing scan data, possibly caused by incorrect `scanLines` parameter",o)}throw new EOIMarkerError("Found EOI marker (0xFFD9) while parsing scan data")}throw new t("unexpected marker")}}return C=7,T>>>7}function R(e){for(var i=e;;){switch(typeof(i=i[F()])){case"number":return i;case"object":continue}throw new t("invalid huffman sequence")}}function D(e){for(var t=0;e>0;)t=t<<1|F(),e--;return t}function N(e){if(1===e)return 1===F()?1:-1;var t=D(e);return t>=1<<e-1?t:t+(-1<<e)+1}function Z(e,t,i,a,r){var n=i%E;z=(i/E|0)*e.A+a;var s=n*e.h+r;t(e,f(e,z,s))}function O(e,t,i){z=i/e.P|0;var a=i%e.P;t(e,f(e,z,a))}var L=s.length;for(w=S?0===l?0===h?function(e,t){var i=R(e.J),a=0===i?0:N(i)<<c;e.D[t]=e.Q+=a}:function(e,t){e.D[t]|=F()<<c}:0===h?function(t,i){if(A>0)A--;else for(var a=l,r=u;a<=r;){var n=R(t.i),s=15&n,o=n>>4;if(0!==s){var h=e[a+=o];t.D[i+h]=N(s)*(1<<c),a++}else{if(o<15){A=D(o)+(1<<o)-1;break}a+=16}}}:function(i,a){for(var r,n,s=l,o=u,h=0;s<=o;){var d=a+e[s],f=i.D[d]<0?-1:1;switch($){case 0:if(h=(n=R(i.i))>>4,0==(r=15&n))h<15?(A=D(h)+(1<<h),$=4):(h=16,$=1);else{if(1!==r)throw new t("invalid ACn encoding");m=N(r),$=h?2:3}continue;case 1:case 2:i.D[d]?i.D[d]+=f*(F()<<c):0==--h&&($=2===$?3:0);break;case 3:i.D[d]?i.D[d]+=f*(F()<<c):(i.D[d]=m<<c,$=0);break;case 4:i.D[d]&&(i.D[d]+=f*(F()<<c))}s++}4===$&&0==--A&&($=0)}:function(t,i){var a=R(t.J),r=0===a?0:N(a),n=1;for(t.D[i]=t.Q+=r;n<64;){var s=R(t.i),o=15&s,l=s>>4;if(0!==o){var u=e[n+=l];t.D[i+u]=N(o),n++}else{if(l<15)break;n+=16}}},k=1===L?s[0].P*s[0].c:E*n.R;B<=k;){var U=o?Math.min(k-B,o):k;if(U>0){for(_=0;_<L;_++)s[_].Q=0;if(A=0,1===L)for(p=s[0],x=0;x<U;x++)O(p,w,B),B++;else for(x=0;x<U;x++){for(_=0;_<L;_++)for(M=(p=s[_]).h,I=p.A,b=0;b<I;b++)for(y=0;y<M;y++)Z(p,w,B,b,y);B++}}if(C=0,!(v=g(i,r)))break;if(v.u&&(r=v.offset),!(v.M>=65488&&v.M<=65495))break;r+=2}return r-P}function p(e,a,c){var d,f,m,p,_,g,b,y,x,w,v,k,M,I,E,S,P,T=e.$,C=e.D;if(!T)throw new t("missing required Quantization Table.");for(var A=0;A<64;A+=8)x=C[a+A],w=C[a+A+1],v=C[a+A+2],k=C[a+A+3],M=C[a+A+4],I=C[a+A+5],E=C[a+A+6],S=C[a+A+7],x*=T[A],w|v|k|M|I|E|S?(w*=T[A+1],v*=T[A+2],k*=T[A+3],M*=T[A+4],I*=T[A+5],E*=T[A+6],S*=T[A+7],f=(d=(d=u*x+128>>8)+(f=u*M+128>>8)+1>>1)-f,P=(m=v)*l+(p=E)*o+128>>8,m=m*o-p*l+128>>8,b=(_=(_=h*(w-S)+128>>8)+(b=I<<4)+1>>1)-b,g=(y=(y=h*(w+S)+128>>8)+(g=k<<4)+1>>1)-g,p=(d=d+(p=P)+1>>1)-p,m=(f=f+m+1>>1)-m,P=_*s+y*n+2048>>12,_=_*n-y*s+2048>>12,y=P,P=g*r+b*i+2048>>12,g=g*i-b*r+2048>>12,b=P,c[A]=d+y,c[A+7]=d-y,c[A+1]=f+b,c[A+6]=f-b,c[A+2]=m+g,c[A+5]=m-g,c[A+3]=p+_,c[A+4]=p-_):(P=u*x+512>>10,c[A]=P,c[A+1]=P,c[A+2]=P,c[A+3]=P,c[A+4]=P,c[A+5]=P,c[A+6]=P,c[A+7]=P);for(var $=0;$<8;++$)x=c[$],(w=c[$+8])|(v=c[$+16])|(k=c[$+24])|(M=c[$+32])|(I=c[$+40])|(E=c[$+48])|(S=c[$+56])?(f=(d=4112+((d=u*x+2048>>12)+(f=u*M+2048>>12)+1>>1))-f,P=(m=v)*l+(p=E)*o+2048>>12,m=m*o-p*l+2048>>12,p=P,b=(_=(_=h*(w-S)+2048>>12)+(b=I)+1>>1)-b,g=(y=(y=h*(w+S)+2048>>12)+(g=k)+1>>1)-g,P=_*s+y*n+2048>>12,_=_*n-y*s+2048>>12,y=P,P=g*r+b*i+2048>>12,g=g*i-b*r+2048>>12,(x=(d=d+p+1>>1)+y)<16?x=0:x>=4080?x=255:x>>=4,(w=(f=f+m+1>>1)+(b=P))<16?w=0:w>=4080?w=255:w>>=4,(v=(m=f-m)+g)<16?v=0:v>=4080?v=255:v>>=4,(k=(p=d-p)+_)<16?k=0:k>=4080?k=255:k>>=4,(M=p-_)<16?M=0:M>=4080?M=255:M>>=4,(I=m-g)<16?I=0:I>=4080?I=255:I>>=4,(E=f-b)<16?E=0:E>=4080?E=255:E>>=4,(S=d-y)<16?S=0:S>=4080?S=255:S>>=4,C[a+$]=x,C[a+$+8]=w,C[a+$+16]=v,C[a+$+24]=k,C[a+$+32]=M,C[a+$+40]=I,C[a+$+48]=E,C[a+$+56]=S):(P=(P=u*x+8192>>14)<-2040?0:P>=2024?255:P+2056>>4,C[a+$]=P,C[a+$+8]=P,C[a+$+16]=P,C[a+$+24]=P,C[a+$+32]=P,C[a+$+40]=P,C[a+$+48]=P,C[a+$+56]=P)}function _(e,t){for(var i=t.P,a=t.c,r=new Int16Array(64),n=0;n<a;n++)for(var s=0;s<i;s++){p(t,f(t,n,s),r)}return t.D}function g(e,t,i){null==i&&(i=t);var r=e.length-1,n=i<t?i:t;if(t>=r)return null;var s=a(e,t);if(s>=65472&&s<=65534)return{u:null,M:s,offset:t};for(var o=a(e,n);!(o>=65472&&o<=65534);){if(++n>=r)return null;o=a(e,n)}return{u:s.toString(16),M:o,offset:n}}return c.prototype={parse(i,r){null==r&&(r={});var n,s,o=r.F,l=0,u=null,h=null,c=0;function f(){var e=a(i,l),t=(l+=2)+e-2,r=g(i,t,l);r&&r.u&&(t=r.offset);var n=i.subarray(l,t);return l+=n.length,n}function p(e){for(var t=Math.ceil(e.o/8/e.X),i=Math.ceil(e.s/8/e.B),a=0;a<e.W.length;a++){U=e.W[a];var r=Math.ceil(Math.ceil(e.o/8)*U.h/e.X),n=Math.ceil(Math.ceil(e.s/8)*U.A/e.B),s=t*U.h,o=64*(i*U.A)*(s+1);U.D=new Int16Array(o),U.P=r,U.c=n}e.m=t,e.R=i}var b=[],y=[],x=[],w=a(i,l);if(l+=2,65496!==w)throw new t("SOI not found");w=a(i,l),l+=2;e:for(;65497!==w;){var v,k,M;switch(w){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var I=f();65504===w&&74===I[0]&&70===I[1]&&73===I[2]&&70===I[3]&&0===I[4]&&(u={version:{d:I[5],T:I[6]},K:I[7],j:I[8]<<8|I[9],H:I[10]<<8|I[11],S:I[12],I:I[13],C:I.subarray(14,14+3*I[12]*I[13])}),65518===w&&65===I[0]&&100===I[1]&&111===I[2]&&98===I[3]&&101===I[4]&&(h={version:I[5]<<8|I[6],k:I[7]<<8|I[8],q:I[9]<<8|I[10],a:I[11]});break;case 65499:for(var E=a(i,l)+(l+=2)-2;l<E;){var S=i[l++],P=new Uint16Array(64);if(S>>4){if(S>>4!=1)throw new t("DQT - invalid table spec");for(k=0;k<64;k++)P[e[k]]=a(i,l),l+=2}else for(k=0;k<64;k++)P[e[k]]=i[l++];b[15&S]=P}break;case 65472:case 65473:case 65474:if(n)throw new t("Only single frame JPEGs supported");l+=2,(n={}).G=65473===w,n.Z=65474===w,n.precision=i[l++];var T,C=a(i,l),A=0,$=0;l+=2,n.s=o||C,n.o=a(i,l),l+=2,n.W=[],n._={};var z=i[l++];for(v=0;v<z;v++){T=i[l];var B=i[l+1]>>4,F=15&i[l+1];A<B&&(A=B),$<F&&($=F);var R=i[l+2];M=n.W.push({h:B,A:F,L:R,$:null}),n._[T]=M-1,l+=3}n.X=A,n.B=$,p(n);break;case 65476:var D=a(i,l);for(l+=2,v=2;v<D;){var N=i[l++],Z=new Uint8Array(16),O=0;for(k=0;k<16;k++,l++)O+=Z[k]=i[l];var L=new Uint8Array(O);for(k=0;k<O;k++,l++)L[k]=i[l];v+=17+O,(N>>4?y:x)[15&N]=d(Z,L)}break;case 65501:s=a(i,l+=2),l+=2;break;case 65498:var U,G=1==++c&&!o;l+=2;var Q=i[l++],j=[];for(v=0;v<Q;v++){var H=i[l++],W=n._[H];(U=n.W[W]).index=H;var q=i[l++];U.J=x[q>>4],U.i=y[15&q],j.push(U)}var V=i[l++],K=i[l++],Y=i[l++];try{var X=m(i,l,n,j,s,V,K,Y>>4,15&Y,G);l+=X}catch(e){if(e instanceof DNLMarkerError)return this.parse(i,{F:e.s});if(e instanceof EOIMarkerError)break e;throw e}break;case 65500:l+=4;break;case 65535:255!==i[l]&&l--;break;default:var J=g(i,l-2,l-3);if(J&&J.u){l=J.offset;break}if(l>=i.length-1)break e;throw new t("JpegImage.parse - unknown marker: "+w.toString(16))}w=a(i,l),l+=2}for(this.width=n.o,this.height=n.s,this.g=u,this.b=h,this.W=[],v=0;v<n.W.length;v++){var ee=b[(U=n.W[v]).L];ee&&(U.$=ee),this.W.push({index:U.index,e:_(0,U),l:U.h/n.X,t:U.A/n.B,P:U.P,c:U.c})}this.p=this.W.length},Y(e,t,i){null==i&&(i=!1);var a,r,n,s,o,l,u,h,c,d,f,m,p=this.width/e,_=this.height/t,g=0,b=this.W.length,y=e*t*b,x=new Uint8ClampedArray(y),w=new Uint32Array(e),v=4294967288;for(u=0;u<b;u++){if(r=(a=this.W[u]).l*p,n=a.t*_,g=u,f=a.e,s=a.P+1<<3,r!==m){for(o=0;o<e;o++)h=0|o*r,w[o]=(h&v)<<3|7&h;m=r}for(l=0;l<t;l++)for(d=s*((h=0|l*n)&v)|(7&h)<<3,o=0;o<e;o++)x[g]=f[d+w[o]],g+=b}var k=this.V;if(i||4!==b||k||(k=new Int32Array([-256,255,-256,255,-256,255,-256,255])),k)for(u=0;u<y;)for(h=0,c=0;h<b;h++,u++,c+=2)x[u]=(x[u]*k[c]>>8)+k[c+1];return x},get f(){return this.b?!!this.b.a:3===this.p?0!==this.N&&(82!==this.W[0].index||71!==this.W[1].index||66!==this.W[2].index):1===this.N},z:function(e){for(var t,i,a,r=0,n=e.length;r<n;r+=3)t=e[r],i=e[r+1],a=e[r+2],e[r]=t-179.456+1.402*a,e[r+1]=t+135.459-.344*i-.714*a,e[r+2]=t-226.816+1.772*i;return e},O:function(e){for(var t,i,a,r,n=0,s=0,o=e.length;s<o;s+=4)t=e[s],i=e[s+1],a=e[s+2],r=e[s+3],e[n++]=i*(-660635669420364e-19*i+.000437130475926232*a-54080610064599e-18*t+.00048449797120281*r-.154362151871126)-122.67195406894+a*(-.000957964378445773*a+.000817076911346625*t-.00477271405408747*r+1.53380253221734)+t*(.000961250184130688*t-.00266257332283933*r+.48357088451265)+r*(-.000336197177618394*r+.484791561490776),e[n++]=107.268039397724+i*(219927104525741e-19*i-.000640992018297945*a+.000659397001245577*t+.000426105652938837*r-.176491792462875)+a*(-.000778269941513683*a+.00130872261408275*t+.000770482631801132*r-.151051492775562)+t*(.00126935368114843*t-.00265090189010898*r+.25802910206845)+r*(-.000318913117588328*r-.213742400323665),e[n++]=i*(-.000570115196973677*i-263409051004589e-19*a+.0020741088115012*t-.00288260236853442*r+.814272968359295)-20.810012546947+a*(-153496057440975e-19*a-.000132689043961446*t+.000560833691242812*r-.195152027534049)+t*(.00174418132927582*t-.00255243321439347*r+.116935020465145)+r*(-.000343531996510555*r+.24165260232407);return e.subarray(0,n)},r:function(e){for(var t,i,a,r=0,n=e.length;r<n;r+=4)t=e[r],i=e[r+1],a=e[r+2],e[r]=434.456-t-1.402*a,e[r+1]=119.541-t+.344*i+.714*a,e[r+2]=481.816-t-1.772*i;return e},U:function(e){for(var t,i,a,r,n=0,s=0,o=e.length;s<o;s+=4)t=e[s],i=e[s+1],a=e[s+2],r=e[s+3],e[n++]=255+t*(-6747147073602441e-20*t+.0008379262121013727*i+.0002894718188643294*a+.003264231057537806*r-1.1185611867203937)+i*(26374107616089405e-21*i-8626949158638572e-20*a-.0002748769067499491*r-.02155688794978967)+a*(-3878099212869363e-20*a-.0003267808279485286*r+.0686742238595345)-r*(.0003361971776183937*r+.7430659151342254),e[n++]=255+t*(.00013596372813588848*t+.000924537132573585*i+.00010567359618683593*a+.0004791864687436512*r-.3109689587515875)+i*(-.00023545346108370344*i+.0002702845253534714*a+.0020200308977307156*r-.7488052167015494)+a*(6834815998235662e-20*a+.00015168452363460973*r-.09751927774728933)-r*(.0003189131175883281*r+.7364883807733168),e[n++]=255+t*(13598650411385307e-21*t+.00012423956175490851*i+.0004751985097583589*a-36729317476630422e-22*r-.05562186980264034)+i*(.00016141380598724676*i+.0009692239130725186*a+.0007782692450036253*r-.44015232367526463)+a*(5.068882914068769e-7*a+.0017778369011375071*r-.7591454649749609)-r*(.0003435319965105553*r+.7063770186160144);return e.subarray(0,n)},getData:function(e){var i=e.width,a=e.height,r=e.forceRGB,n=e.isSourcePDF;if(this.p>4)throw new t("Unsupported color mode");var s=this.Y(i,a,n);if(1===this.p&&r){for(var o=s.length,l=new Uint8ClampedArray(3*o),u=0,h=0;h<o;h++){var c=s[h];l[u++]=c,l[u++]=c,l[u++]=c}return l}if(3===this.p&&this.f)return this.z(s);if(4===this.p){if(this.f)return r?this.O(s):this.r(s);if(r)return this.U(s)}return s}},c}();function a(e,t){return e[t]<<8|e[t+1]}e.JpegDecoder=i}(),e.encodeImage=function(t,i,a,r){var n={t256:[i],t257:[a],t258:[8,8,8,8],t259:[1],t262:[2],t273:[1e3],t277:[4],t278:[a],t279:[i*a*4],t282:[[72,1]],t283:[[72,1]],t284:[1],t286:[[0,1]],t287:[[0,1]],t296:[1],t305:["Photopea (UTIF.js)"],t338:[1]};if(r)for(var s in r)n[s]=r[s];var o=new Uint8Array(e.encode([n])),l=new Uint8Array(t),u=new Uint8Array(1e3+i*a*4);for(s=0;s<o.length;s++)u[s]=o[s];for(s=0;s<l.length;s++)u[1e3+s]=l[s];return u.buffer},e.encode=function(t){var i=new Uint8Array(2e4),a=4,r=e._binBE;i[0]=i[1]=77,r.writeUshort(i,2,42);var n=8;r.writeUint(i,a,n),a+=4;for(var s=0;s<t.length;s++){var o=e._writeIFD(r,e._types.basic,i,n,t[s]);n=o[1],s<t.length-1&&(3&n&&(n+=4-(3&n)),r.writeUint(i,o[0],n))}return i.slice(0,n).buffer},e.decode=function(t,a){null==a&&(a={parseMN:!0,debug:!1});var r=new Uint8Array(t),n=0,s=e._binBE.readASCII(r,n,2);n+=2;var o="II"==s?e._binLE:e._binBE;o.readUshort(r,n),n+=2;var l=o.readUint(r,n);n+=4;for(var u=[];;){var h=o.readUshort(r,l),c=o.readUshort(r,l+4);if(0!=h&&(c<1||13<c)){i("error in TIFF");break}if(e._readIFD(o,r,l,u,0,a),0==(l=o.readUint(r,l+2+12*h)))break}return u},e.decodeImage=function(t,a,r){if(!a.data){var n=new Uint8Array(t),s=e._binBE.readASCII(n,0,2);if(null!=a.t256){a.isLE="II"==s,a.width=a.t256[0],a.height=a.t257[0];var o=a.t259?a.t259[0]:1,l=a.t266?a.t266[0]:1;a.t284&&2==a.t284[0]&&i("PlanarConfiguration 2 should not be used!"),7==o&&a.t258&&a.t258.length>3&&(a.t258=a.t258.slice(0,3));var u=a.t277?a.t277[0]:1,h=(a.t258?a.t258[0]:1)*u;1==o&&null!=a.t279&&a.t278&&32803==a.t262[0]&&(h=Math.round(8*a.t279[0]/(a.width*a.t278[0]))),a.t50885&&4==a.t50885[0]&&(h=3*a.t258[0]);var c=8*Math.ceil(a.width*h/8),d=a.t273;(null==d||a.t322)&&(d=a.t324);var f=a.t279;1==o&&1==d.length&&(f=[a.height*(c>>>3)]),(null==f||a.t322)&&(f=a.t325);var m=new Uint8Array(a.height*(c>>>3)),p=0;if(null!=a.t322){var _=a.t322[0],g=a.t323[0],b=Math.floor((a.width+_-1)/_),y=Math.floor((a.height+g-1)/g),x=new Uint8Array(0|Math.ceil(_*g*h/8));console.log("====",b,y);for(var w=0;w<y;w++)for(var v=0;v<b;v++){var k=w*b+v;x.fill(0),e.decode._decompress(a,r,n,d[k],f[k],o,x,0,l,_,g),6==o?m=x:e._copyTile(x,0|Math.ceil(_*h/8),g,m,0|Math.ceil(a.width*h/8),a.height,0|Math.ceil(v*_*h/8),w*g)}p=8*m.length}else{if(null==d)return;var M=a.t278?a.t278[0]:a.height;M=Math.min(M,a.height);for(k=0;k<d.length;k++)e.decode._decompress(a,r,n,d[k],f[k],o,m,0|Math.ceil(p/8),l,a.width,M),p+=c*M;p=Math.min(p,8*m.length)}a.data=new Uint8Array(m.buffer,0,0|Math.ceil(p/8))}}},e.decode._decompress=function(a,r,n,s,o,l,u,h,c,d,f){if(a.t271&&"Panasonic"==a.t271[0]&&a.t45&&6==a.t45[0]&&(l=34316),1==l)for(var m=0;m<o;m++)u[h+m]=n[s+m];else if(2==l)e.decode._decodeG2(n,s,o,u,h,d,c);else if(3==l)e.decode._decodeG3(n,s,o,u,h,d,c,!!a.t292&&!(1&~a.t292[0]));else if(4==l)e.decode._decodeG4(n,s,o,u,h,d,c);else if(5==l)e.decode._decodeLZW(n,s,o,u,h,8);else if(6==l)e.decode._decodeOldJPEG(a,n,s,o,u,h);else if(7==l||34892==l)e.decode._decodeNewJPEG(a,n,s,o,u,h);else if(8==l||32946==l){var p=new Uint8Array(n.buffer,s+2,o-6),_=t.inflateRaw(p);h+_.length<=u.length&&u.set(_,h)}else 9==l?e.decode._decodeVC5(n,s,o,u,h,a.t33422):32767==l?e.decode._decodeARW(a,n,s,o,u,h):32773==l?e.decode._decodePackBits(n,s,o,u,h):32809==l?e.decode._decodeThunder(n,s,o,u,h):34316==l?e.decode._decodePanasonic(a,n,s,o,u,h):34713==l?e.decode._decodeNikon(a,r,n,s,o,u,h):34676==l?e.decode._decodeLogLuv32(a,n,s,o,u,h):i("Unknown compression",l);var g=a.t258?Math.min(32,a.t258[0]):1,b=a.t277?a.t277[0]:1,y=g*b>>>3,x=Math.ceil(g*b*d/8);if(16==g&&!a.isLE&&null==a.t33422)for(var w=0;w<f;w++)for(var v=h+w*x,k=1;k<x;k+=2){var M=u[v+k];u[v+k]=u[v+k-1],u[v+k-1]=M}if(a.t317&&2==a.t317[0])for(w=0;w<f;w++){var I=h+w*x;if(16==g)for(m=y;m<x;m+=2){var E=(u[I+m+1]<<8|u[I+m])+(u[I+m-y+1]<<8|u[I+m-y]);u[I+m]=255&E,u[I+m+1]=E>>>8&255}else if(3==b)for(m=3;m<x;m+=3)u[I+m]=u[I+m]+u[I+m-3]&255,u[I+m+1]=u[I+m+1]+u[I+m-2]&255,u[I+m+2]=u[I+m+2]+u[I+m-1]&255;else for(m=y;m<x;m++)u[I+m]=u[I+m]+u[I+m-y]&255}},e.decode._decodePanasonic=function(e,t,i,a,r,n){var s,o,l,u,h,c,d,f,m=t.buffer,p=e.t2[0],_=e.t3[0],g=e.t10[0],b=e.t45[0],y=0,x=0,w=0,v=0,k=6==b?new Uint32Array(18):new Uint8Array(16),M=[0,0],I=[0,0],E=0,S=new Uint8Array(16384),P=new Uint16Array(r.buffer);function T(e){if(0==w){var t=new Uint8Array(m,i+x+8184,8200),a=new Uint8Array(m,i+x,8184);S.set(t),S.set(a,t.length),x+=16384}if(5!=b)return(S[v=(w=w-e&131071)>>3^16368]|S[v+1]<<8)>>(7&w)&~(-1<<e);for(s=0;s<16;s++)k[s]=S[w++],w&=16383}function C(e){return S[w+15-e]}function A(){M[0]=0,M[1]=0,I[0]=0,I[1]=0}if(7==b)throw b;if(6==b){var $=12==g,z=$?function(){k[0]=C(0)<<4|C(1)>>4,k[1]=4095&((15&C(1))<<8|C(2)),k[2]=C(3)>>6&3,k[3]=(63&C(3))<<2|C(4)>>6,k[4]=(63&C(4))<<2|C(5)>>6,k[5]=(63&C(5))<<2|C(6)>>6,k[6]=C(6)>>4&3,k[7]=(15&C(6))<<4|C(7)>>4,k[8]=(15&C(7))<<4|C(8)>>4,k[9]=(15&C(8))<<4|C(9)>>4,k[10]=C(9)>>2&3,k[11]=(3&C(9))<<6|C(10)>>2,k[12]=(3&C(10))<<6|C(11)>>2,k[13]=(3&C(11))<<6|C(12)>>2,k[14]=3&C(12),k[15]=C(13),k[16]=C(14),k[17]=C(15),w+=16,v=0}:function(){k[0]=C(0)<<6|C(1)>>2,k[1]=16383&((3&C(1))<<12|C(2)<<4|C(3)>>4),k[2]=C(3)>>2&3,k[3]=(3&C(3))<<8|C(4),k[4]=C(5)<<2|C(6)>>6,k[5]=(63&C(6))<<4|C(7)>>4,k[6]=C(7)>>2&3,k[7]=(3&C(7))<<8|C(8),k[8]=C(9)<<2&1020|C(10)>>6,k[9]=1023&(C(10)<<4|C(11)>>4),k[10]=C(11)>>2&3,k[11]=(3&C(11))<<8|C(12),k[12]=1023&(C(13)<<2&1020|C(14)>>6),k[13]=1023&(C(14)<<4|C(15)>>4),w+=16,v=0},B=$?14:11,F=$?128:512,R=$?2048:8192,D=$?16383:65535,N=$?4095:16383,Z=p/B,O=16*Z,L=$?18:14;for(c=0;c<_-15;c+=16){var U=Math.min(16,_-c),G=O*U;for(S=new Uint8Array(m,i+y,G),w=0,y+=G,f=0,d=0;f<U;f++,d=0){E=(c+f)*p;for(var Q=0;Q<Z;Q++)for(z(),A(),l=0,h=0,s=0;s<B;s++){if(u=1&s,s%3==2){var j=v<L?k[v++]:0;3==j&&(j=4),h=F<<j,l=1<<j}var H=v<L?k[v++]:0;M[u]?(H*=l,h<R&&I[u]>h&&(H+=I[u]-h),I[u]=H):(M[u]=H,H?I[u]=H:H=I[u]),P[E+d++]=H-15<=D?H-15&D:H+2147483633>>31&N}}}}else if(5==b){var W=12==g?10:9;for(c=0;c<_;c++)for(d=0;d<p;d+=W)T(0),12==g?(P[E++]=((15&k[1])<<8)+k[0],P[E++]=16*k[2]+(k[1]>>4),P[E++]=((15&k[4])<<8)+k[3],P[E++]=16*k[5]+(k[4]>>4),P[E++]=((15&k[7])<<8)+k[6],P[E++]=16*k[8]+(k[7]>>4),P[E++]=((15&k[10])<<8)+k[9],P[E++]=16*k[11]+(k[10]>>4),P[E++]=((15&k[13])<<8)+k[12],P[E++]=16*k[14]+(k[13]>>4)):14==g&&(P[E++]=k[0]+((63&k[1])<<8),P[E++]=(k[1]>>6)+4*k[2]+((15&k[3])<<10),P[E++]=(k[3]>>4)+16*k[4]+((3&k[5])<<12),P[E++]=((252&k[5])>>2)+(k[6]<<6),P[E++]=k[7]+((63&k[8])<<8),P[E++]=(k[8]>>6)+4*k[9]+((15&k[10])<<10),P[E++]=(k[10]>>4)+16*k[11]+((3&k[12])<<12),P[E++]=((252&k[12])>>2)+(k[13]<<6),P[E++]=k[14]+((63&k[15])<<8))}else{if(4!=b)throw b;for(c=0;c<_;c++)for(d=0;d<p;d++)u=1&(s=d%14),0==s&&A(),s%3==2&&(l=4>>3-T(2)),I[u]?0!=(o=T(8))&&(M[u]-=128<<l,(M[u]<0||4==l)&&(M[u]&=~(-1<<l)),M[u]+=o<<l):(I[u]=T(8),(I[u]||s>11)&&(M[u]=I[u]<<4|T(4))),P[E++]=M[1&d]}},e.decode._decodeVC5=function(){var t,i,a,r=[1,0,1,0,2,2,1,1,3,7,1,2,5,25,1,3,6,48,1,4,6,54,1,5,7,111,1,8,7,99,1,6,7,105,12,0,7,107,1,7,8,209,20,0,8,212,1,9,8,220,1,10,9,393,1,11,9,394,32,0,9,416,1,12,9,427,1,13,10,887,1,18,10,784,1,14,10,790,1,15,10,835,60,0,10,852,1,16,10,885,1,17,11,1571,1,19,11,1668,1,20,11,1669,100,0,11,1707,1,21,11,1772,1,22,12,3547,1,29,12,3164,1,24,12,3166,1,25,12,3140,1,23,12,3413,1,26,12,3537,1,27,12,3539,1,28,13,7093,1,35,13,6283,1,30,13,6331,1,31,13,6335,180,0,13,6824,1,32,13,7072,1,33,13,7077,320,0,13,7076,1,34,14,12565,1,36,14,12661,1,37,14,12669,1,38,14,13651,1,39,14,14184,1,40,15,28295,1,46,15,28371,1,47,15,25320,1,42,15,25336,1,43,15,25128,1,41,15,27300,1,44,15,28293,1,45,16,50259,1,48,16,50643,1,49,16,50675,1,50,16,56740,1,53,16,56584,1,51,16,56588,1,52,17,113483,1,61,17,113482,1,60,17,101285,1,55,17,101349,1,56,17,109205,1,57,17,109207,1,58,17,100516,1,54,17,113171,1,59,18,202568,1,62,18,202696,1,63,18,218408,1,64,18,218412,1,65,18,226340,1,66,18,226356,1,67,18,226358,1,68,19,402068,1,69,19,405138,1,70,19,405394,1,71,19,436818,1,72,19,436826,1,73,19,452714,1,75,19,452718,1,76,19,452682,1,74,20,804138,1,77,20,810279,1,78,20,810790,1,79,20,873638,1,80,20,873654,1,81,20,905366,1,82,20,905430,1,83,20,905438,1,84,21,1608278,1,85,21,1620557,1,86,21,1621582,1,87,21,1621583,1,88,21,1747310,1,89,21,1810734,1,90,21,1810735,1,91,21,1810863,1,92,21,1810879,1,93,22,3621725,1,99,22,3621757,1,100,22,3241112,1,94,22,3494556,1,95,22,3494557,1,96,22,3494622,1,97,22,3494623,1,98,23,6482227,1,102,23,6433117,1,101,23,6989117,1,103,23,6989119,1,105,23,6989118,1,104,23,7243449,1,106,23,7243512,1,107,24,13978233,1,111,24,12964453,1,109,24,12866232,1,108,24,14486897,1,113,24,13978232,1,110,24,14486896,1,112,24,14487026,1,114,24,14487027,1,115,25,25732598,1,225,25,25732597,1,189,25,25732596,1,188,25,25732595,1,203,25,25732594,1,202,25,25732593,1,197,25,25732592,1,207,25,25732591,1,169,25,25732590,1,223,25,25732589,1,159,25,25732522,1,235,25,25732579,1,152,25,25732575,1,192,25,25732489,1,179,25,25732573,1,201,25,25732472,1,172,25,25732576,1,149,25,25732488,1,178,25,25732566,1,120,25,25732571,1,219,25,25732577,1,150,25,25732487,1,127,25,25732506,1,211,25,25732548,1,125,25,25732588,1,158,25,25732486,1,247,25,25732467,1,238,25,25732508,1,163,25,25732552,1,228,25,25732603,1,183,25,25732513,1,217,25,25732587,1,168,25,25732520,1,122,25,25732484,1,128,25,25732562,1,249,25,25732505,1,187,25,25732504,1,186,25,25732483,1,136,25,25928905,1,181,25,25732560,1,255,25,25732500,1,230,25,25732482,1,135,25,25732555,1,233,25,25732568,1,222,25,25732583,1,145,25,25732481,1,134,25,25732586,1,167,25,25732521,1,248,25,25732518,1,209,25,25732480,1,243,25,25732512,1,216,25,25732509,1,164,25,25732547,1,140,25,25732479,1,157,25,25732544,1,239,25,25732574,1,191,25,25732564,1,251,25,25732478,1,156,25,25732546,1,139,25,25732498,1,242,25,25732557,1,133,25,25732477,1,162,25,25732515,1,213,25,25732584,1,165,25,25732514,1,212,25,25732476,1,227,25,25732494,1,198,25,25732531,1,236,25,25732530,1,234,25,25732529,1,117,25,25732528,1,215,25,25732527,1,124,25,25732526,1,123,25,25732525,1,254,25,25732524,1,253,25,25732523,1,148,25,25732570,1,218,25,25732580,1,146,25,25732581,1,147,25,25732569,1,224,25,25732533,1,143,25,25732540,1,184,25,25732541,1,185,25,25732585,1,166,25,25732556,1,132,25,25732485,1,129,25,25732563,1,250,25,25732578,1,151,25,25732501,1,119,25,25732502,1,193,25,25732536,1,176,25,25732496,1,245,25,25732553,1,229,25,25732516,1,206,25,25732582,1,144,25,25732517,1,208,25,25732558,1,137,25,25732543,1,241,25,25732466,1,237,25,25732507,1,190,25,25732542,1,240,25,25732551,1,131,25,25732554,1,232,25,25732565,1,252,25,25732475,1,171,25,25732493,1,205,25,25732492,1,204,25,25732491,1,118,25,25732490,1,214,25,25928904,1,180,25,25732549,1,126,25,25732602,1,182,25,25732539,1,175,25,25732545,1,141,25,25732559,1,138,25,25732537,1,177,25,25732534,1,153,25,25732503,1,194,25,25732606,1,160,25,25732567,1,121,25,25732538,1,174,25,25732497,1,246,25,25732550,1,130,25,25732572,1,200,25,25732474,1,170,25,25732511,1,221,25,25732601,1,196,25,25732532,1,142,25,25732519,1,210,25,25732495,1,199,25,25732605,1,155,25,25732535,1,154,25,25732499,1,244,25,25732510,1,220,25,25732600,1,195,25,25732607,1,161,25,25732604,1,231,25,25732473,1,173,25,25732599,1,226,26,51465122,1,116,26,51465123,0,1],n=[3,3,3,3,2,2,2,1,1,1];function s(e){var t=e[1],i=e[0][t>>>3]>>>7-(7&t)&1;return e[1]++,i}function o(e,i){if(null==t){t={};for(var a=0;a<r.length;a+=4)t[r[a+1]]=r.slice(a,a+4)}for(var n=s(e),o=t[n];null==o;)n=n<<1|s(e),o=t[n];var l=o[3];0!=l&&(l=0==s(e)?l:-l),i[0]=o[2],i[1]=l}function l(e,t){for(var i=0;i<t;i++)1&~e||e++,e>>>=1;return e}function u(e,t){return e>>t}function h(e,t,i,a,r,n){t[i]=u(u(11*e[r]-4*e[r+n]+e[r+n+n]+4,3)+e[a],1),t[i+n]=u(u(5*e[r]+4*e[r+n]-e[r+n+n]+4,3)-e[a],1)}function c(e,t,i,a,r,n){var s=e[r-n]-e[r+n],o=e[r],l=e[a];t[i]=u(u(s+4,3)+o+l,1),t[i+n]=u(u(4-s,3)+o-l,1)}function d(e,t,i,a,r,n){t[i]=u(u(5*e[r]+4*e[r-n]-e[r-n-n]+4,3)+e[a],1),t[i+n]=u(u(11*e[r]-4*e[r-n]+e[r-n-n]+4,3)-e[a],1)}function f(e){return e=a[e=e<0?0:e>4095?4095:e]>>>2}return function(t,r,s,u,m,p){u=new Uint16Array(u.buffer);var _,g,b,y,x,w,v,k,M=Date.now(),I=e._binBE,E=r+s;r+=4;for(var S=1==p[0];r<E;){var P=I.readShort(t,r),T=I.readUshort(t,r+2);if(r+=4,12==P)R=T;else if(20==P)_=T;else if(21==P)g=T;else if(48==P)b=T;else if(53==P)y=T;else if(35==P);else if(62==P)x=T;else if(101==P);else if(109==P)w=T;else if(84==P);else if(106==P);else if(107==P);else if(108==P);else if(102==P);else if(104==P)ie=T;else if(105==P);else{var C=P<0?-P:P,A=65280&C,$=0;if(24576&C&&(8192&C?($=65535&T,$+=(255&C)<<16):$=65535&T),24576&~C){if(16388==C)r+=4*$;else if(8192!=A&&8448!=A&&9216!=A)throw C.toString(16)}else{if(null==v){v=[];for(var z=0;z<4;z++)v[z]=new Int16Array((_>>>1)*(g>>>1));k=new Int16Array((_>>>1)*(g>>>1)),i=new Int16Array(1024);for(z=0;z<1024;z++){var B=z-512,F=Math.abs(B),R=Math.floor(768*F*F*F/16581375)+F;i[z]=Math.sign(B)*R}a=new Uint16Array(4096);for(z=0;z<4096;z++){var D=z,N=65535*(Math.pow(113,D/4095)-1)/112;a[z]=Math.min(N,65535)}}var Z=v[x],O=l(_,1+n[b]),L=l(g,1+n[b]);if(0==b)for(var U=0;U<L;U++)for(var G=0;G<O;G++){var Q=r+2*(U*O+G);Z[U*(_>>>1)+G]=t[Q]<<8|t[Q+1]}else{var j=[t,8*r],H=[],W=0,q=O*L,V=[0,0],K=0;for(T=0;W<q;)for(o(j,V),K=V[0],T=V[1];K>0;)H[W++]=T,K--;var Y=(b-1)%3,X=1!=Y?O:0,J=0!=Y?L:0;for(U=0;U<L;U++){var ee=(U+J)*(_>>>1)+X,te=U*O;for(G=0;G<O;G++)Z[ee+G]=i[H[te+G]+512]*y}if(2==Y){var ie=_>>>1,ae=2*O,re=2*L;for(U=0;U<L;U++)for(G=0;G<ae;G++){z=2*U*ie+G;var ne=L*ie+(oe=U*ie+G);0==U?h(Z,k,z,ne,oe,ie):U==L-1?d(Z,k,z,ne,oe,ie):c(Z,k,z,ne,oe,ie)}var se=Z;Z=k,k=se;for(U=0;U<re;U++)for(G=0;G<O;G++){var oe;z=U*ie+2*G,ne=O+(oe=U*ie+G);0==G?h(Z,k,z,ne,oe,1):G==O-1?d(Z,k,z,ne,oe,1):c(Z,k,z,ne,oe,1)}se=Z;Z=k,k=se;for(var le=[],ue=2-~~((b-1)/3),he=0;he<3;he++)le[he]=w>>14-2*he&3;var ce=le[ue];if(0!=ce)for(U=0;U<re;U++)for(G=0;G<ae;G++){Z[z=U*ie+G]=Z[z]<<ce}}}if(9==b&&3==x){var de=v[0],fe=v[1],me=v[2],pe=v[3];for(U=0;U<g;U+=2)for(G=0;G<_;G+=2){var _e=U*_+G,ge=de[Q=(U>>>1)*(_>>>1)+(G>>>1)],be=fe[Q]-2048,ye=me[Q]-2048,xe=pe[Q]-2048,we=(be<<1)+ge,ve=(ye<<1)+ge,ke=ge+xe,Me=ge-xe;S?(u[_e]=f(ke),u[_e+1]=f(ve),u[_e+_]=f(we),u[_e+_+1]=f(Me)):(u[_e]=f(we),u[_e+1]=f(ke),u[_e+_]=f(Me),u[_e+_+1]=f(ve))}}r+=4*$}}}console.log(Date.now()-M)}}(),e.decode._decodeLogLuv32=function(e,t,i,a,r,n){for(var s=e.width,o=4*s,l=0,u=new Uint8Array(o);l<a;){for(var h=0;h<o;){var c=t[i+l];if(l++,c<128){for(var d=0;d<c;d++)u[h+d]=t[i+l+d];h+=c,l+=c}else{c-=126;for(d=0;d<c;d++)u[h+d]=t[i+l];h+=c,l++}}for(var f=0;f<s;f++)r[n+0]=u[f],r[n+1]=u[f+s],r[n+2]=u[f+2*s],r[n+4]=u[f+3*s],n+=6}},e.decode._ljpeg_diff=function(t,i,a){var r,n,s=e.decode._getbithuff;return r=s(t,i,a[0],a),(n=s(t,i,r,0))&1<<r-1||(n-=(1<<r)-1),n},e.decode._decodeARW=function(t,i,a,r,n,s){var o=t.t256[0],l=t.t257[0],u=t.t258[0],h=t.isLE?e._binLE:e._binBE;if(o*l==r||o*l*1.5==r)if(o*l*1.5!=r){var c,d,f,m,p,_,g,b,y=new Uint16Array(16),x=new Uint8Array(o+1);for(P=0;P<l;P++){for(var w=0;w<o;w++)x[w]=i[a++];for(b=0,S=0;S<o-30;b+=16){for(d=2047&(c=h.readUint(x,b)),f=2047&c>>>11,m=15&c>>>22,p=15&c>>>26,_=0;_<4&&128<<_<=d-f;_++);for(g=30,v=0;v<16;v++)v==m?y[v]=d:v==p?y[v]=f:(y[v]=((h.readUshort(x,b+(g>>3))>>>(7&g)&127)<<_)+f,y[v]>2047&&(y[v]=2047),g+=7);for(v=0;v<16;v++,S+=2){R=y[v]<<1;e.decode._putsF(n,(P*o+S)*u,R<<16-u)}S-=1&S?1:31}}}else for(var v=0;v<r;v+=3){var k=i[a+v+0],M=i[a+v+1],I=i[a+v+2];n[s+v]=M<<4|k>>>4,n[s+v+1]=k<<4|I>>>4,n[s+v+2]=I<<4|M>>>4}else{l+=8;var E,S,P,T=[a,0,0,0],C=new Uint16Array(32770),A=[3857,3856,3599,3342,3085,2828,2571,2314,2057,1800,1543,1286,1029,772,771,768,514,513],$=0,z=e.decode._ljpeg_diff;for(C[0]=15,E=v=0;v<18;v++)for(var B=32768>>>(A[v]>>>8),F=0;F<B;F++)C[++E]=A[v];for(S=o;S--;)for(P=0;P<l+1;P+=2)if(P==l&&(P=1),$+=z(i,T,C),P<l){var R=4095&$;e.decode._putsF(n,(P*o+S)*u,R<<16-u)}}},e.decode._decodeNikon=function(t,i,a,r,n,s,o){var l=[[0,0,1,5,1,1,1,1,1,1,2,0,0,0,0,0,0,5,4,3,6,2,7,1,0,8,9,11,10,12],[0,0,1,5,1,1,1,1,1,1,2,0,0,0,0,0,0,57,90,56,39,22,5,4,3,2,1,0,11,12,12],[0,0,1,4,2,3,1,2,0,0,0,0,0,0,0,0,0,5,4,6,3,7,2,8,1,9,0,10,11,12],[0,0,1,4,3,1,1,1,1,1,2,0,0,0,0,0,0,5,6,4,7,8,3,9,2,1,0,10,11,12,13,14],[0,0,1,5,1,1,1,1,1,1,1,2,0,0,0,0,0,8,92,75,58,41,7,6,5,4,3,2,1,0,13,14],[0,0,1,4,2,2,3,1,2,0,0,0,0,0,0,0,0,7,6,8,5,9,4,10,3,11,12,2,0,1,13,14]],u=t.t256[0],h=t.t257[0],c=t.t258[0],d=0,f=0,m=e.decode._make_decoder,p=e.decode._getbithuff,_=i[0].exifIFD.makerNote,g=_.t150?_.t150:_.t140,b=0,y=g[b++],x=g[b++];73!=y&&88!=x||(b+=2110),70==y&&(d=2),14==c&&(d+=3);for(var w=[[0,0],[0,0]],v=t.isLE?e._binLE:e._binBE,k=0;k<2;k++)for(var M=0;M<2;M++)w[k][M]=v.readShort(g,b),b+=2;var I,E,S,P,T,C=1<<c&32767,A=0,$=v.readShort(g,b);b+=2,$>1&&(A=Math.floor(C/($-1))),68==y&&32==x&&A>0&&(f=v.readShort(g,562));var z=[0,0],B=m(l[d]),F=[r,0,0,0];for(I=0;I<h;I++)for(f&&I==f&&(B=m(l[d+1])),E=0;E<u;E++){k=p(a,F,B[0],B),(T=1+(p(a,F,(S=15&k)-(P=k>>>4),0)<<1)<<P>>>1)&1<<S-1||(T-=(1<<S)-(0==P?1:0)),E<2?z[E]=w[1&I][E]+=T:z[1&E]+=T;var R=Math.min(Math.max(z[1&E],0),(1<<c)-1),D=(I*u+E)*c;e.decode._putsF(s,D,R<<16-c)}},e.decode._putsF=function(e,t,i){i<<=8-(7&t);var a=t>>>3;e[a]|=i>>>16,e[a+1]|=i>>>8,e[a+2]|=i},e.decode._getbithuff=function(t,i,a,r){var n;e.decode._get_byte;var s=i[0],o=i[1],l=i[2],u=i[3];if(0==a||l<0)return 0;for(;!u&&l<a&&-1!=(n=t[s++])&&!(u=0);)o=(o<<8)+n,l+=8;if(n=o<<32-l>>>32-a,r?(l-=r[n+1]>>>8,n=255&r[n+1]):l-=a,l<0)throw"e";return i[0]=s,i[1]=o,i[2]=l,i[3]=u,n},e.decode._make_decoder=function(e){var t,i,a,r,n,s=[];for(t=16;0!=t&&!e[t];t--);var o=17;for(s[0]=t,a=i=1;i<=t;i++)for(r=0;r<e[i];r++,++o)for(n=0;n<1<<t-i;n++)a<=1<<t&&(s[a++]=i<<8|e[o]);return s},e.decode._decodeNewJPEG=function(t,i,a,r,n,s){r=Math.min(r,i.length-a);var o=t.t347,l=o?o.length:0,u=new Uint8Array(l+r);if(o){for(var h=0,c=0;c<l-1&&(255!=o[c]||217!=o[c+1]);c++)u[h++]=o[c];var d=i[a],f=i[a+1];255==d&&216==f||(u[h++]=d,u[h++]=f);for(c=2;c<r;c++)u[h++]=i[a+c]}else for(c=0;c<r;c++)u[c]=i[a+c];if(32803==t.t262[0]||7==t.t259[0]&&34892==t.t262[0]){var m=t.t258[0],p=e.LosslessJpegDecode(u),_=p.length;if(16==m)if(t.isLE)for(c=0;c<_;c++)n[s+(c<<1)]=255&p[c],n[s+(c<<1)+1]=p[c]>>>8;else for(c=0;c<_;c++)n[s+(c<<1)]=p[c]>>>8,n[s+(c<<1)+1]=255&p[c];else if(14==m||12==m||10==m){var g=16-m;for(c=0;c<_;c++)e.decode._putsF(n,c*m,p[c]<<g)}else{if(8!=m)throw new Error("unsupported bit depth "+m);for(c=0;c<_;c++)n[s+c]=p[c]}}else{var b=new e.JpegDecoder;b.parse(u);var y=b.getData({width:b.width,height:b.height,forceRGB:!0,isSourcePDF:!1});for(c=0;c<y.length;c++)n[s+c]=y[c]}6==t.t262[0]&&(t.t262[0]=2)},e.decode._decodeOldJPEGInit=function(e,t,a,r){var n,s,o,l,u,h=216,c=0,d=0,f=!1,m=e.t513,p=m?m[0]:0,_=e.t514,g=_?_[0]:0,b=e.t324||e.t273||m,y=e.t530,x=0,w=0,v=e.t277?e.t277[0]:1,k=e.t515;if(b&&(d=b[0],f=b.length>1),!f){if(255==t[a]&&t[a+1]==h)return{jpegOffset:a};if(null!=m&&(255==t[a+p]&&t[a+p+1]==h?c=a+p:i("JPEGInterchangeFormat does not point to SOI"),null==_?i("JPEGInterchangeFormatLength field is missing"):(p>=d||p+g<=d)&&i("JPEGInterchangeFormatLength field value is invalid"),null!=c))return{jpegOffset:c}}if(null!=y&&(x=y[0],w=y[1]),null!=m&&null!=_)if(g>=2&&p+g<=d){for(n=255==t[a+p+g-2]&&t[a+p+g-1]==h?new Uint8Array(g-2):new Uint8Array(g),o=0;o<n.length;o++)n[o]=t[a+p+o];i("Incorrect JPEG interchange format: using JPEGInterchangeFormat offset to derive tables")}else i("JPEGInterchangeFormat+JPEGInterchangeFormatLength > offset to first strip or tile");if(null==n){var M=0,I=[];I[M++]=255,I[M++]=h;var E=e.t519;if(null==E)throw new Error("JPEGQTables tag is missing");for(o=0;o<E.length;o++)for(I[M++]=255,I[M++]=219,I[M++]=0,I[M++]=67,I[M++]=o,l=0;l<64;l++)I[M++]=t[a+E[o]+l];for(u=0;u<2;u++){var S=e[0==u?"t520":"t521"];if(null==S)throw new Error((0==u?"JPEGDCTables":"JPEGACTables")+" tag is missing");for(o=0;o<S.length;o++){I[M++]=255,I[M++]=196;var P=19;for(l=0;l<16;l++)P+=t[a+S[o]+l];for(I[M++]=P>>>8,I[M++]=255&P,I[M++]=o|u<<4,l=0;l<16;l++)I[M++]=t[a+S[o]+l];for(l=0;l<P;l++)I[M++]=t[a+S[o]+16+l]}}if(I[M++]=255,I[M++]=192,I[M++]=0,I[M++]=8+3*v,I[M++]=8,I[M++]=e.height>>>8&255,I[M++]=255&e.height,I[M++]=e.width>>>8&255,I[M++]=255&e.width,I[M++]=v,1==v)I[M++]=1,I[M++]=17,I[M++]=0;else for(o=0;o<3;o++)I[M++]=o+1,I[M++]=0!=o?17:(15&x)<<4|15&w,I[M++]=o;null!=k&&0!=k[0]&&(I[M++]=255,I[M++]=221,I[M++]=0,I[M++]=4,I[M++]=k[0]>>>8&255,I[M++]=255&k[0]),n=new Uint8Array(I)}var T=-1;for(o=0;o<n.length-1;){if(255==n[o]&&192==n[o+1]){T=o;break}o++}if(-1==T){var C=new Uint8Array(n.length+10+3*v);C.set(n);var A=n.length;if(T=n.length,(n=C)[A++]=255,n[A++]=192,n[A++]=0,n[A++]=8+3*v,n[A++]=8,n[A++]=e.height>>>8&255,n[A++]=255&e.height,n[A++]=e.width>>>8&255,n[A++]=255&e.width,n[A++]=v,1==v)n[A++]=1,n[A++]=17,n[A++]=0;else for(o=0;o<3;o++)n[A++]=o+1,n[A++]=0!=o?17:(15&x)<<4|15&w,n[A++]=o}if(255==t[d]&&218==t[d+1]){var $=t[d+2]<<8|t[d+3];for((s=new Uint8Array($+2))[0]=t[d],s[1]=t[d+1],s[2]=t[d+2],s[3]=t[d+3],o=0;o<$-2;o++)s[o+4]=t[d+o+4]}else{var z=0;if((s=new Uint8Array(8+2*v))[z++]=255,s[z++]=218,s[z++]=0,s[z++]=6+2*v,s[z++]=v,1==v)s[z++]=1,s[z++]=0;else for(o=0;o<3;o++)s[z++]=o+1,s[z++]=o<<4|o;s[z++]=0,s[z++]=63,s[z++]=0}return{jpegOffset:a,tables:n,sosMarker:s,sofPosition:T}},e.decode._decodeOldJPEG=function(t,i,a,r,n,s){var o,l,u,h,c=e.decode._decodeOldJPEGInit(t,i,a,r);if(null!=c.jpegOffset)for(o=a+r-c.jpegOffset,u=new Uint8Array(o),m=0;m<o;m++)u[m]=i[c.jpegOffset+m];else{for(l=c.tables.length,(u=new Uint8Array(l+c.sosMarker.length+r+2)).set(c.tables),h=l,u[c.sofPosition+5]=t.height>>>8&255,u[c.sofPosition+6]=255&t.height,u[c.sofPosition+7]=t.width>>>8&255,u[c.sofPosition+8]=255&t.width,255==i[a]&&i[a+1]==SOS||(u.set(c.sosMarker,h),h+=sosMarker.length),m=0;m<r;m++)u[h++]=i[a+m];u[h++]=255,u[h++]=EOI}var d=new e.JpegDecoder;d.parse(u);for(var f=d.getData({width:d.width,height:d.height,forceRGB:!0,isSourcePDF:!1}),m=0;m<f.length;m++)n[s+m]=f[m];t.t262&&6==t.t262[0]&&(t.t262[0]=2)},e.decode._decodePackBits=function(e,t,i,a,r){for(var n=new Int8Array(e.buffer),s=new Int8Array(a.buffer),o=t+i;t<o;){var l=n[t];if(t++,l>=0&&l<128)for(var u=0;u<l+1;u++)s[r]=n[t],r++,t++;if(l>=-127&&l<0){for(u=0;u<1-l;u++)s[r]=n[t],r++;t++}}return r},e.decode._decodeThunder=function(e,t,i,a,r){for(var n=[0,1,0,-1],s=[0,1,2,3,0,-3,-2,-1],o=t+i,l=2*r,u=0;t<o;){var h=e[t],c=h>>>6,d=63&h;if(t++,3==c&&(u=15&d,a[l>>>1]|=u<<4*(1-l&1),l++),0==c)for(var f=0;f<d;f++)a[l>>>1]|=u<<4*(1-l&1),l++;if(2==c)for(f=0;f<2;f++){4!=(m=d>>>3*(1-f)&7)&&(u+=s[m],a[l>>>1]|=u<<4*(1-l&1),l++)}if(1==c)for(f=0;f<3;f++){var m;2!=(m=d>>>2*(2-f)&3)&&(u+=n[m],a[l>>>1]|=u<<4*(1-l&1),l++)}}},e.decode._dmap={1:0,"011":1,"000011":2,"0000011":3,"010":-1,"000010":-2,"0000010":-3},e.decode._lens=function(){var e=function(e,t,i,a){for(var r=0;r<t.length;r++)e[t[r]]=i+r*a},t="00110101,000111,0111,1000,1011,1100,1110,1111,10011,10100,00111,01000,001000,000011,110100,110101,101010,101011,0100111,0001100,0001000,0010111,0000011,0000100,0101000,0101011,0010011,0100100,0011000,00000010,00000011,00011010,00011011,00010010,00010011,00010100,00010101,00010110,00010111,00101000,00101001,00101010,00101011,00101100,00101101,00000100,00000101,00001010,00001011,01010010,01010011,01010100,01010101,00100100,00100101,01011000,01011001,01011010,01011011,01001010,01001011,00110010,00110011,00110100",i="0000110111,010,11,10,011,0011,0010,00011,000101,000100,0000100,0000101,0000111,00000100,00000111,000011000,0000010111,0000011000,0000001000,00001100111,00001101000,00001101100,00000110111,00000101000,00000010111,00000011000,000011001010,000011001011,000011001100,000011001101,000001101000,000001101001,000001101010,000001101011,000011010010,000011010011,000011010100,000011010101,000011010110,000011010111,000001101100,000001101101,000011011010,000011011011,000001010100,000001010101,000001010110,000001010111,000001100100,000001100101,000001010010,000001010011,000000100100,000000110111,000000111000,000000100111,000000101000,000001011000,000001011001,000000101011,000000101100,000001011010,000001100110,000001100111",a="11011,10010,010111,0110111,00110110,00110111,01100100,01100101,01101000,01100111,011001100,011001101,011010010,011010011,011010100,011010101,011010110,011010111,011011000,011011001,011011010,011011011,010011000,010011001,010011010,011000,010011011",r="0000001111,000011001000,000011001001,000001011011,000000110011,000000110100,000000110101,0000001101100,0000001101101,0000001001010,0000001001011,0000001001100,0000001001101,0000001110010,0000001110011,0000001110100,0000001110101,0000001110110,0000001110111,0000001010010,0000001010011,0000001010100,0000001010101,0000001011010,0000001011011,0000001100100,0000001100101",n="00000001000,00000001100,00000001101,000000010010,000000010011,000000010100,000000010101,000000010110,000000010111,000000011100,000000011101,000000011110,000000011111";t=t.split(","),i=i.split(","),a=a.split(","),r=r.split(","),n=n.split(",");var s={},o={};return e(s,t,0,1),e(s,a,64,64),e(s,n,1792,64),e(o,i,0,1),e(o,r,64,64),e(o,n,1792,64),[s,o]}(),e.decode._decodeG4=function(t,i,a,r,n,s,o){for(var l=e.decode,u=i<<3,h=0,c="",d=[],f=[],m=0;m<s;m++)f.push(0);f=l._makeDiff(f);for(var p=0,_=0,g=0,b=0,y=0,x=0,w="",v=0,k=8*Math.ceil(s/8);u>>>3<i+a;){g=l._findDiff(f,p+(0==p?0:1),1-y),b=l._findDiff(f,g,y);var M=0;if(1==o&&(M=t[u>>>3]>>>7-(7&u)&1),2==o&&(M=t[u>>>3]>>>(7&u)&1),u++,c+=M,"H"==w){if(null!=l._lens[y][c]){var I=l._lens[y][c];c="",h+=I,I<64&&(l._addNtimes(d,h,y),p+=h,y=1-y,h=0,0==--v&&(w=""))}}else"0001"==c&&(c="",l._addNtimes(d,b-p,y),p=b),"001"==c&&(c="",w="H",v=2),null!=l._dmap[c]&&(_=g+l._dmap[c],l._addNtimes(d,_-p,y),p=_,c="",y=1-y);d.length==s&&""==w&&(l._writeBits(d,r,8*n+x*k),y=0,x++,p=0,f=l._makeDiff(d),d=[])}},e.decode._findDiff=function(e,t,i){for(var a=0;a<e.length;a+=2)if(e[a]>=t&&e[a+1]==i)return e[a]},e.decode._makeDiff=function(e){var t=[];1==e[0]&&t.push(0,1);for(var i=1;i<e.length;i++)e[i-1]!=e[i]&&t.push(i,e[i]);return t.push(e.length,0,e.length,1),t},e.decode._decodeG2=function(t,i,a,r,n,s,o){for(var l=e.decode,u=i<<3,h=0,c="",d=[],f=0,m=0,p=8*Math.ceil(s/8);u>>>3<i+a;){var _=0;1==o&&(_=t[u>>>3]>>>7-(7&u)&1),2==o&&(_=t[u>>>3]>>>(7&u)&1),u++,c+=_,null!=(h=l._lens[f][c])&&(l._addNtimes(d,h,f),c="",h<64&&(f=1-f),d.length==s&&(l._writeBits(d,r,8*n+m*p),d=[],m++,f=0,7&u&&(u+=8-(7&u)),h>=64&&(u+=8)))}},e.decode._decodeG3=function(t,i,a,r,n,s,o,l){for(var u=e.decode,h=i<<3,c=0,d="",f=[],m=[],p=0;p<s;p++)f.push(0);for(var _=0,g=0,b=0,y=0,x=0,w=-1,v="",k=0,M=!0,I=8*Math.ceil(s/8);h>>>3<i+a;){b=u._findDiff(m,_+(0==_?0:1),1-x),y=u._findDiff(m,b,x);var E=0;if(1==o&&(E=t[h>>>3]>>>7-(7&h)&1),2==o&&(E=t[h>>>3]>>>(7&h)&1),h++,d+=E,M){if(null!=u._lens[x][d]){var S=u._lens[x][d];d="",c+=S,S<64&&(u._addNtimes(f,c,x),x=1-x,c=0)}}else if("H"==v){if(null!=u._lens[x][d]){S=u._lens[x][d];d="",c+=S,S<64&&(u._addNtimes(f,c,x),_+=c,x=1-x,c=0,0==--k&&(v=""))}}else"0001"==d&&(d="",u._addNtimes(f,y-_,x),_=y),"001"==d&&(d="",v="H",k=2),null!=u._dmap[d]&&(g=b+u._dmap[d],u._addNtimes(f,g-_,x),_=g,d="",x=1-x);d.endsWith("000000000001")&&(w>=0&&u._writeBits(f,r,8*n+w*I),l&&(1==o&&(M=1==(t[h>>>3]>>>7-(7&h)&1)),2==o&&(M=1==(t[h>>>3]>>>(7&h)&1)),h++),d="",x=0,w++,_=0,m=u._makeDiff(f),f=[])}f.length==s&&u._writeBits(f,r,8*n+w*I)},e.decode._addNtimes=function(e,t,i){for(var a=0;a<t;a++)e.push(i)},e.decode._writeBits=function(e,t,i){for(var a=0;a<e.length;a++)t[i+a>>>3]|=e[a]<<7-(i+a&7)},e.decode._decodeLZW=e.decode._decodeLZW=(o=0,l=0,u=0,h=0,c=function(){var e=a>>>3,t=(r[e]<<16|r[e+1]<<8|r[e+2])>>>24-(7&a)-l&(1<<l)-1;return a+=l,t},d=new Uint32Array(16384),f=0,m=function(e){l=e+1,o=h+1},p=function(e){for(var t=e<<2,i=d[t+2],a=s+i-1;65535!=t;)n[a--]=d[t],t=d[t+1];s+=i},_=function(e,t){var i=o<<2,a=e<<2;d[i]=d[3+(t<<2)],d[i+1]=a,d[i+2]=d[a+2]+1,d[i+3]=d[a+3],1+ ++o==1<<l&&12!=l&&l++},function(e,t,i,l,g,b){a=t<<3,r=e,n=l,s=g;var y=t+i<<3,x=0,w=0;for(function(e){if(e!=f){f=e,h=1+(u=1<<e);for(var t=0;t<h+1;t++)d[4*t]=d[4*t+3]=t,d[4*t+1]=65535,d[4*t+2]=1}}(b),m(b);a<y&&(x=c())!=h;){if(x==u){if(m(b),(x=c())==h)break;p(x)}else x<o?(p(x),_(w,x)):(_(w,w),p(o-1));w=x}return s}),e.tags={},e._types=function(){var e=new Array(250);e.fill(0);return{basic:{main:e=e.concat([0,0,0,0,4,3,3,3,3,3,0,0,3,0,0,0,3,0,0,2,2,2,2,4,3,0,0,3,4,4,3,3,5,5,3,2,5,5,0,0,0,0,4,4,0,0,3,3,0,0,0,0,0,0,0,2,2,0,0,0,0,0,0,0,0,2,2,3,5,5,3,0,3,3,4,4,4,3,4,0,0,0,0,0,0,0,0,0,3,3,0,0,0,0,0,0,0,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),rest:{33432:2,33434:5,33437:5,34665:4,34850:3,34853:4,34855:3,34864:3,34866:4,36864:7,36867:2,36868:2,37121:7,37377:10,37378:5,37380:10,37381:5,37383:3,37384:3,37385:3,37386:5,37510:7,37520:2,37521:2,37522:2,40960:7,40961:3,40962:4,40963:4,40965:4,41486:5,41487:5,41488:3,41985:3,41986:3,41987:3,41988:5,41989:3,41990:3,41993:3,41994:3,41995:7,41996:3,42032:2,42033:2,42034:5,42036:2,42037:2,59932:7}},gps:{main:[1,2,5,2,5,1,5,5,0,9],rest:{18:2,29:2}}}}(),e._readIFD=function(t,a,r,n,s,o){var l=t.readUshort(a,r);r+=2;var u={};o.debug&&i("   ".repeat(s),n.length-1,">>>----------------");for(var h=0;h<l;h++){var c=t.readUshort(a,r);r+=2;var d=t.readUshort(a,r);r+=2;var f=t.readUint(a,r);r+=4;var m=t.readUint(a,r);r+=4;var p=[];if(1==d||7==d){var _=f<5?r-4:m;_+f>a.buffer.byteLength&&(f=a.buffer.byteLength-_),p=new Uint8Array(a.buffer,_,f)}if(2==d){var g=f<5?r-4:m,b=a[g],y=Math.max(0,Math.min(f-1,a.length-g));b<128||0==y?p.push(t.readASCII(a,g,y)):p=new Uint8Array(a.buffer,g,y)}if(3==d)for(var x=0;x<f;x++)p.push(t.readUshort(a,(f<3?r-4:m)+2*x));if(4==d||13==d)for(x=0;x<f;x++)p.push(t.readUint(a,(f<2?r-4:m)+4*x));if(5==d||10==d){var w=5==d?t.readUint:t.readInt;for(x=0;x<f;x++)p.push([w(a,m+8*x),w(a,m+8*x+4)])}if(8==d)for(x=0;x<f;x++)p.push(t.readShort(a,(f<3?r-4:m)+2*x));if(9==d)for(x=0;x<f;x++)p.push(t.readInt(a,(f<2?r-4:m)+4*x));if(11==d)for(x=0;x<f;x++)p.push(t.readFloat(a,m+4*x));if(12==d)for(x=0;x<f;x++)p.push(t.readDouble(a,m+8*x));if(0==f||0!=p.length){if(o.debug&&i("   ".repeat(s),c,d,e.tags[c],p),u["t"+c]=p,330==c&&u.t272&&"DSLR-A100"==u.t272[0]);else if(330==c||34665==c||34853==c||50740==c&&t.readUshort(a,t.readUint(p,0))<300||61440==c){var v=50740==c?[t.readUint(p,0)]:p,k=[];for(x=0;x<v.length;x++)e._readIFD(t,a,v[x],k,s+1,o);330==c&&(u.subIFD=k),34665==c&&(u.exifIFD=k[0]),34853==c&&(u.gpsiIFD=k[0]),50740==c&&(u.dngPrvt=k[0]),61440==c&&(u.fujiIFD=k[0])}if(37500==c&&o.parseMN){var M=p;if("Nikon"==t.readASCII(M,0,5))u.makerNote=e.decode(M.slice(10).buffer)[0];else if("OLYMP"==t.readASCII(M,0,5)||"OM SYSTEM"==t.readASCII(M,0,9)){var I=[8208,8224,8240,8256,8272],E=[];e._readIFD(t,M,77==M[1]?16:85==M[5]?12:8,E,s+1,o);var S=u.makerNote=E.pop();for(x=0;x<I.length;x++){var P="t"+I[x];null!=S[P]&&(e._readIFD(t,M,S[P][0],E,s+1,o),S[P]=E.pop())}S.t12288&&(e._readIFD(t,S.t12288,0,E,s+1,o),S.t12288=E.pop())}else if(t.readUshort(a,m)<300&&t.readUshort(a,m+4)<=12){E=[];e._readIFD(t,a,m,E,s+1,o),u.makerNote=E[0]}}}else if(i(c,"unknown TIFF tag type: ",d,"num:",f),0==h)return}return n.push(u),o.debug&&i("   ".repeat(s),"<<<---------------"),r},e._writeIFD=function(t,i,a,r,n){var s=Object.keys(n),o=s.length;n.exifIFD&&o--,n.gpsiIFD&&o--,t.writeUshort(a,r,o);for(var l=(r+=2)+12*o+4,u=0;u<s.length;u++){var h=s[u];if("t34665"!=h&&"t34853"!=h){"exifIFD"==h&&(h="t34665"),"gpsiIFD"==h&&(h="t34853");var c=parseInt(h.slice(1)),d=i.main[c];if(null==d&&(d=i.rest[c]),null==d||0==d)throw new Error("unknown type of tag: "+c);var f=n[h];if(34665==c)f=[l],l=e._writeIFD(t,i,a,l,n.exifIFD)[1];if(34853==c)f=[l],l=e._writeIFD(t,e._types.gps,a,l,n.gpsiIFD)[1];2==d&&(f=f[0]+"\0");var m=f.length;t.writeUshort(a,r,c),r+=2,t.writeUshort(a,r,d),r+=2,t.writeUint(a,r,m);var p=[-1,1,1,2,4,8,0,1,0,4,8,0,8][d]*m,_=r+=4;if(p>4&&(t.writeUint(a,r,l),_=l),1==d||7==d)for(var g=0;g<m;g++)a[_+g]=f[g];else if(2==d)t.writeASCII(a,_,f);else if(3==d)for(g=0;g<m;g++)t.writeUshort(a,_+2*g,f[g]);else if(4==d)for(g=0;g<m;g++)t.writeUint(a,_+4*g,f[g]);else if(5==d||10==d){var b=5==d?t.writeUint:t.writeInt;for(g=0;g<m;g++){var y=f[g],x=y[0],w=y[1];if(null==x)throw"e";b(a,_+8*g,x),b(a,_+8*g+4,w)}}else if(9==d)for(g=0;g<m;g++)t.writeInt(a,_+4*g,f[g]);else{if(12!=d)throw d;for(g=0;g<m;g++)t.writeDouble(a,_+8*g,f[g])}p>4&&(l+=p+=1&p),r+=4}}return[r,l]},e.toRGBA8=function(e,t){function a(e){return e<.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055}var r=e.width,n=e.height,s=r*n,o=e.data,l=new Uint8Array(4*s),u=e.t262?e.t262[0]:2,h=e.t258?Math.min(32,e.t258[0]):1;null==e.t262&&1==h&&(u=0);var c=e.t277?e.t277[0]:e.t258?e.t258.length:[1,1,3,1,1,4,3][u],d=e.t339?e.t339[0]:null;if(1==u&&32==h&&3!=d)throw"e";var f=Math.ceil(c*h*r/8);if(0==u){t=1/256;for(var m=0;m<n;m++){var p=m*f,_=m*r;if(1==h)for(var g=0;g<r;g++){var b=_+g<<2,y=o[p+(g>>3)]>>7-(7&g)&1;l[b]=l[b+1]=l[b+2]=255*(1-y),l[b+3]=255}if(4==h)for(g=0;g<r;g++){b=_+g<<2,y=o[p+(g>>1)]>>4-4*(1&g)&15;l[b]=l[b+1]=l[b+2]=17*(15-y),l[b+3]=255}if(8==h)for(g=0;g<r;g++){b=_+g<<2,y=o[p+g];l[b]=l[b+1]=l[b+2]=255-y,l[b+3]=255}if(16==h)for(g=0;g<r;g++){b=_+g<<2,y=o[(w=p+2*g)+1]<<8|o[w];l[b]=l[b+1]=l[b+2]=Math.min(255,255-~~(y*t)),l[b+3]=255}}}else if(1==u){null==t&&(t=1/256);var x=3&o.length?null:new Float32Array(o.buffer);for(m=0;m<n;m++){p=m*f,_=m*r;if(1==h)for(g=0;g<r;g++){b=_+g<<2,y=o[p+(g>>3)]>>7-(7&g)&1;l[b]=l[b+1]=l[b+2]=255*y,l[b+3]=255}if(2==h)for(g=0;g<r;g++){b=_+g<<2,y=o[p+(g>>2)]>>6-2*(3&g)&3;l[b]=l[b+1]=l[b+2]=85*y,l[b+3]=255}if(8==h)for(g=0;g<r;g++){b=_+g<<2,y=o[p+g*c];l[b]=l[b+1]=l[b+2]=y,l[b+3]=255}if(16==h)for(g=0;g<r;g++){b=_+g<<2,y=o[(w=p+2*g)+1]<<8|o[w];l[b]=l[b+1]=l[b+2]=Math.min(255,~~(y*t)),l[b+3]=255}if(32==h)for(g=0;g<r;g++){var w;b=_+g<<2,y=x[w=(p>>>2)+g];l[b]=l[b+1]=l[b+2]=~~(.5+255*y),l[b+3]=255}}}else if(2==u)if(8==h){if(1==c)for(g=0;g<s;g++)l[4*g]=l[4*g+1]=l[4*g+2]=o[g],l[4*g+3]=255;if(3==c)for(g=0;g<s;g++){var v=3*g;l[b=g<<2]=o[v],l[b+1]=o[v+1],l[b+2]=o[v+2],l[b+3]=255}if(c>=4)for(g=0;g<s;g++){v=g*c;l[b=g<<2]=o[v],l[b+1]=o[v+1],l[b+2]=o[v+2],l[b+3]=o[v+3]}}else if(16==h){if(4==c)for(g=0;g<s;g++){v=8*g+1;l[b=g<<2]=o[v],l[b+1]=o[v+2],l[b+2]=o[v+4],l[b+3]=o[v+6]}if(3==c)for(g=0;g<s;g++){v=6*g+1;l[b=g<<2]=o[v],l[b+1]=o[v+2],l[b+2]=o[v+4],l[b+3]=255}}else{if(32!=h)throw h;var k=new Float32Array(o.buffer),M=0;for(g=0;g<k.length;g++)M=Math.min(M,k[g]);if(M<0)for(g=0;g<o.length;g+=4){var I=o[g];o[g]=o[g+3],o[g+3]=I,I=o[g+1],o[g+1]=o[g+2],o[g+2]=I}var E=[];for(g=0;g<65536;g++)E.push(a(g/65535));for(g=0;g<k.length;g++){var S=Math.max(0,Math.min(1,k[g]));k[g]=E[~~(.5+65535*S)]}if(3==c)for(g=0;g<s;g++){v=3*g;l[b=g<<2]=~~(.5+255*k[v]),l[b+1]=~~(.5+255*k[v+1]),l[b+2]=~~(.5+255*k[v+2]),l[b+3]=255}else{if(4!=c)throw c;for(g=0;g<s;g++){v=4*g;l[b=g<<2]=~~(.5+255*k[v]),l[b+1]=~~(.5+255*k[v+1]),l[b+2]=~~(.5+255*k[v+2]),l[b+3]=~~(.5+255*k[v+3])}}}else if(3==u){var P=e.t320,T=1<<h,C=8==h&&c>1&&e.t338&&0!=e.t338[0];for(m=0;m<n;m++)for(var A=0;A<r;A++){b=(g=m*r+A)<<2;var $=0,z=m*f;if(1==h)$=o[z+(A>>>3)]>>>7-(7&A)&1;else if(2==h)$=o[z+(A>>>2)]>>>6-2*(3&A)&3;else if(4==h)$=o[z+(A>>>1)]>>>4-4*(1&A)&15;else{if(8!=h)throw h;$=o[z+A*c]}l[b]=P[$]>>8,l[b+1]=P[T+$]>>8,l[b+2]=P[T+T+$]>>8,l[b+3]=C?o[z+A*c+1]:255}}else if(5==u){var B=c>4?1:0;for(g=0;g<s;g++){b=g<<2;var F=g*c;if(window.UDOC){var R=o[F],D=o[F+1],N=o[F+2],Z=o[F+3],O=UDOC.C.cmykToRgb([R*(1/255),D*(1/255),N*(1/255),Z*(1/255)]);l[b]=~~(.5+255*O[0]),l[b+1]=~~(.5+255*O[1]),l[b+2]=~~(.5+255*O[2])}else{R=255-o[F],D=255-o[F+1],N=255-o[F+2],Z=(255-o[F+3])*(1/255);l[b]=~~(R*Z+.5),l[b+1]=~~(D*Z+.5),l[b+2]=~~(N*Z+.5)}l[b+3]=255*(1-B)+o[F+4]*B}}else if(6==u&&e.t278){var L=e.t278[0];for(m=0;m<n;m+=L){g=m*r;for(var U=L*r,G=0;G<U;G++){b=4*(g+G),N=o[(F=3*g+4*(G>>>1))+(1&G)];var Q=o[F+2]-128,j=o[F+3]-128,H=N+((j>>2)+(j>>3)+(j>>5)),W=N-((Q>>2)+(Q>>4)+(Q>>5))-((j>>1)+(j>>3)+(j>>4)+(j>>5)),q=N+(Q+(Q>>1)+(Q>>2)+(Q>>6));l[b]=Math.max(0,Math.min(255,H)),l[b+1]=Math.max(0,Math.min(255,W)),l[b+2]=Math.max(0,Math.min(255,q)),l[b+3]=255}}}else if(32845==u)for(m=0;m<n;m++)for(A=0;A<r;A++){b=4*(m*r+A);var V=o[(F=6*(m*r+A))+1]<<8|o[F],K=(V=Math.pow(2,(V+.5)/256-64),(o[F+3]+.5)/410),Y=(o[F+5]+.5)/410,X=9*K/(6*K-16*Y+12),J=4*Y/(6*K-16*Y+12),ee=X*V/J,te=(1-X-J)*V/J;H=2.69*ee-1.276*(N=V)-.414*te,W=-1.022*ee+1.978*N+.044*te,q=.061*ee-.224*N+1.163*te;l[b]=255*a(Math.min(H,1)),l[b+1]=255*a(Math.min(W,1)),l[b+2]=255*a(Math.min(q,1)),l[b+3]=255}else i("Unknown Photometric interpretation: "+u);return l},e.replaceIMG=function(t){null==t&&(t=document.getElementsByTagName("img"));for(var i=["tif","tiff","dng","cr2","nef"],a=0;a<t.length;a++){var r=t[a],n=r.getAttribute("src");if(null!=n){var s=n.split(".").pop().toLowerCase();if(-1!=i.indexOf(s)){var o=new XMLHttpRequest;e._xhrs.push(o),e._imgs.push(r),o.open("GET",n),o.responseType="arraybuffer",o.onload=e._imgLoaded,o.send()}}}},e._xhrs=[],e._imgs=[],e._imgLoaded=function(t){var i=e._xhrs.indexOf(t.target),a=e._imgs[i];e._xhrs.splice(i,1),e._imgs.splice(i,1),a.setAttribute("src",e.bufferToURI(t.target.response))},e.bufferToURI=function(t){var i=e.decode(t),a=i,r=0,n=a[0];i[0].subIFD&&(a=a.concat(i[0].subIFD));for(var s=0;s<a.length;s++){var o=a[s];if(!(null==o.t258||o.t258.length<3)){var l=o.t256*o.t257;l>r&&(r=l,n=o)}}e.decodeImage(t,n,i);var u=e.toRGBA8(n),h=n.width,c=n.height,d=document.createElement("canvas");d.width=h,d.height=c;var f=d.getContext("2d"),m=new ImageData(new Uint8ClampedArray(u.buffer),h,c);return f.putImageData(m,0,0),d.toDataURL()},e._binBE={nextZero:function(e,t){for(;0!=e[t];)t++;return t},readUshort:function(e,t){return e[t]<<8|e[t+1]},readShort:function(t,i){var a=e._binBE.ui8;return a[0]=t[i+1],a[1]=t[i+0],e._binBE.i16[0]},readInt:function(t,i){var a=e._binBE.ui8;return a[0]=t[i+3],a[1]=t[i+2],a[2]=t[i+1],a[3]=t[i+0],e._binBE.i32[0]},readUint:function(t,i){var a=e._binBE.ui8;return a[0]=t[i+3],a[1]=t[i+2],a[2]=t[i+1],a[3]=t[i+0],e._binBE.ui32[0]},readASCII:function(e,t,i){for(var a="",r=0;r<i;r++)a+=String.fromCharCode(e[t+r]);return a},readFloat:function(t,i){for(var a=e._binBE.ui8,r=0;r<4;r++)a[r]=t[i+3-r];return e._binBE.fl32[0]},readDouble:function(t,i){for(var a=e._binBE.ui8,r=0;r<8;r++)a[r]=t[i+7-r];return e._binBE.fl64[0]},writeUshort:function(e,t,i){e[t]=i>>8&255,e[t+1]=255&i},writeInt:function(t,i,a){var r=e._binBE.ui8;e._binBE.i32[0]=a,t[i+3]=r[0],t[i+2]=r[1],t[i+1]=r[2],t[i+0]=r[3]},writeUint:function(e,t,i){e[t]=i>>24&255,e[t+1]=i>>16&255,e[t+2]=i>>8&255,e[t+3]=255&i},writeASCII:function(e,t,i){for(var a=0;a<i.length;a++)e[t+a]=i.charCodeAt(a)},writeDouble:function(t,i,a){e._binBE.fl64[0]=a;for(var r=0;r<8;r++)t[i+r]=e._binBE.ui8[7-r]}},e._binBE.ui8=new Uint8Array(8),e._binBE.i16=new Int16Array(e._binBE.ui8.buffer),e._binBE.i32=new Int32Array(e._binBE.ui8.buffer),e._binBE.ui32=new Uint32Array(e._binBE.ui8.buffer),e._binBE.fl32=new Float32Array(e._binBE.ui8.buffer),e._binBE.fl64=new Float64Array(e._binBE.ui8.buffer),e._binLE={nextZero:e._binBE.nextZero,readUshort:function(e,t){return e[t+1]<<8|e[t]},readShort:function(t,i){var a=e._binBE.ui8;return a[0]=t[i+0],a[1]=t[i+1],e._binBE.i16[0]},readInt:function(t,i){var a=e._binBE.ui8;return a[0]=t[i+0],a[1]=t[i+1],a[2]=t[i+2],a[3]=t[i+3],e._binBE.i32[0]},readUint:function(t,i){var a=e._binBE.ui8;return a[0]=t[i+0],a[1]=t[i+1],a[2]=t[i+2],a[3]=t[i+3],e._binBE.ui32[0]},readASCII:e._binBE.readASCII,readFloat:function(t,i){for(var a=e._binBE.ui8,r=0;r<4;r++)a[r]=t[i+r];return e._binBE.fl32[0]},readDouble:function(t,i){for(var a=e._binBE.ui8,r=0;r<8;r++)a[r]=t[i+r];return e._binBE.fl64[0]},writeUshort:function(e,t,i){e[t]=255&i,e[t+1]=i>>8&255},writeInt:function(t,i,a){var r=e._binBE.ui8;e._binBE.i32[0]=a,t[i+0]=r[0],t[i+1]=r[1],t[i+2]=r[2],t[i+3]=r[3]},writeUint:function(e,t,i){e[t]=i>>>0&255,e[t+1]=i>>>8&255,e[t+2]=i>>>16&255,e[t+3]=i>>>24&255},writeASCII:e._binBE.writeASCII},e._copyTile=function(e,t,i,a,r,n,s,o){for(var l=Math.min(t,r-s),u=Math.min(i,n-o),h=0;h<u;h++)for(var c=(o+h)*r+s,d=h*t,f=0;f<l;f++)a[c+f]=e[d+f]},e.LosslessJpegDecode=function(){var e,t;function i(){return e[t++]}function a(){return e[t++]<<8|e[t++]}function r(e){for(var t=i(),a=[0,0,0,255],r=[],s=0;s<16;s++)r[s]=i();for(s=0;s<16;s++)for(var o=0;o<r[s];o++){a[n(a,0,s+1,1)+3]=i()}var l=new Uint8Array(256);e[t]=[new Uint8Array(a),l];for(s=0;s<256;s++){for(var u=8,h=s,c=0;255==a[c+3]&&0!=u;)c=a[c+(h>>--u&1)];l[s]=c}}function n(e,t,i,a){if(255!=e[t+3])return 0;if(0==i)return t;for(var r=0;r<2;r++){0==e[t+r]&&(e[t+r]=e.length,e.push(0,0,a,255));var s=n(e,e[t+r],i-1,a+1);if(0!=s)return s}return 0}function s(e){for(var t=e.b,i=e.f;t<25&&e.a<e.d;){var a=e.data[e.a++];255!=a||e.c||e.a++,i=i<<8|a,t+=8}if(t<0)throw"e";e.b=t,e.f=i}function o(e,t){return t.b<e&&s(t),t.f>>(t.b-=e)&65535>>16-e}function l(e,t){var i=e[0],a=0,r=255;t.b<16&&s(t);var n=t.f>>t.b-8&255;for(r=i[(a=e[1][n])+3],t.b-=i[a+2];255==r;)r=i[(a=i[a+(t.f>>--t.b&1)])+3];return r}function u(e,t){return e<32768>>16-t&&(e+=1-(1<<t)),e}function h(e,t){var i=l(e,t);return 0==i?0:16==i?-32768:u(o(i,t),i)}function c(e,t,i,a,r,n){for(var s=0,o=0;o<n;o++){for(var l=o*t,u=0;u<t;u+=r){s++;for(var c=0;c<r;c++)e[l+u+c]=h(a[c],i)}if(0!=i.e&&s%i.e==0&&0!=o){for(var d=i.a,f=i.data;255!=f[d]||!(208<=f[d+1]&&f[d+1]<=215);)d--;i.a=d+2,i.f=0,i.b=0}}}function d(e,t){return u(o(e,t),e)}function f(e,t,i,a,r,n,s,o){for(var l=i*s,u=r;u<n;u++)e[u]+=1<<o-1;for(var h=s;h<l;h+=s)for(u=r;u<n;u++)e[h+u]+=e[h+u-s];for(var c=1;c<a;c++){var d=c*l;for(u=r;u<n;u++)e[d+u]+=e[d+u-l];for(h=s;h<l;h+=s)for(u=r;u<n;u++){var f=d+h+u,m=f-l,p=e[f-s],_=0;if(0==t)_=0;else if(1==t)_=p;else if(2==t)_=e[m];else if(3==t)_=e[m-s];else if(4==t)_=p+(e[m]-e[m-s]);else if(5==t)_=p+(e[m]-e[m-s]>>>1);else if(6==t)_=e[m]+(p-e[m-s]>>>1);else{if(7!=t)throw t;_=p+e[m]>>>1}e[f]+=_}}}return function(n){if(e=n,t=0,65496!=a())throw"e";for(var s=[],o=0,u=0,h=0,m=[],p=[],_=[],g=0,b=0,y=0;;){var x=a();if(65535!=x){var w=a();if(65475==x){u=i(),b=a(),y=a(),g=i();for(var v=0;v<g;v++){var k=i(),M=i();if(0!=i())throw"e";s[k]=[v,M>>4,15&M]}}else if(65476==x)for(var I=t+w-2;t<I;)r(p);else{if(65498==x){t++;for(v=0;v<g;v++){var E=s[i()];_[E[0]]=p[i()>>>4],m[E[0]]=E.slice(1)}o=i(),t+=2;break}65501==x?h=a():t+=w-2}}else t--}var S=new(u>8?Uint16Array:Uint8Array)(b*y*g),P={b:0,f:0,c:8==o,a:t,data:e,d:e.length,e:h};if(P.c)!function(i,a,r,n,s){for(var o=e.length-t,u=0;u<o;u+=4){var h=e[t+u];e[t+u]=e[t+u+3],e[t+u+3]=h,h=e[t+u+1],e[t+u+1]=e[t+u+2],e[t+u+2]=h}for(var c=0;c<s;c++)for(var f=32768,m=32768,p=0;p<a;p+=2){var _=l(n,r),g=l(n,r);0!=_&&(f+=d(_,r)),0!=g&&(m+=d(g,r)),i[c*a+p]=65535&f,i[c*a+p+1]=65535&m}}(S,y*g,P,_[0],b);else{var T=[],C=0,A=0;for(v=0;v<g;v++){var $=m[v];(U=$[0])>C&&(C=U),(L=$[1])>A&&(A=L),T.push(U*L)}if(1!=C||1!=A){if(3!=g||1!=T[1]||1!=T[2])throw"e";if(2!=C||1!=A&&2!=A)throw"e";var z=[],B=0;for(v=0;v<g;v++){for(var F=0;F<T[v];F++)z.push(_[v]);B+=T[v]}var R=y/C,D=b/A,N=R*D;c(S,R*B,P,z,B,D),f(S,o,R,D,B-2,B,B,u);var Z=new Uint16Array(N*T[0]);if(2==C&&2==A){for(v=0;v<N;v++)Z[4*v]=S[6*v],Z[4*v+1]=S[6*v+1],Z[4*v+2]=S[6*v+2],Z[4*v+3]=S[6*v+3];f(Z,o,4*R,D,0,1,1,u);for(v=0;v<N;v++)S[6*v]=Z[4*v],S[6*v+1]=Z[4*v+1],S[6*v+2]=Z[4*v+2],S[6*v+3]=Z[4*v+3]}if(2==C&&1==A){for(v=0;v<N;v++)Z[2*v]=S[4*v],Z[2*v+1]=S[4*v+1];f(Z,o,2*R,D,0,1,1,u);for(v=0;v<N;v++)S[4*v]=Z[2*v],S[4*v+1]=Z[2*v+1]}for(var O=S.slice(0),L=0;L<b;L++)if(2==A)for(var U=0;U<y;U++){var G=((L>>>1)*R+(U>>>1))*B,Q=2*(1&L)+(1&U);S[j=(L*y+U)*g]=O[G+Q],S[j+1]=O[G+4],S[j+2]=O[G+5]}else for(U=0;U<y;U++){var j;G=(L*R+(U>>>1))*B,Q=1&U;S[j=(L*y+U)*g]=O[G+Q],S[j+1]=O[G+2],S[j+2]=O[G+3]}}else if(c(S,y*g,P,_,g,b),0==h)f(S,o,y,b,0,g,g,u);else{var H=Math.floor(h/y);for(L=0;L<b;L+=H){var W=S.slice(L*y*g,(L+H)*y*g);f(W,o,y,H,0,g,g,u),S.set(W,L*y*g)}}}return S}}(),function(){var t=5,i=6,a=13,r=14;function n(e){var t={c:new Int8Array(2<<e.u)};return function(e,t,i){var a=[t,3*t+18,5*t+67,7*t+276,i];e.o=t,e.w=(a[4]+2*t)/(2*t+1)+1|0,e.v=Math.ceil(Math.log2(e.w)),e.t=9,function(e,t){for(var i=-t[4],a=0;i<=t[4];a++,i++)e[a]=i<=-t[3]?-4:i<=-t[2]?-3:i<=-t[1]?-2:i<-t[0]?-1:i<=t[0]?0:i<t[1]?1:i<t[2]?2:i<t[3]?3:4}(e.c,a)}(t,0,e.g),t}function s(e){for(var t=[[],[],[]],i=Math.max(2,e.w+32>>>6),a=0;a<3;a++)for(var r=0;r<41;r++)t[a][r]=[i,1];return t}function o(e,t){var i=0,a=8-e.a;if(e.j,e.a,t){if(t>=a)do{i<<=a,t-=a,i|=e[e.j]&(1<<a)-1,e.j++,a=8}while(t>=8);t&&(i<<=t,a-=t,i|=e[e.j]>>>a&(1<<t)-1),e.a=8-a}return i}function l(e,t,i,a,r,n,s,l){null==l&&(l=0);var u,h,c,d,f,m,p=n+1,_=p%2,g=0,b=a[r],y=a[r-1],x=a[r-2][p],w=y[p-1],v=y[p],k=y[p+1],M=b[p-1],I=b[p+1],E=Math.abs;if(_&&(c=E(k-v),d=E(x-v),f=E(w-v)),_){if(m=(m=c>f&&d<c?x+w:c<f&&d<f?x+k:k+w)+2*v>>>2,l)return void(b[p]=m);u=t.t*t.c[e.g+v-x]+t.c[e.g+w-v]}else m=v>w&&v>k||v<w&&v<k?I+M+2*v>>>2:M+I>>>1,u=t.t*t.c[e.g+v-w]+t.c[e.g+w-M];h=E(u);var S=function(e){for(var t=-1,i=0;!i;t++)i=e[e.j]>>>7-e.a&1,e.a++,e.a&=7,e.a||e.j++;return t}(i);if(S<e.n-t.v-1){var P=function(e,t){var i=0;if(t<e)for(;i<=14&&t<<++i<e;);return i}(s[h][0],s[h][1]);g=o(i,P)+(S<<P)}else g=o(i,t.v)+1;g=1&g?-1-(g>>>1):g>>>1,s[h][0]+=E(g),s[h][1]==e.f&&(s[h][0]>>>=1,s[h][1]>>>=1),s[h][1]++,m=u<0?m-g:m+g,e.i&&(m<0?m+=t.w:m>e.g&&(m-=t.w)),b[p]=m>=0?Math.min(m,e.g):0}function u(e,t,i){for(var a=e[0].length,r=t;r<=i;r++)e[r][0]=e[r-1][1],e[r][a-1]=e[r-1][a-2]}function h(e){u(e,7,12),u(e,2,4),u(e,15,17)}function c(e,t,i,r,n,s,o,u,c,d,f,m,p){for(var _=0,g=1,b=n<a&&n>4;g<e.m;)_<e.m&&(l(e,t,i,r,n,_,o[c],e.h&&(b&&d||!b&&(f||(_&m)==p))),l(e,t,i,r,s,_,o[c],e.h&&(!b&&d||b&&(f||(_&m)==p))),_+=2),_>8&&(l(e,t,i,r,n,g,u[c]),l(e,t,i,r,s,g,u[c]),g+=2);h(r)}function d(e,t,i,a,r,n){c(e,t,i,a,2,7,r,n,0,0,1,0,8),c(e,t,i,a,8,15,r,n,1,0,1,0,8),c(e,t,i,a,3,9,r,n,2,1,0,3,0),c(e,t,i,a,10,16,r,n,0,0,0,3,2),c(e,t,i,a,4,11,r,n,1,0,0,3,2),c(e,t,i,a,12,17,r,n,2,1,0,3,0)}function f(e,t,i,a,r,n){var s=n.length,o=e.l;r+1==e.s&&(o=e.e-r*e.l);for(var l=6*e.e*a+r*e.l,u=0;u<6;u++){for(var h=0;h<o;h++){var c,d=n[u%s][h%s];c=0==d?2+(u>>>1):2==d?15+(u>>>1):7+u;var f=e.h?(2*h/3&2147483646|h%3&1)+(h%3>>>1):h>>>1;t[l+h]=i[c][f+1]}l+=e.e}}e._decompressRAF=function(o,l){var u=function(t){var i=e._binBE.readUshort,a={b:i(t,0),i:t[2],C:t[3],u:t[4],q:i(t,5),k:i(t,7),e:i(t,9),l:i(t,11),s:t[13],d:i(t,14)};if(18771!=a.b||a.i>1||a.q<6||a.q%6||a.e<768||a.e%24||768!=a.l||a.k<a.l||a.k%a.l||a.k-a.e>=a.l||a.s>16||a.s!=a.k/a.l||a.s!=Math.ceil(a.e/a.l)||a.d!=a.q/6||12!=a.u&&14!=a.u&&16!=a.u||16!=a.C&&0!=a.C)throw"Invalid data";if(0==a.i)throw"Not implemented. We need this file!";return a.h=16==a.C,a.m=0|(a.h?2*a.l/3:a.l>>>1),a.A=a.m+2,a.f=64,a.g=(1<<a.u)-1,a.n=4*a.u,a}(o),c=function(t,i){var a=new Array(i.s),r=4*i.s,n=16+r;12&r&&(n+=16-(12&r));for(var s=0,o=16;s<i.s;o+=4){var l=e._binBE.readUint(t,o);a[s]=t.slice(n,n+l),a[s].j=0,a[s].a=0,n+=l,s++}if(n!=t.length)throw"Invalid data";return a}(o,u),m=n(u),p=new Int16Array(u.e*u.q);null==l&&(l=u.h?[[1,1,0,1,1,2],[1,1,2,1,1,0],[2,0,1,0,2,1],[1,1,2,1,1,0],[1,1,0,1,1,2],[0,2,1,2,0,1]]:[[0,1],[3,2]]);for(var _=[[0,3],[1,4],[t,11],[i,12],[a,16],[r,17]],g=[],b=0;b<18;b++)g[b]=new Uint16Array(u.A);for(var y=0;y<u.s;y++){var x=s(m),w=s(m);for(b=0;b<18;b++)for(var v=0;v<u.A;v++)g[b][v]=0;for(var k=0;k<u.d;k++){d(u,m,c[y],g,x,w);for(b=0;b<6;b++)for(v=0;v<u.A;v++)g[_[b][0]][v]=g[_[b][1]][v];f(u,p,g,k,y,l);for(b=2;b<18;b++)if(-1==[t,i,a,r].indexOf(b))for(v=0;v<u.A;v++)g[b][v]=0;h(g)}}return p}}()}(t,"function"==typeof commonjsRequire?requirePako():self.pako)}()}(UTIF);var UTIFExports=UTIF.exports,utif=getDefaultExportFromCjs(UTIFExports),Edge;function getDimensionValue(e){return"number"==typeof e?e:e instanceof Uint8Array?e[0]:"string"==typeof e[0]?parseInt(e[0]):e[0]}function tiff(){return{mime:"image/tiff",encode:e=>{const t=utif.encodeImage(e.data,e.width,e.height);return Buffer.from(t)},decode:e=>{const t=utif.decode(e),i=t[0];if(!i)throw new Error("No page found in TIFF");if(!i.t256)throw new Error("No image width found in TIFF");if(!i.t257)throw new Error("No image height found in TIFF");t.forEach((t=>{utif.decodeImage(e,t)}));const a=utif.toRGBA8(i);return{data:Buffer.from(a),width:getDimensionValue(i.t256),height:getDimensionValue(i.t257)}}}}!function(e){e[e.EXTEND=1]="EXTEND",e[e.WRAP=2]="WRAP",e[e.CROP=3]="CROP"}(Edge||(Edge={}));const JimpClassSchema=z.object({bitmap:z.object({data:z.union([z.instanceof(Buffer),z.instanceof(Uint8Array)]),width:z.number(),height:z.number()})}),BlitOptionsSchemaComplex=z.object({src:JimpClassSchema,x:z.number().optional(),y:z.number().optional(),srcX:z.number().optional(),srcY:z.number().optional(),srcW:z.number().optional(),srcH:z.number().optional()}),BlitOptionsSchema=z.union([JimpClassSchema,BlitOptionsSchemaComplex]),methods$h={blit(e,t){const i=BlitOptionsSchema.parse(t);let{src:a,x:r=0,y:n=0,srcX:s=0,srcY:o=0,srcW:l=a.bitmap.width,srcH:u=a.bitmap.height}="bitmap"in i?{src:i}:i;if(!("bitmap"in a))throw new Error("The source must be a Jimp image");if("number"!=typeof r||"number"!=typeof n)throw new Error("x and y must be numbers");r=Math.round(r),n=Math.round(n),s=Math.round(s),o=Math.round(o),l=Math.round(l),u=Math.round(u);const h=e.bitmap.width,c=e.bitmap.height;return scan(a,s,o,l,u,(function(t,i,l){const u=r+t-s,d=n+i-o;if(u>=0&&d>=0&&h-u>0&&c-d>0){const t=e.getPixelIndex(u,d),i={r:a.bitmap.data[l]||0,g:a.bitmap.data[l+1]||0,b:a.bitmap.data[l+2]||0,a:a.bitmap.data[l+3]||0},r={r:e.bitmap.data[t]||0,g:e.bitmap.data[t+1]||0,b:e.bitmap.data[t+2]||0,a:e.bitmap.data[t+3]||0};e.bitmap.data[t]=(i.a*(i.r-r.r)-r.r+255>>8)+r.r,e.bitmap.data[t+1]=(i.a*(i.g-r.g)-r.g+255>>8)+r.g,e.bitmap.data[t+2]=(i.a*(i.b-r.b)-r.b+255>>8)+r.b,e.bitmap.data[t+3]=limit255(r.a+i.a)}})),e}},mulTable=[1,57,41,21,203,34,97,73,227,91,149,62,105,45,39,137,241,107,3,173,39,71,65,238,219,101,187,87,81,151,141,133,249,117,221,209,197,187,177,169,5,153,73,139,133,127,243,233,223,107,103,99,191,23,177,171,165,159,77,149,9,139,135,131,253,245,119,231,224,109,211,103,25,195,189,23,45,175,171,83,81,79,155,151,147,9,141,137,67,131,129,251,123,30,235,115,113,221,217,53,13,51,50,49,193,189,185,91,179,175,43,169,83,163,5,79,155,19,75,147,145,143,35,69,17,67,33,65,255,251,247,243,239,59,29,229,113,111,219,27,213,105,207,51,201,199,49,193,191,47,93,183,181,179,11,87,43,85,167,165,163,161,159,157,155,77,19,75,37,73,145,143,141,35,138,137,135,67,33,131,129,255,63,250,247,61,121,239,237,117,29,229,227,225,111,55,109,216,213,211,209,207,205,203,201,199,197,195,193,48,190,47,93,185,183,181,179,178,176,175,173,171,85,21,167,165,41,163,161,5,79,157,78,154,153,19,75,149,74,147,73,144,143,71,141,140,139,137,17,135,134,133,66,131,65,129,1],shgTable=[0,9,10,10,14,12,14,14,16,15,16,15,16,15,15,17,18,17,12,18,16,17,17,19,19,18,19,18,18,19,19,19,20,19,20,20,20,20,20,20,15,20,19,20,20,20,21,21,21,20,20,20,21,18,21,21,21,21,20,21,17,21,21,21,22,22,21,22,22,21,22,21,19,22,22,19,20,22,22,21,21,21,22,22,22,18,22,22,21,22,22,23,22,20,23,22,22,23,23,21,19,21,21,21,23,23,23,22,23,23,21,23,22,23,18,22,23,20,22,23,23,23,21,22,20,22,21,22,24,24,24,24,24,22,21,24,23,23,24,21,24,23,24,22,24,24,22,24,24,22,23,24,24,24,20,23,22,23,24,24,24,24,24,24,24,23,21,23,22,23,24,24,24,22,24,24,24,23,22,24,24,25,23,25,25,23,24,25,25,24,22,25,25,25,24,23,24,25,25,25,25,25,25,25,25,25,25,25,25,23,25,23,24,25,25,25,25,25,25,25,25,25,24,22,25,25,23,25,25,20,24,25,24,25,25,22,24,25,24,25,24,25,25,24,25,25,25,25,22,25,25,25,24,25,24,25,18],methods$g={blur(e,t){if("number"!=typeof t)throw new Error("r must be a number");if(t<1)throw new Error("r must be greater than 0");let i,a,r,n,s,o,l,u,h,c,d,f,m;const p=e.bitmap.width-1,_=e.bitmap.height-1,g=t+1,b=mulTable[t],y=shgTable[t],x=[],w=[],v=[],k=[],M=[],I=[];let E=2;for(;E-- >0;){for(f=0,m=0,o=0;o<e.bitmap.height;o++){for(i=e.bitmap.data[m]*g,a=e.bitmap.data[m+1]*g,r=e.bitmap.data[m+2]*g,n=e.bitmap.data[m+3]*g,l=1;l<=t;l++)u=m+((l>p?p:l)<<2),i+=e.bitmap.data[u++],a+=e.bitmap.data[u++],r+=e.bitmap.data[u++],n+=e.bitmap.data[u];for(s=0;s<e.bitmap.width;s++)x[f]=i,w[f]=a,v[f]=r,k[f]=n,0===o&&(M[s]=((u=s+g)<p?u:p)<<2,I[s]=(u=s-t)>0?u<<2:0),h=m+M[s],c=m+I[s],i+=e.bitmap.data[h++]-e.bitmap.data[c++],a+=e.bitmap.data[h++]-e.bitmap.data[c++],r+=e.bitmap.data[h++]-e.bitmap.data[c++],n+=e.bitmap.data[h]-e.bitmap.data[c++],f++;m+=e.bitmap.width<<2}for(s=0;s<e.bitmap.width;s++){for(d=s,i=x[d]*g,a=w[d]*g,r=v[d]*g,n=k[d]*g,l=1;l<=t;l++)d+=l>_?0:e.bitmap.width,i+=x[d],a+=w[d],r+=v[d],n+=k[d];for(f=s<<2,o=0;o<e.bitmap.height;o++)e.bitmap.data[f]=limit255(i*b>>>y),e.bitmap.data[f+1]=limit255(a*b>>>y),e.bitmap.data[f+2]=limit255(r*b>>>y),e.bitmap.data[f+3]=limit255(n*b>>>y),0===s&&(M[o]=((u=o+g)<_?u:_)*e.bitmap.width,I[o]=(u=o-t)>0?u*e.bitmap.width:0),h=s+M[o],c=s+I[o],i+=x[h]-x[c],a+=w[h]-w[c],r+=v[h]-v[c],n+=k[h]-k[c],f+=e.bitmap.width<<2}}return e},gaussian(e,t){if("number"!=typeof t)throw new Error("r must be a number");if(t<1)throw new Error("r must be greater than 0");const i=Math.ceil(2.57*t),a=2*i+1,r=t*t*2,n=r*Math.PI,s=[];for(let e=0;e<a;e++){const t=[];for(let s=0;s<a;s++){const a=(s-i)**2+(e-i)**2;t[s]=Math.exp(-a/r)/n}s.push(t)}for(let t=0;t<e.bitmap.height;t++)for(let r=0;r<e.bitmap.width;r++){let n=0,o=0,l=0,u=0,h=0;for(let c=0;c<a;c++){for(let d=0;d<a;d++){const a=Math.min(e.bitmap.width-1,Math.max(0,d+r-i)),f=Math.min(e.bitmap.height-1,Math.max(0,c+t-i)),m=s[c][d],p=f*e.bitmap.width+a<<2;n+=e.bitmap.data[p]*m,o+=e.bitmap.data[p+1]*m,l+=e.bitmap.data[p+2]*m,u+=e.bitmap.data[p+3]*m,h+=m}const d=t*e.bitmap.width+r<<2;e.bitmap.data[d]=Math.round(n/h),e.bitmap.data[d+1]=Math.round(o/h),e.bitmap.data[d+2]=Math.round(l/h),e.bitmap.data[d+3]=Math.round(u/h)}}return e}},CircleOptionsSchema=z.object({x:z.number().optional(),y:z.number().optional(),radius:z.number().min(0).optional()}),methods$f={circle(e,t={}){const i=CircleOptionsSchema.parse(t),a=i.radius||(e.bitmap.width>e.bitmap.height?e.bitmap.height:e.bitmap.width)/2,r="number"==typeof i.x?i.x:e.bitmap.width/2,n="number"==typeof i.y?i.y:e.bitmap.height/2;return e.scan(((t,i,s)=>{const o=Math.sqrt(Math.pow(t-r,2)+Math.pow(i-n,2));a-o<=0?e.bitmap.data[s+3]=0:a-o<1&&(e.bitmap.data[s+3]=255*(a-o))})),e}},ConvolutionMatrixSchema=z.array(z.number()).min(1).array(),ConvolutionComplexOptionsSchema=z.object({kernel:ConvolutionMatrixSchema,edgeHandling:z.nativeEnum(Edge).optional()}),ConvolutionOptionsSchema=z.union([ConvolutionMatrixSchema,ConvolutionComplexOptionsSchema]),ConvoluteComplexOptionsSchema=z.object({kernel:ConvolutionMatrixSchema,x:z.number().optional(),y:z.number().optional(),w:z.number().optional(),h:z.number().optional()}),ConvoluteOptionsSchema=z.union([ConvolutionMatrixSchema,ConvoluteComplexOptionsSchema]),PixelateSize=z.number().min(1).max(1/0),PixelateComplexOptionsSchema=z.object({size:PixelateSize,x:z.number().optional(),y:z.number().optional(),w:z.number().optional(),h:z.number().optional()}),PixelateOptionsSchema=z.union([PixelateSize,PixelateComplexOptionsSchema]);function applyKernel(e,t,i,a){const r=[0,0,0,0],n=(t.length-1)/2;for(let s=0;s<t.length;s+=1)for(let o=0;o<t[s].length;o+=1){const l=e.getPixelIndex(i+s-n,a+o-n);r[0]+=e.bitmap.data[l]*t[s][o],r[1]+=e.bitmap.data[l+1]*t[s][o],r[2]+=e.bitmap.data[l+2]*t[s][o],r[3]+=e.bitmap.data[l+3]*t[s][o]}return r}function mix(e,t,i=50){return{r:(t.r-e.r)*(i/100)+e.r,g:(t.g-e.g)*(i/100)+e.g,b:(t.b-e.b)*(i/100)+e.b}}const HueActionSchema=z.object({apply:z.literal("hue"),params:z.tuple([z.number().min(-360).max(360)])}),SpinActionSchema=z.object({apply:z.literal("spin"),params:z.tuple([z.number().min(-360).max(360)])}),LightenActionSchema=z.object({apply:z.literal("lighten"),params:z.tuple([z.number().min(0).max(100)]).optional()}),RGBColorSchema=z.object({r:z.number().min(0).max(255),g:z.number().min(0).max(255),b:z.number().min(0).max(255)}),MixActionSchema=z.object({apply:z.literal("mix"),params:z.union([z.tuple([RGBColorSchema]),z.tuple([RGBColorSchema,z.number().min(0).max(100)])])}),TintActionSchema=z.object({apply:z.literal("tint"),params:z.tuple([z.number().min(0).max(100)]).optional()}),ShadeActionSchema=z.object({apply:z.literal("shade"),params:z.tuple([z.number().min(0).max(100)]).optional()}),XorActionSchema=z.object({apply:z.literal("xor"),params:z.tuple([RGBColorSchema])}),RedActionSchema=z.object({apply:z.literal("red"),params:z.tuple([z.number().min(-255).max(255)])}),GreenActionSchema=z.object({apply:z.literal("green"),params:z.tuple([z.number().min(-255).max(255)])}),BlueActionSchema=z.object({apply:z.literal("blue"),params:z.tuple([z.number().min(-255).max(255)])}),BrightenActionSchema=z.object({apply:z.literal("brighten"),params:z.tuple([z.number().min(0).max(100)]).optional()}),DarkenActionSchema=z.object({apply:z.literal("darken"),params:z.tuple([z.number().min(0).max(100)]).optional()}),DesaturateActionSchema=z.object({apply:z.literal("desaturate"),params:z.tuple([z.number().min(0).max(100)]).optional()}),SaturateActionSchema=z.object({apply:z.literal("saturate"),params:z.tuple([z.number().min(0).max(100)]).optional()}),GrayscaleActionSchema=z.object({apply:z.literal("greyscale"),params:z.tuple([]).optional()}),ColorActionNameSchema=z.union([HueActionSchema,SpinActionSchema,LightenActionSchema,MixActionSchema,TintActionSchema,ShadeActionSchema,XorActionSchema,RedActionSchema,GreenActionSchema,BlueActionSchema,BrightenActionSchema,DarkenActionSchema,DesaturateActionSchema,SaturateActionSchema,GrayscaleActionSchema]);function histogram(e){const t={r:new Array(256).fill(0),g:new Array(256).fill(0),b:new Array(256).fill(0)};return e.scan(((i,a,r)=>{t.r[e.bitmap.data[r+0]]++,t.g[e.bitmap.data[r+1]]++,t.b[e.bitmap.data[r+2]]++})),t}const normalizeValue=function(e,t,i){return 255*(e-t)/(i-t)},getBounds=function(e){return[e.findIndex((e=>e>0)),255-e.slice().reverse().findIndex((e=>e>0))]},methods$e={normalize(e){const t=histogram(e),i={r:getBounds(t.r),g:getBounds(t.g),b:getBounds(t.b)};return e.scan(((t,a,r)=>{const n=e.bitmap.data[r+0],s=e.bitmap.data[r+1],o=e.bitmap.data[r+2];e.bitmap.data[r+0]=normalizeValue(n,i.r[0],i.r[1]),e.bitmap.data[r+1]=normalizeValue(s,i.g[0],i.g[1]),e.bitmap.data[r+2]=normalizeValue(o,i.b[0],i.b[1])})),e},invert:e=>(e.scan(((t,i,a)=>{e.bitmap.data[a]=255-e.bitmap.data[a],e.bitmap.data[a+1]=255-e.bitmap.data[a+1],e.bitmap.data[a+2]=255-e.bitmap.data[a+2]})),e),brightness(e,t){if("number"!=typeof t)throw new Error("val must be numbers");return e.scan(((i,a,r)=>{e.bitmap.data[r]=limit255(e.bitmap.data[r]*t),e.bitmap.data[r+1]=limit255(e.bitmap.data[r+1]*t),e.bitmap.data[r+2]=limit255(e.bitmap.data[r+2]*t)})),e},contrast(e,t){if("number"!=typeof t)throw new Error("val must be numbers");if(t<-1||t>1)throw new Error("val must be a number between -1 and +1");const i=(t+1)/(1-t);function a(e){return(e=Math.floor(i*(e-127)+127))<0?0:e>255?255:e}return e.scan(((t,i,r)=>{e.bitmap.data[r]=a(e.bitmap.data[r]),e.bitmap.data[r+1]=a(e.bitmap.data[r+1]),e.bitmap.data[r+2]=a(e.bitmap.data[r+2])})),e},posterize(e,t){if("number"!=typeof t)throw new Error("n must be numbers");return t<2&&(t=2),e.scan(((i,a,r)=>{const n=e.bitmap.data[r],s=e.bitmap.data[r+1],o=e.bitmap.data[r+2];e.bitmap.data[r]=Math.floor(n/255*(t-1))/(t-1)*255,e.bitmap.data[r+1]=Math.floor(s/255*(t-1))/(t-1)*255,e.bitmap.data[r+2]=Math.floor(o/255*(t-1))/(t-1)*255})),e},greyscale:e=>(e.scan(((t,i,a)=>{const r=.2126*e.bitmap.data[a]+.7152*e.bitmap.data[a+1]+.0722*e.bitmap.data[a+2];e.bitmap.data[a]=r,e.bitmap.data[a+1]=r,e.bitmap.data[a+2]=r})),e),opacity(e,t){if("number"!=typeof t)throw new Error("f must be a number");if(t<0||t>1)throw new Error("f must be a number from 0 to 1");return e.scan(((i,a,r)=>{const n=e.bitmap.data[r+3]*t;e.bitmap.data[r+3]=n})),e},sepia:e=>(e.scan(((t,i,a)=>{let r=e.bitmap.data[a],n=e.bitmap.data[a+1],s=e.bitmap.data[a+2];r=.393*r+.769*n+.189*s,n=.349*r+.686*n+.168*s,s=.272*r+.534*n+.131*s,e.bitmap.data[a]=r<255?r:255,e.bitmap.data[a+1]=n<255?n:255,e.bitmap.data[a+2]=s<255?s:255})),e),fade(e,t){if("number"!=typeof t)throw new Error("f must be a number");if(t<0||t>1)throw new Error("f must be a number from 0 to 1");return this.opacity(e,1-t)},convolution(e,t){const i=ConvolutionOptionsSchema.parse(t),{kernel:a,edgeHandling:r=Edge.EXTEND}="kernel"in i?i:{kernel:i,edgeHandling:void 0};if(!a[0])throw new Error("kernel must be a matrix");const n=Buffer.from(e.bitmap.data),s=a.length,o=a[0].length,l=Math.floor(s/2),u=Math.floor(o/2),h=-l,c=-u;let d,f,m,p,_,g,b,y,x,w;return e.scan(((t,i,s)=>{p=0,m=0,f=0;for(let n=h;n<=l;n++)for(let s=c;s<=u;s++)y=t+s,x=i+n,d=a[n+l][s+u],w=e.getPixelIndex(y,x,r),-1===w?(b=0,g=0,_=0):(_=e.bitmap.data[w+0],g=e.bitmap.data[w+1],b=e.bitmap.data[w+2]),f+=d*_,m+=d*g,p+=d*b;f<0&&(f=0),m<0&&(m=0),p<0&&(p=0),f>255&&(f=255),m>255&&(m=255),p>255&&(p=255),n[s+0]=f,n[s+1]=m,n[s+2]=p})),e.bitmap.data=n,e},opaque:e=>(e.scan(((t,i,a)=>{e.bitmap.data[a+3]=255})),e),pixelate(e,t){const i=PixelateOptionsSchema.parse(t),{size:a,x:r=0,y:n=0,w:s=e.bitmap.width-r,h:o=e.bitmap.height-n}="number"==typeof i?{size:i}:i,l=[[1/16,2/16,1/16],[2/16,.25,2/16],[1/16,2/16,1/16]],u=clone(e);return scan(u,r,n,s,o,((t,i,r)=>{t=a*Math.floor(t/a),i=a*Math.floor(i/a);const n=applyKernel(u,l,t,i);e.bitmap.data[r]=n[0],e.bitmap.data[r+1]=n[1],e.bitmap.data[r+2]=n[2],e.bitmap.data[r+3]=n[3]})),e},convolute(e,t){const i=ConvoluteOptionsSchema.parse(t),{kernel:a,x:r=0,y:n=0,w:s=e.bitmap.width-r,h:o=e.bitmap.height-n}="kernel"in i?i:{kernel:i},l=clone(e);return scan(l,r,n,s,o,((t,i,r)=>{const n=applyKernel(l,a,t,i);e.bitmap.data[r]=limit255(n[0]),e.bitmap.data[r+1]=limit255(n[1]),e.bitmap.data[r+2]=limit255(n[2]),e.bitmap.data[r+3]=limit255(n[3])})),e},color(e,t){if(!t||!Array.isArray(t))throw new Error("actions must be an array");return t.forEach((e=>ColorActionNameSchema.parse(e))),t=t.map((e=>("xor"!==e.apply&&"mix"!==e.apply||(e.params[0]=tinycolor(e.params[0]).toRgb()),e))),e.scan(((i,a,r)=>{let n={r:e.bitmap.data[r],g:e.bitmap.data[r+1],b:e.bitmap.data[r+2]};const s=(e,t)=>limit255(n[e]+t);t.forEach((e=>{if("mix"===e.apply)n=mix(n,e.params[0],e.params[1]);else if("tint"===e.apply)n=mix(n,{r:255,g:255,b:255},e.params?.[0]);else if("shade"===e.apply)n=mix(n,{r:0,g:0,b:0},e.params?.[0]);else if("xor"===e.apply)n={r:n.r^e.params[0].r,g:n.g^e.params[0].g,b:n.b^e.params[0].b};else if("red"===e.apply)n.r=s("r",e.params[0]);else if("green"===e.apply)n.g=s("g",e.params[0]);else if("blue"===e.apply)n.b=s("b",e.params[0]);else{"hue"===e.apply&&(e.apply="spin");const t=tinycolor(n),i=t[e.apply].bind(t);if(!i)throw new Error("action "+e.apply+" not supported");n=i(...e.params||[]).toRgb()}})),e.bitmap.data[r]=n.r,e.bitmap.data[r+1]=n.g,e.bitmap.data[r+2]=n.b})),e}};var lib$1={},ieee754={
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
read:function(e,t,i,a,r){var n,s,o=8*r-a-1,l=(1<<o)-1,u=l>>1,h=-7,c=i?r-1:0,d=i?-1:1,f=e[t+c];for(c+=d,n=f&(1<<-h)-1,f>>=-h,h+=o;h>0;n=256*n+e[t+c],c+=d,h-=8);for(s=n&(1<<-h)-1,n>>=-h,h+=a;h>0;s=256*s+e[t+c],c+=d,h-=8);if(0===n)n=1-u;else{if(n===l)return s?NaN:1/0*(f?-1:1);s+=Math.pow(2,a),n-=u}return(f?-1:1)*s*Math.pow(2,n-a)},write:function(e,t,i,a,r,n){var s,o,l,u=8*n-r-1,h=(1<<u)-1,c=h>>1,d=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,f=a?0:n-1,m=a?1:-1,p=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(o=isNaN(t)?1:0,s=h):(s=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-s))<1&&(s--,l*=2),(t+=s+c>=1?d/l:d*Math.pow(2,1-c))*l>=2&&(s++,l/=2),s+c>=h?(o=0,s=h):s+c>=1?(o=(t*l-1)*Math.pow(2,r),s+=c):(o=t*Math.pow(2,c-1)*Math.pow(2,r),s=0));r>=8;e[i+f]=255&o,f+=m,o/=256,r-=8);for(s=s<<r|o,u+=r;u>0;e[i+f]=255&s,f+=m,s/=256,u-=8);e[i+f-m]|=128*p}};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AnsiStringType=e.StringType=e.BufferType=e.Uint8ArrayType=e.IgnoreType=e.Float80_LE=e.Float80_BE=e.Float64_LE=e.Float64_BE=e.Float32_LE=e.Float32_BE=e.Float16_LE=e.Float16_BE=e.INT64_BE=e.UINT64_BE=e.INT64_LE=e.UINT64_LE=e.INT32_LE=e.INT32_BE=e.INT24_BE=e.INT24_LE=e.INT16_LE=e.INT16_BE=e.INT8=e.UINT32_BE=e.UINT32_LE=e.UINT24_BE=e.UINT24_LE=e.UINT16_BE=e.UINT16_LE=e.UINT8=void 0;const t=ieee754;function i(e){return new DataView(e.buffer,e.byteOffset)}e.UINT8={len:1,get:(e,t)=>i(e).getUint8(t),put:(e,t,a)=>(i(e).setUint8(t,a),t+1)},e.UINT16_LE={len:2,get:(e,t)=>i(e).getUint16(t,!0),put:(e,t,a)=>(i(e).setUint16(t,a,!0),t+2)},e.UINT16_BE={len:2,get:(e,t)=>i(e).getUint16(t),put:(e,t,a)=>(i(e).setUint16(t,a),t+2)},e.UINT24_LE={len:3,get(e,t){const a=i(e);return a.getUint8(t)+(a.getUint16(t+1,!0)<<8)},put(e,t,a){const r=i(e);return r.setUint8(t,255&a),r.setUint16(t+1,a>>8,!0),t+3}},e.UINT24_BE={len:3,get(e,t){const a=i(e);return(a.getUint16(t)<<8)+a.getUint8(t+2)},put(e,t,a){const r=i(e);return r.setUint16(t,a>>8),r.setUint8(t+2,255&a),t+3}},e.UINT32_LE={len:4,get:(e,t)=>i(e).getUint32(t,!0),put:(e,t,a)=>(i(e).setUint32(t,a,!0),t+4)},e.UINT32_BE={len:4,get:(e,t)=>i(e).getUint32(t),put:(e,t,a)=>(i(e).setUint32(t,a),t+4)},e.INT8={len:1,get:(e,t)=>i(e).getInt8(t),put:(e,t,a)=>(i(e).setInt8(t,a),t+1)},e.INT16_BE={len:2,get:(e,t)=>i(e).getInt16(t),put:(e,t,a)=>(i(e).setInt16(t,a),t+2)},e.INT16_LE={len:2,get:(e,t)=>i(e).getInt16(t,!0),put:(e,t,a)=>(i(e).setInt16(t,a,!0),t+2)},e.INT24_LE={len:3,get(t,i){const a=e.UINT24_LE.get(t,i);return a>8388607?a-16777216:a},put(e,t,a){const r=i(e);return r.setUint8(t,255&a),r.setUint16(t+1,a>>8,!0),t+3}},e.INT24_BE={len:3,get(t,i){const a=e.UINT24_BE.get(t,i);return a>8388607?a-16777216:a},put(e,t,a){const r=i(e);return r.setUint16(t,a>>8),r.setUint8(t+2,255&a),t+3}},e.INT32_BE={len:4,get:(e,t)=>i(e).getInt32(t),put:(e,t,a)=>(i(e).setInt32(t,a),t+4)},e.INT32_LE={len:4,get:(e,t)=>i(e).getInt32(t,!0),put:(e,t,a)=>(i(e).setInt32(t,a,!0),t+4)},e.UINT64_LE={len:8,get:(e,t)=>i(e).getBigUint64(t,!0),put:(e,t,a)=>(i(e).setBigUint64(t,a,!0),t+8)},e.INT64_LE={len:8,get:(e,t)=>i(e).getBigInt64(t,!0),put:(e,t,a)=>(i(e).setBigInt64(t,a,!0),t+8)},e.UINT64_BE={len:8,get:(e,t)=>i(e).getBigUint64(t),put:(e,t,a)=>(i(e).setBigUint64(t,a),t+8)},e.INT64_BE={len:8,get:(e,t)=>i(e).getBigInt64(t),put:(e,t,a)=>(i(e).setBigInt64(t,a),t+8)},e.Float16_BE={len:2,get(e,i){return t.read(e,i,!1,10,this.len)},put(e,i,a){return t.write(e,a,i,!1,10,this.len),i+this.len}},e.Float16_LE={len:2,get(e,i){return t.read(e,i,!0,10,this.len)},put(e,i,a){return t.write(e,a,i,!0,10,this.len),i+this.len}},e.Float32_BE={len:4,get:(e,t)=>i(e).getFloat32(t),put:(e,t,a)=>(i(e).setFloat32(t,a),t+4)},e.Float32_LE={len:4,get:(e,t)=>i(e).getFloat32(t,!0),put:(e,t,a)=>(i(e).setFloat32(t,a,!0),t+4)},e.Float64_BE={len:8,get:(e,t)=>i(e).getFloat64(t),put:(e,t,a)=>(i(e).setFloat64(t,a),t+8)},e.Float64_LE={len:8,get:(e,t)=>i(e).getFloat64(t,!0),put:(e,t,a)=>(i(e).setFloat64(t,a,!0),t+8)},e.Float80_BE={len:10,get(e,i){return t.read(e,i,!1,63,this.len)},put(e,i,a){return t.write(e,a,i,!1,63,this.len),i+this.len}},e.Float80_LE={len:10,get(e,i){return t.read(e,i,!0,63,this.len)},put(e,i,a){return t.write(e,a,i,!0,63,this.len),i+this.len}};e.IgnoreType=class{constructor(e){this.len=e}get(e,t){}};e.Uint8ArrayType=class{constructor(e){this.len=e}get(e,t){return e.subarray(t,t+this.len)}};e.BufferType=class{constructor(e){this.len=e}get(e,t){return Buffer.from(e.subarray(t,t+this.len))}};e.StringType=class{constructor(e,t){this.len=e,this.encoding=t}get(e,t){return Buffer.from(e).toString(this.encoding,t,t+this.len)}};class a{constructor(e){this.len=e}static decode(e,t,i){let r="";for(let n=t;n<i;++n)r+=a.codePointToString(a.singleByteDecoder(e[n]));return r}static inRange(e,t,i){return t<=e&&e<=i}static codePointToString(e){return e<=65535?String.fromCharCode(e):(e-=65536,String.fromCharCode(55296+(e>>10),56320+(1023&e)))}static singleByteDecoder(e){if(a.inRange(e,0,127))return e;const t=a.windows1252[e-128];if(null===t)throw Error("invaliding encoding");return t}get(e,t=0){return a.decode(e,t,t+this.len)}}e.AnsiStringType=a,a.windows1252=[8364,129,8218,402,8222,8230,8224,8225,710,8240,352,8249,338,141,381,143,144,8216,8217,8220,8221,8226,8211,8212,732,8482,353,8250,339,157,382,376,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255]}(lib$1);var core$1={},ReadStreamTokenizer$1={},AbstractTokenizer$1={},lib={},EndOfFileStream={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.EndOfStreamError=e.defaultMessages=void 0,e.defaultMessages="End-Of-Stream";class t extends Error{constructor(){super(e.defaultMessages)}}e.EndOfStreamError=t}(EndOfFileStream);var StreamReader={},Deferred$1={};Object.defineProperty(Deferred$1,"__esModule",{value:!0}),Deferred$1.Deferred=void 0;class Deferred{constructor(){this.resolve=()=>null,this.reject=()=>null,this.promise=new Promise(((e,t)=>{this.reject=t,this.resolve=e}))}}Deferred$1.Deferred=Deferred,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.StreamReader=e.EndOfStreamError=void 0;const t=EndOfFileStream,i=Deferred$1;var a=EndOfFileStream;Object.defineProperty(e,"EndOfStreamError",{enumerable:!0,get:function(){return a.EndOfStreamError}});e.StreamReader=class{constructor(e){if(this.s=e,this.deferred=null,this.endOfStream=!1,this.peekQueue=[],!e.read||!e.once)throw new Error("Expected an instance of stream.Readable");this.s.once("end",(()=>this.reject(new t.EndOfStreamError))),this.s.once("error",(e=>this.reject(e))),this.s.once("close",(()=>this.reject(new Error("Stream closed"))))}async peek(e,t,i){const a=await this.read(e,t,i);return this.peekQueue.push(e.subarray(t,t+a)),a}async read(e,i,a){if(0===a)return 0;if(0===this.peekQueue.length&&this.endOfStream)throw new t.EndOfStreamError;let r=a,n=0;for(;this.peekQueue.length>0&&r>0;){const t=this.peekQueue.pop();if(!t)throw new Error("peekData should be defined");const a=Math.min(t.length,r);e.set(t.subarray(0,a),i+n),n+=a,r-=a,a<t.length&&this.peekQueue.push(t.subarray(a))}for(;r>0&&!this.endOfStream;){const t=Math.min(r,1048576),a=await this.readFromStream(e,i+n,t);if(n+=a,a<t)break;r-=a}return n}async readFromStream(e,t,a){const r=this.s.read(a);if(r)return e.set(r,t),r.length;{const r={buffer:e,offset:t,length:a,deferred:new i.Deferred};return this.deferred=r.deferred,this.s.once("readable",(()=>{this.readDeferred(r)})),r.deferred.promise}}readDeferred(e){const t=this.s.read(e.length);t?(e.buffer.set(t,e.offset),e.deferred.resolve(t.length),this.deferred=null):this.s.once("readable",(()=>{this.readDeferred(e)}))}reject(e){this.endOfStream=!0,this.deferred&&(this.deferred.reject(e),this.deferred=null)}}}(StreamReader),function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.StreamReader=e.EndOfStreamError=void 0;var t=EndOfFileStream;Object.defineProperty(e,"EndOfStreamError",{enumerable:!0,get:function(){return t.EndOfStreamError}});var i=StreamReader;Object.defineProperty(e,"StreamReader",{enumerable:!0,get:function(){return i.StreamReader}})}(lib),Object.defineProperty(AbstractTokenizer$1,"__esModule",{value:!0}),AbstractTokenizer$1.AbstractTokenizer=void 0;const peek_readable_1$2=lib;class AbstractTokenizer{constructor(e){this.position=0,this.numBuffer=new Uint8Array(8),this.fileInfo=e||{}}async readToken(e,t=this.position){const i=Buffer.alloc(e.len);if(await this.readBuffer(i,{position:t})<e.len)throw new peek_readable_1$2.EndOfStreamError;return e.get(i,0)}async peekToken(e,t=this.position){const i=Buffer.alloc(e.len);if(await this.peekBuffer(i,{position:t})<e.len)throw new peek_readable_1$2.EndOfStreamError;return e.get(i,0)}async readNumber(e){if(await this.readBuffer(this.numBuffer,{length:e.len})<e.len)throw new peek_readable_1$2.EndOfStreamError;return e.get(this.numBuffer,0)}async peekNumber(e){if(await this.peekBuffer(this.numBuffer,{length:e.len})<e.len)throw new peek_readable_1$2.EndOfStreamError;return e.get(this.numBuffer,0)}async ignore(e){if(void 0!==this.fileInfo.size){const t=this.fileInfo.size-this.position;if(e>t)return this.position+=t,t}return this.position+=e,e}async close(){}normalizeOptions(e,t){if(t&&void 0!==t.position&&t.position<this.position)throw new Error("`options.position` must be equal or greater than `tokenizer.position`");return t?{mayBeLess:!0===t.mayBeLess,offset:t.offset?t.offset:0,length:t.length?t.length:e.length-(t.offset?t.offset:0),position:t.position?t.position:this.position}:{mayBeLess:!1,offset:0,length:e.length,position:this.position}}}AbstractTokenizer$1.AbstractTokenizer=AbstractTokenizer,Object.defineProperty(ReadStreamTokenizer$1,"__esModule",{value:!0}),ReadStreamTokenizer$1.ReadStreamTokenizer=void 0;const AbstractTokenizer_1$1=AbstractTokenizer$1,peek_readable_1$1=lib,maxBufferSize=256e3;class ReadStreamTokenizer extends AbstractTokenizer_1$1.AbstractTokenizer{constructor(e,t){super(t),this.streamReader=new peek_readable_1$1.StreamReader(e)}async getFileInfo(){return this.fileInfo}async readBuffer(e,t){const i=this.normalizeOptions(e,t),a=i.position-this.position;if(a>0)return await this.ignore(a),this.readBuffer(e,t);if(a<0)throw new Error("`options.position` must be equal or greater than `tokenizer.position`");if(0===i.length)return 0;const r=await this.streamReader.read(e,i.offset,i.length);if(this.position+=r,(!t||!t.mayBeLess)&&r<i.length)throw new peek_readable_1$1.EndOfStreamError;return r}async peekBuffer(e,t){const i=this.normalizeOptions(e,t);let a=0;if(i.position){const t=i.position-this.position;if(t>0){const r=new Uint8Array(i.length+t);return a=await this.peekBuffer(r,{mayBeLess:i.mayBeLess}),e.set(r.subarray(t),i.offset),a-t}if(t<0)throw new Error("Cannot peek from a negative offset in a stream")}if(i.length>0){try{a=await this.streamReader.peek(e,i.offset,i.length)}catch(e){if(t&&t.mayBeLess&&e instanceof peek_readable_1$1.EndOfStreamError)return 0;throw e}if(!i.mayBeLess&&a<i.length)throw new peek_readable_1$1.EndOfStreamError}return a}async ignore(e){const t=Math.min(maxBufferSize,e),i=new Uint8Array(t);let a=0;for(;a<e;){const r=e-a,n=await this.readBuffer(i,{length:Math.min(t,r)});if(n<0)return n;a+=n}return a}}ReadStreamTokenizer$1.ReadStreamTokenizer=ReadStreamTokenizer;var BufferTokenizer$1={};Object.defineProperty(BufferTokenizer$1,"__esModule",{value:!0}),BufferTokenizer$1.BufferTokenizer=void 0;const peek_readable_1=lib,AbstractTokenizer_1=AbstractTokenizer$1;class BufferTokenizer extends AbstractTokenizer_1.AbstractTokenizer{constructor(e,t){super(t),this.uint8Array=e,this.fileInfo.size=this.fileInfo.size?this.fileInfo.size:e.length}async readBuffer(e,t){if(t&&t.position){if(t.position<this.position)throw new Error("`options.position` must be equal or greater than `tokenizer.position`");this.position=t.position}const i=await this.peekBuffer(e,t);return this.position+=i,i}async peekBuffer(e,t){const i=this.normalizeOptions(e,t),a=Math.min(this.uint8Array.length-i.position,i.length);if(!i.mayBeLess&&a<i.length)throw new peek_readable_1.EndOfStreamError;return e.set(this.uint8Array.subarray(i.position,i.position+a),i.offset),a}async close(){}}BufferTokenizer$1.BufferTokenizer=BufferTokenizer,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.fromBuffer=e.fromStream=e.EndOfStreamError=void 0;const t=ReadStreamTokenizer$1,i=BufferTokenizer$1;var a=lib;Object.defineProperty(e,"EndOfStreamError",{enumerable:!0,get:function(){return a.EndOfStreamError}}),e.fromStream=function(e,i){return i=i||{},new t.ReadStreamTokenizer(e,i)},e.fromBuffer=function(e,t){return new i.BufferTokenizer(e,t)}}(core$1);var util={stringToBytes:e=>[...e].map((e=>e.charCodeAt(0))),tarHeaderChecksumMatches:(e,t=0)=>{const i=parseInt(e.toString("utf8",148,154).replace(/\0.*$/,"").trim(),8);if(isNaN(i))return!1;let a=256;for(let i=t;i<t+148;i++)a+=e[i];for(let i=t+156;i<t+512;i++)a+=e[i];return i===a},uint32SyncSafeToken:{get:(e,t)=>127&e[t+3]|e[t+2]<<7|e[t+1]<<14|e[t]<<21,len:4}},supported$1={extensions:["jpg","png","apng","gif","webp","flif","xcf","cr2","cr3","orf","arw","dng","nef","rw2","raf","tif","bmp","icns","jxr","psd","indd","zip","tar","rar","gz","bz2","7z","dmg","mp4","mid","mkv","webm","mov","avi","mpg","mp2","mp3","m4a","oga","ogg","ogv","opus","flac","wav","spx","amr","pdf","epub","exe","swf","rtf","wasm","woff","woff2","eot","ttf","otf","ico","flv","ps","xz","sqlite","nes","crx","xpi","cab","deb","ar","rpm","Z","lz","cfb","mxf","mts","blend","bpg","docx","pptx","xlsx","3gp","3g2","jp2","jpm","jpx","mj2","aif","qcp","odt","ods","odp","xml","mobi","heic","cur","ktx","ape","wv","dcm","ics","glb","pcap","dsf","lnk","alias","voc","ac3","m4v","m4p","m4b","f4v","f4p","f4b","f4a","mie","asf","ogm","ogx","mpc","arrow","shp","aac","mp1","it","s3m","xm","ai","skp","avif","eps","lzh","pgp","asar","stl","chm","3mf","zst","jxl","vcf"],mimeTypes:["image/jpeg","image/png","image/gif","image/webp","image/flif","image/x-xcf","image/x-canon-cr2","image/x-canon-cr3","image/tiff","image/bmp","image/vnd.ms-photo","image/vnd.adobe.photoshop","application/x-indesign","application/epub+zip","application/x-xpinstall","application/vnd.oasis.opendocument.text","application/vnd.oasis.opendocument.spreadsheet","application/vnd.oasis.opendocument.presentation","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/zip","application/x-tar","application/x-rar-compressed","application/gzip","application/x-bzip2","application/x-7z-compressed","application/x-apple-diskimage","application/x-apache-arrow","video/mp4","audio/midi","video/x-matroska","video/webm","video/quicktime","video/vnd.avi","audio/vnd.wave","audio/qcelp","audio/x-ms-asf","video/x-ms-asf","application/vnd.ms-asf","video/mpeg","video/3gpp","audio/mpeg","audio/mp4","audio/opus","video/ogg","audio/ogg","application/ogg","audio/x-flac","audio/ape","audio/wavpack","audio/amr","application/pdf","application/x-msdownload","application/x-shockwave-flash","application/rtf","application/wasm","font/woff","font/woff2","application/vnd.ms-fontobject","font/ttf","font/otf","image/x-icon","video/x-flv","application/postscript","application/eps","application/x-xz","application/x-sqlite3","application/x-nintendo-nes-rom","application/x-google-chrome-extension","application/vnd.ms-cab-compressed","application/x-deb","application/x-unix-archive","application/x-rpm","application/x-compress","application/x-lzip","application/x-cfb","application/x-mie","application/mxf","video/mp2t","application/x-blender","image/bpg","image/jp2","image/jpx","image/jpm","image/mj2","audio/aiff","application/xml","application/x-mobipocket-ebook","image/heif","image/heif-sequence","image/heic","image/heic-sequence","image/icns","image/ktx","application/dicom","audio/x-musepack","text/calendar","text/vcard","model/gltf-binary","application/vnd.tcpdump.pcap","audio/x-dsf","application/x.ms.shortcut","application/x.apple.alias","audio/x-voc","audio/vnd.dolby.dd-raw","audio/x-m4a","image/apng","image/x-olympus-orf","image/x-sony-arw","image/x-adobe-dng","image/x-nikon-nef","image/x-panasonic-rw2","image/x-fujifilm-raf","video/x-m4v","video/3gpp2","application/x-esri-shape","audio/aac","audio/x-it","audio/x-s3m","audio/x-xm","video/MP1S","video/MP2P","application/vnd.sketchup.skp","image/avif","application/x-lzh-compressed","application/pgp-encrypted","application/x-asar","model/stl","application/vnd.ms-htmlhelp","model/3mf","image/jxl","application/zstd"]};const Token=lib$1,strtok3=core$1,{stringToBytes:stringToBytes,tarHeaderChecksumMatches:tarHeaderChecksumMatches,uint32SyncSafeToken:uint32SyncSafeToken}=util,supported=supported$1,minimumBytes=4100;async function fromStream(e){const t=await strtok3.fromStream(e);try{return await fromTokenizer(t)}finally{await t.close()}}async function fromBuffer(e){if(!(e instanceof Uint8Array||e instanceof ArrayBuffer||Buffer.isBuffer(e)))throw new TypeError(`Expected the \`input\` argument to be of type \`Uint8Array\` or \`Buffer\` or \`ArrayBuffer\`, got \`${typeof e}\``);const t=e instanceof Buffer?e:Buffer.from(e);if(!(t&&t.length>1))return;return fromTokenizer(strtok3.fromBuffer(t))}function _check(e,t,i){i={offset:0,...i};for(const[a,r]of t.entries())if(i.mask){if(r!==(i.mask[a]&e[a+i.offset]))return!1}else if(r!==e[a+i.offset])return!1;return!0}async function fromTokenizer(e){try{return _fromTokenizer(e)}catch(e){if(!(e instanceof strtok3.EndOfStreamError))throw e}}async function _fromTokenizer(e){let t=Buffer.alloc(minimumBytes);const i=(e,i)=>_check(t,e,i),a=(e,t)=>i(stringToBytes(e),t);if(e.fileInfo.size||(e.fileInfo.size=Number.MAX_SAFE_INTEGER),await e.peekBuffer(t,{length:12,mayBeLess:!0}),i([66,77]))return{ext:"bmp",mime:"image/bmp"};if(i([11,119]))return{ext:"ac3",mime:"audio/vnd.dolby.dd-raw"};if(i([120,1]))return{ext:"dmg",mime:"application/x-apple-diskimage"};if(i([77,90]))return{ext:"exe",mime:"application/x-msdownload"};if(i([37,33]))return await e.peekBuffer(t,{length:24,mayBeLess:!0}),a("PS-Adobe-",{offset:2})&&a(" EPSF-",{offset:14})?{ext:"eps",mime:"application/eps"}:{ext:"ps",mime:"application/postscript"};if(i([31,160])||i([31,157]))return{ext:"Z",mime:"application/x-compress"};if(i([255,216,255]))return{ext:"jpg",mime:"image/jpeg"};if(i([73,73,188]))return{ext:"jxr",mime:"image/vnd.ms-photo"};if(i([31,139,8]))return{ext:"gz",mime:"application/gzip"};if(i([66,90,104]))return{ext:"bz2",mime:"application/x-bzip2"};if(a("ID3")){await e.ignore(6);const r=await e.readToken(uint32SyncSafeToken);return e.position+r>e.fileInfo.size?{ext:"mp3",mime:"audio/mpeg"}:(await e.ignore(r),fromTokenizer(e))}if(a("MP+"))return{ext:"mpc",mime:"audio/x-musepack"};if((67===t[0]||70===t[0])&&i([87,83],{offset:1}))return{ext:"swf",mime:"application/x-shockwave-flash"};if(i([71,73,70]))return{ext:"gif",mime:"image/gif"};if(a("FLIF"))return{ext:"flif",mime:"image/flif"};if(a("8BPS"))return{ext:"psd",mime:"image/vnd.adobe.photoshop"};if(a("WEBP",{offset:8}))return{ext:"webp",mime:"image/webp"};if(a("MPCK"))return{ext:"mpc",mime:"audio/x-musepack"};if(a("FORM"))return{ext:"aif",mime:"audio/aiff"};if(a("icns",{offset:0}))return{ext:"icns",mime:"image/icns"};if(i([80,75,3,4])){try{for(;e.position+30<e.fileInfo.size;){await e.readBuffer(t,{length:30});const n={compressedSize:t.readUInt32LE(18),uncompressedSize:t.readUInt32LE(22),filenameLength:t.readUInt16LE(26),extraFieldLength:t.readUInt16LE(28)};if(n.filename=await e.readToken(new Token.StringType(n.filenameLength,"utf-8")),await e.ignore(n.extraFieldLength),"META-INF/mozilla.rsa"===n.filename)return{ext:"xpi",mime:"application/x-xpinstall"};if(n.filename.endsWith(".rels")||n.filename.endsWith(".xml")){switch(n.filename.split("/")[0]){case"_rels":default:break;case"word":return{ext:"docx",mime:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"};case"ppt":return{ext:"pptx",mime:"application/vnd.openxmlformats-officedocument.presentationml.presentation"};case"xl":return{ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}}}if(n.filename.startsWith("xl/"))return{ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"};if(n.filename.startsWith("3D/")&&n.filename.endsWith(".model"))return{ext:"3mf",mime:"model/3mf"};if("mimetype"===n.filename&&n.compressedSize===n.uncompressedSize){switch(await e.readToken(new Token.StringType(n.compressedSize,"utf-8"))){case"application/epub+zip":return{ext:"epub",mime:"application/epub+zip"};case"application/vnd.oasis.opendocument.text":return{ext:"odt",mime:"application/vnd.oasis.opendocument.text"};case"application/vnd.oasis.opendocument.spreadsheet":return{ext:"ods",mime:"application/vnd.oasis.opendocument.spreadsheet"};case"application/vnd.oasis.opendocument.presentation":return{ext:"odp",mime:"application/vnd.oasis.opendocument.presentation"}}}if(0===n.compressedSize){let s=-1;for(;s<0&&e.position<e.fileInfo.size;)await e.peekBuffer(t,{mayBeLess:!0}),s=t.indexOf("504B0304",0,"hex"),await e.ignore(s>=0?s:t.length)}else await e.ignore(n.compressedSize)}}catch(o){if(!(o instanceof strtok3.EndOfStreamError))throw o}return{ext:"zip",mime:"application/zip"}}if(a("OggS")){await e.ignore(28);const l=Buffer.alloc(8);return await e.readBuffer(l),_check(l,[79,112,117,115,72,101,97,100])?{ext:"opus",mime:"audio/opus"}:_check(l,[128,116,104,101,111,114,97])?{ext:"ogv",mime:"video/ogg"}:_check(l,[1,118,105,100,101,111,0])?{ext:"ogm",mime:"video/ogg"}:_check(l,[127,70,76,65,67])?{ext:"oga",mime:"audio/ogg"}:_check(l,[83,112,101,101,120,32,32])?{ext:"spx",mime:"audio/ogg"}:_check(l,[1,118,111,114,98,105,115])?{ext:"ogg",mime:"audio/ogg"}:{ext:"ogx",mime:"application/ogg"}}if(i([80,75])&&(3===t[2]||5===t[2]||7===t[2])&&(4===t[3]||6===t[3]||8===t[3]))return{ext:"zip",mime:"application/zip"};if(a("ftyp",{offset:4})&&96&t[8]){const u=t.toString("binary",8,12).replace("\0"," ").trim();switch(u){case"avif":return{ext:"avif",mime:"image/avif"};case"mif1":return{ext:"heic",mime:"image/heif"};case"msf1":return{ext:"heic",mime:"image/heif-sequence"};case"heic":case"heix":return{ext:"heic",mime:"image/heic"};case"hevc":case"hevx":return{ext:"heic",mime:"image/heic-sequence"};case"qt":return{ext:"mov",mime:"video/quicktime"};case"M4V":case"M4VH":case"M4VP":return{ext:"m4v",mime:"video/x-m4v"};case"M4P":return{ext:"m4p",mime:"video/mp4"};case"M4B":return{ext:"m4b",mime:"audio/mp4"};case"M4A":return{ext:"m4a",mime:"audio/x-m4a"};case"F4V":return{ext:"f4v",mime:"video/mp4"};case"F4P":return{ext:"f4p",mime:"video/mp4"};case"F4A":return{ext:"f4a",mime:"audio/mp4"};case"F4B":return{ext:"f4b",mime:"audio/mp4"};case"crx":return{ext:"cr3",mime:"image/x-canon-cr3"};default:return u.startsWith("3g")?u.startsWith("3g2")?{ext:"3g2",mime:"video/3gpp2"}:{ext:"3gp",mime:"video/3gpp"}:{ext:"mp4",mime:"video/mp4"}}}if(a("MThd"))return{ext:"mid",mime:"audio/midi"};if(a("wOFF")&&(i([0,1,0,0],{offset:4})||a("OTTO",{offset:4})))return{ext:"woff",mime:"font/woff"};if(a("wOF2")&&(i([0,1,0,0],{offset:4})||a("OTTO",{offset:4})))return{ext:"woff2",mime:"font/woff2"};if(i([212,195,178,161])||i([161,178,195,212]))return{ext:"pcap",mime:"application/vnd.tcpdump.pcap"};if(a("DSD "))return{ext:"dsf",mime:"audio/x-dsf"};if(a("LZIP"))return{ext:"lz",mime:"application/x-lzip"};if(a("fLaC"))return{ext:"flac",mime:"audio/x-flac"};if(i([66,80,71,251]))return{ext:"bpg",mime:"image/bpg"};if(a("wvpk"))return{ext:"wv",mime:"audio/wavpack"};if(a("%PDF")){await e.ignore(1350);const h=10485760,c=Buffer.alloc(Math.min(h,e.fileInfo.size));return await e.readBuffer(c,{mayBeLess:!0}),c.includes(Buffer.from("AIPrivateData"))?{ext:"ai",mime:"application/postscript"}:{ext:"pdf",mime:"application/pdf"}}if(i([0,97,115,109]))return{ext:"wasm",mime:"application/wasm"};if(i([73,73,42,0]))return a("CR",{offset:8})?{ext:"cr2",mime:"image/x-canon-cr2"}:i([28,0,254,0],{offset:8})||i([31,0,11,0],{offset:8})?{ext:"nef",mime:"image/x-nikon-nef"}:i([8,0,0,0],{offset:4})&&(i([45,0,254,0],{offset:8})||i([39,0,254,0],{offset:8}))?{ext:"dng",mime:"image/x-adobe-dng"}:(t=Buffer.alloc(24),await e.peekBuffer(t),(i([16,251,134,1],{offset:4})||i([8,0,0,0],{offset:4}))&&i([0,254,0,4,0,1,0,0,0,1,0,0,0,3,1],{offset:9})?{ext:"arw",mime:"image/x-sony-arw"}:{ext:"tif",mime:"image/tiff"});if(i([77,77,0,42]))return{ext:"tif",mime:"image/tiff"};if(a("MAC "))return{ext:"ape",mime:"audio/ape"};if(i([26,69,223,163])){async function d(){const t=await e.peekNumber(Token.UINT8);let i=128,a=0;for(;!(t&i)&&0!==i;)++a,i>>=1;const r=Buffer.alloc(a+1);return await e.readBuffer(r),r}async function f(){const e=await d(),t=await d();t[0]^=128>>t.length-1;const i=Math.min(6,t.length);return{id:e.readUIntBE(0,e.length),len:t.readUIntBE(t.length-i,i)}}async function m(t,i){for(;i>0;){const t=await f();if(17026===t.id)return e.readToken(new Token.StringType(t.len,"utf-8"));await e.ignore(t.len),--i}}const p=await f();switch(await m(0,p.len)){case"webm":return{ext:"webm",mime:"video/webm"};case"matroska":return{ext:"mkv",mime:"video/x-matroska"};default:return}}if(i([82,73,70,70])){if(i([65,86,73],{offset:8}))return{ext:"avi",mime:"video/vnd.avi"};if(i([87,65,86,69],{offset:8}))return{ext:"wav",mime:"audio/vnd.wave"};if(i([81,76,67,77],{offset:8}))return{ext:"qcp",mime:"audio/qcelp"}}if(a("SQLi"))return{ext:"sqlite",mime:"application/x-sqlite3"};if(i([78,69,83,26]))return{ext:"nes",mime:"application/x-nintendo-nes-rom"};if(a("Cr24"))return{ext:"crx",mime:"application/x-google-chrome-extension"};if(a("MSCF")||a("ISc("))return{ext:"cab",mime:"application/vnd.ms-cab-compressed"};if(i([237,171,238,219]))return{ext:"rpm",mime:"application/x-rpm"};if(i([197,208,211,198]))return{ext:"eps",mime:"application/eps"};if(i([40,181,47,253]))return{ext:"zst",mime:"application/zstd"};if(i([79,84,84,79,0]))return{ext:"otf",mime:"font/otf"};if(a("#!AMR"))return{ext:"amr",mime:"audio/amr"};if(a("{\\rtf"))return{ext:"rtf",mime:"application/rtf"};if(i([70,76,86,1]))return{ext:"flv",mime:"video/x-flv"};if(a("IMPM"))return{ext:"it",mime:"audio/x-it"};if(a("-lh0-",{offset:2})||a("-lh1-",{offset:2})||a("-lh2-",{offset:2})||a("-lh3-",{offset:2})||a("-lh4-",{offset:2})||a("-lh5-",{offset:2})||a("-lh6-",{offset:2})||a("-lh7-",{offset:2})||a("-lzs-",{offset:2})||a("-lz4-",{offset:2})||a("-lz5-",{offset:2})||a("-lhd-",{offset:2}))return{ext:"lzh",mime:"application/x-lzh-compressed"};if(i([0,0,1,186])){if(i([33],{offset:4,mask:[241]}))return{ext:"mpg",mime:"video/MP1S"};if(i([68],{offset:4,mask:[196]}))return{ext:"mpg",mime:"video/MP2P"}}if(a("ITSF"))return{ext:"chm",mime:"application/vnd.ms-htmlhelp"};if(i([253,55,122,88,90,0]))return{ext:"xz",mime:"application/x-xz"};if(a("<?xml "))return{ext:"xml",mime:"application/xml"};if(i([55,122,188,175,39,28]))return{ext:"7z",mime:"application/x-7z-compressed"};if(i([82,97,114,33,26,7])&&(0===t[6]||1===t[6]))return{ext:"rar",mime:"application/x-rar-compressed"};if(a("solid "))return{ext:"stl",mime:"model/stl"};if(a("BLENDER"))return{ext:"blend",mime:"application/x-blender"};if(a("!<arch>")){await e.ignore(8);return"debian-binary"===await e.readToken(new Token.StringType(13,"ascii"))?{ext:"deb",mime:"application/x-deb"}:{ext:"ar",mime:"application/x-unix-archive"}}if(i([137,80,78,71,13,10,26,10])){async function _(){return{length:await e.readToken(Token.INT32_BE),type:await e.readToken(new Token.StringType(4,"binary"))}}await e.ignore(8);do{const g=await _();if(g.length<0)return;switch(g.type){case"IDAT":return{ext:"png",mime:"image/png"};case"acTL":return{ext:"apng",mime:"image/apng"};default:await e.ignore(g.length+4)}}while(e.position+8<e.fileInfo.size);return{ext:"png",mime:"image/png"}}if(i([65,82,82,79,87,49,0,0]))return{ext:"arrow",mime:"application/x-apache-arrow"};if(i([103,108,84,70,2,0,0,0]))return{ext:"glb",mime:"model/gltf-binary"};if(i([102,114,101,101],{offset:4})||i([109,100,97,116],{offset:4})||i([109,111,111,118],{offset:4})||i([119,105,100,101],{offset:4}))return{ext:"mov",mime:"video/quicktime"};if(i([73,73,82,79,8,0,0,0,24]))return{ext:"orf",mime:"image/x-olympus-orf"};if(a("gimp xcf "))return{ext:"xcf",mime:"image/x-xcf"};if(i([73,73,85,0,24,0,0,0,136,231,116,216]))return{ext:"rw2",mime:"image/x-panasonic-rw2"};if(i([48,38,178,117,142,102,207,17,166,217])){async function b(){const t=Buffer.alloc(16);return await e.readBuffer(t),{id:t,size:Number(await e.readToken(Token.UINT64_LE))}}for(await e.ignore(30);e.position+24<e.fileInfo.size;){const y=await b();let x=y.size-24;if(_check(y.id,[145,7,220,183,183,169,207,17,142,230,0,192,12,32,83,101])){const w=Buffer.alloc(16);if(x-=await e.readBuffer(w),_check(w,[64,158,105,248,77,91,207,17,168,253,0,128,95,92,68,43]))return{ext:"asf",mime:"audio/x-ms-asf"};if(_check(w,[192,239,25,188,77,91,207,17,168,253,0,128,95,92,68,43]))return{ext:"asf",mime:"video/x-ms-asf"};break}await e.ignore(x)}return{ext:"asf",mime:"application/vnd.ms-asf"}}if(i([171,75,84,88,32,49,49,187,13,10,26,10]))return{ext:"ktx",mime:"image/ktx"};if((i([126,16,4])||i([126,24,4]))&&i([48,77,73,69],{offset:4}))return{ext:"mie",mime:"application/x-mie"};if(i([39,10,0,0,0,0,0,0,0,0,0,0],{offset:2}))return{ext:"shp",mime:"application/x-esri-shape"};if(i([0,0,0,12,106,80,32,32,13,10,135,10])){await e.ignore(20);switch(await e.readToken(new Token.StringType(4,"ascii"))){case"jp2 ":return{ext:"jp2",mime:"image/jp2"};case"jpx ":return{ext:"jpx",mime:"image/jpx"};case"jpm ":return{ext:"jpm",mime:"image/jpm"};case"mjp2":return{ext:"mj2",mime:"image/mj2"};default:return}}if(i([255,10])||i([0,0,0,12,74,88,76,32,13,10,135,10]))return{ext:"jxl",mime:"image/jxl"};if(i([0,0,1,186])||i([0,0,1,179]))return{ext:"mpg",mime:"video/mpeg"};if(i([0,1,0,0,0]))return{ext:"ttf",mime:"font/ttf"};if(i([0,0,1,0]))return{ext:"ico",mime:"image/x-icon"};if(i([0,0,2,0]))return{ext:"cur",mime:"image/x-icon"};if(i([208,207,17,224,161,177,26,225]))return{ext:"cfb",mime:"application/x-cfb"};if(await e.peekBuffer(t,{length:Math.min(256,e.fileInfo.size),mayBeLess:!0}),a("BEGIN:")){if(a("VCARD",{offset:6}))return{ext:"vcf",mime:"text/vcard"};if(a("VCALENDAR",{offset:6}))return{ext:"ics",mime:"text/calendar"}}if(a("FUJIFILMCCD-RAW"))return{ext:"raf",mime:"image/x-fujifilm-raf"};if(a("Extended Module:"))return{ext:"xm",mime:"audio/x-xm"};if(a("Creative Voice File"))return{ext:"voc",mime:"audio/x-voc"};if(i([4,0,0,0])&&t.length>=16){const v=t.readUInt32LE(12);if(v>12&&t.length>=v+16)try{const k=t.slice(16,v+16).toString();if(JSON.parse(k).files)return{ext:"asar",mime:"application/x-asar"}}catch(M){}}if(i([6,14,43,52,2,5,1,1,13,1,2,1,1,2]))return{ext:"mxf",mime:"application/mxf"};if(a("SCRM",{offset:44}))return{ext:"s3m",mime:"audio/x-s3m"};if(i([71],{offset:4})&&(i([71],{offset:192})||i([71],{offset:196})))return{ext:"mts",mime:"video/mp2t"};if(i([66,79,79,75,77,79,66,73],{offset:60}))return{ext:"mobi",mime:"application/x-mobipocket-ebook"};if(i([68,73,67,77],{offset:128}))return{ext:"dcm",mime:"application/dicom"};if(i([76,0,0,0,1,20,2,0,0,0,0,0,192,0,0,0,0,0,0,70]))return{ext:"lnk",mime:"application/x.ms.shortcut"};if(i([98,111,111,107,0,0,0,0,109,97,114,107,0,0,0,0]))return{ext:"alias",mime:"application/x.apple.alias"};if(i([76,80],{offset:34})&&(i([0,0,1],{offset:8})||i([1,0,2],{offset:8})||i([2,0,2],{offset:8})))return{ext:"eot",mime:"application/vnd.ms-fontobject"};if(i([6,6,237,245,216,29,70,229,189,49,239,231,254,116,183,29]))return{ext:"indd",mime:"application/x-indesign"};if(await e.peekBuffer(t,{length:Math.min(512,e.fileInfo.size),mayBeLess:!0}),tarHeaderChecksumMatches(t))return{ext:"tar",mime:"application/x-tar"};if(i([255,254,255,14,83,0,107,0,101,0,116,0,99,0,104,0,85,0,112,0,32,0,77,0,111,0,100,0,101,0,108,0]))return{ext:"skp",mime:"application/vnd.sketchup.skp"};if(a("-----BEGIN PGP MESSAGE-----"))return{ext:"pgp",mime:"application/pgp-encrypted"};if(t.length>=2&&i([255,224],{offset:0,mask:[255,224]})){if(i([16],{offset:1,mask:[22]}))return i([8],{offset:1,mask:[8]}),{ext:"aac",mime:"audio/aac"};if(i([2],{offset:1,mask:[6]}))return{ext:"mp3",mime:"audio/mpeg"};if(i([4],{offset:1,mask:[6]}))return{ext:"mp2",mime:"audio/mpeg"};if(i([6],{offset:1,mask:[6]}))return{ext:"mp1",mime:"audio/mpeg"}}}const stream=readableStream=>new Promise(((resolve,reject)=>{const stream=eval("require")("stream");readableStream.on("error",reject),readableStream.once("readable",(async()=>{const e=new stream.PassThrough;let t;t=stream.pipeline?stream.pipeline(readableStream,e,(()=>{})):readableStream.pipe(e);const i=readableStream.read(minimumBytes)||readableStream.read()||Buffer.alloc(0);try{const t=await fromBuffer(i);e.fileType=t}catch(e){reject(e)}resolve(t)}))})),fileType={fromStream:fromStream,fromTokenizer:fromTokenizer,fromBuffer:fromBuffer,stream:stream};Object.defineProperty(fileType,"extensions",{get:()=>new Set(supported.extensions)}),Object.defineProperty(fileType,"mimeTypes",{get:()=>new Set(supported.mimeTypes)});var core=fileType,fileType$1=getDefaultExportFromCjs(core);function to(e,t){return e.then((function(e){return[null,e]})).catch((function(e){return t&&Object.assign(e,t),[e,void 0]}))}const readFile=require$$6.promises.readFile,writeFile=require$$6.promises.writeFile;function Mime$1(){this._types=Object.create(null),this._extensions=Object.create(null);for(let e=0;e<arguments.length;e++)this.define(arguments[e]);this.define=this.define.bind(this),this.getType=this.getType.bind(this),this.getExtension=this.getExtension.bind(this)}Mime$1.prototype.define=function(e,t){for(let i in e){let a=e[i].map((function(e){return e.toLowerCase()}));i=i.toLowerCase();for(let e=0;e<a.length;e++){const r=a[e];if("*"!==r[0]){if(!t&&r in this._types)throw new Error('Attempt to change mapping for "'+r+'" extension from "'+this._types[r]+'" to "'+i+'". Pass `force=true` to allow this, otherwise remove "'+r+'" from the list of extensions for "'+i+'".');this._types[r]=i}}if(t||!this._extensions[i]){const e=a[0];this._extensions[i]="*"!==e[0]?e:e.substr(1)}}},Mime$1.prototype.getType=function(e){let t=(e=String(e)).replace(/^.*[/\\]/,"").toLowerCase(),i=t.replace(/^.*\./,"").toLowerCase(),a=t.length<e.length;return(i.length<t.length-1||!a)&&this._types[i]||null},Mime$1.prototype.getExtension=function(e){return(e=/^\s*([^;\s]*)/.test(e)&&RegExp.$1)&&this._extensions[e.toLowerCase()]||null};var Mime_1=Mime$1,standard={"application/andrew-inset":["ez"],"application/applixware":["aw"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomdeleted+xml":["atomdeleted"],"application/atomsvc+xml":["atomsvc"],"application/atsc-dwd+xml":["dwd"],"application/atsc-held+xml":["held"],"application/atsc-rsat+xml":["rsat"],"application/bdoc":["bdoc"],"application/calendar+xml":["xcs"],"application/ccxml+xml":["ccxml"],"application/cdfx+xml":["cdfx"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cu-seeme":["cu"],"application/dash+xml":["mpd"],"application/davmount+xml":["davmount"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["es","ecma"],"application/emma+xml":["emma"],"application/emotionml+xml":["emotionml"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/express":["exp"],"application/fdt+xml":["fdt"],"application/font-tdpfr":["pfr"],"application/geo+json":["geojson"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/gzip":["gz"],"application/hjson":["hjson"],"application/hyperstudio":["stk"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/its+xml":["its"],"application/java-archive":["jar","war","ear"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["js","mjs"],"application/json":["json","map"],"application/json5":["json5"],"application/jsonml+json":["jsonml"],"application/ld+json":["jsonld"],"application/lgr+xml":["lgr"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/manifest+json":["webmanifest"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml"],"application/mbox":["mbox"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mmt-aei+xml":["maei"],"application/mmt-usd+xml":["musd"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["mp4s","m4p"],"application/msword":["doc","dot"],"application/mxf":["mxf"],"application/n-quads":["nq"],"application/n-triples":["nt"],"application/node":["cjs"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg"],"application/oxps":["oxps"],"application/p2p-overlay+xml":["relo"],"application/patch-ops-error+xml":["xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-signature":["asc","sig"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/provenance+xml":["provx"],"application/pskc+xml":["pskcxml"],"application/raml+yaml":["raml"],"application/rdf+xml":["rdf","owl"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/route-apd+xml":["rapd"],"application/route-s-tsid+xml":["sls"],"application/route-usd+xml":["rusd"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/senml+xml":["senmlx"],"application/sensml+xml":["sensmlx"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/sieve":["siv","sieve"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/swid+xml":["swidtag"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/toml":["toml"],"application/trig":["trig"],"application/ttml+xml":["ttml"],"application/ubjson":["ubj"],"application/urc-ressheet+xml":["rsheet"],"application/urc-targetdesc+xml":["td"],"application/voicexml+xml":["vxml"],"application/wasm":["wasm"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/xaml+xml":["xaml"],"application/xcap-att+xml":["xav"],"application/xcap-caps+xml":["xca"],"application/xcap-diff+xml":["xdf"],"application/xcap-el+xml":["xel"],"application/xcap-ns+xml":["xns"],"application/xenc+xml":["xenc"],"application/xhtml+xml":["xhtml","xht"],"application/xliff+xml":["xlf"],"application/xml":["xml","xsl","xsd","rng"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["*xsl","xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"audio/3gpp":["*3gpp"],"audio/adpcm":["adp"],"audio/amr":["amr"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mobile-xmf":["mxmf"],"audio/mp3":["*mp3"],"audio/mp4":["m4a","mp4a"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx","opus"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/wav":["wav"],"audio/wave":["*wav"],"audio/webm":["weba"],"audio/xm":["xm"],"font/collection":["ttc"],"font/otf":["otf"],"font/ttf":["ttf"],"font/woff":["woff"],"font/woff2":["woff2"],"image/aces":["exr"],"image/apng":["apng"],"image/avif":["avif"],"image/bmp":["bmp"],"image/cgm":["cgm"],"image/dicom-rle":["drle"],"image/emf":["emf"],"image/fits":["fits"],"image/g3fax":["g3"],"image/gif":["gif"],"image/heic":["heic"],"image/heic-sequence":["heics"],"image/heif":["heif"],"image/heif-sequence":["heifs"],"image/hej2k":["hej2"],"image/hsj2":["hsj2"],"image/ief":["ief"],"image/jls":["jls"],"image/jp2":["jp2","jpg2"],"image/jpeg":["jpeg","jpg","jpe"],"image/jph":["jph"],"image/jphc":["jhc"],"image/jpm":["jpm"],"image/jpx":["jpx","jpf"],"image/jxr":["jxr"],"image/jxra":["jxra"],"image/jxrs":["jxrs"],"image/jxs":["jxs"],"image/jxsc":["jxsc"],"image/jxsi":["jxsi"],"image/jxss":["jxss"],"image/ktx":["ktx"],"image/ktx2":["ktx2"],"image/png":["png"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/t38":["t38"],"image/tiff":["tif","tiff"],"image/tiff-fx":["tfx"],"image/webp":["webp"],"image/wmf":["wmf"],"message/disposition-notification":["disposition-notification"],"message/global":["u8msg"],"message/global-delivery-status":["u8dsn"],"message/global-disposition-notification":["u8mdn"],"message/global-headers":["u8hdr"],"message/rfc822":["eml","mime"],"model/3mf":["3mf"],"model/gltf+json":["gltf"],"model/gltf-binary":["glb"],"model/iges":["igs","iges"],"model/mesh":["msh","mesh","silo"],"model/mtl":["mtl"],"model/obj":["obj"],"model/step+xml":["stpx"],"model/step+zip":["stpz"],"model/step-xml+zip":["stpxz"],"model/stl":["stl"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["*x3db","x3dbz"],"model/x3d+fastinfoset":["x3db"],"model/x3d+vrml":["*x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"model/x3d-vrml":["x3dv"],"text/cache-manifest":["appcache","manifest"],"text/calendar":["ics","ifb"],"text/coffeescript":["coffee","litcoffee"],"text/css":["css"],"text/csv":["csv"],"text/html":["html","htm","shtml"],"text/jade":["jade"],"text/jsx":["jsx"],"text/less":["less"],"text/markdown":["markdown","md"],"text/mathml":["mml"],"text/mdx":["mdx"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in","ini"],"text/richtext":["rtx"],"text/rtf":["*rtf"],"text/sgml":["sgml","sgm"],"text/shex":["shex"],"text/slim":["slim","slm"],"text/spdx":["spdx"],"text/stylus":["stylus","styl"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vtt":["vtt"],"text/xml":["*xml"],"text/yaml":["yaml","yml"],"video/3gpp":["3gp","3gpp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/iso.segment":["m4s"],"video/jpeg":["jpgv"],"video/jpm":["*jpm","jpgm"],"video/mj2":["mj2","mjp2"],"video/mp2t":["ts"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/webm":["webm"]};let Mime=Mime_1;var lite=new Mime(standard),mime=getDefaultExportFromCjs(lite),HorizontalAlign,VerticalAlign,BlendMode;function srcOver(e,t,i=1){e.a*=i;const a=t.a+e.a-t.a*e.a;return{r:(e.r*e.a+t.r*t.a*(1-e.a))/a,g:(e.g*e.a+t.g*t.a*(1-e.a))/a,b:(e.b*e.a+t.b*t.a*(1-e.a))/a,a:a}}function dstOver(e,t,i=1){e.a*=i;const a=t.a+e.a-t.a*e.a;return{r:(t.r*t.a+e.r*e.a*(1-t.a))/a,g:(t.g*t.a+e.g*e.a*(1-t.a))/a,b:(t.b*t.a+e.b*e.a*(1-t.a))/a,a:a}}function multiply(e,t,i=1){e.a*=i;const a=t.a+e.a-t.a*e.a,r=e.r*e.a,n=e.g*e.a,s=e.b*e.a,o=t.r*t.a,l=t.g*t.a,u=t.b*t.a;return{r:(r*o+r*(1-t.a)+o*(1-e.a))/a,g:(n*l+n*(1-t.a)+l*(1-e.a))/a,b:(s*u+s*(1-t.a)+u*(1-e.a))/a,a:a}}function add(e,t,i=1){e.a*=i;const a=t.a+e.a-t.a*e.a,r=e.r*e.a,n=e.g*e.a,s=e.b*e.a;return{r:(r+t.r*t.a)/a,g:(n+t.g*t.a)/a,b:(s+t.b*t.a)/a,a:a}}function screen(e,t,i=1){e.a*=i;const a=t.a+e.a-t.a*e.a,r=e.r*e.a,n=e.g*e.a,s=e.b*e.a,o=t.r*t.a,l=t.g*t.a,u=t.b*t.a;return{r:(r*t.a+o*e.a-r*o+r*(1-t.a)+o*(1-e.a))/a,g:(n*t.a+l*e.a-n*l+n*(1-t.a)+l*(1-e.a))/a,b:(s*t.a+u*e.a-s*u+s*(1-t.a)+u*(1-e.a))/a,a:a}}function overlay(e,t,i=1){e.a*=i;const a=t.a+e.a-t.a*e.a,r=e.r*e.a,n=e.g*e.a,s=e.b*e.a,o=t.r*t.a,l=t.g*t.a,u=t.b*t.a;return{r:(2*o<=t.a?2*r*o+r*(1-t.a)+o*(1-e.a):r*(1+t.a)+o*(1+e.a)-2*o*r-t.a*e.a)/a,g:(2*l<=t.a?2*n*l+n*(1-t.a)+l*(1-e.a):n*(1+t.a)+l*(1+e.a)-2*l*n-t.a*e.a)/a,b:(2*u<=t.a?2*s*u+s*(1-t.a)+u*(1-e.a):s*(1+t.a)+u*(1+e.a)-2*u*s-t.a*e.a)/a,a:a}}function darken(e,t,i=1){e.a*=i;const a=t.a+e.a-t.a*e.a,r=e.r*e.a,n=e.g*e.a,s=e.b*e.a,o=t.r*t.a,l=t.g*t.a,u=t.b*t.a;return{r:(Math.min(r*t.a,o*e.a)+r*(1-t.a)+o*(1-e.a))/a,g:(Math.min(n*t.a,l*e.a)+n*(1-t.a)+l*(1-e.a))/a,b:(Math.min(s*t.a,u*e.a)+s*(1-t.a)+u*(1-e.a))/a,a:a}}function lighten(e,t,i=1){e.a*=i;const a=t.a+e.a-t.a*e.a,r=e.r*e.a,n=e.g*e.a,s=e.b*e.a,o=t.r*t.a,l=t.g*t.a,u=t.b*t.a;return{r:(Math.max(r*t.a,o*e.a)+r*(1-t.a)+o*(1-e.a))/a,g:(Math.max(n*t.a,l*e.a)+n*(1-t.a)+l*(1-e.a))/a,b:(Math.max(s*t.a,u*e.a)+s*(1-t.a)+u*(1-e.a))/a,a:a}}function hardLight(e,t,i=1){e.a*=i;const a=t.a+e.a-t.a*e.a,r=e.r*e.a,n=e.g*e.a,s=e.b*e.a,o=t.r*t.a,l=t.g*t.a,u=t.b*t.a;return{r:(2*r<=e.a?2*r*o+r*(1-t.a)+o*(1-e.a):r*(1+t.a)+o*(1+e.a)-2*o*r-t.a*e.a)/a,g:(2*n<=e.a?2*n*l+n*(1-t.a)+l*(1-e.a):n*(1+t.a)+l*(1+e.a)-2*l*n-t.a*e.a)/a,b:(2*s<=e.a?2*s*u+s*(1-t.a)+u*(1-e.a):s*(1+t.a)+u*(1+e.a)-2*u*s-t.a*e.a)/a,a:a}}function difference(e,t,i=1){e.a*=i;const a=t.a+e.a-t.a*e.a,r=e.r*e.a,n=e.g*e.a,s=e.b*e.a,o=t.r*t.a,l=t.g*t.a,u=t.b*t.a;return{r:(r+o-2*Math.min(r*t.a,o*e.a))/a,g:(n+l-2*Math.min(n*t.a,l*e.a))/a,b:(s+u-2*Math.min(s*t.a,u*e.a))/a,a:a}}function exclusion(e,t,i=1){e.a*=i;const a=t.a+e.a-t.a*e.a,r=e.r*e.a,n=e.g*e.a,s=e.b*e.a,o=t.r*t.a,l=t.g*t.a,u=t.b*t.a;return{r:(r*t.a+o*e.a-2*r*o+r*(1-t.a)+o*(1-e.a))/a,g:(n*t.a+l*e.a-2*n*l+n*(1-t.a)+l*(1-e.a))/a,b:(s*t.a+u*e.a-2*s*u+s*(1-t.a)+u*(1-e.a))/a,a:a}}!function(e){e[e.LEFT=1]="LEFT",e[e.CENTER=2]="CENTER",e[e.RIGHT=4]="RIGHT"}(HorizontalAlign||(HorizontalAlign={})),function(e){e[e.TOP=8]="TOP",e[e.MIDDLE=16]="MIDDLE",e[e.BOTTOM=32]="BOTTOM"}(VerticalAlign||(VerticalAlign={})),function(e){e.SRC_OVER="srcOver",e.DST_OVER="dstOver",e.MULTIPLY="multiply",e.ADD="add",e.SCREEN="screen",e.OVERLAY="overlay",e.DARKEN="darken",e.LIGHTEN="lighten",e.HARD_LIGHT="hardLight",e.DIFFERENCE="difference",e.EXCLUSION="exclusion"}(BlendMode||(BlendMode={}));const names=[srcOver,dstOver,multiply,add,screen,overlay,darken,lighten,hardLight,difference,exclusion];var compositeModes=Object.freeze({__proto__:null,add:add,darken:darken,difference:difference,dstOver:dstOver,exclusion:exclusion,hardLight:hardLight,lighten:lighten,multiply:multiply,names:names,overlay:overlay,screen:screen,srcOver:srcOver});function composite(e,t,i=0,a=0,r={}){if(!(t instanceof e.constructor))throw new Error("The source must be a Jimp image");if("number"!=typeof i||"number"!=typeof a)throw new Error("x and y must be numbers");const{mode:n=BlendMode.SRC_OVER}=r;let{opacitySource:s=1,opacityDest:o=1}=r;("number"!=typeof s||s<0||s>1)&&(s=1),("number"!=typeof o||o<0||o>1)&&(o=1);const l=compositeModes[n];return i=Math.round(i),a=Math.round(a),1!==o&&e.scan(((t,i,a)=>{const r=e.bitmap.data[a+3]*o;e.bitmap.data[a+3]=r})),t.scan(((r,n,o)=>{const u=e.getPixelIndex(i+r,a+n,Edge.CROP);if(-1===u)return;const h=l({r:t.bitmap.data[o+0]/255,g:t.bitmap.data[o+1]/255,b:t.bitmap.data[o+2]/255,a:t.bitmap.data[o+3]/255},{r:e.bitmap.data[u+0]/255,g:e.bitmap.data[u+1]/255,b:e.bitmap.data[u+2]/255,a:e.bitmap.data[u+3]/255},s);e.bitmap.data[u+0]=limit255(255*h.r),e.bitmap.data[u+1]=limit255(255*h.g),e.bitmap.data[u+2]=limit255(255*h.b),e.bitmap.data[u+3]=limit255(255*h.a)})),e}var jpeg$1={parseSections:function(e,t){var i,a;for(e.setBigEndian(!0);e.remainingLength()>0&&218!==a;){if(255!==e.nextUInt8())throw new Error("Invalid JPEG section offset");i=(a=e.nextUInt8())>=208&&a<=217||218===a?0:e.nextUInt16()-2,t(a,e.branch(0,i)),e.skip(i)}},getSizeFromSOFSection:function(e){return e.skip(1),{height:e.nextUInt16(),width:e.nextUInt16()}},getSectionName:function(e){var t,i;switch(e){case 216:t="SOI";break;case 196:t="DHT";break;case 219:t="DQT";break;case 221:t="DRI";break;case 218:t="SOS";break;case 254:t="COM";break;case 217:t="EOI";break;default:e>=224&&e<=239?(t="APP",i=e-224):e>=192&&e<=207&&196!==e&&200!==e&&204!==e?(t="SOF",i=e-192):e>=208&&e<=215&&(t="RST",i=e-208)}var a={name:t};return"number"==typeof i&&(a.index=i),a}};function readExifValue(e,t){switch(e){case 1:return t.nextUInt8();case 3:case 8:return t.nextUInt16();case 4:case 9:return t.nextUInt32();case 5:return[t.nextUInt32(),t.nextUInt32()];case 6:return t.nextInt8();case 10:return[t.nextInt32(),t.nextInt32()];case 11:return t.nextFloat();case 12:return t.nextDouble();default:throw new Error("Invalid format while decoding: "+e)}}function getBytesPerComponent(e){switch(e){case 1:case 2:case 6:case 7:return 1;case 3:case 8:return 2;case 4:case 9:case 11:return 4;case 5:case 10:case 12:return 8;default:return 0}}function readExifTag(e,t){var i,a,r=t.nextUInt16(),n=t.nextUInt16(),s=getBytesPerComponent(n),o=t.nextUInt32(),l=s*o;if(l>4&&(t=e.openWithOffset(t.nextUInt32())),2===n){var u=(i=t.nextString(o)).indexOf("\0");-1!==u&&(i=i.substr(0,u))}else if(7===n)i=t.nextBuffer(o);else if(0!==n)for(i=[],a=0;a<o;++a)i.push(readExifValue(n,t));return l<4&&t.skip(4-l),[r,i,n]}function readIFDSection(e,t,i){var a,r,n=t.nextUInt16();for(r=0;r<n;++r)i((a=readExifTag(e,t))[0],a[1],a[2])}function readHeader(e){if("Exif\0\0"!==e.nextString(6))throw new Error("Invalid EXIF header");var t=e.mark(),i=e.nextUInt16();if(18761===i)e.setBigEndian(!1);else{if(19789!==i)throw new Error("Invalid TIFF header");e.setBigEndian(!0)}if(42!==e.nextUInt16())throw new Error("Invalid TIFF data");return t}var exif$2={IFD0:1,IFD1:2,GPSIFD:3,SubIFD:4,InteropIFD:5,parseTags:function(e,t){var i,a,r,n;try{i=readHeader(e)}catch(e){return!1}var s=i.openWithOffset(e.nextUInt32()),o=this.IFD0;readIFDSection(i,s,(function(e,i,n){switch(e){case 34853:r=i[0];break;case 34665:a=i[0];break;default:t(o,e,i,n)}}));var l=s.nextUInt32();if(0!==l){var u=i.openWithOffset(l);readIFDSection(i,u,t.bind(null,this.IFD1))}if(r){var h=i.openWithOffset(r);readIFDSection(i,h,t.bind(null,this.GPSIFD))}if(a){var c=i.openWithOffset(a),d=this.InteropIFD;readIFDSection(i,c,(function(e,i,a){40965===e?n=i[0]:t(d,e,i,a)}))}if(n){var f=i.openWithOffset(n);readIFDSection(i,f,t.bind(null,this.InteropIFD))}return!0}};function parseNumber(e){return parseInt(e,10)}var hours=3600,minutes=60;function parseDateTimeParts(e,t){e=e.map(parseNumber),t=t.map(parseNumber);var i=e[0],a=e[1]-1,r=e[2],n=t[0],s=t[1],o=t[2];return Date.UTC(i,a,r,n,s,o,0)/1e3}function parseDateWithTimezoneFormat(e){var t=e.substr(0,10).split("-"),i=e.substr(11,8).split(":"),a=e.substr(19,6).split(":").map(parseNumber),r=a[0]*hours+a[1]*minutes,n=parseDateTimeParts(t,i);if("number"==typeof(n-=r)&&!isNaN(n))return n}function parseDateWithSpecFormat(e){var t=e.split(" "),i=parseDateTimeParts(t[0].split(":"),t[1].split(":"));if("number"==typeof i&&!isNaN(i))return i}function parseExifDate(e){var t=19===e.length&&":"===e.charAt(4);return 25===e.length&&"T"===e.charAt(10)?parseDateWithTimezoneFormat(e):t?parseDateWithSpecFormat(e):void 0}var date$1={parseDateWithSpecFormat:parseDateWithSpecFormat,parseDateWithTimezoneFormat:parseDateWithTimezoneFormat,parseExifDate:parseExifDate},exif$1=exif$2,date=date$1,degreeTags=[{section:exif$1.GPSIFD,type:2,name:"GPSLatitude",refType:1,refName:"GPSLatitudeRef",posVal:"N"},{section:exif$1.GPSIFD,type:4,name:"GPSLongitude",refType:3,refName:"GPSLongitudeRef",posVal:"E"}],dateTags=[{section:exif$1.SubIFD,type:306,name:"ModifyDate"},{section:exif$1.SubIFD,type:36867,name:"DateTimeOriginal"},{section:exif$1.SubIFD,type:36868,name:"CreateDate"},{section:exif$1.SubIFD,type:306,name:"ModifyDate"}],simplify$1={castDegreeValues:function(e,t){degreeTags.forEach((function(i){var a=e(i);if(a){var r=e({section:i.section,type:i.refType,name:i.refName})===i.posVal?1:-1,n=(a[0]+a[1]/60+a[2]/3600)*r;t(i,n)}}))},castDateValues:function(e,t){dateTags.forEach((function(i){var a=e(i);if(a){var r=date.parseExifDate(a);void 0!==r&&t(i,r)}}))},simplifyValue:function(e,t){return Array.isArray(e)&&1===(e=e.map((function(e){return 10===t||5===t?e[0]/e[1]:e}))).length&&(e=e[0]),e}},exifTags,hasRequiredExifTags;function requireExifTags(){return hasRequiredExifTags?exifTags:(hasRequiredExifTags=1,exifTags={exif:{1:"InteropIndex",2:"InteropVersion",11:"ProcessingSoftware",254:"SubfileType",255:"OldSubfileType",256:"ImageWidth",257:"ImageHeight",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",263:"Thresholding",264:"CellWidth",265:"CellLength",266:"FillOrder",269:"DocumentName",270:"ImageDescription",271:"Make",272:"Model",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",280:"MinSampleValue",281:"MaxSampleValue",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",285:"PageName",286:"XPosition",287:"YPosition",288:"FreeOffsets",289:"FreeByteCounts",290:"GrayResponseUnit",291:"GrayResponseCurve",292:"T4Options",293:"T6Options",296:"ResolutionUnit",297:"PageNumber",300:"ColorResponseUnit",301:"TransferFunction",305:"Software",306:"ModifyDate",315:"Artist",316:"HostComputer",317:"Predictor",318:"WhitePoint",319:"PrimaryChromaticities",320:"ColorMap",321:"HalftoneHints",322:"TileWidth",323:"TileLength",324:"TileOffsets",325:"TileByteCounts",326:"BadFaxLines",327:"CleanFaxData",328:"ConsecutiveBadFaxLines",330:"SubIFD",332:"InkSet",333:"InkNames",334:"NumberofInks",336:"DotRange",337:"TargetPrinter",338:"ExtraSamples",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",342:"TransferRange",343:"ClipPath",344:"XClipPathUnits",345:"YClipPathUnits",346:"Indexed",347:"JPEGTables",351:"OPIProxy",400:"GlobalParametersIFD",401:"ProfileType",402:"FaxProfile",403:"CodingMethods",404:"VersionYear",405:"ModeNumber",433:"Decode",434:"DefaultImageColor",435:"T82Options",437:"JPEGTables",512:"JPEGProc",513:"ThumbnailOffset",514:"ThumbnailLength",515:"JPEGRestartInterval",517:"JPEGLosslessPredictors",518:"JPEGPointTransforms",519:"JPEGQTables",520:"JPEGDCTables",521:"JPEGACTables",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite",559:"StripRowCounts",700:"ApplicationNotes",999:"USPTOMiscellaneous",4096:"RelatedImageFileFormat",4097:"RelatedImageWidth",4098:"RelatedImageHeight",18246:"Rating",18247:"XP_DIP_XML",18248:"StitchInfo",18249:"RatingPercent",32781:"ImageID",32931:"WangTag1",32932:"WangAnnotation",32933:"WangTag3",32934:"WangTag4",32995:"Matteing",32996:"DataType",32997:"ImageDepth",32998:"TileDepth",33405:"Model2",33421:"CFARepeatPatternDim",33422:"CFAPattern2",33423:"BatteryLevel",33424:"KodakIFD",33432:"Copyright",33434:"ExposureTime",33437:"FNumber",33445:"MDFileTag",33446:"MDScalePixel",33447:"MDColorTable",33448:"MDLabName",33449:"MDSampleInfo",33450:"MDPrepDate",33451:"MDPrepTime",33452:"MDFileUnits",33550:"PixelScale",33589:"AdventScale",33590:"AdventRevision",33628:"UIC1Tag",33629:"UIC2Tag",33630:"UIC3Tag",33631:"UIC4Tag",33723:"IPTC-NAA",33918:"IntergraphPacketData",33919:"IntergraphFlagRegisters",33920:"IntergraphMatrix",33921:"INGRReserved",33922:"ModelTiePoint",34016:"Site",34017:"ColorSequence",34018:"IT8Header",34019:"RasterPadding",34020:"BitsPerRunLength",34021:"BitsPerExtendedRunLength",34022:"ColorTable",34023:"ImageColorIndicator",34024:"BackgroundColorIndicator",34025:"ImageColorValue",34026:"BackgroundColorValue",34027:"PixelIntensityRange",34028:"TransparencyIndicator",34029:"ColorCharacterization",34030:"HCUsage",34031:"TrapIndicator",34032:"CMYKEquivalent",34118:"SEMInfo",34152:"AFCP_IPTC",34232:"PixelMagicJBIGOptions",34264:"ModelTransform",34306:"WB_GRGBLevels",34310:"LeafData",34377:"PhotoshopSettings",34665:"ExifOffset",34675:"ICC_Profile",34687:"TIFF_FXExtensions",34688:"MultiProfiles",34689:"SharedData",34690:"T88Options",34732:"ImageLayer",34735:"GeoTiffDirectory",34736:"GeoTiffDoubleParams",34737:"GeoTiffAsciiParams",34850:"ExposureProgram",34852:"SpectralSensitivity",34853:"GPSInfo",34855:"ISO",34856:"Opto-ElectricConvFactor",34857:"Interlace",34858:"TimeZoneOffset",34859:"SelfTimerMode",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",34908:"FaxRecvParams",34909:"FaxSubAddress",34910:"FaxRecvTime",34954:"LeafSubIFD",36864:"ExifVersion",36867:"DateTimeOriginal",36868:"CreateDate",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureCompensation",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",37387:"FlashEnergy",37388:"SpatialFrequencyResponse",37389:"Noise",37390:"FocalPlaneXResolution",37391:"FocalPlaneYResolution",37392:"FocalPlaneResolutionUnit",37393:"ImageNumber",37394:"SecurityClassification",37395:"ImageHistory",37396:"SubjectArea",37397:"ExposureIndex",37398:"TIFF-EPStandardID",37399:"SensingMethod",37434:"CIP3DataFile",37435:"CIP3Sheet",37436:"CIP3Side",37439:"StoNits",37500:"MakerNote",37510:"UserComment",37520:"SubSecTime",37521:"SubSecTimeOriginal",37522:"SubSecTimeDigitized",37679:"MSDocumentText",37680:"MSPropertySetStorage",37681:"MSDocumentTextPosition",37724:"ImageSourceData",40091:"XPTitle",40092:"XPComment",40093:"XPAuthor",40094:"XPKeywords",40095:"XPSubject",40960:"FlashpixVersion",40961:"ColorSpace",40962:"ExifImageWidth",40963:"ExifImageHeight",40964:"RelatedSoundFile",40965:"InteropOffset",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41485:"Noise",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41489:"ImageNumber",41490:"SecurityClassification",41491:"ImageHistory",41492:"SubjectLocation",41493:"ExposureIndex",41494:"TIFF-EPStandardID",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFormat",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"OwnerName",42033:"SerialNumber",42034:"LensInfo",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber",42112:"GDALMetadata",42113:"GDALNoData",42240:"Gamma",44992:"ExpandSoftware",44993:"ExpandLens",44994:"ExpandFilm",44995:"ExpandFilterLens",44996:"ExpandScanner",44997:"ExpandFlashLamp",48129:"PixelFormat",48130:"Transformation",48131:"Uncompressed",48132:"ImageType",48256:"ImageWidth",48257:"ImageHeight",48258:"WidthResolution",48259:"HeightResolution",48320:"ImageOffset",48321:"ImageByteCount",48322:"AlphaOffset",48323:"AlphaByteCount",48324:"ImageDataDiscard",48325:"AlphaDataDiscard",50215:"OceScanjobDesc",50216:"OceApplicationSelector",50217:"OceIDNumber",50218:"OceImageLogic",50255:"Annotations",50341:"PrintIM",50560:"USPTOOriginalContentType",50706:"DNGVersion",50707:"DNGBackwardVersion",50708:"UniqueCameraModel",50709:"LocalizedCameraModel",50710:"CFAPlaneColor",50711:"CFALayout",50712:"LinearizationTable",50713:"BlackLevelRepeatDim",50714:"BlackLevel",50715:"BlackLevelDeltaH",50716:"BlackLevelDeltaV",50717:"WhiteLevel",50718:"DefaultScale",50719:"DefaultCropOrigin",50720:"DefaultCropSize",50721:"ColorMatrix1",50722:"ColorMatrix2",50723:"CameraCalibration1",50724:"CameraCalibration2",50725:"ReductionMatrix1",50726:"ReductionMatrix2",50727:"AnalogBalance",50728:"AsShotNeutral",50729:"AsShotWhiteXY",50730:"BaselineExposure",50731:"BaselineNoise",50732:"BaselineSharpness",50733:"BayerGreenSplit",50734:"LinearResponseLimit",50735:"CameraSerialNumber",50736:"DNGLensInfo",50737:"ChromaBlurRadius",50738:"AntiAliasStrength",50739:"ShadowScale",50740:"DNGPrivateData",50741:"MakerNoteSafety",50752:"RawImageSegmentation",50778:"CalibrationIlluminant1",50779:"CalibrationIlluminant2",50780:"BestQualityScale",50781:"RawDataUniqueID",50784:"AliasLayerMetadata",50827:"OriginalRawFileName",50828:"OriginalRawFileData",50829:"ActiveArea",50830:"MaskedAreas",50831:"AsShotICCProfile",50832:"AsShotPreProfileMatrix",50833:"CurrentICCProfile",50834:"CurrentPreProfileMatrix",50879:"ColorimetricReference",50898:"PanasonicTitle",50899:"PanasonicTitle2",50931:"CameraCalibrationSig",50932:"ProfileCalibrationSig",50933:"ProfileIFD",50934:"AsShotProfileName",50935:"NoiseReductionApplied",50936:"ProfileName",50937:"ProfileHueSatMapDims",50938:"ProfileHueSatMapData1",50939:"ProfileHueSatMapData2",50940:"ProfileToneCurve",50941:"ProfileEmbedPolicy",50942:"ProfileCopyright",50964:"ForwardMatrix1",50965:"ForwardMatrix2",50966:"PreviewApplicationName",50967:"PreviewApplicationVersion",50968:"PreviewSettingsName",50969:"PreviewSettingsDigest",50970:"PreviewColorSpace",50971:"PreviewDateTime",50972:"RawImageDigest",50973:"OriginalRawFileDigest",50974:"SubTileBlockSize",50975:"RowInterleaveFactor",50981:"ProfileLookTableDims",50982:"ProfileLookTableData",51008:"OpcodeList1",51009:"OpcodeList2",51022:"OpcodeList3",51041:"NoiseProfile",51043:"TimeCodes",51044:"FrameRate",51058:"TStop",51081:"ReelName",51089:"OriginalDefaultFinalSize",51090:"OriginalBestQualitySize",51091:"OriginalDefaultCropSize",51105:"CameraLabel",51107:"ProfileHueSatMapEncoding",51108:"ProfileLookTableEncoding",51109:"BaselineExposureOffset",51110:"DefaultBlackRender",51111:"NewRawImageDigest",51112:"RawToPreviewGain",51125:"DefaultUserCrop",59932:"Padding",59933:"OffsetSchema",65e3:"OwnerName",65001:"SerialNumber",65002:"Lens",65024:"KDC_IFD",65100:"RawFile",65101:"Converter",65102:"WhiteBalance",65105:"Exposure",65106:"Shadows",65107:"Brightness",65108:"Contrast",65109:"Saturation",65110:"Sharpness",65111:"Smoothness",65112:"MoireFilter"},gps:{0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"}})}var jpeg=jpeg$1,exif=exif$2,simplify=simplify$1;function ExifResult(e,t,i,a,r,n,s){this.startMarker=e,this.tags=t,this.imageSize=i,this.thumbnailOffset=a,this.thumbnailLength=r,this.thumbnailType=n,this.app1Offset=s}function Parser$1(e){this.stream=e,this.flags={readBinaryTags:!1,resolveTagNames:!0,simplifyValues:!0,imageSize:!0,hidePointers:!0,returnTags:!0}}ExifResult.prototype={hasThumbnail:function(e){return!(!this.thumbnailOffset||!this.thumbnailLength)&&("string"!=typeof e||("image/jpeg"===e.toLowerCase().trim()?6===this.thumbnailType:"image/tiff"===e.toLowerCase().trim()&&1===this.thumbnailType))},getThumbnailOffset:function(){return this.app1Offset+6+this.thumbnailOffset},getThumbnailLength:function(){return this.thumbnailLength},getThumbnailBuffer:function(){return this._getThumbnailStream().nextBuffer(this.thumbnailLength)},_getThumbnailStream:function(){return this.startMarker.openWithOffset(this.getThumbnailOffset())},getImageSize:function(){return this.imageSize},getThumbnailSize:function(){var e,t=this._getThumbnailStream();return jpeg.parseSections(t,(function(t,i){"SOF"===jpeg.getSectionName(t).name&&(e=jpeg.getSizeFromSOFSection(i))})),e}},Parser$1.prototype={enableBinaryFields:function(e){return this.flags.readBinaryTags=!!e,this},enablePointers:function(e){return this.flags.hidePointers=!e,this},enableTagNames:function(e){return this.flags.resolveTagNames=!!e,this},enableImageSize:function(e){return this.flags.imageSize=!!e,this},enableReturnTags:function(e){return this.flags.returnTags=!!e,this},enableSimpleValues:function(e){return this.flags.simplifyValues=!!e,this},parse:function(){var e,t,i,a,r,n,s,o,l,u=this.stream.mark(),h=u.openWithOffset(0),c=this.flags;return c.resolveTagNames&&(s=requireExifTags()),c.resolveTagNames?(e={},o=function(t){return e[t.name]},l=function(t,i){e[t.name]=i}):(e=[],o=function(t){var i;for(i=0;i<e.length;++i)if(e[i].type===t.type&&e[i].section===t.section)return e.value},l=function(t,i){var a;for(a=0;a<e.length;++a)if(e[a].type===t.type&&e[a].section===t.section)return void(e.value=i)}),jpeg.parseSections(h,(function(o,l){var h=l.offsetFrom(u);225===o?exif.parseTags(l,(function(t,n,o,l){if(c.readBinaryTags||7!==l){if(513===n){if(i=o[0],c.hidePointers)return}else if(514===n){if(a=o[0],c.hidePointers)return}else if(259===n&&(r=o[0],c.hidePointers))return;if(c.returnTags)if(c.simplifyValues&&(o=simplify.simplifyValue(o,l)),c.resolveTagNames){var u=(t===exif.GPSIFD?s.gps:s.exif)[n];u||(u=s.exif[n]),e.hasOwnProperty(u)||(e[u]=o)}else e.push({section:t,type:n,value:o})}}))&&(n=h):c.imageSize&&"SOF"===jpeg.getSectionName(o).name&&(t=jpeg.getSizeFromSOFSection(l))})),c.simplifyValues&&(simplify.castDegreeValues(o,l),simplify.castDateValues(o,l)),new ExifResult(u,e,t,i,a,r,n)}};var parser=Parser$1,domBufferstream,hasRequiredDomBufferstream,bufferstream,hasRequiredBufferstream;function requireDomBufferstream(){if(hasRequiredDomBufferstream)return domBufferstream;function e(e,t,i,a,r,n){this.global=r,t=t||0,i=i||e.byteLength-t,this.arrayBuffer=e.slice(t,t+i),this.view=new r.DataView(this.arrayBuffer,0,this.arrayBuffer.byteLength),this.setBigEndian(a),this.offset=0,this.parentOffset=(n||0)+t}return hasRequiredDomBufferstream=1,e.prototype={setBigEndian:function(e){this.littleEndian=!e},nextUInt8:function(){var e=this.view.getUint8(this.offset);return this.offset+=1,e},nextInt8:function(){var e=this.view.getInt8(this.offset);return this.offset+=1,e},nextUInt16:function(){var e=this.view.getUint16(this.offset,this.littleEndian);return this.offset+=2,e},nextUInt32:function(){var e=this.view.getUint32(this.offset,this.littleEndian);return this.offset+=4,e},nextInt16:function(){var e=this.view.getInt16(this.offset,this.littleEndian);return this.offset+=2,e},nextInt32:function(){var e=this.view.getInt32(this.offset,this.littleEndian);return this.offset+=4,e},nextFloat:function(){var e=this.view.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e},nextDouble:function(){var e=this.view.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e},nextBuffer:function(e){var t=this.arrayBuffer.slice(this.offset,this.offset+e);return this.offset+=e,t},remainingLength:function(){return this.arrayBuffer.byteLength-this.offset},nextString:function(e){var t=this.arrayBuffer.slice(this.offset,this.offset+e);return t=String.fromCharCode.apply(null,new this.global.Uint8Array(t)),this.offset+=e,t},mark:function(){var t=this;return{openWithOffset:function(i){return i=(i||0)+this.offset,new e(t.arrayBuffer,i,t.arrayBuffer.byteLength-i,!t.littleEndian,t.global,t.parentOffset)},offset:this.offset,getParentOffset:function(){return t.parentOffset}}},offsetFrom:function(e){return this.parentOffset+this.offset-(e.offset+e.getParentOffset())},skip:function(e){this.offset+=e},branch:function(t,i){return i="number"==typeof i?i:this.arrayBuffer.byteLength-(this.offset+t),new e(this.arrayBuffer,this.offset+t,i,!this.littleEndian,this.global,this.parentOffset)}},domBufferstream=e}function requireBufferstream(){if(hasRequiredBufferstream)return bufferstream;function e(e,t,i,a){this.buffer=e,this.offset=t||0,i="number"==typeof i?i:e.length,this.endPosition=this.offset+i,this.setBigEndian(a)}return hasRequiredBufferstream=1,e.prototype={setBigEndian:function(e){this.bigEndian=!!e},nextUInt8:function(){var e=this.buffer.readUInt8(this.offset);return this.offset+=1,e},nextInt8:function(){var e=this.buffer.readInt8(this.offset);return this.offset+=1,e},nextUInt16:function(){var e=this.bigEndian?this.buffer.readUInt16BE(this.offset):this.buffer.readUInt16LE(this.offset);return this.offset+=2,e},nextUInt32:function(){var e=this.bigEndian?this.buffer.readUInt32BE(this.offset):this.buffer.readUInt32LE(this.offset);return this.offset+=4,e},nextInt16:function(){var e=this.bigEndian?this.buffer.readInt16BE(this.offset):this.buffer.readInt16LE(this.offset);return this.offset+=2,e},nextInt32:function(){var e=this.bigEndian?this.buffer.readInt32BE(this.offset):this.buffer.readInt32LE(this.offset);return this.offset+=4,e},nextFloat:function(){var e=this.bigEndian?this.buffer.readFloatBE(this.offset):this.buffer.readFloatLE(this.offset);return this.offset+=4,e},nextDouble:function(){var e=this.bigEndian?this.buffer.readDoubleBE(this.offset):this.buffer.readDoubleLE(this.offset);return this.offset+=8,e},nextBuffer:function(e){var t=this.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t},remainingLength:function(){return this.endPosition-this.offset},nextString:function(e){var t=this.buffer.toString("utf8",this.offset,this.offset+e);return this.offset+=e,t},mark:function(){var t=this;return{openWithOffset:function(i){return i=(i||0)+this.offset,new e(t.buffer,i,t.endPosition-i,t.bigEndian)},offset:this.offset}},offsetFrom:function(e){return this.offset-e.offset},skip:function(e){this.offset+=e},branch:function(t,i){return i="number"==typeof i?i:this.endPosition-(this.offset+t),new e(this.buffer,this.offset+t,i,this.bigEndian)}},bufferstream=e}var Parser=parser;function getGlobal(){return(0,eval)("this")}var exifParser={create:function(e,t){if(e instanceof(t=t||getGlobal()).ArrayBuffer){var i=requireDomBufferstream();return new Parser(new i(e,0,e.byteLength,!0,t))}var a=requireBufferstream();return new Parser(new a(e,0,e.length,!0))}},EXIFParser=getDefaultExportFromCjs(exifParser);function getExifOrientation(e){const t=e._exif;return t&&t.tags&&t.tags.Orientation||1}function getExifOrientationTransformation(e){const t=e.bitmap.width,i=e.bitmap.height;switch(getExifOrientation(e)){case 1:default:return null;case 2:return function(e,i){return[t-e-1,i]};case 3:return function(e,a){return[t-e-1,i-a-1]};case 4:return function(e,t){return[e,i-t-1]};case 5:return function(e,t){return[t,e]};case 6:return function(e,t){return[t,i-e-1]};case 7:return function(e,a){return[t-a-1,i-e-1]};case 8:return function(e,i){return[t-i-1,e]}}}function transformBitmap(e,t,i,a){const r=e.bitmap.data,n=e.bitmap.width,s=Buffer.alloc(r.length);for(let e=0;e<t;e++)for(let o=0;o<i;o++){const[i,l]=a(e,o),u=t*o+e<<2,h=n*l+i<<2,c=r.readUInt32BE(h);s.writeUInt32BE(c,u)}e.bitmap.data=s,e.bitmap.width=t,e.bitmap.height=i,e._exif.tags.Orientation=1}function exifRotate(e){if(getExifOrientation(e)<2)return;const t=getExifOrientationTransformation(e),i=getExifOrientation(e)>4,a=i?e.bitmap.height:e.bitmap.width,r=i?e.bitmap.width:e.bitmap.height;t&&transformBitmap(e,a,r,t)}async function attemptExifRotate(e,t){try{e._exif=EXIFParser.create(t).parse(),exifRotate(e)}catch{}}const emptyBitmap={data:Buffer.alloc(0),width:0,height:0};function bufferFromArrayBuffer(e){const t=Buffer.alloc(e.byteLength),i=new Uint8Array(e);for(let e=0;e<t.length;++e)t[e]=i[e];return t}function createJimp({plugins:e,formats:t}={}){const i=e||[],a=(t||[]).map((e=>e())),r=class{bitmap=emptyBitmap;background=0;formats=[];mime;constructor(e=emptyBitmap){if(this.formats=a,"data"in e)this.bitmap=e;else if(this.bitmap={data:Buffer.alloc(e.width*e.height*4),width:e.width,height:e.height},e.color){this.background="string"==typeof e.color?cssColorToHex(e.color):e.color;for(let e=0;e<this.bitmap.data.length;e+=4)this.bitmap.data.writeUInt32BE(this.background,e)}for(const e of i)for(const t in e)this[t]=(...i)=>{const a=e[t]?.(this,...i);return"object"==typeof a&&"bitmap"in a?(this.bitmap=a.bitmap,this):a}}static async read(e,t){if(Buffer.isBuffer(e)||e instanceof ArrayBuffer)return this.fromBuffer(e);if(require$$6.existsSync(e))return this.fromBuffer(await readFile(e));const[i,a]=await to(fetch(e));if(i)throw new Error(`Could not load Buffer from URL: ${e}`);if(!a.ok)throw new Error(`HTTP Status ${a.status} for url ${e}`);const[r,n]=await to(a.arrayBuffer());if(r)throw new Error(`Could not load Buffer from ${e}`);const s=bufferFromArrayBuffer(n);return this.fromBuffer(s,t)}static fromBitmap(e){let t;if(e.data instanceof Buffer&&(t=Buffer.from(e.data)),(e.data instanceof Uint8Array||e.data instanceof Uint8ClampedArray)&&(t=Buffer.from(e.data.buffer)),Array.isArray(e.data)&&(t=Buffer.concat(e.data.map((e=>Buffer.from(e.toString(16).padStart(8,"0"),"hex"))))),!t)throw new Error("data must be a Buffer");if("number"!=typeof e.height||"number"!=typeof e.width)throw new Error("bitmap must have width and height");return new r({height:e.height,width:e.width,data:t})}static async fromBuffer(e,t){const i=e instanceof ArrayBuffer?bufferFromArrayBuffer(e):e,n=await fileType$1.fromBuffer(i);if(!n||!n.mime)throw new Error("Could not find MIME for Buffer");const s=a.find((e=>e.mime===n.mime));if(!s||!s.decode)throw new Error(`Mime type ${n.mime} does not support decoding`);const o=new r(await s.decode(i,t?.[s.mime]));return o.mime=n.mime,attemptExifRotate(o,i),o}inspect(){return"<Jimp "+(this.bitmap===emptyBitmap?"pending...":this.bitmap.width+"x"+this.bitmap.height)+">"}toString(){return"[object Jimp]"}get width(){return this.bitmap.width}get height(){return this.bitmap.height}async getBuffer(e,t){const i=this.formats.find((t=>t.mime===e));if(!i||!i.encode)throw new Error(`Unsupported MIME type: ${e}`);let a;return i.hasAlpha?a=this:(a=new r({width:this.bitmap.width,height:this.bitmap.height,color:this.background}),composite(a,this)),i.encode(a.bitmap,t)}async getBase64(e,t){return"data:"+e+";base64,"+(await this.getBuffer(e,t)).toString("base64")}async write(e,t){const i=mime.getType(e);await writeFile(e,await this.getBuffer(i,t))}clone(){return new r({...this.bitmap,data:Buffer.from(this.bitmap.data)})}getPixelIndex(e,t,i){let a,r;if(i||(i=Edge.EXTEND),"number"!=typeof e||"number"!=typeof t)throw new Error("x and y must be numbers");a=e=Math.round(e),r=t=Math.round(t),i===Edge.EXTEND&&(e<0&&(a=0),e>=this.bitmap.width&&(a=this.bitmap.width-1),t<0&&(r=0),t>=this.bitmap.height&&(r=this.bitmap.height-1)),i===Edge.WRAP&&(e<0&&(a=this.bitmap.width+e),e>=this.bitmap.width&&(a=e%this.bitmap.width),t<0&&(r=this.bitmap.height+t),t>=this.bitmap.height&&(r=t%this.bitmap.height));let n=this.bitmap.width*r+a<<2;return(a<0||a>=this.bitmap.width)&&(n=-1),(r<0||r>=this.bitmap.height)&&(n=-1),n}getPixelColor(e,t){if("number"!=typeof e||"number"!=typeof t)throw new Error("x and y must be numbers");const i=this.getPixelIndex(e,t);return this.bitmap.data.readUInt32BE(i)}setPixelColor(e,t,i){if("number"!=typeof e||"number"!=typeof t||"number"!=typeof i)throw new Error("hex, x and y must be numbers");const a=this.getPixelIndex(t,i);return this.bitmap.data.writeUInt32BE(e,a),this}hasAlpha(){const{width:e,height:t,data:i}=this.bitmap,a=e*t<<2;for(let e=3;e<a;e+=4)if(255!==i[e])return!0;return!1}composite(e,t=0,i=0,a={}){return composite(this,e,t,i,a)}scan(e,t,i,a,r){return scan(this,e,t,i,a,r)}scanIterator(e=0,t=0,i=this.bitmap.width,a=this.bitmap.height){if("number"!=typeof e||"number"!=typeof t)throw new Error("x and y must be numbers");if("number"!=typeof i||"number"!=typeof a)throw new Error("w and h must be numbers");return scanIterator(this,e,t,i,a)}};return r}var ResizeStrategy;function Resize(e,t,i,a,r,n,s){this.widthOriginal=Math.abs(Math.floor(e)||0),this.heightOriginal=Math.abs(Math.floor(t)||0),this.targetWidth=Math.abs(Math.floor(i)||0),this.targetHeight=Math.abs(Math.floor(a)||0),this.colorChannels=r?4:3,this.interpolationPass=Boolean(n),this.resizeCallback="function"==typeof s?s:function(){},this.targetWidthMultipliedByChannels=this.targetWidth*this.colorChannels,this.originalWidthMultipliedByChannels=this.widthOriginal*this.colorChannels,this.originalHeightMultipliedByChannels=this.heightOriginal*this.colorChannels,this.widthPassResultSize=this.targetWidthMultipliedByChannels*this.heightOriginal,this.finalResultSize=this.targetWidthMultipliedByChannels*this.targetHeight,this.initialize()}!function(e){e.NEAREST_NEIGHBOR="nearestNeighbor",e.BILINEAR="bilinearInterpolation",e.BICUBIC="bicubicInterpolation",e.HERMITE="hermiteInterpolation",e.BEZIER="bezierInterpolation"}(ResizeStrategy||(ResizeStrategy={})),Resize.prototype.initialize=function(){if(!(this.widthOriginal>0&&this.heightOriginal>0&&this.targetWidth>0&&this.targetHeight>0))throw console.log(this),new Error("Invalid settings specified for the resizer.");this.configurePasses()},Resize.prototype.configurePasses=function(){this.widthOriginal===this.targetWidth?this.resizeWidth=this.bypassResizer:(this.ratioWeightWidthPass=this.widthOriginal/this.targetWidth,this.ratioWeightWidthPass<1&&this.interpolationPass?(this.initializeFirstPassBuffers(!0),this.resizeWidth=4===this.colorChannels?this.resizeWidthInterpolatedRGBA:this.resizeWidthInterpolatedRGB):(this.initializeFirstPassBuffers(!1),this.resizeWidth=4===this.colorChannels?this.resizeWidthRGBA:this.resizeWidthRGB)),this.heightOriginal===this.targetHeight?this.resizeHeight=this.bypassResizer:(this.ratioWeightHeightPass=this.heightOriginal/this.targetHeight,this.ratioWeightHeightPass<1&&this.interpolationPass?(this.initializeSecondPassBuffers(!0),this.resizeHeight=this.resizeHeightInterpolated):(this.initializeSecondPassBuffers(!1),this.resizeHeight=4===this.colorChannels?this.resizeHeightRGBA:this.resizeHeightRGB))},Resize.prototype._resizeWidthInterpolatedRGBChannels=function(e,t){const i=t?4:3,a=this.ratioWeightWidthPass,r=this.widthBuffer;let n,s,o=0,l=0,u=0,h=0,c=0;for(n=0;o<1/3;n+=i,o+=a)for(l=n,u=0;l<this.widthPassResultSize;u+=this.originalWidthMultipliedByChannels,l+=this.targetWidthMultipliedByChannels)r[l]=e[u],r[l+1]=e[u+1],r[l+2]=e[u+2],t&&(r[l+3]=e[u+3]);for(o-=1/3,s=this.widthOriginal-1;o<s;n+=i,o+=a)for(c=o%1,h=1-c,l=n,u=Math.floor(o)*i;l<this.widthPassResultSize;u+=this.originalWidthMultipliedByChannels,l+=this.targetWidthMultipliedByChannels)r[l+0]=e[u+0]*h+e[u+i+0]*c,r[l+1]=e[u+1]*h+e[u+i+1]*c,r[l+2]=e[u+2]*h+e[u+i+2]*c,t&&(r[l+3]=e[u+3]*h+e[u+i+3]*c);for(s=this.originalWidthMultipliedByChannels-i;n<this.targetWidthMultipliedByChannels;n+=i)for(l=n,u=s;l<this.widthPassResultSize;u+=this.originalWidthMultipliedByChannels,l+=this.targetWidthMultipliedByChannels)r[l]=e[u],r[l+1]=e[u+1],r[l+2]=e[u+2],t&&(r[l+3]=e[u+3]);return r},Resize.prototype._resizeWidthRGBChannels=function(e,t){const i=t?4:3,a=this.ratioWeightWidthPass,r=1/a,n=this.originalWidthMultipliedByChannels-i+1,s=this.targetWidthMultipliedByChannels-i+1,o=this.outputWidthWorkBench,l=this.widthBuffer,u=this.outputWidthWorkBenchOpaquePixelsCount;let h=0,c=0,d=0,f=0,m=0,p=0,_=0,g=1,b=0,y=0,x=0,w=0;do{for(m=0;m<this.originalHeightMultipliedByChannels;)o[m++]=0,o[m++]=0,o[m++]=0,t&&(o[m++]=0,u[m/i-1]=0);h=a;do{for(c=1+d-f,g=Math.min(h,c),m=0,p=d;m<this.originalHeightMultipliedByChannels;p+=n)b=e[p],y=e[++p],x=e[++p],w=t?e[++p]:255,o[m++]+=(w?b:0)*g,o[m++]+=(w?y:0)*g,o[m++]+=(w?x:0)*g,t&&(o[m++]+=w*g,u[m/i-1]+=w?g:0);if(!(h>=c)){f+=h;break}d+=i,f=d,h-=c}while(h>0&&d<this.originalWidthMultipliedByChannels);for(m=0,p=_;m<this.originalHeightMultipliedByChannels;p+=s)h=t?u[m/i]:1,g=t?h?1/h:0:r,l[p]=o[m++]*g,l[++p]=o[m++]*g,l[++p]=o[m++]*g,t&&(l[++p]=o[m++]*r);_+=i}while(_<this.targetWidthMultipliedByChannels);return l},Resize.prototype._resizeHeightRGBChannels=function(e,t){const i=this.ratioWeightHeightPass,a=1/i,r=this.outputHeightWorkBench,n=this.heightBuffer,s=this.outputHeightWorkBenchOpaquePixelsCount;let o=0,l=0,u=0,h=0,c=0,d=0,f=0,m=1,p=0,_=0,g=0,b=0;do{for(c=0;c<this.targetWidthMultipliedByChannels;)r[c++]=0,r[c++]=0,r[c++]=0,t&&(r[c++]=0,s[c/4-1]=0);o=i;do{for(l=1+u-h,m=Math.min(o,l),f=u,c=0;c<this.targetWidthMultipliedByChannels;)p=e[f++],_=e[f++],g=e[f++],b=t?e[f++]:255,r[c++]+=(b?p:0)*m,r[c++]+=(b?_:0)*m,r[c++]+=(b?g:0)*m,t&&(r[c++]+=b*m,s[c/4-1]+=b?m:0);if(!(o>=l)){h+=o;break}u=f,h=u,o-=l}while(o>0&&u<this.widthPassResultSize);for(c=0;c<this.targetWidthMultipliedByChannels;)o=t?s[c/4]:1,m=t?o?1/o:0:a,n[d++]=Math.round(r[c++]*m),n[d++]=Math.round(r[c++]*m),n[d++]=Math.round(r[c++]*m),t&&(n[d++]=Math.round(r[c++]*a))}while(d<this.finalResultSize);return n},Resize.prototype.resizeWidthInterpolatedRGB=function(e){return this._resizeWidthInterpolatedRGBChannels(e,!1)},Resize.prototype.resizeWidthInterpolatedRGBA=function(e){return this._resizeWidthInterpolatedRGBChannels(e,!0)},Resize.prototype.resizeWidthRGB=function(e){return this._resizeWidthRGBChannels(e,!1)},Resize.prototype.resizeWidthRGBA=function(e){return this._resizeWidthRGBChannels(e,!0)},Resize.prototype.resizeHeightInterpolated=function(e){const t=this.ratioWeightHeightPass,i=this.heightBuffer;let a,r=0,n=0,s=0,o=0,l=0,u=0,h=0;for(;r<1/3;r+=t)for(s=0;s<this.targetWidthMultipliedByChannels;)i[n++]=Math.round(e[s++]);for(r-=1/3,a=this.heightOriginal-1;r<a;r+=t)for(h=r%1,u=1-h,o=Math.floor(r)*this.targetWidthMultipliedByChannels,l=o+this.targetWidthMultipliedByChannels,s=0;s<this.targetWidthMultipliedByChannels;++s)i[n++]=Math.round(e[o++]*u+e[l++]*h);for(;n<this.finalResultSize;)for(s=0,o=a*this.targetWidthMultipliedByChannels;s<this.targetWidthMultipliedByChannels;++s)i[n++]=Math.round(e[o++]);return i},Resize.prototype.resizeHeightRGB=function(e){return this._resizeHeightRGBChannels(e,!1)},Resize.prototype.resizeHeightRGBA=function(e){return this._resizeHeightRGBChannels(e,!0)},Resize.prototype.resize=function(e){this.resizeCallback(this.resizeHeight(this.resizeWidth(e)))},Resize.prototype.bypassResizer=function(e){return e},Resize.prototype.initializeFirstPassBuffers=function(e){this.widthBuffer=this.generateFloatBuffer(this.widthPassResultSize),e||(this.outputWidthWorkBench=this.generateFloatBuffer(this.originalHeightMultipliedByChannels),this.colorChannels>3&&(this.outputWidthWorkBenchOpaquePixelsCount=this.generateFloat64Buffer(this.heightOriginal)))},Resize.prototype.initializeSecondPassBuffers=function(e){this.heightBuffer=this.generateUint8Buffer(this.finalResultSize),e||(this.outputHeightWorkBench=this.generateFloatBuffer(this.targetWidthMultipliedByChannels),this.colorChannels>3&&(this.outputHeightWorkBenchOpaquePixelsCount=this.generateFloat64Buffer(this.targetWidth)))},Resize.prototype.generateFloatBuffer=function(e){try{return new Float32Array(e)}catch(e){return console.error(e),[]}},Resize.prototype.generateFloat64Buffer=function(e){try{return new Float64Array(e)}catch(e){return console.error(e),[]}},Resize.prototype.generateUint8Buffer=function(e){try{return new Uint8Array(e)}catch(e){return console.error(e),[]}};const operations={nearestNeighbor(e,t){const i=e.width,a=e.height,r=t.width,n=t.height,s=e.data,o=t.data;for(let e=0;e<n;e++)for(let t=0;t<r;t++){let l=4*(e*r+t);let u=4*(Math.floor(e*a/n)*i+Math.floor(t*i/r));o[l++]=s[u++],o[l++]=s[u++],o[l++]=s[u++],o[l++]=s[u++]}},bilinearInterpolation(e,t){const i=e.width,a=e.height,r=t.width,n=t.height,s=e.data,o=t.data,l=function(e,t,i,a,r){return t===a?i:Math.round((e-t)*r+(a-e)*i)},u=function(e,t,a,r,n,u,h,c){let d=4*(h*i+r)+t,f=4*(h*i+n)+t;const m=l(a,r,s[d],n,s[f]);if(c===h)o[e+t]=m;else{d=4*(c*i+r)+t,f=4*(c*i+n)+t;const p=l(a,r,s[d],n,s[f]);o[e+t]=l(u,h,m,c,p)}};for(let e=0;e<n;e++)for(let t=0;t<r;t++){const s=4*(e*r+t),o=t*i/r,l=Math.floor(o),h=Math.min(Math.ceil(o),i-1),c=e*a/n,d=Math.floor(c),f=Math.min(Math.ceil(c),a-1);u(s,0,o,l,h,c,d,f),u(s,1,o,l,h,c,d,f),u(s,2,o,l,h,c,d,f),u(s,3,o,l,h,c,d,f)}},_interpolate2D(e,t,i,a){const r=e.data,n=t.data,s=e.width,o=e.height,l=t.width,u=t.height,h=Math.max(1,Math.floor(s/l)),c=l*h,d=Math.max(1,Math.floor(o/u)),f=u*d,m=Buffer.alloc(c*o*4);for(let e=0;e<o;e++)for(let t=0;t<c;t++){const i=t*(s-1)/c,n=Math.floor(i),o=i-n,l=4*(e*s+n),u=4*(e*c+t);for(let e=0;e<4;e++){const t=l+e,i=n>0?r[t-4]:2*r[t]-r[t+4],h=r[t],c=r[t+4],d=n<s-2?r[t+8]:2*r[t+4]-r[t];m[u+e]=a(i,h,c,d,o)}}const p=Buffer.alloc(c*f*4);for(let e=0;e<f;e++)for(let t=0;t<c;t++){const i=e*(o-1)/f,r=Math.floor(i),n=i-r,s=4*(r*c+t),l=4*(e*c+t);for(let e=0;e<4;e++){const t=s+e,i=r>0?m[t-4*c]:2*m[t]-m[t+4*c],u=m[t],h=m[t+4*c],d=r<o-2?m[t+8*c]:2*m[t+4*c]-m[t];p[l+e]=a(i,u,h,d,n)}}const _=h*d;if(_>1)for(let e=0;e<u;e++)for(let t=0;t<l;t++){let i=0,a=0,r=0,s=0,o=0;for(let n=0;n<d;n++){const l=e*d+n;for(let e=0;e<h;e++){const n=4*(l*c+(t*h+e)),u=p[n+3];u&&(i+=p[n],a+=p[n+1],r+=p[n+2],o++),s+=u}}const u=4*(e*l+t);n[u]=o?Math.round(i/o):0,n[u+1]=o?Math.round(a/o):0,n[u+2]=o?Math.round(r/o):0,n[u+3]=Math.round(s/_)}else t.data=p},bicubicInterpolation(e,t,i){return this._interpolate2D(e,t,i,(function(e,t,i,a,r){const n=a-i-e+t,s=e-t-n,o=i-e,l=t;return Math.max(0,Math.min(255,n*(r*r*r)+s*(r*r)+o*r+l))}))},hermiteInterpolation(e,t,i){return this._interpolate2D(e,t,i,(function(e,t,i,a,r){const n=t,s=.5*(i-e),o=e-2.5*t+2*i-.5*a,l=.5*(a-e)+1.5*(t-i);return Math.max(0,Math.min(255,Math.round(((l*r+o)*r+s)*r+n)))}))},bezierInterpolation(e,t,i){return this._interpolate2D(e,t,i,(function(e,t,i,a,r){const n=1-r,s=t*n*n*n,o=3*(t+(i-e)/4)*n*n*r,l=3*(i-(a-t)/4)*n*r*r,u=i*r*r*r;return Math.max(0,Math.min(255,Math.round(s+o+l+u)))}))}},ResizeOptionsSchema=z.union([z.object({w:z.number().min(0),h:z.number().min(0).optional(),mode:z.nativeEnum(ResizeStrategy).optional()}),z.object({w:z.number().min(0).optional(),h:z.number().min(0),mode:z.nativeEnum(ResizeStrategy).optional()})]),ScaleToFitOptionsSchema=z.object({w:z.number().min(0),h:z.number().min(0),mode:z.nativeEnum(ResizeStrategy).optional()}),ScaleComplexOptionsSchema=z.object({f:z.number().min(0),mode:z.nativeEnum(ResizeStrategy).optional()}),methods$d={resize(e,t){const{mode:i}=ResizeOptionsSchema.parse(t);let a,r;if("number"==typeof t.w)a=t.w,r=t.h??e.bitmap.height*(a/e.bitmap.width);else{if("number"!=typeof t.h)throw new Error("w must be a number");r=t.h,a=t.w??e.bitmap.width*(r/e.bitmap.height)}if(a=Math.round(a)||1,r=Math.round(r)||1,i&&"function"==typeof operations[i]){const t={data:Buffer.alloc(a*r*4),width:a,height:r};operations[i](e.bitmap,t),e.bitmap=t}else{new Resize(e.bitmap.width,e.bitmap.height,a,r,!0,!0,(t=>{e.bitmap.data=Buffer.from(t),e.bitmap.width=a,e.bitmap.height=r})).resize(e.bitmap.data)}return e},scale(e,t){const{f:i,mode:a}="number"==typeof t?{f:t}:ScaleComplexOptionsSchema.parse(t),r=e.bitmap.width*i,n=e.bitmap.height*i;return this.resize(e,{w:r,h:n,mode:a})},scaleToFit(e,t){const{h:i,w:a,mode:r}=ScaleToFitOptionsSchema.parse(t),n=a/i>e.bitmap.width/e.bitmap.height?i/e.bitmap.height:a/e.bitmap.width;return this.scale(e,{f:n,mode:r})}},ContainOptionsSchema=z.object({w:z.number(),h:z.number(),align:z.number().optional(),mode:z.nativeEnum(ResizeStrategy).optional()}),methods$c={contain(e,t){const{w:i,h:a,align:r=HorizontalAlign.CENTER|VerticalAlign.MIDDLE,mode:n}=ContainOptionsSchema.parse(t),s=7&r,o=r>>3;if((0===s||s&s-1)&&(0===o||o&o-1))throw new Error("only use one flag per alignment direction");const l=s>>1,u=o>>1,h=i/a>e.bitmap.width/e.bitmap.height?a/e.bitmap.height:i/e.bitmap.width,c=methods$d.scale(clone(e),{f:h,mode:n});return(e=methods$d.resize(e,{w:i,h:a,mode:n})).scan(((t,i,a)=>{e.bitmap.data.writeUInt32BE(e.background,a)})),e=methods$h.blit(e,{src:c,x:(e.bitmap.width-c.bitmap.width)/2*l,y:(e.bitmap.height-c.bitmap.height)/2*u})}},CropOptionsSchema=z.object({x:z.number(),y:z.number(),w:z.number(),h:z.number()}),AutocropComplexOptionsSchema=z.object({tolerance:z.number().min(0).max(1).optional(),cropOnlyFrames:z.boolean().optional(),cropSymmetric:z.boolean().optional(),leaveBorder:z.number().optional(),ignoreSides:z.object({north:z.boolean().optional(),south:z.boolean().optional(),east:z.boolean().optional(),west:z.boolean().optional()}).optional()}),methods$b={crop(e,t){let{x:i,y:a,w:r,h:n}=CropOptionsSchema.parse(t);if(i=Math.round(i),a=Math.round(a),r=Math.round(r),n=Math.round(n),0===i&&r===e.bitmap.width){const t=r*a+i<<2,s=t+(n*r<<2);e.bitmap.data=e.bitmap.data.slice(t,s)}else{const t=Buffer.allocUnsafe(r*n*4);let s=0;scan(e,i,a,r,n,(function(i,a,r){const n=e.bitmap.data.readUInt32BE(r);t.writeUInt32BE(n,s),s+=4})),e.bitmap.data=t}return e.bitmap.width=r,e.bitmap.height=n,e},autocrop(e,t={}){const{tolerance:i=2e-4,cropOnlyFrames:a=!0,cropSymmetric:r=!1,leaveBorder:n=0,ignoreSides:s}="number"==typeof t?{tolerance:t}:AutocropComplexOptionsSchema.parse(t),o=e.bitmap.width,l=e.bitmap.height,u={north:!1,south:!1,east:!1,west:!1,...s};let h=e.getPixelColor(0,0);const c=intToRGBA$1(h);let d=0,f=0,m=0,p=0;if(h=e.getPixelColor(0,0),!u.north)e:for(let t=0;t<l-1;t++){for(let a=0;a<o;a++){if(colorDiff(c,intToRGBA$1(e.getPixelColor(a,t)))>i)break e}d++}if(h=e.getPixelColor(o,0),!u.west)e:for(let t=0;t<o-1;t++){for(let a=0+d;a<l;a++){if(colorDiff(c,intToRGBA$1(e.getPixelColor(t,a)))>i)break e}p++}if(h=e.getPixelColor(0,l),!u.south)e:for(let t=l-1;t>=d+1;t--){for(let a=o-f-1;a>=0;a--){if(colorDiff(c,intToRGBA$1(e.getPixelColor(a,t)))>i)break e}m++}if(h=e.getPixelColor(o,l),!u.east)e:for(let t=o-1;t>=0+p+1;t--){for(let a=l-1;a>=0+d;a--){if(colorDiff(c,intToRGBA$1(e.getPixelColor(t,a)))>i)break e}f++}let _=!1;if(p-=n,f-=n,d-=n,m-=n,r){const e=Math.min(f,p),t=Math.min(d,m);p=e,f=e,d=t,m=t}p=p>=0?p:0,f=f>=0?f:0,d=d>=0?d:0,m=m>=0?m:0;const g=o-(p+f),b=l-(m+d);return _=a?0!==f&&0!==d&&0!==p&&0!==m:0!==f||0!==d||0!==p||0!==m,_&&this.crop(e,{x:p,y:d,w:g,h:b}),e}},CoverOptionsSchema=z.object({w:z.number(),h:z.number(),align:z.number().optional(),mode:z.nativeEnum(ResizeStrategy).optional()}),methods$a={cover(e,t){const{w:i,h:a,align:r=HorizontalAlign.CENTER|VerticalAlign.MIDDLE,mode:n}=CoverOptionsSchema.parse(t),s=7&r,o=r>>3;if((0===s||s&s-1)&&(0===o||o&o-1))throw new Error("only use one flag per alignment direction");const l=s>>1,u=o>>1,h=i/a>e.bitmap.width/e.bitmap.height?i/e.bitmap.width:a/e.bitmap.height;return e=methods$d.scale(e,{f:h,mode:n}),e=methods$b.crop(e,{x:(e.bitmap.width-i)/2*l,y:(e.bitmap.height-a)/2*u,w:i,h:a})}},DisplaceOptionsSchema=z.object({map:JimpClassSchema,offset:z.number()}),methods$9={displace(e,t){const{map:i,offset:a}=DisplaceOptionsSchema.parse(t),r=clone(e);return e.scan(((t,n,s)=>{let o=i.bitmap.data[s]/256*a;o=Math.round(o);const l=e.getPixelIndex(t+o,n);e.bitmap.data[l]=r.bitmap.data[s],e.bitmap.data[l+1]=r.bitmap.data[s+1],e.bitmap.data[l+2]=r.bitmap.data[s+2]})),e}},methods$8={dither(e){const t=[1,9,3,11,13,5,15,7,4,12,2,10,16,8,14,6];return e.scan(((i,a,r)=>{const n=t[((3&a)<<2)+i%4];e.bitmap.data[r]=Math.min(e.bitmap.data[r]+n,255),e.bitmap.data[r+1]=Math.min(e.bitmap.data[r+1]+n,255),e.bitmap.data[r+2]=Math.min(e.bitmap.data[r+2]+n,255)})),e}},FisheyeOptionsSchema=z.object({radius:z.number().min(0).optional()}),methods$7={fisheye(e,t={}){const{radius:i=2.5}=FisheyeOptionsSchema.parse(t),a=clone(e),{width:r,height:n}=a.bitmap;return a.scan(((t,s)=>{const o=t/r,l=s/n,u=Math.sqrt(Math.pow(o-.5,2)+Math.pow(l-.5,2)),h=2*Math.pow(u,i),c=(o-.5)/u,d=(l-.5)/u,f=Math.round((h*c+.5)*r),m=Math.round((h*d+.5)*n),p=a.getPixelColor(f,m);e.setPixelColor(p,t,s)})),e.setPixelColor(a.getPixelColor(r/2,n/2),r/2,n/2),e}},FlipOptionsSchema=z.object({horizontal:z.boolean().optional(),vertical:z.boolean().optional()}),methods$6={flip(e,t){const{horizontal:i,vertical:a}=FlipOptionsSchema.parse(t),r=Buffer.alloc(e.bitmap.data.length);return e.scan(((t,n,s)=>{const o=i?e.bitmap.width-1-t:t,l=a?e.bitmap.height-1-n:n,u=e.bitmap.width*l+o<<2,h=e.bitmap.data.readUInt32BE(s);r.writeUInt32BE(h,u)})),e.bitmap.data=Buffer.from(r),e}};function Converter$1(e,t){if(!(e&&t&&e.length&&t.length))throw new Error("Bad alphabet");this.srcAlphabet=e,this.dstAlphabet=t}Converter$1.prototype.convert=function(e){var t,i,a,r={},n=this.srcAlphabet.length,s=this.dstAlphabet.length,o=e.length,l="string"==typeof e?"":[];if(!this.isValid(e))throw new Error('Number "'+e+'" contains of non-alphabetic digits ('+this.srcAlphabet+")");if(this.srcAlphabet===this.dstAlphabet)return e;for(t=0;t<o;t++)r[t]=this.srcAlphabet.indexOf(e[t]);do{for(i=0,a=0,t=0;t<o;t++)(i=i*n+r[t])>=s?(r[a++]=parseInt(i/s,10),i%=s):a>0&&(r[a++]=0);o=a,l=this.dstAlphabet.slice(i,i+1).concat(l)}while(0!==a);return l},Converter$1.prototype.isValid=function(e){for(var t=0;t<e.length;++t)if(-1===this.srcAlphabet.indexOf(e[t]))return!1;return!0};var converter=Converter$1,Converter=converter;function anyBase(e,t){var i=new Converter(e,t);return function(e){return i.convert(e)}}anyBase.BIN="01",anyBase.OCT="01234567",anyBase.DEC="0123456789",anyBase.HEX="0123456789abcdef";var anyBase_1=anyBase,anyBase$1=getDefaultExportFromCjs(anyBase_1);class ImagePHash{size;smallerSize;constructor(e,t){this.size=e||32,this.smallerSize=t||8,initCoefficients(this.size)}distance(e,t){let i=0;for(let a=0;a<e.length;a++)e[a]!==t[a]&&i++;return i/e.length}getHash(e){e=methods$d.resize(clone(e),{w:this.size,h:this.size}),e=methods$e.greyscale(e);const t=[];for(let i=0;i<e.bitmap.width;i++){const a=[];for(let t=0;t<e.bitmap.height;t++)a[t]=intToRGBA(e.getPixelColor(i,t)).b;t[i]=a}const i=applyDCT(t,this.size);let a=0;for(let e=0;e<this.smallerSize;e++)for(let t=0;t<this.smallerSize;t++)a+=i[e][t];const r=a/(this.smallerSize*this.smallerSize);let n="";for(let e=0;e<this.smallerSize;e++)for(let t=0;t<this.smallerSize;t++)n+=i[e][t]>r?"1":"0";return n}}function intToRGBA(e){const t=255&e,i=255&(e>>>=8),a=255&(e>>>=8);return{r:255&(e>>>=8),g:a,b:i,a:t}}const c=[];function initCoefficients(e){for(let t=1;t<e;t++)c[t]=1;c[0]=1/Math.sqrt(2)}function applyDCT(e,t){const i=t,a=[];for(let t=0;t<i;t++){const r=[];for(let n=0;n<i;n++){let s=0;for(let a=0;a<i;a++)for(let r=0;r<i;r++)s+=Math.cos((2*a+1)/(2*i)*t*Math.PI)*Math.cos((2*r+1)/(2*i)*n*Math.PI)*e[a][r];s*=c[t]*c[n]/4,r[n]=s,a[t]=r}}return a}const alphabet="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ$_",maxHashLength=[NaN,NaN];for(let e=2;e<65;e++){const t=anyBase$1(anyBase$1.BIN,alphabet.slice(0,e))(new Array(65).join("1"));maxHashLength.push(t.length)}const methods$5={pHash:e=>(new ImagePHash).getHash(e),hash(e,t=64){if(t<2||t>64)throw new Error("base must be a number between 2 and 64");const i=alphabet.slice(0,t),a=this.pHash(e),r=maxHashLength[t];return anyBase$1(anyBase$1.BIN,i)(a).padStart(r,"0")},distanceFromHash(e,t){const i=new ImagePHash,a=i.getHash(e);return i.distance(a,t)}},MaskOptionsObjectSchema=z.object({src:JimpClassSchema,x:z.number().optional(),y:z.number().optional()}),MaskOptionsSchema=z.union([JimpClassSchema,MaskOptionsObjectSchema]),methods$4={mask(e,t){let i,a,r;MaskOptionsSchema.parse(t),"bitmap"in t?(i=t,a=0,r=0):(i=t.src,a=t.x??0,r=t.y??0),a=Math.round(a),r=Math.round(r);const n=e.bitmap.width,s=e.bitmap.height;return i.scan((function(t,o,l){const u=a+t,h=r+o;if(u>=0&&h>=0&&u<n&&h<s){const t=e.getPixelIndex(u,h),{data:a}=i.bitmap,r=(a[l+0]+a[l+1]+a[l+2])/3;e.bitmap.data[t+3]*=r/255}})),e}};function measureText(e,t){let i=0;for(let a=0;a<t.length;a++){const r=t[a],n=e.chars[r];if(n){const s=e.kernings[r],o=t[a+1],l=s&&o&&s[o]&&s[o]||0;i+=(n.xadvance||0)+l}}return i}function splitLines(e,t,i){const a=t.replace(/[\r\n]+/g," \n").split(" "),r=[];let n=[],s=0;return a.forEach((t=>{if(measureText(e,t+(a.length>1?" ":""))>i){const a=t[Symbol.iterator]();let s="";for(const t of a){const a=[...n,s+t].join(" "),o=measureText(e,a);o<i?s+=t:o>i?(r.push([...n,s]),n=[],s=t):(r.push([...n,s+t]),n=[],s="")}return}const o=[...n,t].join(" "),l=measureText(e,o);l<=i&&!t.includes("\n")?(l>s&&(s=l),n.push(t)):(r.push(n),n=[t.replace("\n","")])})),r.push(n),{lines:r,longestLine:s}}function measureTextHeight(e,t,i){const{lines:a}=splitLines(e,t,i);return a.length*e.common.lineHeight}const PrintOptionsSchema=z.object({x:z.number(),y:z.number(),text:z.union([z.union([z.string(),z.number()]),z.object({text:z.union([z.string(),z.number()]),alignmentX:z.nativeEnum(HorizontalAlign).optional(),alignmentY:z.nativeEnum(VerticalAlign).optional()})]),maxWidth:z.number().optional(),maxHeight:z.number().optional(),cb:z.function(z.tuple([z.object({x:z.number(),y:z.number()})])).optional()});function xOffsetBasedOnAlignment(e,t,i,a){return a===HorizontalAlign.LEFT?0:a===HorizontalAlign.CENTER?(i-measureText(e,t))/2:i-measureText(e,t)}function drawCharacter(e,t,i,a,r){if(r.width>0&&r.height>0){const n=t.pages[r.page];n&&(e=methods$h.blit(e,{src:n,x:i+r.xoffset,y:a+r.yoffset,srcX:r.x,srcY:r.y,srcW:r.width,srcH:r.height}))}return e}function printText(e,t,i,a,r,n){for(let s=0;s<r.length;s++){const o=r[s];let l;l=t.chars[o]?o:/\s/.test(o)?"":"?";const u=t.chars[l]||{xadvance:void 0},h=t.kernings[l];u&&drawCharacter(e,t,i,a,u);const c=r[s+1];i+=(h&&c&&h[c]&&h[c]||0)+(u.xadvance||n)}}const methods$3={print(e,{font:t,...i}){let a,r,{x:n,y:s,text:o,maxWidth:l=1/0,maxHeight:u=1/0,cb:h=()=>{}}=PrintOptionsSchema.parse(i);"object"==typeof o&&null!==o.text&&void 0!==o.text?(a=o.alignmentX||HorizontalAlign.LEFT,r=o.alignmentY||VerticalAlign.TOP,({text:o}=o)):(a=HorizontalAlign.LEFT,r=VerticalAlign.TOP,o=o.toString()),"number"==typeof o&&(o=o.toString()),u!==1/0&&r===VerticalAlign.BOTTOM?s+=u-measureTextHeight(t,o,l):u!==1/0&&r===VerticalAlign.MIDDLE&&(s+=u/2-measureTextHeight(t,o,l)/2);const c=Object.entries(t.chars).find((e=>e[1].xadvance))?.[1].xadvance;if("number"!=typeof c)throw new Error("Could not find default character width");const{lines:d,longestLine:f}=splitLines(t,o,l);return d.forEach((i=>{const r=i.join(" "),o=xOffsetBasedOnAlignment(t,r,l,a);printText(e,t,n+o,s,r,c),s+=t.common.lineHeight})),h.bind(e)({x:n+f,y:s}),e}},RotateOptionsSchema=z.union([z.number(),z.object({deg:z.number(),mode:z.union([z.boolean(),z.nativeEnum(ResizeStrategy)]).optional()})]);function createIdxTranslationFunction(e){return function(t,i){return i*e+t<<2}}function matrixRotate(e,t){if(Math.abs(t)%90!=0)throw new Error("Unsupported matrix rotation degree");const i=e.bitmap.width,a=e.bitmap.height;let r;switch(t){case 90:case-270:r=90;break;case 180:case-180:r=180;break;case 270:case-90:r=-90;break;default:throw new Error("Unsupported matrix rotation degree")}const n=180===r?i:a,s=180===r?a:i,o=Buffer.alloc(e.bitmap.data.length),l=createIdxTranslationFunction(i),u=createIdxTranslationFunction(n);for(let t=0;t<i;t++)for(let n=0;n<a;n++){const s=l(t,n),h=e.bitmap.data.readUInt32BE(s);let c;switch(r){case 90:c=u(n,i-t-1);break;case-90:c=u(a-n-1,t);break;case 180:c=u(i-t-1,a-n-1);break;default:throw new Error("Unsupported matrix rotation angle")}o.writeUInt32BE(h,c)}e.bitmap.data=o,e.bitmap.width=n,e.bitmap.height=s}function createTranslationFunction(e,t){return function(i,a){return{x:i+e,y:a+t}}}function advancedRotate(e,t,i){const a=t*Math.PI/180,r=Math.cos(a),n=Math.sin(a);let s=e.bitmap.width,o=e.bitmap.height;if(!0===i||"string"==typeof i){s=Math.ceil(Math.abs(e.bitmap.width*r)+Math.abs(e.bitmap.height*n))+1,o=Math.ceil(Math.abs(e.bitmap.width*n)+Math.abs(e.bitmap.height*r))+1,s%2!=0&&s++,o%2!=0&&o++;const t=clone(e);e.scan(((t,i,a)=>{e.bitmap.data.writeUInt32BE(e.background,a)}));const a=Math.max(s,o,e.bitmap.width,e.bitmap.height);e=composite(e=methods$d.resize(e,{h:a,w:a,mode:!0===i?void 0:i}),t,e.bitmap.width/2-t.bitmap.width/2,e.bitmap.height/2-t.bitmap.height/2)}const l=e.bitmap.width,u=e.bitmap.height,h=Buffer.alloc(e.bitmap.data.length),c=createTranslationFunction(-l/2,-u/2),d=createTranslationFunction(l/2+.5,u/2+.5);for(let t=1;t<=u;t++)for(let i=1;i<=l;i++){const a=c(i,t),s=d(r*a.x-n*a.y,r*a.y+n*a.x),o=l*(t-1)+i-1<<2;if(s.x>=0&&s.x<l&&s.y>=0&&s.y<u){const t=l*(0|s.y)+s.x<<2,i=e.bitmap.data.readUInt32BE(t);h.writeUInt32BE(i,o)}else h.writeUInt32BE(e.background,o)}if(e.bitmap.data=h,!0===i||"string"==typeof i){const t=Math.max(l/2-s/2,0),i=Math.max(u/2-o/2,0);e=methods$b.crop(e,{x:t,y:i,w:s,h:o})}}const methods$2={rotate(e,t){const i=RotateOptionsSchema.parse(t),a="number"==typeof i?{deg:i}:i,{mode:r=!0}=a;let{deg:n}=a;if(n%=360,n%360==0)return e;return n%90==0&&(r||e.bitmap.width===e.bitmap.height||n%180==0)?matrixRotate(e,n):advancedRotate(e,n,r),e}},ThresholdOptionsSchema=z.object({max:z.number().min(0).max(255),replace:z.number().min(0).max(255).optional(),autoGreyscale:z.boolean().optional()}),methods$1={threshold(e,t){let{max:i,replace:a=255,autoGreyscale:r=!0}=ThresholdOptionsSchema.parse(t);return i=limit255(i),a=limit255(a),r&&methods$e.greyscale(e),e.scan(((t,r,n)=>{const s=e.bitmap.data[n]<i?e.bitmap.data[n]:a;e.bitmap.data[n]=s,e.bitmap.data[n+1]=s,e.bitmap.data[n+2]=s})),e}};var __defProp=Object.defineProperty,__defNormalProp=(e,t,i)=>t in e?__defProp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,__export=(e,t)=>{for(var i in t)__defProp(e,i,{get:t[i],enumerable:!0})},__publicField=(e,t,i)=>(__defNormalProp(e,"symbol"!=typeof t?t+"":t,i),i),constants_exports={};__export(constants_exports,{bt709:()=>bt709_exports});var bt709_exports={};__export(bt709_exports,{Y:()=>Y,x:()=>x,y:()=>y});var Y=(e=>(e[e.RED=.2126]="RED",e[e.GREEN=.7152]="GREEN",e[e.BLUE=.0722]="BLUE",e[e.WHITE=1]="WHITE",e))(Y||{}),x=(e=>(e[e.RED=.64]="RED",e[e.GREEN=.3]="GREEN",e[e.BLUE=.15]="BLUE",e[e.WHITE=.3127]="WHITE",e))(x||{}),y=(e=>(e[e.RED=.33]="RED",e[e.GREEN=.6]="GREEN",e[e.BLUE=.06]="BLUE",e[e.WHITE=.329]="WHITE",e))(y||{}),conversion_exports={};function correctGamma(e){return e>.04045?((e+.055)/1.055)**2.4:e/12.92}function rgb2xyz(e,t,i){return{x:.4124*(e=correctGamma(e/255))+.3576*(t=correctGamma(t/255))+.1805*(i=correctGamma(i/255)),y:.2126*e+.7152*t+.0722*i,z:.0193*e+.1192*t+.9505*i}}__export(conversion_exports,{lab2rgb:()=>lab2rgb,lab2xyz:()=>lab2xyz,rgb2hsl:()=>rgb2hsl,rgb2lab:()=>rgb2lab,rgb2xyz:()=>rgb2xyz,xyz2lab:()=>xyz2lab,xyz2rgb:()=>xyz2rgb});var arithmetic_exports={};function degrees2radians(e){return e*(Math.PI/180)}function max3(e,t,i){let a=e;return a<t&&(a=t),a<i&&(a=i),a}function min3(e,t,i){let a=e;return a>t&&(a=t),a>i&&(a=i),a}function intInRange(e,t,i){return e>i&&(e=i),e<t&&(e=t),0|e}function inRange0to255Rounded(e){return(e=Math.round(e))>255?e=255:e<0&&(e=0),e}function inRange0to255(e){return e>255?e=255:e<0&&(e=0),e}function stableSort(e,t){const i=typeof e[0];let a;if("number"===i||"string"===i){const i=Object.create(null);for(let t=0,a=e.length;t<a;t++){const a=e[t];i[a]||0===i[a]||(i[a]=t)}a=e.sort(((e,a)=>t(e,a)||i[e]-i[a]))}else{const i=e.slice(0);a=e.sort(((e,a)=>t(e,a)||i.indexOf(e)-i.indexOf(a)))}return a}function rgb2hsl(e,t,i){const a=min3(e,t,i),r=max3(e,t,i),n=r-a,s=(a+r)/510;let o=0;s>0&&s<1&&(o=n/(s<.5?r+a:510-r-a));let l=0;return n>0&&(l=r===e?(t-i)/n:r===t?2+(i-e)/n:4+(e-t)/n,l*=60,l<0&&(l+=360)),{h:l,s:o,l:s}}__export(arithmetic_exports,{degrees2radians:()=>degrees2radians,inRange0to255:()=>inRange0to255,inRange0to255Rounded:()=>inRange0to255Rounded,intInRange:()=>intInRange,max3:()=>max3,min3:()=>min3,stableSort:()=>stableSort});var refX=.95047,refY=1,refZ=1.08883;function pivot(e){return e>.008856?e**(1/3):7.787*e+16/116}function xyz2lab(e,t,i){if(e=pivot(e/refX),t=pivot(t/refY),i=pivot(i/refZ),116*t-16<0)throw new Error("xxx");return{L:Math.max(0,116*t-16),a:500*(e-t),b:200*(t-i)}}function rgb2lab(e,t,i){const a=rgb2xyz(e,t,i);return xyz2lab(a.x,a.y,a.z)}var refX2=.95047,refY2=1,refZ2=1.08883;function pivot2(e){return e>.206893034?e**3:(e-16/116)/7.787}function lab2xyz(e,t,i){const a=(e+16)/116,r=a-i/200;return{x:refX2*pivot2(t/500+a),y:refY2*pivot2(a),z:refZ2*pivot2(r)}}function correctGamma2(e){return e>.0031308?1.055*e**(1/2.4)-.055:12.92*e}function xyz2rgb(e,t,i){const a=correctGamma2(3.2406*e+-1.5372*t+-.4986*i),r=correctGamma2(-.9689*e+1.8758*t+.0415*i),n=correctGamma2(.0557*e+-.204*t+1.057*i);return{r:inRange0to255Rounded(255*a),g:inRange0to255Rounded(255*r),b:inRange0to255Rounded(255*n)}}function lab2rgb(e,t,i){const a=lab2xyz(e,t,i);return xyz2rgb(a.x,a.y,a.z)}var distance_exports={};__export(distance_exports,{AbstractDistanceCalculator:()=>AbstractDistanceCalculator,AbstractEuclidean:()=>AbstractEuclidean,AbstractManhattan:()=>AbstractManhattan,CIE94GraphicArts:()=>CIE94GraphicArts,CIE94Textiles:()=>CIE94Textiles,CIEDE2000:()=>CIEDE2000,CMetric:()=>CMetric,Euclidean:()=>Euclidean,EuclideanBT709:()=>EuclideanBT709,EuclideanBT709NoAlpha:()=>EuclideanBT709NoAlpha,Manhattan:()=>Manhattan,ManhattanBT709:()=>ManhattanBT709,ManhattanNommyde:()=>ManhattanNommyde,PNGQuant:()=>PNGQuant});var AbstractDistanceCalculator=class{constructor(){__publicField(this,"_maxDistance"),__publicField(this,"_whitePoint"),this._setDefaults(),this.setWhitePoint(255,255,255,255)}setWhitePoint(e,t,i,a){this._whitePoint={r:e>0?255/e:0,g:t>0?255/t:0,b:i>0?255/i:0,a:a>0?255/a:0},this._maxDistance=this.calculateRaw(e,t,i,a,0,0,0,0)}calculateNormalized(e,t){return this.calculateRaw(e.r,e.g,e.b,e.a,t.r,t.g,t.b,t.a)/this._maxDistance}},AbstractCIE94=class extends AbstractDistanceCalculator{calculateRaw(e,t,i,a,r,n,s,o){const l=rgb2lab(inRange0to255(e*this._whitePoint.r),inRange0to255(t*this._whitePoint.g),inRange0to255(i*this._whitePoint.b)),u=rgb2lab(inRange0to255(r*this._whitePoint.r),inRange0to255(n*this._whitePoint.g),inRange0to255(s*this._whitePoint.b)),h=l.L-u.L,c=l.a-u.a,d=l.b-u.b,f=Math.sqrt(l.a*l.a+l.b*l.b),m=f-Math.sqrt(u.a*u.a+u.b*u.b);let p=c*c+d*d-m*m;p=p<0?0:Math.sqrt(p);const _=(o-a)*this._whitePoint.a*this._kA;return Math.sqrt((h/this._Kl)**2+(m/(1+this._K1*f))**2+(p/(1+this._K2*f))**2+_**2)}},CIE94Textiles=class extends AbstractCIE94{_setDefaults(){this._Kl=2,this._K1=.048,this._K2=.014,this._kA=12.5/255}},CIE94GraphicArts=class extends AbstractCIE94{_setDefaults(){this._Kl=1,this._K1=.045,this._K2=.015,this._kA=25/255}},_CIEDE2000=class extends AbstractDistanceCalculator{_setDefaults(){}static _calculatehp(e,t){const i=Math.atan2(e,t);return i>=0?i:i+_CIEDE2000._deg360InRad}static _calculateRT(e,t){const i=t**7,a=2*Math.sqrt(i/(i+_CIEDE2000._pow25to7)),r=_CIEDE2000._deg30InRad*Math.exp(-(((e-_CIEDE2000._deg275InRad)/_CIEDE2000._deg25InRad)**2));return-Math.sin(2*r)*a}static _calculateT(e){return 1-.17*Math.cos(e-_CIEDE2000._deg30InRad)+.24*Math.cos(2*e)+.32*Math.cos(3*e+_CIEDE2000._deg6InRad)-.2*Math.cos(4*e-_CIEDE2000._deg63InRad)}static _calculate_ahp(e,t,i,a){const r=i+a;return 0===e?r:t<=_CIEDE2000._deg180InRad?r/2:r<_CIEDE2000._deg360InRad?(r+_CIEDE2000._deg360InRad)/2:(r-_CIEDE2000._deg360InRad)/2}static _calculate_dHp(e,t,i,a){let r;return r=0===e?0:t<=_CIEDE2000._deg180InRad?i-a:i<=a?i-a+_CIEDE2000._deg360InRad:i-a-_CIEDE2000._deg360InRad,2*Math.sqrt(e)*Math.sin(r/2)}calculateRaw(e,t,i,a,r,n,s,o){const l=rgb2lab(inRange0to255(e*this._whitePoint.r),inRange0to255(t*this._whitePoint.g),inRange0to255(i*this._whitePoint.b)),u=rgb2lab(inRange0to255(r*this._whitePoint.r),inRange0to255(n*this._whitePoint.g),inRange0to255(s*this._whitePoint.b)),h=(o-a)*this._whitePoint.a*_CIEDE2000._kA,c=this.calculateRawInLab(l,u);return Math.sqrt(c+h*h)}calculateRawInLab(e,t){const i=e.L,a=e.a,r=e.b,n=t.L,s=t.a,o=t.b,l=((Math.sqrt(a*a+r*r)+Math.sqrt(s*s+o*o))/2)**7,u=.5*(1-Math.sqrt(l/(l+_CIEDE2000._pow25to7))),h=(1+u)*a,c=(1+u)*s,d=Math.sqrt(h*h+r*r),f=Math.sqrt(c*c+o*o),m=d*f,p=_CIEDE2000._calculatehp(r,h),_=_CIEDE2000._calculatehp(o,c),g=Math.abs(p-_),b=n-i,y=f-d,x=_CIEDE2000._calculate_dHp(m,g,_,p),w=_CIEDE2000._calculate_ahp(m,g,p,_),v=(d+f)/2,k=((i+n)/2-50)**2,M=y/(1+.045*v),I=x/(1+.015*_CIEDE2000._calculateT(w)*v);return(b/(1+.015*k/Math.sqrt(20+k)))**2+M**2+I**2+_CIEDE2000._calculateRT(w,v)*M*I}},CIEDE2000=_CIEDE2000;__publicField(CIEDE2000,"_kA",25/255),__publicField(CIEDE2000,"_pow25to7",25**7),__publicField(CIEDE2000,"_deg360InRad",degrees2radians(360)),__publicField(CIEDE2000,"_deg180InRad",degrees2radians(180)),__publicField(CIEDE2000,"_deg30InRad",degrees2radians(30)),__publicField(CIEDE2000,"_deg6InRad",degrees2radians(6)),__publicField(CIEDE2000,"_deg63InRad",degrees2radians(63)),__publicField(CIEDE2000,"_deg275InRad",degrees2radians(275)),__publicField(CIEDE2000,"_deg25InRad",degrees2radians(25));var CMetric=class extends AbstractDistanceCalculator{calculateRaw(e,t,i,a,r,n,s,o){const l=(e+r)/2*this._whitePoint.r,u=(e-r)*this._whitePoint.r,h=(t-n)*this._whitePoint.g,c=(i-s)*this._whitePoint.b,d=((512+l)*u*u>>8)+4*h*h+((767-l)*c*c>>8),f=(o-a)*this._whitePoint.a;return Math.sqrt(d+f*f)}_setDefaults(){}},AbstractEuclidean=class extends AbstractDistanceCalculator{calculateRaw(e,t,i,a,r,n,s,o){const l=r-e,u=n-t,h=s-i,c=o-a;return Math.sqrt(this._kR*l*l+this._kG*u*u+this._kB*h*h+this._kA*c*c)}},Euclidean=class extends AbstractEuclidean{_setDefaults(){this._kR=1,this._kG=1,this._kB=1,this._kA=1}},EuclideanBT709=class extends AbstractEuclidean{_setDefaults(){this._kR=.2126,this._kG=.7152,this._kB=.0722,this._kA=1}},EuclideanBT709NoAlpha=class extends AbstractEuclidean{_setDefaults(){this._kR=.2126,this._kG=.7152,this._kB=.0722,this._kA=0}},AbstractManhattan=class extends AbstractDistanceCalculator{calculateRaw(e,t,i,a,r,n,s,o){let l=r-e,u=n-t,h=s-i,c=o-a;return l<0&&(l=0-l),u<0&&(u=0-u),h<0&&(h=0-h),c<0&&(c=0-c),this._kR*l+this._kG*u+this._kB*h+this._kA*c}},Manhattan=class extends AbstractManhattan{_setDefaults(){this._kR=1,this._kG=1,this._kB=1,this._kA=1}},ManhattanNommyde=class extends AbstractManhattan{_setDefaults(){this._kR=.4984,this._kG=.8625,this._kB=.2979,this._kA=1}},ManhattanBT709=class extends AbstractManhattan{_setDefaults(){this._kR=.2126,this._kG=.7152,this._kB=.0722,this._kA=1}},PNGQuant=class extends AbstractDistanceCalculator{calculateRaw(e,t,i,a,r,n,s,o){const l=(o-a)*this._whitePoint.a;return this._colordifferenceCh(e*this._whitePoint.r,r*this._whitePoint.r,l)+this._colordifferenceCh(t*this._whitePoint.g,n*this._whitePoint.g,l)+this._colordifferenceCh(i*this._whitePoint.b,s*this._whitePoint.b,l)}_colordifferenceCh(e,t,i){const a=e-t,r=a+i;return a*a+r*r}_setDefaults(){}},palette_exports={};__export(palette_exports,{AbstractPaletteQuantizer:()=>AbstractPaletteQuantizer,ColorHistogram:()=>ColorHistogram,NeuQuant:()=>NeuQuant,NeuQuantFloat:()=>NeuQuantFloat,RGBQuant:()=>RGBQuant,WuColorCube:()=>WuColorCube,WuQuant:()=>WuQuant});var AbstractPaletteQuantizer=class{quantizeSync(){for(const e of this.quantize())if(e.palette)return e.palette;throw new Error("unreachable")}},Point=class{constructor(){__publicField(this,"r"),__publicField(this,"g"),__publicField(this,"b"),__publicField(this,"a"),__publicField(this,"uint32"),__publicField(this,"rgba"),this.uint32=-1>>>0,this.r=this.g=this.b=this.a=0,this.rgba=new Array(4),this.rgba[0]=0,this.rgba[1]=0,this.rgba[2]=0,this.rgba[3]=0}static createByQuadruplet(e){const t=new Point;return t.r=0|e[0],t.g=0|e[1],t.b=0|e[2],t.a=0|e[3],t._loadUINT32(),t._loadQuadruplet(),t}static createByRGBA(e,t,i,a){const r=new Point;return r.r=0|e,r.g=0|t,r.b=0|i,r.a=0|a,r._loadUINT32(),r._loadQuadruplet(),r}static createByUint32(e){const t=new Point;return t.uint32=e>>>0,t._loadRGBA(),t._loadQuadruplet(),t}from(e){this.r=e.r,this.g=e.g,this.b=e.b,this.a=e.a,this.uint32=e.uint32,this.rgba[0]=e.r,this.rgba[1]=e.g,this.rgba[2]=e.b,this.rgba[3]=e.a}getLuminosity(e){let t=this.r,i=this.g,a=this.b;return e&&(t=Math.min(255,255-this.a+this.a*t/255),i=Math.min(255,255-this.a+this.a*i/255),a=Math.min(255,255-this.a+this.a*a/255)),.2126*t+.7152*i+.0722*a}_loadUINT32(){this.uint32=(this.a<<24|this.b<<16|this.g<<8|this.r)>>>0}_loadRGBA(){this.r=255&this.uint32,this.g=this.uint32>>>8&255,this.b=this.uint32>>>16&255,this.a=this.uint32>>>24&255}_loadQuadruplet(){this.rgba[0]=this.r,this.rgba[1]=this.g,this.rgba[2]=this.b,this.rgba[3]=this.a}},PointContainer=class{constructor(){__publicField(this,"_pointArray"),__publicField(this,"_width"),__publicField(this,"_height"),this._width=0,this._height=0,this._pointArray=[]}getWidth(){return this._width}getHeight(){return this._height}setWidth(e){this._width=e}setHeight(e){this._height=e}getPointArray(){return this._pointArray}clone(){const e=new PointContainer;e._width=this._width,e._height=this._height;for(let t=0,i=this._pointArray.length;t<i;t++)e._pointArray[t]=Point.createByUint32(0|this._pointArray[t].uint32);return e}toUint32Array(){const e=this._pointArray.length,t=new Uint32Array(e);for(let i=0;i<e;i++)t[i]=this._pointArray[i].uint32;return t}toUint8Array(){return new Uint8Array(this.toUint32Array().buffer)}static fromHTMLImageElement(e){const t=e.naturalWidth,i=e.naturalHeight,a=document.createElement("canvas");a.width=t,a.height=i;return a.getContext("2d").drawImage(e,0,0,t,i,0,0,t,i),PointContainer.fromHTMLCanvasElement(a)}static fromHTMLCanvasElement(e){const t=e.width,i=e.height,a=e.getContext("2d").getImageData(0,0,t,i);return PointContainer.fromImageData(a)}static fromImageData(e){const t=e.width,i=e.height;return PointContainer.fromUint8Array(e.data,t,i)}static fromUint8Array(e,t,i){switch(Object.prototype.toString.call(e)){case"[object Uint8ClampedArray]":case"[object Uint8Array]":break;default:e=new Uint8Array(e)}const a=new Uint32Array(e.buffer);return PointContainer.fromUint32Array(a,t,i)}static fromUint32Array(e,t,i){const a=new PointContainer;a._width=t,a._height=i;for(let t=0,i=e.length;t<i;t++)a._pointArray[t]=Point.createByUint32(0|e[t]);return a}static fromBuffer(e,t,i){const a=new Uint32Array(e.buffer,e.byteOffset,e.byteLength/Uint32Array.BYTES_PER_ELEMENT);return PointContainer.fromUint32Array(a,t,i)}},hueGroups=10;function hueGroup(e,t){const i=360/t;for(let a=1,r=i-i/2;a<t;a++,r+=i)if(e>=r&&e<r+i)return a;return 0}var Palette=class{constructor(){__publicField(this,"_pointContainer"),__publicField(this,"_pointArray",[]),__publicField(this,"_i32idx",{}),this._pointContainer=new PointContainer,this._pointContainer.setHeight(1),this._pointArray=this._pointContainer.getPointArray()}add(e){this._pointArray.push(e),this._pointContainer.setWidth(this._pointArray.length)}has(e){for(let t=this._pointArray.length-1;t>=0;t--)if(e.uint32===this._pointArray[t].uint32)return!0;return!1}getNearestColor(e,t){return this._pointArray[0|this._getNearestIndex(e,t)]}getPointContainer(){return this._pointContainer}_nearestPointFromCache(e){return"number"==typeof this._i32idx[e]?this._i32idx[e]:-1}_getNearestIndex(e,t){let i=this._nearestPointFromCache(""+t.uint32);if(i>=0)return i;let a=Number.MAX_VALUE;i=0;for(let r=0,n=this._pointArray.length;r<n;r++){const n=this._pointArray[r],s=e.calculateRaw(t.r,t.g,t.b,t.a,n.r,n.g,n.b,n.a);s<a&&(a=s,i=r)}return this._i32idx[t.uint32]=i,i}sort(){this._i32idx={},this._pointArray.sort(((e,t)=>{const i=rgb2hsl(e.r,e.g,e.b),a=rgb2hsl(t.r,t.g,t.b),r=e.r===e.g&&e.g===e.b?0:1+hueGroup(i.h,hueGroups),n=(t.r===t.g&&t.g===t.b?0:1+hueGroup(a.h,hueGroups))-r;if(n)return-n;const s=e.getLuminosity(!0),o=t.getLuminosity(!0);if(o-s!=0)return o-s;const l=(100*a.s|0)-(100*i.s|0);return l?-l:0}))}},utils_exports={};__export(utils_exports,{HueStatistics:()=>HueStatistics,Palette:()=>Palette,Point:()=>Point,PointContainer:()=>PointContainer,ProgressTracker:()=>ProgressTracker,arithmetic:()=>arithmetic_exports});var HueGroup=class{constructor(){__publicField(this,"num",0),__publicField(this,"cols",[])}},HueStatistics=class{constructor(e,t){__publicField(this,"_numGroups"),__publicField(this,"_minCols"),__publicField(this,"_stats"),__publicField(this,"_groupsFull"),this._numGroups=e,this._minCols=t,this._stats=[];for(let t=0;t<=e;t++)this._stats[t]=new HueGroup;this._groupsFull=0}check(e){this._groupsFull===this._numGroups+1&&(this.check=()=>{});const t=255&e,i=e>>>8&255,a=e>>>16&255,r=t===i&&i===a?0:1+hueGroup(rgb2hsl(t,i,a).h,this._numGroups),n=this._stats[r],s=this._minCols;n.num++,n.num>s||(n.num===s&&this._groupsFull++,n.num<=s&&this._stats[r].cols.push(e))}injectIntoDictionary(e){for(let t=0;t<=this._numGroups;t++)this._stats[t].num<=this._minCols&&this._stats[t].cols.forEach((t=>{e[t]?e[t]++:e[t]=1}))}injectIntoArray(e){for(let t=0;t<=this._numGroups;t++)this._stats[t].num<=this._minCols&&this._stats[t].cols.forEach((t=>{-1===e.indexOf(t)&&e.push(t)}))}},_ProgressTracker=class{constructor(e,t){__publicField(this,"progress"),__publicField(this,"_step"),__publicField(this,"_range"),__publicField(this,"_last"),__publicField(this,"_progressRange"),this._range=e,this._progressRange=t,this._step=Math.max(1,this._range/(_ProgressTracker.steps+1)|0),this._last=-this._step,this.progress=0}shouldNotify(e){return e-this._last>=this._step&&(this._last=e,this.progress=Math.min(this._progressRange*this._last/this._range,this._progressRange),!0)}},ProgressTracker=_ProgressTracker;__publicField(ProgressTracker,"steps",100);var networkBiasShift=3,Neuron=class{constructor(e){__publicField(this,"r"),__publicField(this,"g"),__publicField(this,"b"),__publicField(this,"a"),this.r=this.g=this.b=this.a=e}toPoint(){return Point.createByRGBA(this.r>>networkBiasShift,this.g>>networkBiasShift,this.b>>networkBiasShift,this.a>>networkBiasShift)}subtract(e,t,i,a){this.r-=0|e,this.g-=0|t,this.b-=0|i,this.a-=0|a}},_NeuQuant=class extends AbstractPaletteQuantizer{constructor(e,t=256){super(),__publicField(this,"_pointArray"),__publicField(this,"_networkSize"),__publicField(this,"_network"),__publicField(this,"_sampleFactor"),__publicField(this,"_radPower"),__publicField(this,"_freq"),__publicField(this,"_bias"),__publicField(this,"_distance"),this._distance=e,this._pointArray=[],this._sampleFactor=1,this._networkSize=t,this._distance.setWhitePoint(255<<networkBiasShift,255<<networkBiasShift,255<<networkBiasShift,255<<networkBiasShift)}sample(e){this._pointArray=this._pointArray.concat(e.getPointArray())}*quantize(){this._init(),yield*this._learn(),yield{palette:this._buildPalette(),progress:100}}_init(){this._freq=[],this._bias=[],this._radPower=[],this._network=[];for(let e=0;e<this._networkSize;e++)this._network[e]=new Neuron((e<<networkBiasShift+8)/this._networkSize|0),this._freq[e]=_NeuQuant._initialBias/this._networkSize|0,this._bias[e]=0}*_learn(){let e=this._sampleFactor;const t=this._pointArray.length;t<_NeuQuant._minpicturebytes&&(e=1);const i=30+(e-1)/3|0,a=t/e|0;let r,n=a/_NeuQuant._nCycles|0,s=_NeuQuant._initAlpha,o=(this._networkSize>>3)*_NeuQuant._radiusBias,l=o>>_NeuQuant._radiusBiasShift;l<=1&&(l=0);for(let e=0;e<l;e++)this._radPower[e]=s*((l*l-e*e)*_NeuQuant._radBias/(l*l))>>>0;r=t<_NeuQuant._minpicturebytes?1:t%_NeuQuant._prime1!=0?_NeuQuant._prime1:t%_NeuQuant._prime2!=0?_NeuQuant._prime2:t%_NeuQuant._prime3!=0?_NeuQuant._prime3:_NeuQuant._prime4;const u=new ProgressTracker(a,99);for(let e=0,h=0;e<a;){u.shouldNotify(e)&&(yield{progress:u.progress});const a=this._pointArray[h],c=a.b<<networkBiasShift,d=a.g<<networkBiasShift,f=a.r<<networkBiasShift,m=a.a<<networkBiasShift,p=this._contest(c,d,f,m);if(this._alterSingle(s,p,c,d,f,m),0!==l&&this._alterNeighbour(l,p,c,d,f,m),h+=r,h>=t&&(h-=t),e++,0===n&&(n=1),e%n==0){s-=s/i|0,o-=o/_NeuQuant._radiusDecrease|0,l=o>>_NeuQuant._radiusBiasShift,l<=1&&(l=0);for(let e=0;e<l;e++)this._radPower[e]=s*((l*l-e*e)*_NeuQuant._radBias/(l*l))>>>0}}}_buildPalette(){const e=new Palette;return this._network.forEach((t=>{e.add(t.toPoint())})),e.sort(),e}_alterNeighbour(e,t,i,a,r,n){let s=t-e;s<-1&&(s=-1);let o=t+e;o>this._networkSize&&(o=this._networkSize);let l=t+1,u=t-1,h=1;for(;l<o||u>s;){const e=this._radPower[h++]/_NeuQuant._alphaRadBias;if(l<o){const t=this._network[l++];t.subtract(e*(t.r-r),e*(t.g-a),e*(t.b-i),e*(t.a-n))}if(u>s){const t=this._network[u--];t.subtract(e*(t.r-r),e*(t.g-a),e*(t.b-i),e*(t.a-n))}}}_alterSingle(e,t,i,a,r,n){e/=_NeuQuant._initAlpha;const s=this._network[t];s.subtract(e*(s.r-r),e*(s.g-a),e*(s.b-i),e*(s.a-n))}_contest(e,t,i,a){const r=1020<<networkBiasShift;let n=~(1<<31),s=n,o=-1,l=o;for(let u=0;u<this._networkSize;u++){const h=this._network[u],c=this._distance.calculateNormalized(h,{r:i,g:t,b:e,a:a})*r|0;c<n&&(n=c,o=u);const d=c-(this._bias[u]>>_NeuQuant._initialBiasShift-networkBiasShift);d<s&&(s=d,l=u);const f=this._freq[u]>>_NeuQuant._betaShift;this._freq[u]-=f,this._bias[u]+=f<<_NeuQuant._gammaShift}return this._freq[o]+=_NeuQuant._beta,this._bias[o]-=_NeuQuant._betaGamma,l}},NeuQuant=_NeuQuant;__publicField(NeuQuant,"_prime1",499),__publicField(NeuQuant,"_prime2",491),__publicField(NeuQuant,"_prime3",487),__publicField(NeuQuant,"_prime4",503),__publicField(NeuQuant,"_minpicturebytes",_NeuQuant._prime4),__publicField(NeuQuant,"_nCycles",100),__publicField(NeuQuant,"_initialBiasShift",16),__publicField(NeuQuant,"_initialBias",1<<_NeuQuant._initialBiasShift),__publicField(NeuQuant,"_gammaShift",10),__publicField(NeuQuant,"_betaShift",10),__publicField(NeuQuant,"_beta",_NeuQuant._initialBias>>_NeuQuant._betaShift),__publicField(NeuQuant,"_betaGamma",_NeuQuant._initialBias<<_NeuQuant._gammaShift-_NeuQuant._betaShift),__publicField(NeuQuant,"_radiusBiasShift",6),__publicField(NeuQuant,"_radiusBias",1<<_NeuQuant._radiusBiasShift),__publicField(NeuQuant,"_radiusDecrease",30),__publicField(NeuQuant,"_alphaBiasShift",10),__publicField(NeuQuant,"_initAlpha",1<<_NeuQuant._alphaBiasShift),__publicField(NeuQuant,"_radBiasShift",8),__publicField(NeuQuant,"_radBias",1<<_NeuQuant._radBiasShift),__publicField(NeuQuant,"_alphaRadBiasShift",_NeuQuant._alphaBiasShift+_NeuQuant._radBiasShift),__publicField(NeuQuant,"_alphaRadBias",1<<_NeuQuant._alphaRadBiasShift);var networkBiasShift2=3,NeuronFloat=class{constructor(e){__publicField(this,"r"),__publicField(this,"g"),__publicField(this,"b"),__publicField(this,"a"),this.r=this.g=this.b=this.a=e}toPoint(){return Point.createByRGBA(this.r>>networkBiasShift2,this.g>>networkBiasShift2,this.b>>networkBiasShift2,this.a>>networkBiasShift2)}subtract(e,t,i,a){this.r-=e,this.g-=t,this.b-=i,this.a-=a}},_NeuQuantFloat=class extends AbstractPaletteQuantizer{constructor(e,t=256){super(),__publicField(this,"_pointArray"),__publicField(this,"_networkSize"),__publicField(this,"_network"),__publicField(this,"_sampleFactor"),__publicField(this,"_radPower"),__publicField(this,"_freq"),__publicField(this,"_bias"),__publicField(this,"_distance"),this._distance=e,this._pointArray=[],this._sampleFactor=1,this._networkSize=t,this._distance.setWhitePoint(255<<networkBiasShift2,255<<networkBiasShift2,255<<networkBiasShift2,255<<networkBiasShift2)}sample(e){this._pointArray=this._pointArray.concat(e.getPointArray())}*quantize(){this._init(),yield*this._learn(),yield{palette:this._buildPalette(),progress:100}}_init(){this._freq=[],this._bias=[],this._radPower=[],this._network=[];for(let e=0;e<this._networkSize;e++)this._network[e]=new NeuronFloat((e<<networkBiasShift2+8)/this._networkSize),this._freq[e]=_NeuQuantFloat._initialBias/this._networkSize,this._bias[e]=0}*_learn(){let e=this._sampleFactor;const t=this._pointArray.length;t<_NeuQuantFloat._minpicturebytes&&(e=1);const i=30+(e-1)/3,a=t/e;let r,n=a/_NeuQuantFloat._nCycles|0,s=_NeuQuantFloat._initAlpha,o=(this._networkSize>>3)*_NeuQuantFloat._radiusBias,l=o>>_NeuQuantFloat._radiusBiasShift;l<=1&&(l=0);for(let e=0;e<l;e++)this._radPower[e]=s*((l*l-e*e)*_NeuQuantFloat._radBias/(l*l));r=t<_NeuQuantFloat._minpicturebytes?1:t%_NeuQuantFloat._prime1!=0?_NeuQuantFloat._prime1:t%_NeuQuantFloat._prime2!=0?_NeuQuantFloat._prime2:t%_NeuQuantFloat._prime3!=0?_NeuQuantFloat._prime3:_NeuQuantFloat._prime4;const u=new ProgressTracker(a,99);for(let e=0,h=0;e<a;){u.shouldNotify(e)&&(yield{progress:u.progress});const a=this._pointArray[h],c=a.b<<networkBiasShift2,d=a.g<<networkBiasShift2,f=a.r<<networkBiasShift2,m=a.a<<networkBiasShift2,p=this._contest(c,d,f,m);if(this._alterSingle(s,p,c,d,f,m),0!==l&&this._alterNeighbour(l,p,c,d,f,m),h+=r,h>=t&&(h-=t),e++,0===n&&(n=1),e%n==0){s-=s/i,o-=o/_NeuQuantFloat._radiusDecrease,l=o>>_NeuQuantFloat._radiusBiasShift,l<=1&&(l=0);for(let e=0;e<l;e++)this._radPower[e]=s*((l*l-e*e)*_NeuQuantFloat._radBias/(l*l))}}}_buildPalette(){const e=new Palette;return this._network.forEach((t=>{e.add(t.toPoint())})),e.sort(),e}_alterNeighbour(e,t,i,a,r,n){let s=t-e;s<-1&&(s=-1);let o=t+e;o>this._networkSize&&(o=this._networkSize);let l=t+1,u=t-1,h=1;for(;l<o||u>s;){const e=this._radPower[h++]/_NeuQuantFloat._alphaRadBias;if(l<o){const t=this._network[l++];t.subtract(e*(t.r-r),e*(t.g-a),e*(t.b-i),e*(t.a-n))}if(u>s){const t=this._network[u--];t.subtract(e*(t.r-r),e*(t.g-a),e*(t.b-i),e*(t.a-n))}}}_alterSingle(e,t,i,a,r,n){e/=_NeuQuantFloat._initAlpha;const s=this._network[t];s.subtract(e*(s.r-r),e*(s.g-a),e*(s.b-i),e*(s.a-n))}_contest(e,t,i,a){const r=1020<<networkBiasShift2;let n=~(1<<31),s=n,o=-1,l=o;for(let u=0;u<this._networkSize;u++){const h=this._network[u],c=this._distance.calculateNormalized(h,{r:i,g:t,b:e,a:a})*r;c<n&&(n=c,o=u);const d=c-(this._bias[u]>>_NeuQuantFloat._initialBiasShift-networkBiasShift2);d<s&&(s=d,l=u);const f=this._freq[u]>>_NeuQuantFloat._betaShift;this._freq[u]-=f,this._bias[u]+=f<<_NeuQuantFloat._gammaShift}return this._freq[o]+=_NeuQuantFloat._beta,this._bias[o]-=_NeuQuantFloat._betaGamma,l}},NeuQuantFloat=_NeuQuantFloat;__publicField(NeuQuantFloat,"_prime1",499),__publicField(NeuQuantFloat,"_prime2",491),__publicField(NeuQuantFloat,"_prime3",487),__publicField(NeuQuantFloat,"_prime4",503),__publicField(NeuQuantFloat,"_minpicturebytes",_NeuQuantFloat._prime4),__publicField(NeuQuantFloat,"_nCycles",100),__publicField(NeuQuantFloat,"_initialBiasShift",16),__publicField(NeuQuantFloat,"_initialBias",1<<_NeuQuantFloat._initialBiasShift),__publicField(NeuQuantFloat,"_gammaShift",10),__publicField(NeuQuantFloat,"_betaShift",10),__publicField(NeuQuantFloat,"_beta",_NeuQuantFloat._initialBias>>_NeuQuantFloat._betaShift),__publicField(NeuQuantFloat,"_betaGamma",_NeuQuantFloat._initialBias<<_NeuQuantFloat._gammaShift-_NeuQuantFloat._betaShift),__publicField(NeuQuantFloat,"_radiusBiasShift",6),__publicField(NeuQuantFloat,"_radiusBias",1<<_NeuQuantFloat._radiusBiasShift),__publicField(NeuQuantFloat,"_radiusDecrease",30),__publicField(NeuQuantFloat,"_alphaBiasShift",10),__publicField(NeuQuantFloat,"_initAlpha",1<<_NeuQuantFloat._alphaBiasShift),__publicField(NeuQuantFloat,"_radBiasShift",8),__publicField(NeuQuantFloat,"_radBias",1<<_NeuQuantFloat._radBiasShift),__publicField(NeuQuantFloat,"_alphaRadBiasShift",_NeuQuantFloat._alphaBiasShift+_NeuQuantFloat._radBiasShift),__publicField(NeuQuantFloat,"_alphaRadBias",1<<_NeuQuantFloat._alphaRadBiasShift);var _ColorHistogram=class{constructor(e,t){__publicField(this,"_method"),__publicField(this,"_hueStats"),__publicField(this,"_histogram"),__publicField(this,"_initColors"),__publicField(this,"_minHueCols"),this._method=e,this._minHueCols=t<<2,this._initColors=t<<2,this._hueStats=new HueStatistics(_ColorHistogram._hueGroups,this._minHueCols),this._histogram=Object.create(null)}sample(e){switch(this._method){case 1:this._colorStats1D(e);break;case 2:this._colorStats2D(e)}}getImportanceSortedColorsIDXI32(){const e=stableSort(Object.keys(this._histogram),((e,t)=>this._histogram[t]-this._histogram[e]));if(0===e.length)return[];let t;switch(this._method){case 1:const i=Math.min(e.length,this._initColors),a=e[i-1],r=this._histogram[a];t=e.slice(0,i);let n=i;const s=e.length;for(;n<s&&this._histogram[e[n]]===r;)t.push(e[n++]);this._hueStats.injectIntoArray(t);break;case 2:t=e;break;default:throw new Error("Incorrect method")}return t.map((e=>+e))}_colorStats1D(e){const t=this._histogram,i=e.getPointArray(),a=i.length;for(let e=0;e<a;e++){const a=i[e].uint32;this._hueStats.check(a),a in t?t[a]++:t[a]=1}}_colorStats2D(e){const t=e.getWidth(),i=e.getHeight(),a=e.getPointArray(),r=_ColorHistogram._boxSize[0],n=_ColorHistogram._boxSize[1],s=r*n,o=this._makeBoxes(t,i,r,n),l=this._histogram;o.forEach((e=>{let i=Math.round(e.w*e.h/s)*_ColorHistogram._boxPixels;i<2&&(i=2);const r={};this._iterateBox(e,t,(e=>{const t=a[e].uint32;this._hueStats.check(t),t in l?l[t]++:t in r?++r[t]>=i&&(l[t]=r[t]):r[t]=1}))})),this._hueStats.injectIntoDictionary(l)}_iterateBox(e,t,i){const a=e,r=a.y*t+a.x,n=(a.y+a.h-1)*t+(a.x+a.w-1),s=t-a.w+1;let o=0,l=r;do{i.call(this,l),l+=++o%a.w==0?s:1}while(l<=n)}_makeBoxes(e,t,i,a){const r=e%i,n=t%a,s=e-r,o=t-n,l=[];for(let u=0;u<t;u+=a)for(let t=0;t<e;t+=i)l.push({x:t,y:u,w:t===s?r:i,h:u===o?n:a});return l}},ColorHistogram=_ColorHistogram;__publicField(ColorHistogram,"_boxSize",[64,64]),__publicField(ColorHistogram,"_boxPixels",2),__publicField(ColorHistogram,"_hueGroups",10);var RemovedColor=class{constructor(e,t,i){__publicField(this,"index"),__publicField(this,"color"),__publicField(this,"distance"),this.index=e,this.color=t,this.distance=i}},RGBQuant=class extends AbstractPaletteQuantizer{constructor(e,t=256,i=2){super(),__publicField(this,"_colors"),__publicField(this,"_initialDistance"),__publicField(this,"_distanceIncrement"),__publicField(this,"_histogram"),__publicField(this,"_distance"),this._distance=e,this._colors=t,this._histogram=new ColorHistogram(i,t),this._initialDistance=.01,this._distanceIncrement=.005}sample(e){this._histogram.sample(e)}*quantize(){const e=this._histogram.getImportanceSortedColorsIDXI32();if(0===e.length)throw new Error("No colors in image");yield*this._buildPalette(e)}*_buildPalette(e){const t=new Palette,i=t.getPointContainer().getPointArray(),a=new Array(e.length);for(let t=0;t<e.length;t++)i.push(Point.createByUint32(e[t])),a[t]=1;const r=i.length,n=[];let s=r,o=this._initialDistance;const l=new ProgressTracker(s-this._colors,99);for(;s>this._colors;){n.length=0;for(let e=0;e<r;e++){if(l.shouldNotify(r-s)&&(yield{progress:l.progress}),0===a[e])continue;const t=i[e];for(let l=e+1;l<r;l++){if(0===a[l])continue;const e=i[l],r=this._distance.calculateNormalized(t,e);r<o&&(n.push(new RemovedColor(l,e,r)),a[l]=0,s--)}}o+=s>3*this._colors?this._initialDistance:this._distanceIncrement}if(s<this._colors){stableSort(n,((e,t)=>t.distance-e.distance));let e=0;for(;s<this._colors&&e<n.length;){a[n[e].index]=1,s++,e++}}let u=i.length;for(let e=u-1;e>=0;e--)0===a[e]&&(e!==u-1&&(i[e]=i[u-1]),--u);i.length=u,t.sort(),yield{palette:t,progress:100}}};function createArray1D(e){const t=[];for(let i=0;i<e;i++)t[i]=0;return t}function createArray4D(e,t,i,a){const r=new Array(e);for(let n=0;n<e;n++){r[n]=new Array(t);for(let e=0;e<t;e++){r[n][e]=new Array(i);for(let t=0;t<i;t++){r[n][e][t]=new Array(a);for(let i=0;i<a;i++)r[n][e][t][i]=0}}}return r}function createArray3D(e,t,i){const a=new Array(e);for(let r=0;r<e;r++){a[r]=new Array(t);for(let e=0;e<t;e++){a[r][e]=new Array(i);for(let t=0;t<i;t++)a[r][e][t]=0}}return a}function fillArray3D(e,t,i,a,r){for(let n=0;n<t;n++){e[n]=[];for(let t=0;t<i;t++){e[n][t]=[];for(let i=0;i<a;i++)e[n][t][i]=r}}}function fillArray1D(e,t,i){for(let a=0;a<t;a++)e[a]=i}var WuColorCube=class{constructor(){__publicField(this,"redMinimum"),__publicField(this,"redMaximum"),__publicField(this,"greenMinimum"),__publicField(this,"greenMaximum"),__publicField(this,"blueMinimum"),__publicField(this,"blueMaximum"),__publicField(this,"volume"),__publicField(this,"alphaMinimum"),__publicField(this,"alphaMaximum")}},_WuQuant=class extends AbstractPaletteQuantizer{constructor(e,t=256,i=5){super(),__publicField(this,"_reds"),__publicField(this,"_greens"),__publicField(this,"_blues"),__publicField(this,"_alphas"),__publicField(this,"_sums"),__publicField(this,"_weights"),__publicField(this,"_momentsRed"),__publicField(this,"_momentsGreen"),__publicField(this,"_momentsBlue"),__publicField(this,"_momentsAlpha"),__publicField(this,"_moments"),__publicField(this,"_table"),__publicField(this,"_pixels"),__publicField(this,"_cubes"),__publicField(this,"_colors"),__publicField(this,"_significantBitsPerChannel"),__publicField(this,"_maxSideIndex"),__publicField(this,"_alphaMaxSideIndex"),__publicField(this,"_sideSize"),__publicField(this,"_alphaSideSize"),__publicField(this,"_distance"),this._distance=e,this._setQuality(i),this._initialize(t)}sample(e){const t=e.getPointArray();for(let e=0,i=t.length;e<i;e++)this._addColor(t[e]);this._pixels=this._pixels.concat(t)}*quantize(){yield*this._preparePalette();const e=new Palette;for(let t=0;t<this._colors;t++)if(this._sums[t]>0){const i=this._sums[t],a=this._reds[t]/i,r=this._greens[t]/i,n=this._blues[t]/i,s=this._alphas[t]/i,o=Point.createByRGBA(0|a,0|r,0|n,0|s);e.add(o)}e.sort(),yield{palette:e,progress:100}}*_preparePalette(){yield*this._calculateMoments();let e=0;const t=createArray1D(this._colors);for(let i=1;i<this._colors;++i){this._cut(this._cubes[e],this._cubes[i])?(t[e]=this._cubes[e].volume>1?this._calculateVariance(this._cubes[e]):0,t[i]=this._cubes[i].volume>1?this._calculateVariance(this._cubes[i]):0):(t[e]=0,i--),e=0;let a=t[0];for(let r=1;r<=i;++r)t[r]>a&&(a=t[r],e=r);if(a<=0){this._colors=i+1;break}}const i=[],a=[],r=[],n=[];for(let e=0;e<this._colors;++e){const t=_WuQuant._volume(this._cubes[e],this._weights);t>0?(i[e]=_WuQuant._volume(this._cubes[e],this._momentsRed)/t|0,a[e]=_WuQuant._volume(this._cubes[e],this._momentsGreen)/t|0,r[e]=_WuQuant._volume(this._cubes[e],this._momentsBlue)/t|0,n[e]=_WuQuant._volume(this._cubes[e],this._momentsAlpha)/t|0):(i[e]=0,a[e]=0,r[e]=0,n[e]=0)}this._reds=createArray1D(this._colors+1),this._greens=createArray1D(this._colors+1),this._blues=createArray1D(this._colors+1),this._alphas=createArray1D(this._colors+1),this._sums=createArray1D(this._colors+1);for(let e=0,t=this._pixels.length;e<t;e++){const t=this._pixels[e];let s=-1,o=Number.MAX_VALUE;for(let e=0;e<this._colors;e++){const l=i[e],u=a[e],h=r[e],c=n[e],d=this._distance.calculateRaw(l,u,h,c,t.r,t.g,t.b,t.a);d<o&&(o=d,s=e)}this._reds[s]+=t.r,this._greens[s]+=t.g,this._blues[s]+=t.b,this._alphas[s]+=t.a,this._sums[s]++}}_addColor(e){const t=8-this._significantBitsPerChannel,i=1+(e.r>>t),a=1+(e.g>>t),r=1+(e.b>>t),n=1+(e.a>>t);this._weights[n][i][a][r]++,this._momentsRed[n][i][a][r]+=e.r,this._momentsGreen[n][i][a][r]+=e.g,this._momentsBlue[n][i][a][r]+=e.b,this._momentsAlpha[n][i][a][r]+=e.a,this._moments[n][i][a][r]+=this._table[e.r]+this._table[e.g]+this._table[e.b]+this._table[e.a]}*_calculateMoments(){const e=[],t=[],i=[],a=[],r=[],n=[],s=createArray3D(this._sideSize,this._sideSize,this._sideSize),o=createArray3D(this._sideSize,this._sideSize,this._sideSize),l=createArray3D(this._sideSize,this._sideSize,this._sideSize),u=createArray3D(this._sideSize,this._sideSize,this._sideSize),h=createArray3D(this._sideSize,this._sideSize,this._sideSize),c=createArray3D(this._sideSize,this._sideSize,this._sideSize);let d=0;const f=new ProgressTracker(this._alphaMaxSideIndex*this._maxSideIndex,99);for(let m=1;m<=this._alphaMaxSideIndex;++m){fillArray3D(s,this._sideSize,this._sideSize,this._sideSize,0),fillArray3D(o,this._sideSize,this._sideSize,this._sideSize,0),fillArray3D(l,this._sideSize,this._sideSize,this._sideSize,0),fillArray3D(u,this._sideSize,this._sideSize,this._sideSize,0),fillArray3D(h,this._sideSize,this._sideSize,this._sideSize,0),fillArray3D(c,this._sideSize,this._sideSize,this._sideSize,0);for(let p=1;p<=this._maxSideIndex;++p,++d){f.shouldNotify(d)&&(yield{progress:f.progress}),fillArray1D(e,this._sideSize,0),fillArray1D(t,this._sideSize,0),fillArray1D(i,this._sideSize,0),fillArray1D(a,this._sideSize,0),fillArray1D(r,this._sideSize,0),fillArray1D(n,this._sideSize,0);for(let d=1;d<=this._maxSideIndex;++d){let f=0,_=0,g=0,b=0,y=0,x=0;for(let w=1;w<=this._maxSideIndex;++w)f+=this._weights[m][p][d][w],_+=this._momentsRed[m][p][d][w],g+=this._momentsGreen[m][p][d][w],b+=this._momentsBlue[m][p][d][w],y+=this._momentsAlpha[m][p][d][w],x+=this._moments[m][p][d][w],e[w]+=f,t[w]+=_,i[w]+=g,a[w]+=b,r[w]+=y,n[w]+=x,s[p][d][w]=s[p-1][d][w]+e[w],o[p][d][w]=o[p-1][d][w]+t[w],l[p][d][w]=l[p-1][d][w]+i[w],u[p][d][w]=u[p-1][d][w]+a[w],h[p][d][w]=h[p-1][d][w]+r[w],c[p][d][w]=c[p-1][d][w]+n[w],this._weights[m][p][d][w]=this._weights[m-1][p][d][w]+s[p][d][w],this._momentsRed[m][p][d][w]=this._momentsRed[m-1][p][d][w]+o[p][d][w],this._momentsGreen[m][p][d][w]=this._momentsGreen[m-1][p][d][w]+l[p][d][w],this._momentsBlue[m][p][d][w]=this._momentsBlue[m-1][p][d][w]+u[p][d][w],this._momentsAlpha[m][p][d][w]=this._momentsAlpha[m-1][p][d][w]+h[p][d][w],this._moments[m][p][d][w]=this._moments[m-1][p][d][w]+c[p][d][w]}}}}static _volumeFloat(e,t){return t[e.alphaMaximum][e.redMaximum][e.greenMaximum][e.blueMaximum]-t[e.alphaMaximum][e.redMaximum][e.greenMinimum][e.blueMaximum]-t[e.alphaMaximum][e.redMinimum][e.greenMaximum][e.blueMaximum]+t[e.alphaMaximum][e.redMinimum][e.greenMinimum][e.blueMaximum]-t[e.alphaMinimum][e.redMaximum][e.greenMaximum][e.blueMaximum]+t[e.alphaMinimum][e.redMaximum][e.greenMinimum][e.blueMaximum]+t[e.alphaMinimum][e.redMinimum][e.greenMaximum][e.blueMaximum]-t[e.alphaMinimum][e.redMinimum][e.greenMinimum][e.blueMaximum]-(t[e.alphaMaximum][e.redMaximum][e.greenMaximum][e.blueMinimum]-t[e.alphaMinimum][e.redMaximum][e.greenMaximum][e.blueMinimum]-t[e.alphaMaximum][e.redMaximum][e.greenMinimum][e.blueMinimum]+t[e.alphaMinimum][e.redMaximum][e.greenMinimum][e.blueMinimum]-t[e.alphaMaximum][e.redMinimum][e.greenMaximum][e.blueMinimum]+t[e.alphaMinimum][e.redMinimum][e.greenMaximum][e.blueMinimum]+t[e.alphaMaximum][e.redMinimum][e.greenMinimum][e.blueMinimum]-t[e.alphaMinimum][e.redMinimum][e.greenMinimum][e.blueMinimum])}static _volume(e,t){return 0|_WuQuant._volumeFloat(e,t)}static _top(e,t,i,a){let r;switch(t){case _WuQuant._alpha:r=a[i][e.redMaximum][e.greenMaximum][e.blueMaximum]-a[i][e.redMaximum][e.greenMinimum][e.blueMaximum]-a[i][e.redMinimum][e.greenMaximum][e.blueMaximum]+a[i][e.redMinimum][e.greenMinimum][e.blueMaximum]-(a[i][e.redMaximum][e.greenMaximum][e.blueMinimum]-a[i][e.redMaximum][e.greenMinimum][e.blueMinimum]-a[i][e.redMinimum][e.greenMaximum][e.blueMinimum]+a[i][e.redMinimum][e.greenMinimum][e.blueMinimum]);break;case _WuQuant._red:r=a[e.alphaMaximum][i][e.greenMaximum][e.blueMaximum]-a[e.alphaMaximum][i][e.greenMinimum][e.blueMaximum]-a[e.alphaMinimum][i][e.greenMaximum][e.blueMaximum]+a[e.alphaMinimum][i][e.greenMinimum][e.blueMaximum]-(a[e.alphaMaximum][i][e.greenMaximum][e.blueMinimum]-a[e.alphaMaximum][i][e.greenMinimum][e.blueMinimum]-a[e.alphaMinimum][i][e.greenMaximum][e.blueMinimum]+a[e.alphaMinimum][i][e.greenMinimum][e.blueMinimum]);break;case _WuQuant._green:r=a[e.alphaMaximum][e.redMaximum][i][e.blueMaximum]-a[e.alphaMaximum][e.redMinimum][i][e.blueMaximum]-a[e.alphaMinimum][e.redMaximum][i][e.blueMaximum]+a[e.alphaMinimum][e.redMinimum][i][e.blueMaximum]-(a[e.alphaMaximum][e.redMaximum][i][e.blueMinimum]-a[e.alphaMaximum][e.redMinimum][i][e.blueMinimum]-a[e.alphaMinimum][e.redMaximum][i][e.blueMinimum]+a[e.alphaMinimum][e.redMinimum][i][e.blueMinimum]);break;case _WuQuant._blue:r=a[e.alphaMaximum][e.redMaximum][e.greenMaximum][i]-a[e.alphaMaximum][e.redMaximum][e.greenMinimum][i]-a[e.alphaMaximum][e.redMinimum][e.greenMaximum][i]+a[e.alphaMaximum][e.redMinimum][e.greenMinimum][i]-(a[e.alphaMinimum][e.redMaximum][e.greenMaximum][i]-a[e.alphaMinimum][e.redMaximum][e.greenMinimum][i]-a[e.alphaMinimum][e.redMinimum][e.greenMaximum][i]+a[e.alphaMinimum][e.redMinimum][e.greenMinimum][i]);break;default:throw new Error("impossible")}return 0|r}static _bottom(e,t,i){switch(t){case _WuQuant._alpha:return-i[e.alphaMinimum][e.redMaximum][e.greenMaximum][e.blueMaximum]+i[e.alphaMinimum][e.redMaximum][e.greenMinimum][e.blueMaximum]+i[e.alphaMinimum][e.redMinimum][e.greenMaximum][e.blueMaximum]-i[e.alphaMinimum][e.redMinimum][e.greenMinimum][e.blueMaximum]-(-i[e.alphaMinimum][e.redMaximum][e.greenMaximum][e.blueMinimum]+i[e.alphaMinimum][e.redMaximum][e.greenMinimum][e.blueMinimum]+i[e.alphaMinimum][e.redMinimum][e.greenMaximum][e.blueMinimum]-i[e.alphaMinimum][e.redMinimum][e.greenMinimum][e.blueMinimum]);case _WuQuant._red:return-i[e.alphaMaximum][e.redMinimum][e.greenMaximum][e.blueMaximum]+i[e.alphaMaximum][e.redMinimum][e.greenMinimum][e.blueMaximum]+i[e.alphaMinimum][e.redMinimum][e.greenMaximum][e.blueMaximum]-i[e.alphaMinimum][e.redMinimum][e.greenMinimum][e.blueMaximum]-(-i[e.alphaMaximum][e.redMinimum][e.greenMaximum][e.blueMinimum]+i[e.alphaMaximum][e.redMinimum][e.greenMinimum][e.blueMinimum]+i[e.alphaMinimum][e.redMinimum][e.greenMaximum][e.blueMinimum]-i[e.alphaMinimum][e.redMinimum][e.greenMinimum][e.blueMinimum]);case _WuQuant._green:return-i[e.alphaMaximum][e.redMaximum][e.greenMinimum][e.blueMaximum]+i[e.alphaMaximum][e.redMinimum][e.greenMinimum][e.blueMaximum]+i[e.alphaMinimum][e.redMaximum][e.greenMinimum][e.blueMaximum]-i[e.alphaMinimum][e.redMinimum][e.greenMinimum][e.blueMaximum]-(-i[e.alphaMaximum][e.redMaximum][e.greenMinimum][e.blueMinimum]+i[e.alphaMaximum][e.redMinimum][e.greenMinimum][e.blueMinimum]+i[e.alphaMinimum][e.redMaximum][e.greenMinimum][e.blueMinimum]-i[e.alphaMinimum][e.redMinimum][e.greenMinimum][e.blueMinimum]);case _WuQuant._blue:return-i[e.alphaMaximum][e.redMaximum][e.greenMaximum][e.blueMinimum]+i[e.alphaMaximum][e.redMaximum][e.greenMinimum][e.blueMinimum]+i[e.alphaMaximum][e.redMinimum][e.greenMaximum][e.blueMinimum]-i[e.alphaMaximum][e.redMinimum][e.greenMinimum][e.blueMinimum]-(-i[e.alphaMinimum][e.redMaximum][e.greenMaximum][e.blueMinimum]+i[e.alphaMinimum][e.redMaximum][e.greenMinimum][e.blueMinimum]+i[e.alphaMinimum][e.redMinimum][e.greenMaximum][e.blueMinimum]-i[e.alphaMinimum][e.redMinimum][e.greenMinimum][e.blueMinimum]);default:return 0}}_calculateVariance(e){const t=_WuQuant._volume(e,this._momentsRed),i=_WuQuant._volume(e,this._momentsGreen),a=_WuQuant._volume(e,this._momentsBlue),r=_WuQuant._volume(e,this._momentsAlpha);return _WuQuant._volumeFloat(e,this._moments)-(t*t+i*i+a*a+r*r)/_WuQuant._volume(e,this._weights)}_maximize(e,t,i,a,r,n,s,o,l){const u=0|_WuQuant._bottom(e,t,this._momentsRed),h=0|_WuQuant._bottom(e,t,this._momentsGreen),c=0|_WuQuant._bottom(e,t,this._momentsBlue),d=0|_WuQuant._bottom(e,t,this._momentsAlpha),f=0|_WuQuant._bottom(e,t,this._weights);let m=0,p=-1;for(let _=i;_<a;++_){let i=u+_WuQuant._top(e,t,_,this._momentsRed),a=h+_WuQuant._top(e,t,_,this._momentsGreen),g=c+_WuQuant._top(e,t,_,this._momentsBlue),b=d+_WuQuant._top(e,t,_,this._momentsAlpha),y=f+_WuQuant._top(e,t,_,this._weights);if(0!==y){let e=i*i+a*a+g*g+b*b,t=e/y;i=r-i,a=n-a,g=s-g,b=o-b,y=l-y,0!==y&&(e=i*i+a*a+g*g+b*b,t+=e/y,t>m&&(m=t,p=_))}}return{max:m,position:p}}_cut(e,t){let i;const a=_WuQuant._volume(e,this._momentsRed),r=_WuQuant._volume(e,this._momentsGreen),n=_WuQuant._volume(e,this._momentsBlue),s=_WuQuant._volume(e,this._momentsAlpha),o=_WuQuant._volume(e,this._weights),l=this._maximize(e,_WuQuant._red,e.redMinimum+1,e.redMaximum,a,r,n,s,o),u=this._maximize(e,_WuQuant._green,e.greenMinimum+1,e.greenMaximum,a,r,n,s,o),h=this._maximize(e,_WuQuant._blue,e.blueMinimum+1,e.blueMaximum,a,r,n,s,o),c=this._maximize(e,_WuQuant._alpha,e.alphaMinimum+1,e.alphaMaximum,a,r,n,s,o);if(c.max>=l.max&&c.max>=u.max&&c.max>=h.max){if(i=_WuQuant._alpha,c.position<0)return!1}else i=l.max>=c.max&&l.max>=u.max&&l.max>=h.max?_WuQuant._red:u.max>=c.max&&u.max>=l.max&&u.max>=h.max?_WuQuant._green:_WuQuant._blue;switch(t.redMaximum=e.redMaximum,t.greenMaximum=e.greenMaximum,t.blueMaximum=e.blueMaximum,t.alphaMaximum=e.alphaMaximum,i){case _WuQuant._red:t.redMinimum=e.redMaximum=l.position,t.greenMinimum=e.greenMinimum,t.blueMinimum=e.blueMinimum,t.alphaMinimum=e.alphaMinimum;break;case _WuQuant._green:t.greenMinimum=e.greenMaximum=u.position,t.redMinimum=e.redMinimum,t.blueMinimum=e.blueMinimum,t.alphaMinimum=e.alphaMinimum;break;case _WuQuant._blue:t.blueMinimum=e.blueMaximum=h.position,t.redMinimum=e.redMinimum,t.greenMinimum=e.greenMinimum,t.alphaMinimum=e.alphaMinimum;break;case _WuQuant._alpha:t.alphaMinimum=e.alphaMaximum=c.position,t.blueMinimum=e.blueMinimum,t.redMinimum=e.redMinimum,t.greenMinimum=e.greenMinimum}return e.volume=(e.redMaximum-e.redMinimum)*(e.greenMaximum-e.greenMinimum)*(e.blueMaximum-e.blueMinimum)*(e.alphaMaximum-e.alphaMinimum),t.volume=(t.redMaximum-t.redMinimum)*(t.greenMaximum-t.greenMinimum)*(t.blueMaximum-t.blueMinimum)*(t.alphaMaximum-t.alphaMinimum),!0}_initialize(e){this._colors=e,this._cubes=[];for(let t=0;t<e;t++)this._cubes[t]=new WuColorCube;this._cubes[0].redMinimum=0,this._cubes[0].greenMinimum=0,this._cubes[0].blueMinimum=0,this._cubes[0].alphaMinimum=0,this._cubes[0].redMaximum=this._maxSideIndex,this._cubes[0].greenMaximum=this._maxSideIndex,this._cubes[0].blueMaximum=this._maxSideIndex,this._cubes[0].alphaMaximum=this._alphaMaxSideIndex,this._weights=createArray4D(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._momentsRed=createArray4D(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._momentsGreen=createArray4D(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._momentsBlue=createArray4D(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._momentsAlpha=createArray4D(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._moments=createArray4D(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._table=[];for(let e=0;e<256;++e)this._table[e]=e*e;this._pixels=[]}_setQuality(e=5){this._significantBitsPerChannel=e,this._maxSideIndex=1<<this._significantBitsPerChannel,this._alphaMaxSideIndex=this._maxSideIndex,this._sideSize=this._maxSideIndex+1,this._alphaSideSize=this._alphaMaxSideIndex+1}},WuQuant=_WuQuant;__publicField(WuQuant,"_alpha",3),__publicField(WuQuant,"_red",2),__publicField(WuQuant,"_green",1),__publicField(WuQuant,"_blue",0);var image_exports={};__export(image_exports,{AbstractImageQuantizer:()=>AbstractImageQuantizer,ErrorDiffusionArray:()=>ErrorDiffusionArray,ErrorDiffusionArrayKernel:()=>ErrorDiffusionArrayKernel,ErrorDiffusionRiemersma:()=>ErrorDiffusionRiemersma,NearestColor:()=>NearestColor});var AbstractImageQuantizer=class{quantizeSync(e,t){for(const i of this.quantize(e,t))if(i.pointContainer)return i.pointContainer;throw new Error("unreachable")}},NearestColor=class extends AbstractImageQuantizer{constructor(e){super(),__publicField(this,"_distance"),this._distance=e}*quantize(e,t){const i=e.getPointArray(),a=e.getWidth(),r=e.getHeight(),n=new ProgressTracker(r,99);for(let e=0;e<r;e++){n.shouldNotify(e)&&(yield{progress:n.progress});for(let r=0,n=e*a;r<a;r++,n++){const e=i[n];e.from(t.getNearestColor(this._distance,e))}}yield{pointContainer:e,progress:100}}},ErrorDiffusionArrayKernel=(e=>(e[e.FloydSteinberg=0]="FloydSteinberg",e[e.FalseFloydSteinberg=1]="FalseFloydSteinberg",e[e.Stucki=2]="Stucki",e[e.Atkinson=3]="Atkinson",e[e.Jarvis=4]="Jarvis",e[e.Burkes=5]="Burkes",e[e.Sierra=6]="Sierra",e[e.TwoSierra=7]="TwoSierra",e[e.SierraLite=8]="SierraLite",e))(ErrorDiffusionArrayKernel||{}),ErrorDiffusionArray=class extends AbstractImageQuantizer{constructor(e,t,i=!0,a=0,r=!1){super(),__publicField(this,"_minColorDistance"),__publicField(this,"_serpentine"),__publicField(this,"_kernel"),__publicField(this,"_calculateErrorLikeGIMP"),__publicField(this,"_distance"),this._setKernel(t),this._distance=e,this._minColorDistance=a,this._serpentine=i,this._calculateErrorLikeGIMP=r}*quantize(e,t){const i=e.getPointArray(),a=new Point,r=e.getWidth(),n=e.getHeight(),s=[];let o=1,l=1;for(const e of this._kernel){const t=e[2]+1;l<t&&(l=t)}for(let e=0;e<l;e++)this._fillErrorLine(s[e]=[],r);const u=new ProgressTracker(n,99);for(let e=0;e<n;e++){u.shouldNotify(e)&&(yield{progress:u.progress}),this._serpentine&&(o*=-1);const l=e*r,h=1===o?0:r-1,c=1===o?r:-1;this._fillErrorLine(s[0],r),s.push(s.shift());const d=s[0];for(let u=h,f=l+h;u!==c;u+=o,f+=o){const l=i[f],h=d[u];a.from(l);const c=Point.createByRGBA(inRange0to255Rounded(l.r+h[0]),inRange0to255Rounded(l.g+h[1]),inRange0to255Rounded(l.b+h[2]),inRange0to255Rounded(l.a+h[3])),m=t.getNearestColor(this._distance,c);if(l.from(m),this._minColorDistance){if(this._distance.calculateNormalized(a,m)<this._minColorDistance)continue}let p,_,g,b;this._calculateErrorLikeGIMP?(p=c.r-m.r,_=c.g-m.g,g=c.b-m.b,b=c.a-m.a):(p=a.r-m.r,_=a.g-m.g,g=a.b-m.b,b=a.a-m.a);const y=1===o?0:this._kernel.length-1,x=1===o?this._kernel.length:-1;for(let t=y;t!==x;t+=o){const i=this._kernel[t][1]*o,a=this._kernel[t][2];if(i+u>=0&&i+u<r&&a+e>=0&&a+e<n){const e=this._kernel[t][0],r=s[a][i+u];r[0]+=p*e,r[1]+=_*e,r[2]+=g*e,r[3]+=b*e}}}}yield{pointContainer:e,progress:100}}_fillErrorLine(e,t){e.length>t&&(e.length=t);const i=e.length;for(let t=0;t<i;t++){const i=e[t];i[0]=i[1]=i[2]=i[3]=0}for(let a=i;a<t;a++)e[a]=[0,0,0,0]}_setKernel(e){switch(e){case 0:this._kernel=[[7/16,1,0],[3/16,-1,1],[5/16,0,1],[1/16,1,1]];break;case 1:this._kernel=[[3/8,1,0],[3/8,0,1],[2/8,1,1]];break;case 2:this._kernel=[[8/42,1,0],[4/42,2,0],[2/42,-2,1],[4/42,-1,1],[8/42,0,1],[4/42,1,1],[2/42,2,1],[1/42,-2,2],[2/42,-1,2],[4/42,0,2],[2/42,1,2],[1/42,2,2]];break;case 3:this._kernel=[[1/8,1,0],[1/8,2,0],[1/8,-1,1],[1/8,0,1],[1/8,1,1],[1/8,0,2]];break;case 4:this._kernel=[[7/48,1,0],[5/48,2,0],[3/48,-2,1],[5/48,-1,1],[7/48,0,1],[5/48,1,1],[3/48,2,1],[1/48,-2,2],[3/48,-1,2],[5/48,0,2],[3/48,1,2],[1/48,2,2]];break;case 5:this._kernel=[[.25,1,0],[4/32,2,0],[2/32,-2,1],[4/32,-1,1],[.25,0,1],[4/32,1,1],[2/32,2,1]];break;case 6:this._kernel=[[5/32,1,0],[3/32,2,0],[2/32,-2,1],[4/32,-1,1],[5/32,0,1],[4/32,1,1],[2/32,2,1],[2/32,-1,2],[3/32,0,2],[2/32,1,2]];break;case 7:this._kernel=[[.25,1,0],[3/16,2,0],[1/16,-2,1],[2/16,-1,1],[3/16,0,1],[2/16,1,1],[1/16,2,1]];break;case 8:this._kernel=[[.5,1,0],[1/4,-1,1],[1/4,0,1]];break;default:throw new Error(`ErrorDiffusionArray: unknown kernel = ${e}`)}}};function*hilbertCurve(e,t,i){const a=Math.max(e,t),r={width:e,height:t,level:Math.floor(Math.log(a)/Math.log(2)+1),callback:i,tracker:new ProgressTracker(e*t,99),index:0,x:0,y:0};yield*walkHilbert(r,1),visit(r,0)}function*walkHilbert(e,t){if(!(e.level<1)){switch(e.tracker.shouldNotify(e.index)&&(yield{progress:e.tracker.progress}),e.level--,t){case 2:yield*walkHilbert(e,1),visit(e,3),yield*walkHilbert(e,2),visit(e,4),yield*walkHilbert(e,2),visit(e,2),yield*walkHilbert(e,4);break;case 3:yield*walkHilbert(e,4),visit(e,2),yield*walkHilbert(e,3),visit(e,1),yield*walkHilbert(e,3),visit(e,3),yield*walkHilbert(e,1);break;case 1:yield*walkHilbert(e,2),visit(e,4),yield*walkHilbert(e,1),visit(e,3),yield*walkHilbert(e,1),visit(e,1),yield*walkHilbert(e,3);break;case 4:yield*walkHilbert(e,3),visit(e,1),yield*walkHilbert(e,4),visit(e,2),yield*walkHilbert(e,4),visit(e,4),yield*walkHilbert(e,2)}e.level++}}function visit(e,t){switch(e.x>=0&&e.x<e.width&&e.y>=0&&e.y<e.height&&(e.callback(e.x,e.y),e.index++),t){case 2:e.x--;break;case 3:e.x++;break;case 1:e.y--;break;case 4:e.y++}}var ErrorDiffusionRiemersma=class extends AbstractImageQuantizer{constructor(e,t=16,i=1){super(),__publicField(this,"_distance"),__publicField(this,"_weights"),__publicField(this,"_errorQueueSize"),this._distance=e,this._errorQueueSize=t,this._weights=ErrorDiffusionRiemersma._createWeights(i,t)}*quantize(e,t){const i=e.getPointArray(),a=e.getWidth(),r=e.getHeight(),n=[];let s=0;for(let e=0;e<this._errorQueueSize;e++)n[e]={r:0,g:0,b:0,a:0};yield*hilbertCurve(a,r,((e,r)=>{const o=i[e+r*a];let{r:l,g:u,b:h,a:c}=o;for(let e=0;e<this._errorQueueSize;e++){const t=this._weights[e],i=n[(e+s)%this._errorQueueSize];l+=i.r*t,u+=i.g*t,h+=i.b*t,c+=i.a*t}const d=Point.createByRGBA(inRange0to255Rounded(l),inRange0to255Rounded(u),inRange0to255Rounded(h),inRange0to255Rounded(c)),f=t.getNearestColor(this._distance,d);s=(s+1)%this._errorQueueSize;const m=(s+this._errorQueueSize-1)%this._errorQueueSize;n[m].r=o.r-f.r,n[m].g=o.g-f.g,n[m].b=o.b-f.b,n[m].a=o.a-f.a,o.from(f)})),yield{pointContainer:e,progress:100}}static _createWeights(e,t){const i=[],a=Math.exp(Math.log(t)/(t-1));for(let r=0,n=1;r<t;r++)i[r]=(n+.5|0)/t*e,n*=a;return i}},quality_exports={};__export(quality_exports,{ssim:()=>ssim});var K1=.01,K2=.03;function ssim(e,t){if(e.getHeight()!==t.getHeight()||e.getWidth()!==t.getWidth())throw new Error("Images have different sizes!");const i=(255*K1)**2,a=(255*K2)**2;let r=0,n=0;return iterate(e,t,((e,t,s,o)=>{let l=0,u=0,h=0;for(let i=0;i<e.length;i++)u+=(e[i]-s)**2,h+=(t[i]-o)**2,l+=(e[i]-s)*(t[i]-o);const c=e.length-1;u/=c,h/=c,l/=c;n+=(2*s*o+i)*(2*l+a)/((s**2+o**2+i)*(u+h+a)),r++})),n/r}function iterate(e,t,i){const a=e.getWidth(),r=e.getHeight();for(let n=0;n<r;n+=8)for(let s=0;s<a;s+=8){const o=Math.min(8,a-s),l=Math.min(8,r-n),u=calculateLumaValuesForWindow(e,s,n,o,l),h=calculateLumaValuesForWindow(t,s,n,o,l);i(u,h,calculateAverageLuma(u),calculateAverageLuma(h))}}function calculateLumaValuesForWindow(e,t,i,a,r){const n=e.getPointArray(),s=[];let o=0;for(let l=i;l<i+r;l++){const i=l*e.getWidth();for(let e=t;e<t+a;e++){const t=n[i+e];s[o]=.2126*t.r+.7152*t.g+.0722*t.b,o++}}return s}function calculateAverageLuma(e){let t=0;for(const i of e)t+=i;return t/e.length}function buildPaletteSync(e,{colorDistanceFormula:t,paletteQuantization:i,colors:a}={}){const r=paletteQuantizationToPaletteQuantizer(colorDistanceFormulaToColorDistance(t),i,a);return e.forEach((e=>r.sample(e))),r.quantizeSync()}function applyPaletteSync(e,t,{colorDistanceFormula:i,imageQuantization:a}={}){return imageQuantizationToImageQuantizer(colorDistanceFormulaToColorDistance(i),a).quantizeSync(e,t)}function colorDistanceFormulaToColorDistance(e="euclidean-bt709"){switch(e){case"cie94-graphic-arts":return new CIE94GraphicArts;case"cie94-textiles":return new CIE94Textiles;case"ciede2000":return new CIEDE2000;case"color-metric":return new CMetric;case"euclidean":return new Euclidean;case"euclidean-bt709":return new EuclideanBT709;case"euclidean-bt709-noalpha":return new EuclideanBT709NoAlpha;case"manhattan":return new Manhattan;case"manhattan-bt709":return new ManhattanBT709;case"manhattan-nommyde":return new ManhattanNommyde;case"pngquant":return new PNGQuant;default:throw new Error(`Unknown colorDistanceFormula ${e}`)}}function imageQuantizationToImageQuantizer(e,t="floyd-steinberg"){switch(t){case"nearest":return new NearestColor(e);case"riemersma":return new ErrorDiffusionRiemersma(e);case"floyd-steinberg":return new ErrorDiffusionArray(e,0);case"false-floyd-steinberg":return new ErrorDiffusionArray(e,1);case"stucki":return new ErrorDiffusionArray(e,2);case"atkinson":return new ErrorDiffusionArray(e,3);case"jarvis":return new ErrorDiffusionArray(e,4);case"burkes":return new ErrorDiffusionArray(e,5);case"sierra":return new ErrorDiffusionArray(e,6);case"two-sierra":return new ErrorDiffusionArray(e,7);case"sierra-lite":return new ErrorDiffusionArray(e,8);default:throw new Error(`Unknown imageQuantization ${t}`)}}function paletteQuantizationToPaletteQuantizer(e,t="wuquant",i=256){switch(t){case"neuquant":return new NeuQuant(e,i);case"rgbquant":return new RGBQuant(e,i);case"wuquant":return new WuQuant(e,i);case"neuquant-float":return new NeuQuantFloat(e,i);default:throw new Error(`Unknown paletteQuantization ${t}`)}}
/**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * cie94.ts - part of Image Quantization Library
 */
/**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * ciede2000.ts - part of Image Quantization Library
 */
/**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * cmetric.ts - part of Image Quantization Library
 */
/**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * common.ts - part of Image Quantization Library
 */
/**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * constants.ts - part of Image Quantization Library
 */
/**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * ditherErrorDiffusionArray.ts - part of Image Quantization Library
 */
/**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * euclidean.ts - part of Image Quantization Library
 */
/**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * helper.ts - part of Image Quantization Library
 */
/**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * hueStatistics.ts - part of Image Quantization Library
 */
/**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * iq.ts - Image Quantization Library
 */
/**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * lab2rgb.ts - part of Image Quantization Library
 */
/**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * lab2xyz.ts - part of Image Quantization Library
 */
/**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * manhattanNeuQuant.ts - part of Image Quantization Library
 */
/**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * nearestColor.ts - part of Image Quantization Library
 */
/**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * palette.ts - part of Image Quantization Library
 */
/**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * pngQuant.ts - part of Image Quantization Library
 */
/**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * point.ts - part of Image Quantization Library
 */
/**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * pointContainer.ts - part of Image Quantization Library
 */
/**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * rgb2hsl.ts - part of Image Quantization Library
 */
/**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * rgb2lab.ts - part of Image Quantization Library
 */
/**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * rgb2xyz.ts - part of Image Quantization Library
 */
/**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * ssim.ts - part of Image Quantization Library
 */
/**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * wuQuant.ts - part of Image Quantization Library
 */
/**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * xyz2lab.ts - part of Image Quantization Library
 */
/**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * xyz2rgb.ts - part of Image Quantization Library
 */
/**
 * @preserve
 * MIT License
 *
 * Copyright 2015-2018 Igor Bezkrovnyi
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to
 * deal in the Software without restriction, including without limitation the
 * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
 * sell copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL
 * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
 * IN THE SOFTWARE.
 *
 * riemersma.ts - part of Image Quantization Library
 */
/**
 * @preserve TypeScript port:
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * colorHistogram.ts - part of Image Quantization Library
 */
/**
 * @preserve TypeScript port:
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * neuquant.ts - part of Image Quantization Library
 */
/**
 * @preserve TypeScript port:
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * rgbquant.ts - part of Image Quantization Library
 */"function"==typeof setImmediate?setImmediate:"undefined"!=typeof process&&(null==process||process.nextTick);const QuantizeOptionsSchema=z.object({colors:z.number().optional(),colorDistanceFormula:z.union([z.literal("cie94-textiles"),z.literal("cie94-graphic-arts"),z.literal("ciede2000"),z.literal("color-metric"),z.literal("euclidean"),z.literal("euclidean-bt709-noalpha"),z.literal("euclidean-bt709"),z.literal("manhattan"),z.literal("manhattan-bt709"),z.literal("manhattan-nommyde"),z.literal("pngquant")]).optional(),paletteQuantization:z.union([z.literal("neuquant"),z.literal("neuquant-float"),z.literal("rgbquant"),z.literal("wuquant")]).optional(),imageQuantization:z.union([z.literal("nearest"),z.literal("riemersma"),z.literal("floyd-steinberg"),z.literal("false-floyd-steinberg"),z.literal("stucki"),z.literal("atkinson"),z.literal("jarvis"),z.literal("burkes"),z.literal("sierra"),z.literal("two-sierra"),z.literal("sierra-lite")]).optional()}),methods={quantize(e,t){const{colors:i,colorDistanceFormula:a,paletteQuantization:r,imageQuantization:n}=QuantizeOptionsSchema.parse(t),s=utils_exports.PointContainer.fromUint8Array(e.bitmap.data,e.bitmap.width,e.bitmap.height),o=applyPaletteSync(s,buildPaletteSync([s],{colors:i,colorDistanceFormula:a,paletteQuantization:r}),{colorDistanceFormula:a,imageQuantization:n});return e.bitmap.data=Buffer.from(o.toUint8Array()),e}},defaultPlugins=[methods$h,methods$g,methods$f,methods$e,methods$c,methods$a,methods$b,methods$9,methods$8,methods$7,methods$6,methods$5,methods$4,methods$3,methods$d,methods$2,methods$1,methods],defaultFormats=[bmp,msBmp,gif,jpeg$2,png,tiff];bmp().mime,gif().mime,jpeg$2().mime,png().mime,tiff().mime;const Jimp=createJimp({formats:defaultFormats,plugins:defaultPlugins});function isGraytone(e,t,i){if(e==t&&e==i&&0==e||e+t+i<20)return!0;{const a=(e+t+i)/3,r=((e-a)**2+(t-a)**2+(i-a)**2)/3;return Math.sqrt(r)/a<=.05}}var api=defineOperationApi({id:"operation-extract-colors",handler:async({character:e})=>{const t="/characters/"+e.game+"/"+e.id+"/gachaSplash.webp",i=[{key:"trim",params:[1,"FF00FF"]},{key:"gravity",params:["fp",e.focalPoint.x+.2*Math.random()-.1,e.focalPoint.y+.2*Math.random()-.1]},{key:"crop",params:[300*e.crop.x,300*e.crop.y]},{key:"resize",params:["fill",200,200]}],a=ProxyService.getImage(t,i,"png"),r={pixels:1e5,distance:.18,saturationDistance:.2,colorValidator:(e,t,i,a=255)=>!isGraytone(e,t,i)&&a>250,lightnessDistance:.2,hueDistance:.083};return{data:await(async e=>{const t=await Jimp.read(e),i={data:new Uint8ClampedArray(t.bitmap.data),width:200,height:200};return await extractColors(i,r)})(a)}}});module.exports=api;
