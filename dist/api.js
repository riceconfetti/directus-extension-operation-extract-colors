"use strict";var e=require("path"),r=require("fs"),t=require("stream"),n=require("zlib"),o=require("os"),a=require("crypto"),i=require("node:crypto");function s(e){if(e.__esModule)return e;var r=e.default;if("function"==typeof r){var t=function e(){if(this instanceof e){var t=[null];return t.push.apply(t,arguments),new(Function.bind.apply(r,t))}return r.apply(this,arguments)};t.prototype=r.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(e).forEach((function(r){var n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return e[r]}})})),t}function h(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}var c=function(e){for(var r=new Array(e),t=0;t<e;++t)r[t]=t;return r},u=function(e){return null!=e&&(h(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&h(e.slice(0,0))}(e)||!!e._isBuffer)},f="undefined"!=typeof Float64Array;function l(e,r){return e[0]-r[0]}function p(){var e,r=this.stride,t=new Array(r.length);for(e=0;e<t.length;++e)t[e]=[Math.abs(r[e]),e];t.sort(l);var n=new Array(t.length);for(e=0;e<n.length;++e)n[e]=t[e][1];return n}function d(e,r){var t=["View",r,"d",e].join("");r<0&&(t="View_Nil"+e);var n="generic"===e;if(-1===r){var o="function "+t+"(a){this.data=a;};var proto="+t+".prototype;proto.dtype='"+e+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+t+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+t+"(a){return new "+t+"(a);}";return new Function(o)()}if(0===r){o="function "+t+"(a,d) {this.data = a;this.offset = d};var proto="+t+".prototype;proto.dtype='"+e+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+t+"_copy() {return new "+t+"(this.data,this.offset)};proto.pick=function "+t+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+t+"_get(){return "+(n?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+t+"_set(v){return "+(n?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+t+"(a,b,c,d){return new "+t+"(a,d)}";return new Function("TrivialArray",o)(g[e][0])}o=["'use strict'"];var a=c(r),i=a.map((function(e){return"i"+e})),s="this.offset+"+a.map((function(e){return"this.stride["+e+"]*i"+e})).join("+"),h=a.map((function(e){return"b"+e})).join(","),u=a.map((function(e){return"c"+e})).join(",");o.push("function "+t+"(a,"+h+","+u+",d){this.data=a","this.shape=["+h+"]","this.stride=["+u+"]","this.offset=d|0}","var proto="+t+".prototype","proto.dtype='"+e+"'","proto.dimension="+r),o.push("Object.defineProperty(proto,'size',{get:function "+t+"_size(){return "+a.map((function(e){return"this.shape["+e+"]"})).join("*"),"}})"),1===r?o.push("proto.order=[0]"):(o.push("Object.defineProperty(proto,'order',{get:"),r<4?(o.push("function "+t+"_order(){"),2===r?o.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===r&&o.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):o.push("ORDER})")),o.push("proto.set=function "+t+"_set("+i.join(",")+",v){"),n?o.push("return this.data.set("+s+",v)}"):o.push("return this.data["+s+"]=v}"),o.push("proto.get=function "+t+"_get("+i.join(",")+"){"),n?o.push("return this.data.get("+s+")}"):o.push("return this.data["+s+"]}"),o.push("proto.index=function "+t+"_index(",i.join(),"){return "+s+"}"),o.push("proto.hi=function "+t+"_hi("+i.join(",")+"){return new "+t+"(this.data,"+a.map((function(e){return["(typeof i",e,"!=='number'||i",e,"<0)?this.shape[",e,"]:i",e,"|0"].join("")})).join(",")+","+a.map((function(e){return"this.stride["+e+"]"})).join(",")+",this.offset)}");var f=a.map((function(e){return"a"+e+"=this.shape["+e+"]"})),l=a.map((function(e){return"c"+e+"=this.stride["+e+"]"}));o.push("proto.lo=function "+t+"_lo("+i.join(",")+"){var b=this.offset,d=0,"+f.join(",")+","+l.join(","));for(var d=0;d<r;++d)o.push("if(typeof i"+d+"==='number'&&i"+d+">=0){d=i"+d+"|0;b+=c"+d+"*d;a"+d+"-=d}");o.push("return new "+t+"(this.data,"+a.map((function(e){return"a"+e})).join(",")+","+a.map((function(e){return"c"+e})).join(",")+",b)}"),o.push("proto.step=function "+t+"_step("+i.join(",")+"){var "+a.map((function(e){return"a"+e+"=this.shape["+e+"]"})).join(",")+","+a.map((function(e){return"b"+e+"=this.stride["+e+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(d=0;d<r;++d)o.push("if(typeof i"+d+"==='number'){d=i"+d+"|0;if(d<0){c+=b"+d+"*(a"+d+"-1);a"+d+"=ceil(-a"+d+"/d)}else{a"+d+"=ceil(a"+d+"/d)}b"+d+"*=d}");o.push("return new "+t+"(this.data,"+a.map((function(e){return"a"+e})).join(",")+","+a.map((function(e){return"b"+e})).join(",")+",c)}");var _=new Array(r),v=new Array(r);for(d=0;d<r;++d)_[d]="a[i"+d+"]",v[d]="b[i"+d+"]";o.push("proto.transpose=function "+t+"_transpose("+i+"){"+i.map((function(e,r){return e+"=("+e+"===undefined?"+r+":"+e+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+t+"(this.data,"+_.join(",")+","+v.join(",")+",this.offset)}"),o.push("proto.pick=function "+t+"_pick("+i+"){var a=[],b=[],c=this.offset");for(d=0;d<r;++d)o.push("if(typeof i"+d+"==='number'&&i"+d+">=0){c=(c+this.stride["+d+"]*i"+d+")|0}else{a.push(this.shape["+d+"]);b.push(this.stride["+d+"])}");return o.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),o.push("return function construct_"+t+"(data,shape,stride,offset){return new "+t+"(data,"+a.map((function(e){return"shape["+e+"]"})).join(",")+","+a.map((function(e){return"stride["+e+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",o.join("\n"))(g[e],p)}var g={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};var _=function(e,r,t,n){if(void 0===e)return(0,g.array[0])([]);"number"==typeof e&&(e=[e]),void 0===r&&(r=[e.length]);var o=r.length;if(void 0===t){t=new Array(o);for(var a=o-1,i=1;a>=0;--a)t[a]=i,i*=r[a]}if(void 0===n){n=0;for(a=0;a<o;++a)t[a]<0&&(n-=(r[a]-1)*t[a])}for(var s=function(e){if(u(e))return"buffer";if(f)switch(Object.prototype.toString.call(e)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(e)?"array":"generic"}(e),h=g[s];h.length<=o+1;)h.push(d(s,h.length-1));return(0,h[o+1])(e,r,t,n)},v={};function b(e){var r,t,n,o,a,i=Math.floor,s=new Array(64),h=new Array(64),c=new Array(64),u=new Array(64),f=new Array(65535),l=new Array(65535),p=new Array(64),d=new Array(64),g=[],_=0,v=7,b=new Array(64),y=new Array(64),w=new Array(64),m=new Array(256),E=new Array(2048),I=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],A=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],k=[0,1,2,3,4,5,6,7,8,9,10,11],T=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],j=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],B=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],O=[0,1,2,3,4,5,6,7,8,9,10,11],P=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],x=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function C(e,r){for(var t=0,n=0,o=new Array,a=1;a<=16;a++){for(var i=1;i<=e[a];i++)o[r[n]]=[],o[r[n]][0]=t,o[r[n]][1]=a,n++,t++;t*=2}return o}function D(e){for(var r=e[0],t=e[1]-1;t>=0;)r&1<<t&&(_|=1<<v),t--,--v<0&&(255==_?(N(255),N(0)):N(_),v=7,_=0)}function N(e){g.push(e)}function U(e){N(e>>8&255),N(255&e)}function M(e,r,t,n,o){var a,i=o[0],s=o[240];for(var h=function(e,r){var t,n,o,a,i,s,h,c,u,f,l=0;for(u=0;u<8;++u){t=e[l],n=e[l+1],o=e[l+2],a=e[l+3],i=e[l+4],s=e[l+5],h=e[l+6];var d=t+(c=e[l+7]),g=t-c,_=n+h,v=n-h,b=o+s,y=o-s,w=a+i,m=a-i,E=d+w,I=d-w,A=_+b,k=_-b;e[l]=E+A,e[l+4]=E-A;var T=.707106781*(k+I);e[l+2]=I+T,e[l+6]=I-T;var j=.382683433*((E=m+y)-(k=v+g)),B=.5411961*E+j,O=1.306562965*k+j,P=.707106781*(A=y+v),x=g+P,C=g-P;e[l+5]=C+B,e[l+3]=C-B,e[l+1]=x+O,e[l+7]=x-O,l+=8}for(l=0,u=0;u<8;++u){t=e[l],n=e[l+8],o=e[l+16],a=e[l+24],i=e[l+32],s=e[l+40],h=e[l+48];var D=t+(c=e[l+56]),N=t-c,U=n+h,M=n-h,R=o+s,S=o-s,V=a+i,L=a-i,H=D+V,G=D-V,F=U+R,Y=U-R;e[l]=H+F,e[l+32]=H-F;var W=.707106781*(Y+G);e[l+16]=G+W,e[l+48]=G-W;var $=.382683433*((H=L+S)-(Y=M+N)),z=.5411961*H+$,X=1.306562965*Y+$,q=.707106781*(F=S+M),K=N+q,Q=N-q;e[l+40]=Q+z,e[l+24]=Q-z,e[l+8]=K+X,e[l+56]=K-X,l++}for(u=0;u<64;++u)f=e[u]*r[u],p[u]=f>0?f+.5|0:f-.5|0;return p}(e,r),c=0;c<64;++c)d[I[c]]=h[c];var u=d[0]-t;t=d[0],0==u?D(n[0]):(D(n[l[a=32767+u]]),D(f[a]));for(var g=63;g>0&&0==d[g];g--);if(0==g)return D(i),t;for(var _,v=1;v<=g;){for(var b=v;0==d[v]&&v<=g;++v);var y=v-b;if(y>=16){_=y>>4;for(var w=1;w<=_;++w)D(s);y&=15}a=32767+d[v],D(o[(y<<4)+l[a]]),D(f[a]),v++}return 63!=g&&D(i),t}function R(e){if(e<=0&&(e=1),e>100&&(e=100),a!=e){(function(e){for(var r=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],t=0;t<64;t++){var n=i((r[t]*e+50)/100);n<1?n=1:n>255&&(n=255),s[I[t]]=n}for(var o=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],a=0;a<64;a++){var f=i((o[a]*e+50)/100);f<1?f=1:f>255&&(f=255),h[I[a]]=f}for(var l=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],p=0,d=0;d<8;d++)for(var g=0;g<8;g++)c[p]=1/(s[I[p]]*l[d]*l[g]*8),u[p]=1/(h[I[p]]*l[d]*l[g]*8),p++})(e<50?Math.floor(5e3/e):Math.floor(200-2*e)),a=e}}this.encode=function(e,a){(new Date).getTime(),a&&R(a),g=new Array,_=0,v=7,U(65496),U(65504),U(16),N(74),N(70),N(73),N(70),N(0),N(1),N(1),N(0),U(1),U(1),N(0),N(0),function(){U(65499),U(132),N(0);for(var e=0;e<64;e++)N(s[e]);N(1);for(var r=0;r<64;r++)N(h[r])}(),function(e,r){U(65472),U(17),N(8),U(r),U(e),N(3),N(1),N(17),N(0),N(2),N(17),N(1),N(3),N(17),N(1)}(e.width,e.height),function(){U(65476),U(418),N(0);for(var e=0;e<16;e++)N(A[e+1]);for(var r=0;r<=11;r++)N(k[r]);N(16);for(var t=0;t<16;t++)N(T[t+1]);for(var n=0;n<=161;n++)N(j[n]);N(1);for(var o=0;o<16;o++)N(B[o+1]);for(var a=0;a<=11;a++)N(O[a]);N(17);for(var i=0;i<16;i++)N(P[i+1]);for(var s=0;s<=161;s++)N(x[s])}(),U(65498),U(12),N(3),N(1),N(0),N(2),N(17),N(3),N(17),N(0),N(63),N(0);var i=0,f=0,l=0;_=0,v=7,this.encode.displayName="_encode_";for(var p,d,m,I,C,S,V,L,H,G=e.data,F=e.width,Y=e.height,W=4*F,$=0;$<Y;){for(p=0;p<W;){for(S=C=W*$+p,V=-1,L=0,H=0;H<64;H++)S=C+(L=H>>3)*W+(V=4*(7&H)),$+L>=Y&&(S-=W*($+1+L-Y)),p+V>=W&&(S-=p+V-W+4),d=G[S++],m=G[S++],I=G[S++],b[H]=(E[d]+E[m+256|0]+E[I+512|0]>>16)-128,y[H]=(E[d+768|0]+E[m+1024|0]+E[I+1280|0]>>16)-128,w[H]=(E[d+1280|0]+E[m+1536|0]+E[I+1792|0]>>16)-128;i=M(b,c,i,r,n),f=M(y,u,f,t,o),l=M(w,u,l,t,o),p+=32}$+=8}if(v>=0){var z=[];z[1]=v+1,z[0]=(1<<v+1)-1,D(z)}return U(65497),new Buffer(g)},(new Date).getTime(),e||(e=50),function(){for(var e=String.fromCharCode,r=0;r<256;r++)m[r]=e(r)}(),r=C(A,k),t=C(B,O),n=C(T,j),o=C(P,x),function(){for(var e=1,r=2,t=1;t<=15;t++){for(var n=e;n<r;n++)l[32767+n]=t,f[32767+n]=[],f[32767+n][1]=t,f[32767+n][0]=n;for(var o=-(r-1);o<=-e;o++)l[32767+o]=t,f[32767+o]=[],f[32767+o][1]=t,f[32767+o][0]=r-1+o;e<<=1,r<<=1}}(),function(){for(var e=0;e<256;e++)E[e]=19595*e,E[e+256|0]=38470*e,E[e+512|0]=7471*e+32768,E[e+768|0]=-11059*e,E[e+1024|0]=-21709*e,E[e+1280|0]=32768*e+8421375,E[e+1536|0]=-27439*e,E[e+1792|0]=-5329*e}(),R(e),(new Date).getTime()}!function(e){var o=r,a=t,i=n,s=new Buffer("89504e470d0a1a0a","hex");function h(e,r,t,n){this.width=e,this.height=r,this.data=t,this.trailer=n}function c(e,r,t){var n=e+r-t,o=Math.abs(n-e),a=Math.abs(n-r),i=Math.abs(n-t);return o<=a&&o<=i?e:a<=i?r:t}h.prototype.getPixel=function(e,r){return e=Math.round(e),r=Math.round(r),e<0||r<0||e>=this.width||r>=this.height?0:this.data.readUInt32BE(4*(r*this.width+e))},e.parseStream=function(e,r){var t,n,o,a,u,f,l,p,d,g,_,v,b,y,w,m,E,I=i.createInflate(),A=0,k=0,T=new Buffer(13),j=2,B=-1,O=0,P=0,x=0;function C(t){return e.destroy&&e.destroy(),I.destroy&&I.destroy(),r(t)}function D(){if(! --j)return r(void 0,new h(n,o,l,w))}e.on("error",C),I.on("error",C),e.on("end",(function(){return e.destroy(),l?w?D():C(new Error("Missing IEND chunk. (Corrupt PNG?)")):C(new Error("Missing IHDR chunk. (Corrupt PNG?)"))})),I.on("end",(function(){return I.destroy&&I.destroy(),O!==l.length?C(new Error("Too little pixel data! (Corrupt PNG?)")):D()})),e.on("data",(function(r){if(e.readable)for(var i,h=r.length,c=0;c!==h;)switch(A){case 0:if(r[c++]!==s[k++])return C(new Error("Invalid PNG header."));k===s.length&&(A=1,k=0);break;case 1:if(h-c<8-k)r.copy(T,k,c),k+=h-c,c=h;else switch(r.copy(T,k,c,c+8-k),c+=8-k,k=0,t=T.readUInt32BE(0),T.toString("ascii",4,8)){case"IHDR":A=2;break;case"PLTE":if(3!==f)A=7;else{if(t%3!=0)return C(new Error("Invalid PLTE size."));P=t/3,m=new Buffer(t),A=3}break;case"tRNS":if(3!==f)return C(new Error("tRNS for non-paletted images not yet supported."));x=t,E=new Buffer(t),A=4;break;case"IDAT":A=5;break;case"IEND":A=6;break;default:A=7}break;case 2:if(13!==t)return C(new Error("Invalid IHDR chunk."));if(h-c<t-k)r.copy(T,k,c),k+=h-c,c=h;else{if(r.copy(T,k,c,c+t-k),0!==T.readUInt8(10))return C(new Error("Unsupported compression method."));if(0!==T.readUInt8(11))return C(new Error("Unsupported filter method."));if(0!==T.readUInt8(12))return C(new Error("Unsupported interlace method."));switch(c+=t-k,A=8,k=0,n=T.readUInt32BE(0),o=T.readUInt32BE(4),a=T.readUInt8(8),u=255/((1<<a)-1),f=T.readUInt8(9),l=new Buffer(n*o*4),f){case 0:p=1,d=Math.ceil(.125*a);break;case 2:p=3,d=Math.ceil(.375*a);break;case 3:p=1,d=1;break;case 4:p=2,d=Math.ceil(.25*a);break;case 6:p=4,d=Math.ceil(.5*a);break;default:return C(new Error("Unsupported color type: "+f))}g=Math.ceil(n*a*p*.125),_=new Buffer(p),v=new Buffer(g),b=new Buffer(g),v.fill(0)}break;case 3:h-c<t-k?(r.copy(m,k,c),k+=h-c,c=h):(r.copy(m,k,c,c+t-k),c+=t-k,A=8,k=0);break;case 4:h-c<t-k?(r.copy(E,k,c),k+=h-c,c=h):(r.copy(E,k,c,c+t-k),c+=t-k,A=8,k=0);break;case 5:h-c<t-k?(I.write(r.slice(c)),k+=h-c,c=h):(I.write(r.slice(c,c+t-k)),c+=t-k,A=8,k=0);break;case 6:if(0!==t)return C(new Error("Invalid IEND chunk."));h-c<4-k?(k+=h-c,c=h):(w=new Buffer(0),c+=4-k,A=9,k=0,I.end());break;case 7:h-c<t-k?(k+=h-c,c=h):(c+=t-k,A=8,k=0);break;case 8:h-c<4-k?(k+=h-c,c=h):(c+=4-k,A=1,k=0);break;case 9:i=new Buffer(k+h-c),w.copy(i),r.copy(i,k,c,h),w=i,k+=h-c,c=h}})),I.on("data",(function(e){if(I.readable){var r,t,o,i,s,h=e.length;for(r=0;r!==h;++r){if(-1===B)y=e[r],t=v,v=b,b=t;else switch(y){case 0:v[B]=e[r];break;case 1:v[B]=B<d?e[r]:e[r]+v[B-d]&255;break;case 2:v[B]=e[r]+b[B]&255;break;case 3:v[B]=e[r]+((B<d?b[B]:v[B-d]+b[B])>>>1)&255;break;case 4:v[B]=e[r]+(B<d?b[B]:c(v[B-d],b[B],b[B-d]))&255;break;default:return C(new Error("Unsupported scanline filter: "+y))}if(++B===g){if(O===l.length)return C(new Error("Too much pixel data! (Corrupt PNG?)"));for(i=0,o=0;o!==n;++o){for(s=0;s!==p;++i,++s)switch(a){case 1:_[s]=v[i>>>3]>>7-(7&i)&1;break;case 2:_[s]=v[i>>>2]>>(3-(3&i)<<1)&3;break;case 4:_[s]=v[i>>>1]>>(1-(1&i)<<2)&15;break;case 8:_[s]=v[i];break;default:return C(new Error("Unsupported bit depth: "+a))}switch(f){case 0:l[O++]=l[O++]=l[O++]=_[0]*u,l[O++]=255;break;case 2:l[O++]=_[0]*u,l[O++]=_[1]*u,l[O++]=_[2]*u,l[O++]=255;break;case 3:if(_[0]>=P)return C(new Error("Invalid palette index."));l[O++]=m[3*_[0]+0],l[O++]=m[3*_[0]+1],l[O++]=m[3*_[0]+2],l[O++]=_[0]<x?E[_[0]]:255;break;case 4:l[O++]=l[O++]=l[O++]=_[0]*u,l[O++]=_[1]*u;break;case 6:l[O++]=_[0]*u,l[O++]=_[1]*u,l[O++]=_[2]*u,l[O++]=_[3]*u}}B=-1}}}}))},e.parseFile=function(r,t){return e.parseStream(o.createReadStream(r),t)},e.parseBuffer=function(r,t){var n=new a.Stream;n.readable=!0,n.destroy=function(){n.readable=!1},e.parseStream(n,t),n.emit("data",r),n.readable&&n.emit("end")},e.parse=e.parseBuffer}(v);var y=function(e,r){void 0===r&&(r=50);var t=new b(r),n=t.encode(e,r);return{data:n,width:e.width,height:e.height}};var w=function(){var e=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),r=4017,t=799,n=3406,o=2276,a=1567,i=3784,s=5793,h=2896;function c(){}function u(e,r){for(var t,n,o=0,a=[],i=16;i>0&&!e[i-1];)i--;a.push({children:[],index:0});var s,h=a[0];for(t=0;t<i;t++){for(n=0;n<e[t];n++){for((h=a.pop()).children[h.index]=r[o];h.index>0;)h=a.pop();for(h.index++,a.push(h);a.length<=t;)a.push(s={children:[],index:0}),h.children[h.index]=s.children,h=s;o++}t+1<i&&(a.push(s={children:[],index:0}),h.children[h.index]=s.children,h=s)}return a[0].children}function f(r,t,n,o,a,i,s,h,c){n.precision,n.samplesPerLine,n.scanLines;var u=n.mcusPerLine,f=n.progressive;n.maxH,n.maxV;var l=t,p=0,d=0;function g(){if(d>0)return d--,p>>d&1;if(255==(p=r[t++])){var e=r[t++];if(e)throw"unexpected marker: "+(p<<8|e).toString(16)}return d=7,p>>>7}function _(e){for(var r,t=e;null!==(r=g());){if("number"==typeof(t=t[r]))return t;if("object"!=typeof t)throw"invalid huffman sequence"}return null}function v(e){for(var r=0;e>0;){var t=g();if(null===t)return;r=r<<1|t,e--}return r}function b(e){var r=v(e);return r>=1<<e-1?r:r+(-1<<e)+1}var y=0;var w,m=0;function E(e,r,t,n,o){var a=t%u,i=(t/u|0)*e.v+n,s=a*e.h+o;r(e,e.blocks[i][s])}function I(e,r,t){var n=t/e.blocksPerLine|0,o=t%e.blocksPerLine;r(e,e.blocks[n][o])}var A,k,T,j,B,O,P=o.length;O=f?0===i?0===h?function(e,r){var t=_(e.huffmanTableDC),n=0===t?0:b(t)<<c;r[0]=e.pred+=n}:function(e,r){r[0]|=g()<<c}:0===h?function(r,t){if(y>0)y--;else for(var n=i,o=s;n<=o;){var a=_(r.huffmanTableAC),h=15&a,u=a>>4;if(0!==h)t[e[n+=u]]=b(h)*(1<<c),n++;else{if(u<15){y=v(u)+(1<<u)-1;break}n+=16}}}:function(r,t){for(var n=i,o=s,a=0;n<=o;){var h=e[n];switch(m){case 0:var u=_(r.huffmanTableAC),f=15&u;if(a=u>>4,0===f)a<15?(y=v(a)+(1<<a),m=4):(a=16,m=1);else{if(1!==f)throw"invalid ACn encoding";w=b(f),m=a?2:3}continue;case 1:case 2:t[h]?t[h]+=g()<<c:0==--a&&(m=2==m?3:0);break;case 3:t[h]?t[h]+=g()<<c:(t[h]=w<<c,m=0);break;case 4:t[h]&&(t[h]+=g()<<c)}n++}4===m&&0==--y&&(m=0)}:function(r,t){var n=_(r.huffmanTableDC),o=0===n?0:b(n);t[0]=r.pred+=o;for(var a=1;a<64;){var i=_(r.huffmanTableAC),s=15&i,h=i>>4;if(0!==s)t[e[a+=h]]=b(s),a++;else{if(h<15)break;a+=16}}};var x,C,D,N,U=0;for(C=1==P?o[0].blocksPerLine*o[0].blocksPerColumn:u*n.mcusPerColumn,a||(a=C);U<C;){for(k=0;k<P;k++)o[k].pred=0;if(y=0,1==P)for(A=o[0],B=0;B<a;B++)I(A,O,U),U++;else for(B=0;B<a;B++){for(k=0;k<P;k++)for(D=(A=o[k]).h,N=A.v,T=0;T<N;T++)for(j=0;j<D;j++)E(A,O,U,T,j);U++}if(d=0,(x=r[t]<<8|r[t+1])<65280)throw"marker was not found";if(!(x>=65488&&x<=65495))break;t+=2}return t-l}function l(e,c){var u,f,l=[],p=c.blocksPerLine,d=c.blocksPerColumn,g=p<<3,_=new Int32Array(64),v=new Uint8Array(64);function b(e,u,f){var l,p,d,g,_,v,b,y,w,m,E=c.quantizationTable,I=f;for(m=0;m<64;m++)I[m]=e[m]*E[m];for(m=0;m<8;++m){var A=8*m;0!=I[1+A]||0!=I[2+A]||0!=I[3+A]||0!=I[4+A]||0!=I[5+A]||0!=I[6+A]||0!=I[7+A]?(l=s*I[0+A]+128>>8,p=s*I[4+A]+128>>8,d=I[2+A],g=I[6+A],_=h*(I[1+A]-I[7+A])+128>>8,y=h*(I[1+A]+I[7+A])+128>>8,v=I[3+A]<<4,b=I[5+A]<<4,w=l-p+1>>1,l=l+p+1>>1,p=w,w=d*i+g*a+128>>8,d=d*a-g*i+128>>8,g=w,w=_-b+1>>1,_=_+b+1>>1,b=w,w=y+v+1>>1,v=y-v+1>>1,y=w,w=l-g+1>>1,l=l+g+1>>1,g=w,w=p-d+1>>1,p=p+d+1>>1,d=w,w=_*o+y*n+2048>>12,_=_*n-y*o+2048>>12,y=w,w=v*t+b*r+2048>>12,v=v*r-b*t+2048>>12,b=w,I[0+A]=l+y,I[7+A]=l-y,I[1+A]=p+b,I[6+A]=p-b,I[2+A]=d+v,I[5+A]=d-v,I[3+A]=g+_,I[4+A]=g-_):(w=s*I[0+A]+512>>10,I[0+A]=w,I[1+A]=w,I[2+A]=w,I[3+A]=w,I[4+A]=w,I[5+A]=w,I[6+A]=w,I[7+A]=w)}for(m=0;m<8;++m){var k=m;0!=I[8+k]||0!=I[16+k]||0!=I[24+k]||0!=I[32+k]||0!=I[40+k]||0!=I[48+k]||0!=I[56+k]?(l=s*I[0+k]+2048>>12,p=s*I[32+k]+2048>>12,d=I[16+k],g=I[48+k],_=h*(I[8+k]-I[56+k])+2048>>12,y=h*(I[8+k]+I[56+k])+2048>>12,v=I[24+k],b=I[40+k],w=l-p+1>>1,l=l+p+1>>1,p=w,w=d*i+g*a+2048>>12,d=d*a-g*i+2048>>12,g=w,w=_-b+1>>1,_=_+b+1>>1,b=w,w=y+v+1>>1,v=y-v+1>>1,y=w,w=l-g+1>>1,l=l+g+1>>1,g=w,w=p-d+1>>1,p=p+d+1>>1,d=w,w=_*o+y*n+2048>>12,_=_*n-y*o+2048>>12,y=w,w=v*t+b*r+2048>>12,v=v*r-b*t+2048>>12,b=w,I[0+k]=l+y,I[56+k]=l-y,I[8+k]=p+b,I[48+k]=p-b,I[16+k]=d+v,I[40+k]=d-v,I[24+k]=g+_,I[32+k]=g-_):(w=s*f[m+0]+8192>>14,I[0+k]=w,I[8+k]=w,I[16+k]=w,I[24+k]=w,I[32+k]=w,I[40+k]=w,I[48+k]=w,I[56+k]=w)}for(m=0;m<64;++m){var T=128+(I[m]+8>>4);u[m]=T<0?0:T>255?255:T}}for(var y=0;y<d;y++){var w=y<<3;for(u=0;u<8;u++)l.push(new Uint8Array(g));for(var m=0;m<p;m++){b(c.blocks[y][m],v,_);var E=0,I=m<<3;for(f=0;f<8;f++){var A=l[w+f];for(u=0;u<8;u++)A[I+u]=v[E++]}}}return l}function p(e){return e<0?0:e>255?255:e}return c.prototype={load:function(e){var r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="arraybuffer",r.onload=function(){var e=new Uint8Array(r.response||r.mozResponseArrayBuffer);this.parse(e),this.onload&&this.onload()}.bind(this),r.send(null)},parse:function(r){var t=0;function n(){var e=r[t]<<8|r[t+1];return t+=2,e}function o(e){var r,t,n=0,o=0;for(t in e.components)e.components.hasOwnProperty(t)&&(n<(r=e.components[t]).h&&(n=r.h),o<r.v&&(o=r.v));var a=Math.ceil(e.samplesPerLine/8/n),i=Math.ceil(e.scanLines/8/o);for(t in e.components)if(e.components.hasOwnProperty(t)){r=e.components[t];for(var s=Math.ceil(Math.ceil(e.samplesPerLine/8)*r.h/n),h=Math.ceil(Math.ceil(e.scanLines/8)*r.v/o),c=a*r.h,u=i*r.v,f=[],l=0;l<u;l++){for(var p=[],d=0;d<c;d++)p.push(new Int32Array(64));f.push(p)}r.blocksPerLine=s,r.blocksPerColumn=h,r.blocks=f}e.maxH=n,e.maxV=o,e.mcusPerLine=a,e.mcusPerColumn=i}r.length;var a,i,s,h,c=null,p=null,d=[],g=[],_=[],v=[],b=n();if(65496!=b)throw"SOI not found";for(b=n();65497!=b;){var y;switch(b){case 65280:break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var w=(s=void 0,h=void 0,s=n(),h=r.subarray(t,t+s-2),t+=h.length,h);65504===b&&74===w[0]&&70===w[1]&&73===w[2]&&70===w[3]&&0===w[4]&&(c={version:{major:w[5],minor:w[6]},densityUnits:w[7],xDensity:w[8]<<8|w[9],yDensity:w[10]<<8|w[11],thumbWidth:w[12],thumbHeight:w[13],thumbData:w.subarray(14,14+3*w[12]*w[13])}),65518===b&&65===w[0]&&100===w[1]&&111===w[2]&&98===w[3]&&101===w[4]&&0===w[5]&&(p={version:w[6],flags0:w[7]<<8|w[8],flags1:w[9]<<8|w[10],transformCode:w[11]});break;case 65499:for(var m=n()+t-2;t<m;){var E=r[t++],I=new Int32Array(64);if(E>>4){if(E>>4!=1)throw"DQT: invalid table spec";for(y=0;y<64;y++){I[e[y]]=n()}}else for(y=0;y<64;y++){I[e[y]]=r[t++]}d[15&E]=I}break;case 65472:case 65473:case 65474:n(),(a={}).extended=65473===b,a.progressive=65474===b,a.precision=r[t++],a.scanLines=n(),a.samplesPerLine=n(),a.components={},a.componentsOrder=[];var A,k=r[t++];for(H=0;H<k;H++){A=r[t];var T=r[t+1]>>4,j=15&r[t+1],B=r[t+2];a.componentsOrder.push(A),a.components[A]={h:T,v:j,quantizationTable:d[B]},t+=3}o(a),g.push(a);break;case 65476:var O=n();for(H=2;H<O;){var P=r[t++],x=new Uint8Array(16),C=0;for(y=0;y<16;y++,t++)C+=x[y]=r[t];var D=new Uint8Array(C);for(y=0;y<C;y++,t++)D[y]=r[t];H+=17+C,(P>>4?_:v)[15&P]=u(x,D)}break;case 65501:n(),i=n();break;case 65498:n();var N=r[t++],U=[];for(H=0;H<N;H++){G=a.components[r[t++]];var M=r[t++];G.huffmanTableDC=v[M>>4],G.huffmanTableAC=_[15&M],U.push(G)}var R=r[t++],S=r[t++],V=r[t++],L=f(r,t,a,U,i,R,S,V>>4,15&V);t+=L;break;default:if(255==r[t-3]&&r[t-2]>=192&&r[t-2]<=254){t-=3;break}throw"unknown JPEG marker "+b.toString(16)}b=n()}if(1!=g.length)throw"only single frame JPEGs supported";this.width=a.samplesPerLine,this.height=a.scanLines,this.jfif=c,this.adobe=p,this.components=[];for(var H=0;H<a.componentsOrder.length;H++){var G=a.components[a.componentsOrder[H]];this.components.push({lines:l(0,G),scaleX:G.h/a.maxH,scaleY:G.v/a.maxV})}},getData:function(e,r){var t,n,o,a,i,s,h,c,u,f,l,d,g,_,v,b,y,w,m,E,I,A=this.width/e,k=this.height/r,T=0,j=e*r*this.components.length,B=new Uint8Array(j);switch(this.components.length){case 1:for(t=this.components[0],f=0;f<r;f++)for(i=t.lines[0|f*t.scaleY*k],u=0;u<e;u++)l=i[0|u*t.scaleX*A],B[T++]=l;break;case 2:for(t=this.components[0],n=this.components[1],f=0;f<r;f++)for(i=t.lines[0|f*t.scaleY*k],s=n.lines[0|f*n.scaleY*k],u=0;u<e;u++)l=i[0|u*t.scaleX*A],B[T++]=l,l=s[0|u*n.scaleX*A],B[T++]=l;break;case 3:for(I=!0,this.adobe&&this.adobe.transformCode?I=!0:void 0!==this.colorTransform&&(I=!!this.colorTransform),t=this.components[0],n=this.components[1],o=this.components[2],f=0;f<r;f++)for(i=t.lines[0|f*t.scaleY*k],s=n.lines[0|f*n.scaleY*k],h=o.lines[0|f*o.scaleY*k],u=0;u<e;u++)I?(l=i[0|u*t.scaleX*A],d=s[0|u*n.scaleX*A],w=p(l+1.402*((g=h[0|u*o.scaleX*A])-128)),m=p(l-.3441363*(d-128)-.71413636*(g-128)),E=p(l+1.772*(d-128))):(w=i[0|u*t.scaleX*A],m=s[0|u*n.scaleX*A],E=h[0|u*o.scaleX*A]),B[T++]=w,B[T++]=m,B[T++]=E;break;case 4:if(!this.adobe)throw"Unsupported color mode (4 components)";for(I=!1,this.adobe&&this.adobe.transformCode?I=!0:void 0!==this.colorTransform&&(I=!!this.colorTransform),t=this.components[0],n=this.components[1],o=this.components[2],a=this.components[3],f=0;f<r;f++)for(i=t.lines[0|f*t.scaleY*k],s=n.lines[0|f*n.scaleY*k],h=o.lines[0|f*o.scaleY*k],c=a.lines[0|f*a.scaleY*k],u=0;u<e;u++)I?(l=i[0|u*t.scaleX*A],d=s[0|u*n.scaleX*A],g=h[0|u*o.scaleX*A],_=c[0|u*a.scaleX*A],v=255-p(l+1.402*(g-128)),b=255-p(l-.3441363*(d-128)-.71413636*(g-128)),y=255-p(l+1.772*(d-128))):(v=i[0|u*t.scaleX*A],b=s[0|u*n.scaleX*A],y=h[0|u*o.scaleX*A],_=c[0|u*a.scaleX*A]),B[T++]=v,B[T++]=b,B[T++]=y,B[T++]=_;break;default:throw"Unsupported color mode"}return B},copyToImageData:function(e){var r,t,n,o,a,i,s,h,c,u=e.width,f=e.height,l=e.data,d=this.getData(u,f),g=0,_=0;switch(this.components.length){case 1:for(t=0;t<f;t++)for(r=0;r<u;r++)n=d[g++],l[_++]=n,l[_++]=n,l[_++]=n,l[_++]=255;break;case 3:for(t=0;t<f;t++)for(r=0;r<u;r++)s=d[g++],h=d[g++],c=d[g++],l[_++]=s,l[_++]=h,l[_++]=c,l[_++]=255;break;case 4:for(t=0;t<f;t++)for(r=0;r<u;r++)a=d[g++],i=d[g++],n=d[g++],s=255-p(a*(1-(o=d[g++])/255)+o),h=255-p(i*(1-o/255)+o),c=255-p(n*(1-o/255)+o),l[_++]=s,l[_++]=h,l[_++]=c,l[_++]=255;break;default:throw"Unsupported color mode"}}},c}();var m={encode:y,decode:function(e){var r=new Uint8Array(e),t=new w;t.parse(r);for(var n=t.getData(t.width,t.height),o=new Buffer(t.width*t.height*4),a=0,i=0;i<o.length;i++)o[i+(i/3|0)]=n[a++],i%4==3&&(o[i]=255);return{data:o,width:t.width,height:t.height}}},E={},I={exports:{}};!function(){var e=t;function r(r,t){r=r||function(e){this.queue(e)},t=t||function(){this.queue(null)};var n=!1,o=!1,a=[],i=new e;function s(){for(;a.length&&!i.paused;){var e=a.shift();if(null===e)return i.emit("end");i.emit("data",e)}}return i.readable=i.writable=!0,i.paused=!1,i.write=function(e){return r.call(this,e),!i.paused},i.queue=i.push=function(e){return a.push(e),s(),i},i.on("end",(function(){i.readable=!1,i.writable||process.nextTick((function(){i.destroy()}))})),i.end=function(e){if(!n)return n=!0,arguments.length&&i.write(e),i.writable=!1,t.call(i),i.readable||i.destroy(),i},i.destroy=function(){if(!o)return o=!0,n=!0,a.length=0,i.writable=i.readable=!1,i.emit("close"),i},i.pause=function(){if(!i.paused)return i.paused=!0,i.emit("pause"),i},i.resume=function(){return i.paused&&(i.paused=!1),s(),i.paused||i.emit("drain"),i},i}I.exports=r,r.through=r}();var A=I.exports,k=0,T=1,j=2,B=3,O=0,P=1;function x(e,r){this.cb=r,this.buffer=[],this.width=0,this.height=0,this.depth=0,this.state=k,this.cur_row=0,this.cur_col=0,this.cur_channel=-1,this.image=[],this.buffer=[],this.ptr=0,this.stream=e,this.error_cb=x.prototype.onerror.bind(this),this.data_cb=x.prototype.ondata.bind(this),this.end_cb=x.prototype.onend.bind(this),e.on("error",this.error_cb),e.on("data",this.data_cb),e.on("end",this.end_cb)}function C(e){this.stream=A(),this.image=e,this.cur_row=0,this.cur_col=0,this.drain_cb=C.prototype.writeBody.bind(this),this.stream.on("drain",this.drain_cb),process.nextTick(C.prototype.writeHeader.bind(this))}x.prototype.next=function(e){++e[0]>=this.buffer[e[1]].length&&(e[0]=0,++e[1]>=this.buffer.length&&(e[0]=-1,e[1]=this.buffer.length))},x.prototype.get=function(e){return e[0]<0?-1:this.buffer[e[1]][e[0]]},x.prototype.ondata=function(e){if(this.state!==B&&0!==e.length){this.buffer.push(new Buffer(e));var r=[this.ptr,0],t=[0,0];e:for(;r[0]>=0&&this.state!==B&&this.state!==j;)switch(t[0]=r[0],t[1]=r[1],this.get(r)){case 35:for(;;){var n=this.get(t);if(n<0)break e;if(13===n||10===n)break;this.next(t)}r[0]=t[0],r[1]=t[1];break;case 9:case 10:case 11:case 12:case 13:case 32:this.next(r);break;case 80:if(this.get(t)<0)break e;if(this.next(t),51!==this.get(t))return;this.ontoken(O),this.next(t),r[0]=t[0],r[1]=t[1];break;case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:case 58:case 59:for(var o=0;;){var a=this.get(t);if(a<0)break e;if(a<48||a>59)break;this.next(t),o=10*o+a-48}this.ontoken(P,o),r[0]=t[0],r[1]=t[1];break;case-1:break e;default:return void this.onerror(new Error("Invalid character in token stream: "+this.get(r)))}r[0]<0?(this.ptr=0,this.buffer.length=0):(this.ptr=r[0],r[1]>0&&this.buffer.splice(0,r[1]))}},x.prototype.onerror=function(e){this.state!==B&&this.state!==j&&(this.buffer=[],this.image=[],this.stream.removeListener("data",this.data_cb),this.stream.removeListener("error",this.error_cb),this.stream.removeListener("end",this.end_cb),this.state=B,this.cb(e,null),this.data_cb=this.error_cb=this.end_cb=null)},x.prototype.ontoken=function(e,r){switch(this.state){case k:if(this.cur_channel<0&&e===O)this.cur_channel=0;else{if(!(this.cur_channel>=0&&e===P))return void this.onerror(new Error("Invalid PPM file"));switch(this.cur_channel){case 0:this.width=r;break;case 1:this.height=r;break;case 2:this.depth=r,this.image=new Array(this.height);for(var t=0;t<this.height;++t){for(var n=new Array(this.width),o=0;o<this.width;++o)n[o]=[0,0,0];this.image[t]=n}return this.state=T,void(this.cur_col=this.cur_row=this.cur_channel=0);default:this.onerror(new Error("Invalid PPM header"))}this.cur_channel++}break;case T:if(e!==P)return void this.onerror(new Error("Invalid token in PPM file"));this.image[this.cur_row][this.cur_col][this.cur_channel]=r,++this.cur_channel>=3&&(this.cur_channel=0,++this.cur_col>=this.width&&(this.cur_col=0,++this.cur_row>=this.height&&(this.state=j)))}},x.prototype.onend=function(){switch(this.ondata(new Buffer("\n")),this.state){case B:break;case j:this.buffer.length=0,this.cb(null,this.image);break;default:this.state=B,this.cb(new Error("Unexpected EOF"),null)}},E.parse=function(e,r){return new x(e,r)},C.prototype.writeHeader=function(){this.stream.write("P3\n#JS PPM\n"+this.image[0].length+" "+this.image.length+"\n255\n")&&this.writeBody()},C.prototype.writeBody=function(){for(;this.stream.write(this.image[this.cur_row][this.cur_col].join(" ")+" ");)if(++this.cur_col>=this.image[0].length&&(this.cur_col=0,++this.cur_row>=this.image.length)){this.stream.removeListener("drain",this.drain_cb),this.stream.end("\n");break}},E.serialize=function(e){return new C(e).stream};var D=function(e,r,t){return 0===e.length?e:r?(t||e.sort(r),function(e,r){for(var t=1,n=e.length,o=e[0],a=e[0],i=1;i<n;++i)if(a=o,r(o=e[i],a)){if(i===t){t++;continue}e[t++]=o}return e.length=t,e}(e,r)):(t||e.sort(),function(e){for(var r=1,t=e.length,n=e[0],o=e[0],a=1;a<t;++a,o=n)if(o=n,(n=e[a])!==o){if(a===r){r++;continue}e[r++]=n}return e.length=r,e}(e))};function N(e,r,t){var n,o,a=e.length,i=r.arrayArgs.length,s=r.indexArgs.length>0,h=[],c=[],u=0,f=0;for(n=0;n<a;++n)c.push(["i",n,"=0"].join(""));for(o=0;o<i;++o)for(n=0;n<a;++n)f=u,u=e[n],0===n?c.push(["d",o,"s",n,"=t",o,"p",u].join("")):c.push(["d",o,"s",n,"=(t",o,"p",u,"-s",f,"*t",o,"p",f,")"].join(""));for(c.length>0&&h.push("var "+c.join(",")),n=a-1;n>=0;--n)u=e[n],h.push(["for(i",n,"=0;i",n,"<s",u,";++i",n,"){"].join(""));for(h.push(t),n=0;n<a;++n){for(f=u,u=e[n],o=0;o<i;++o)h.push(["p",o,"+=d",o,"s",n].join(""));s&&(n>0&&h.push(["index[",f,"]-=s",f].join("")),h.push(["++index[",u,"]"].join(""))),h.push("}")}return h.join("\n")}function U(e,r,t){for(var n=e.body,o=[],a=[],i=0;i<e.args.length;++i){var s=e.args[i];if(!(s.count<=0)){var h=new RegExp(s.name,"g"),c="",u=r.arrayArgs.indexOf(i);switch(r.argTypes[i]){case"offset":var f=r.offsetArgIndex.indexOf(i);u=r.offsetArgs[f].array,c="+q"+f;case"array":c="p"+u+c;var l="l"+i,p="a"+u;if(0===r.arrayBlockIndices[u])1===s.count?"generic"===t[u]?s.lvalue?(o.push(["var ",l,"=",p,".get(",c,")"].join("")),n=n.replace(h,l),a.push([p,".set(",c,",",l,")"].join(""))):n=n.replace(h,[p,".get(",c,")"].join("")):n=n.replace(h,[p,"[",c,"]"].join("")):"generic"===t[u]?(o.push(["var ",l,"=",p,".get(",c,")"].join("")),n=n.replace(h,l),s.lvalue&&a.push([p,".set(",c,",",l,")"].join(""))):(o.push(["var ",l,"=",p,"[",c,"]"].join("")),n=n.replace(h,l),s.lvalue&&a.push([p,"[",c,"]=",l].join("")));else{for(var d=[s.name],g=[c],_=0;_<Math.abs(r.arrayBlockIndices[u]);_++)d.push("\\s*\\[([^\\]]+)\\]"),g.push("$"+(_+1)+"*t"+u+"b"+_);if(h=new RegExp(d.join(""),"g"),c=g.join("+"),"generic"===t[u])throw new Error("cwise: Generic arrays not supported in combination with blocks!");n=n.replace(h,[p,"[",c,"]"].join(""))}break;case"scalar":n=n.replace(h,"Y"+r.scalarArgs.indexOf(i));break;case"index":n=n.replace(h,"index");break;case"shape":n=n.replace(h,"shape")}}}return[o.join("\n"),n,a.join("\n")].join("\n").trim()}function M(e){for(var r=new Array(e.length),t=!0,n=0;n<e.length;++n){var o=e[n],a=o.match(/\d+/);a=a?a[0]:"",0===o.charAt(0)?r[n]="u"+o.charAt(1)+a:r[n]=o.charAt(0)+a,n>0&&(t=t&&r[n]===r[n-1])}return t?r[0]:r.join("")}var R=function(e,r){for(var t=r[1].length-Math.abs(e.arrayBlockIndices[0])|0,n=new Array(e.arrayArgs.length),o=new Array(e.arrayArgs.length),a=0;a<e.arrayArgs.length;++a)o[a]=r[2*a],n[a]=r[2*a+1];var i=[],s=[],h=[],c=[],u=[];for(a=0;a<e.arrayArgs.length;++a){e.arrayBlockIndices[a]<0?(h.push(0),c.push(t),i.push(t),s.push(t+e.arrayBlockIndices[a])):(h.push(e.arrayBlockIndices[a]),c.push(e.arrayBlockIndices[a]+t),i.push(0),s.push(e.arrayBlockIndices[a]));for(var f=[],l=0;l<n[a].length;l++)h[a]<=n[a][l]&&n[a][l]<c[a]&&f.push(n[a][l]-h[a]);u.push(f)}var p=["SS"],d=["'use strict'"],g=[];for(l=0;l<t;++l)g.push(["s",l,"=SS[",l,"]"].join(""));for(a=0;a<e.arrayArgs.length;++a){p.push("a"+a),p.push("t"+a),p.push("p"+a);for(l=0;l<t;++l)g.push(["t",a,"p",l,"=t",a,"[",h[a]+l,"]"].join(""));for(l=0;l<Math.abs(e.arrayBlockIndices[a]);++l)g.push(["t",a,"b",l,"=t",a,"[",i[a]+l,"]"].join(""))}for(a=0;a<e.scalarArgs.length;++a)p.push("Y"+a);if(e.shapeArgs.length>0&&g.push("shape=SS.slice(0)"),e.indexArgs.length>0){var _=new Array(t);for(a=0;a<t;++a)_[a]="0";g.push(["index=[",_.join(","),"]"].join(""))}for(a=0;a<e.offsetArgs.length;++a){var v=e.offsetArgs[a],b=[];for(l=0;l<v.offset.length;++l)0!==v.offset[l]&&(1===v.offset[l]?b.push(["t",v.array,"p",l].join("")):b.push([v.offset[l],"*t",v.array,"p",l].join("")));0===b.length?g.push("q"+a+"=0"):g.push(["q",a,"=",b.join("+")].join(""))}var y=D([].concat(e.pre.thisVars).concat(e.body.thisVars).concat(e.post.thisVars));for((g=g.concat(y)).length>0&&d.push("var "+g.join(",")),a=0;a<e.arrayArgs.length;++a)d.push("p"+a+"|=0");e.pre.body.length>3&&d.push(U(e.pre,e,o));var w=U(e.body,e,o),m=function(e){for(var r=0,t=e[0].length;r<t;){for(var n=1;n<e.length;++n)if(e[n][r]!==e[0][r])return r;++r}return r}(u);m<t?d.push(function(e,r,t,n){for(var o=r.length,a=t.arrayArgs.length,i=t.blockSize,s=t.indexArgs.length>0,h=[],c=0;c<a;++c)h.push(["var offset",c,"=p",c].join(""));for(c=e;c<o;++c)h.push(["for(var j"+c+"=SS[",r[c],"]|0;j",c,">0;){"].join("")),h.push(["if(j",c,"<",i,"){"].join("")),h.push(["s",r[c],"=j",c].join("")),h.push(["j",c,"=0"].join("")),h.push(["}else{s",r[c],"=",i].join("")),h.push(["j",c,"-=",i,"}"].join("")),s&&h.push(["index[",r[c],"]=j",c].join(""));for(c=0;c<a;++c){for(var u=["offset"+c],f=e;f<o;++f)u.push(["j",f,"*t",c,"p",r[f]].join(""));h.push(["p",c,"=(",u.join("+"),")"].join(""))}for(h.push(N(r,t,n)),c=e;c<o;++c)h.push("}");return h.join("\n")}(m,u[0],e,w)):d.push(N(u[0],e,w)),e.post.body.length>3&&d.push(U(e.post,e,o)),e.debug&&console.log("-----Generated cwise routine for ",r,":\n"+d.join("\n")+"\n----------");var E=[e.funcName||"unnamed","_cwise_loop_",n[0].join("s"),"m",m,M(o)].join("");return new Function(["function ",E,"(",p.join(","),"){",d.join("\n"),"} return ",E].join(""))()},S=R;var V=function(e){var r=["'use strict'","var CACHED={}"],t=[],n=e.funcName+"_cwise_thunk";r.push(["return function ",n,"(",e.shimArgs.join(","),"){"].join(""));for(var o=[],a=[],i=[["array",e.arrayArgs[0],".shape.slice(",Math.max(0,e.arrayBlockIndices[0]),e.arrayBlockIndices[0]<0?","+e.arrayBlockIndices[0]+")":")"].join("")],s=[],h=[],c=0;c<e.arrayArgs.length;++c){var u=e.arrayArgs[c];t.push(["t",u,"=array",u,".dtype,","r",u,"=array",u,".order"].join("")),o.push("t"+u),o.push("r"+u),a.push("t"+u),a.push("r"+u+".join()"),i.push("array"+u+".data"),i.push("array"+u+".stride"),i.push("array"+u+".offset|0"),c>0&&(s.push("array"+e.arrayArgs[0]+".shape.length===array"+u+".shape.length+"+(Math.abs(e.arrayBlockIndices[0])-Math.abs(e.arrayBlockIndices[c]))),h.push("array"+e.arrayArgs[0]+".shape[shapeIndex+"+Math.max(0,e.arrayBlockIndices[0])+"]===array"+u+".shape[shapeIndex+"+Math.max(0,e.arrayBlockIndices[c])+"]"))}for(e.arrayArgs.length>1&&(r.push("if (!("+s.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same dimensionality!')"),r.push("for(var shapeIndex=array"+e.arrayArgs[0]+".shape.length-"+Math.abs(e.arrayBlockIndices[0])+"; shapeIndex--\x3e0;) {"),r.push("if (!("+h.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same shape!')"),r.push("}")),c=0;c<e.scalarArgs.length;++c)i.push("scalar"+e.scalarArgs[c]);return t.push(["type=[",a.join(","),"].join()"].join("")),t.push("proc=CACHED[type]"),r.push("var "+t.join(",")),r.push(["if(!proc){","CACHED[type]=proc=compile([",o.join(","),"])}","return proc(",i.join(","),")}"].join("")),e.debug&&console.log("-----Generated thunk:\n"+r.join("\n")+"\n----------"),new Function("compile",r.join("\n"))(S.bind(void 0,e))};function L(){this.argTypes=[],this.shimArgs=[],this.arrayArgs=[],this.arrayBlockIndices=[],this.scalarArgs=[],this.offsetArgs=[],this.offsetArgIndex=[],this.indexArgs=[],this.shapeArgs=[],this.funcName="",this.pre=null,this.body=null,this.post=null,this.debug=!1}var H=function(e){var r=new L;r.pre=e.pre,r.body=e.body,r.post=e.post;var t=e.args.slice(0);r.argTypes=t;for(var n=0;n<t.length;++n){var o=t[n];if("array"===o||"object"==typeof o&&o.blockIndices){if(r.argTypes[n]="array",r.arrayArgs.push(n),r.arrayBlockIndices.push(o.blockIndices?o.blockIndices:0),r.shimArgs.push("array"+n),n<r.pre.args.length&&r.pre.args[n].count>0)throw new Error("cwise: pre() block may not reference array args");if(n<r.post.args.length&&r.post.args[n].count>0)throw new Error("cwise: post() block may not reference array args")}else if("scalar"===o)r.scalarArgs.push(n),r.shimArgs.push("scalar"+n);else if("index"===o){if(r.indexArgs.push(n),n<r.pre.args.length&&r.pre.args[n].count>0)throw new Error("cwise: pre() block may not reference array index");if(n<r.body.args.length&&r.body.args[n].lvalue)throw new Error("cwise: body() block may not write to array index");if(n<r.post.args.length&&r.post.args[n].count>0)throw new Error("cwise: post() block may not reference array index")}else if("shape"===o){if(r.shapeArgs.push(n),n<r.pre.args.length&&r.pre.args[n].lvalue)throw new Error("cwise: pre() block may not write to array shape");if(n<r.body.args.length&&r.body.args[n].lvalue)throw new Error("cwise: body() block may not write to array shape");if(n<r.post.args.length&&r.post.args[n].lvalue)throw new Error("cwise: post() block may not write to array shape")}else{if("object"!=typeof o||!o.offset)throw new Error("cwise: Unknown argument type "+t[n]);r.argTypes[n]="offset",r.offsetArgs.push({array:o.array,offset:o.offset}),r.offsetArgIndex.push(n)}}if(r.arrayArgs.length<=0)throw new Error("cwise: No array arguments specified");if(r.pre.args.length>t.length)throw new Error("cwise: Too many arguments in pre() block");if(r.body.args.length>t.length)throw new Error("cwise: Too many arguments in body() block");if(r.post.args.length>t.length)throw new Error("cwise: Too many arguments in post() block");return r.debug=!!e.printCode||!!e.debug,r.funcName=e.funcName||"cwise",r.blockSize=e.blockSize||64,V(r)}({args:["array","scalar","index"],pre:{body:"{}",args:[],thisVars:[],localVars:[]},body:{body:"{\nvar _inline_1_v=_inline_1_arg1_,_inline_1_i\nfor(_inline_1_i=0;_inline_1_i<_inline_1_arg2_.length-1;++_inline_1_i) {\n_inline_1_v=_inline_1_v[_inline_1_arg2_[_inline_1_i]]\n}\n_inline_1_arg0_=_inline_1_v[_inline_1_arg2_[_inline_1_arg2_.length-1]]\n}",args:[{name:"_inline_1_arg0_",lvalue:!0,rvalue:!1,count:1},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:1},{name:"_inline_1_arg2_",lvalue:!1,rvalue:!0,count:4}],thisVars:[],localVars:["_inline_1_i","_inline_1_v"]},post:{body:"{}",args:[],thisVars:[],localVars:[]},funcName:"convert",blockSize:64}),G=_,F=H,Y={};function W(e,r,t,n){for(var o=e[r++],a=1<<o,i=a+1,s=i+1,h=o+1,c=(1<<h)-1,u=0,f=0,l=0,p=e[r++],d=new Int32Array(4096),g=null;;){for(;u<16&&0!==p;)f|=e[r++]<<u,u+=8,1===p?p=e[r++]:--p;if(u<h)break;var _=f&c;if(f>>=h,u-=h,_!==a){if(_===i)break;for(var v=_<s?_:g,b=0,y=v;y>a;)y=d[y]>>8,++b;var w=y;if(l+b+(v!==_?1:0)>n)return void console.log("Warning, gif stream longer than expected.");t[l++]=w;var m=l+=b;for(v!==_&&(t[l++]=w),y=v;b--;)y=d[y],t[--m]=255&y,y>>=8;null!==g&&s<4096&&(d[s++]=g<<8|w,s>=c+1&&h<12&&(++h,c=c<<1|1)),g=_}else s=i+1,c=(1<<(h=o+1))-1,g=null}return l!==n&&console.log("Warning, gif stream shorter than expected."),t}try{Y.GifWriter=function(e,r,t,n){var o=0,a=void 0===(n=void 0===n?{}:n).loop?null:n.loop,i=void 0===n.palette?null:n.palette;if(r<=0||t<=0||r>65535||t>65535)throw new Error("Width/Height invalid.");function s(e){var r=e.length;if(r<2||r>256||r&r-1)throw new Error("Invalid code/color length, must be power of 2 and 2 .. 256.");return r}e[o++]=71,e[o++]=73,e[o++]=70,e[o++]=56,e[o++]=57,e[o++]=97;var h=0,c=0;if(null!==i){for(var u=s(i);u>>=1;)++h;if(u=1<<h,--h,void 0!==n.background){if((c=n.background)>=u)throw new Error("Background index out of range.");if(0===c)throw new Error("Background index explicitly passed as 0.")}}if(e[o++]=255&r,e[o++]=r>>8&255,e[o++]=255&t,e[o++]=t>>8&255,e[o++]=(null!==i?128:0)|h,e[o++]=c,e[o++]=0,null!==i)for(var f=0,l=i.length;f<l;++f){var p=i[f];e[o++]=p>>16&255,e[o++]=p>>8&255,e[o++]=255&p}if(null!==a){if(a<0||a>65535)throw new Error("Loop count invalid.");e[o++]=33,e[o++]=255,e[o++]=11,e[o++]=78,e[o++]=69,e[o++]=84,e[o++]=83,e[o++]=67,e[o++]=65,e[o++]=80,e[o++]=69,e[o++]=50,e[o++]=46,e[o++]=48,e[o++]=3,e[o++]=1,e[o++]=255&a,e[o++]=a>>8&255,e[o++]=0}var d=!1;this.addFrame=function(r,t,n,a,h,c){if(!0===d&&(--o,d=!1),c=void 0===c?{}:c,r<0||t<0||r>65535||t>65535)throw new Error("x/y invalid.");if(n<=0||a<=0||n>65535||a>65535)throw new Error("Width/Height invalid.");if(h.length<n*a)throw new Error("Not enough pixels for the frame size.");var u=!0,f=c.palette;if(null==f&&(u=!1,f=i),null==f)throw new Error("Must supply either a local or global palette.");for(var l=s(f),p=0;l>>=1;)++p;l=1<<p;var g=void 0===c.delay?0:c.delay,_=void 0===c.disposal?0:c.disposal;if(_<0||_>3)throw new Error("Disposal out of range.");var v=!1,b=0;if(void 0!==c.transparent&&null!==c.transparent&&(v=!0,(b=c.transparent)<0||b>=l))throw new Error("Transparent color index.");if((0!==_||v||0!==g)&&(e[o++]=33,e[o++]=249,e[o++]=4,e[o++]=_<<2|(!0===v?1:0),e[o++]=255&g,e[o++]=g>>8&255,e[o++]=b,e[o++]=0),e[o++]=44,e[o++]=255&r,e[o++]=r>>8&255,e[o++]=255&t,e[o++]=t>>8&255,e[o++]=255&n,e[o++]=n>>8&255,e[o++]=255&a,e[o++]=a>>8&255,e[o++]=!0===u?128|p-1:0,!0===u)for(var y=0,w=f.length;y<w;++y){var m=f[y];e[o++]=m>>16&255,e[o++]=m>>8&255,e[o++]=255&m}return o=function(e,r,t,n){e[r++]=t;var o=r++,a=1<<t,i=a-1,s=a+1,h=s+1,c=t+1,u=0,f=0;function l(t){for(;u>=t;)e[r++]=255&f,f>>=8,u-=8,r===o+256&&(e[o]=255,o=r++)}function p(e){f|=e<<u,u+=c,l(8)}var d=n[0]&i,g={};p(a);for(var _=1,v=n.length;_<v;++_){var b=n[_]&i,y=d<<8|b,w=g[y];if(void 0===w){for(f|=d<<u,u+=c;u>=8;)e[r++]=255&f,f>>=8,u-=8,r===o+256&&(e[o]=255,o=r++);4096===h?(p(a),h=s+1,c=t+1,g={}):(h>=1<<c&&++c,g[y]=h++),d=b}else d=w}return p(d),p(s),l(1),o+1===r?e[o]=0:(e[o]=r-o-1,e[r++]=0),r}(e,o,p<2?2:p,h),o},this.end=function(){return!1===d&&(e[o++]=59,d=!0),o},this.getOutputBuffer=function(){return e},this.setOutputBuffer=function(r){e=r},this.getOutputBufferPosition=function(){return o},this.setOutputBufferPosition=function(e){o=e}},Y.GifReader=function(e){var r=0;if(71!==e[r++]||73!==e[r++]||70!==e[r++]||56!==e[r++]||56!=(e[r++]+1&253)||97!==e[r++])throw new Error("Invalid GIF 87a/89a header.");var t=e[r++]|e[r++]<<8,n=e[r++]|e[r++]<<8,o=e[r++],a=o>>7,i=1<<1+(7&o);e[r++],e[r++];var s=null,h=null;a&&(s=r,h=i,r+=3*i);var c=!0,u=[],f=0,l=null,p=0,d=null;for(this.width=t,this.height=n;c&&r<e.length;)switch(e[r++]){case 33:switch(e[r++]){case 255:if(11!==e[r]||78==e[r+1]&&69==e[r+2]&&84==e[r+3]&&83==e[r+4]&&67==e[r+5]&&65==e[r+6]&&80==e[r+7]&&69==e[r+8]&&50==e[r+9]&&46==e[r+10]&&48==e[r+11]&&3==e[r+12]&&1==e[r+13]&&0==e[r+16])r+=14,d=e[r++]|e[r++]<<8,r++;else for(r+=12;;){if(!((j=e[r++])>=0))throw Error("Invalid block size");if(0===j)break;r+=j}break;case 249:if(4!==e[r++]||0!==e[r+4])throw new Error("Invalid graphics extension block.");var g=e[r++];f=e[r++]|e[r++]<<8,l=e[r++],1&g||(l=null),p=g>>2&7,r++;break;case 254:for(;;){if(!((j=e[r++])>=0))throw Error("Invalid block size");if(0===j)break;r+=j}break;default:throw new Error("Unknown graphic control label: 0x"+e[r-1].toString(16))}break;case 44:var _=e[r++]|e[r++]<<8,v=e[r++]|e[r++]<<8,b=e[r++]|e[r++]<<8,y=e[r++]|e[r++]<<8,w=e[r++],m=w>>6&1,E=1<<1+(7&w),I=s,A=h,k=!1;w>>7&&(k=!0,I=r,A=E,r+=3*E);var T=r;for(r++;;){var j;if(!((j=e[r++])>=0))throw Error("Invalid block size");if(0===j)break;r+=j}u.push({x:_,y:v,width:b,height:y,has_local_palette:k,palette_offset:I,palette_size:A,data_offset:T,data_length:r-T,transparent_index:l,interlaced:!!m,delay:f,disposal:p});break;case 59:c=!1;break;default:throw new Error("Unknown gif block: 0x"+e[r-1].toString(16))}this.numFrames=function(){return u.length},this.loopCount=function(){return d},this.frameInfo=function(e){if(e<0||e>=u.length)throw new Error("Frame index out of range.");return u[e]},this.decodeAndBlitFrameBGRA=function(r,n){var o=this.frameInfo(r),a=o.width*o.height,i=new Uint8Array(a);W(e,o.data_offset,i,a);var s=o.palette_offset,h=o.transparent_index;null===h&&(h=256);var c=o.width,u=t-c,f=c,l=4*(o.y*t+o.x),p=4*((o.y+o.height)*t+o.x),d=l,g=4*u;!0===o.interlaced&&(g+=4*t*7);for(var _=8,v=0,b=i.length;v<b;++v){var y=i[v];if(0===f&&(f=c,(d+=g)>=p&&(g=4*u+4*t*(_-1),d=l+(c+u)*(_<<1),_>>=1)),y===h)d+=4;else{var w=e[s+3*y],m=e[s+3*y+1],E=e[s+3*y+2];n[d++]=E,n[d++]=m,n[d++]=w,n[d++]=255}--f}},this.decodeAndBlitFrameRGBA=function(r,n){var o=this.frameInfo(r),a=o.width*o.height,i=new Uint8Array(a);W(e,o.data_offset,i,a);var s=o.palette_offset,h=o.transparent_index;null===h&&(h=256);var c=o.width,u=t-c,f=c,l=4*(o.y*t+o.x),p=4*((o.y+o.height)*t+o.x),d=l,g=4*u;!0===o.interlaced&&(g+=4*t*7);for(var _=8,v=0,b=i.length;v<b;++v){var y=i[v];if(0===f&&(f=c,(d+=g)>=p&&(g=4*u+4*t*(_-1),d=l+(c+u)*(_<<1),_>>=1)),y===h)d+=4;else{var w=e[s+3*y],m=e[s+3*y+1],E=e[s+3*y+2];n[d++]=w,n[d++]=m,n[d++]=E,n[d++]=255}--f}}}}catch(e){}var $={exports:{}};!function(){var e=$.exports=function(e){this.buffer=e,this.initialized=!1,this.fileHeader=null,this.infoHeader=null,this.coreHeader=null,this.colorPalette=null,this.dataPos=-1};e.prototype.CORE_TYPE_WINDOWS_V3=40,e.prototype.CORE_TYPE_WINDOWS_V4=108,e.prototype.CORE_TYPE_WINDOWS_V5=124,e.prototype.CORE_TYPE_OS2_V1=12,e.prototype.CORE_TYPE_OS2_V2=64,e.prototype.BITMAPCOREHEADER=e.prototype.CORE_TYPE_OS2_V1,e.prototype.BITMAPINFOHEADER=e.prototype.CORE_TYPE_WINDOWS_V3,e.prototype.BITMAPINFOHEADER2=e.prototype.CORE_TYPE_OS2_V2,e.prototype.BITMAPV4HEADER=e.prototype.CORE_TYPE_WINDOWS_V4,e.prototype.BITMAPV5HEADER=e.prototype.CORE_TYPE_WINDOWS_V5,e.prototype.COMPRESSION_BI_RGB=0,e.prototype.COMPRESSION_BI_RLE8=1,e.prototype.COMPRESSION_BI_RLE4=2,e.prototype.COMPRESSION_BI_BITFIELDS=3,e.prototype.COMPRESSION_BI_JPEG=4,e.prototype.COMPRESSION_BI_PNG=5,e.prototype.BITCOUNT_2=1,e.prototype.BITCOUNT_16=4,e.prototype.BITCOUNT_256=8,e.prototype.BITCOUNT_16bit=16,e.prototype.BITCOUNT_24bit=24,e.prototype.BITCOUNT_32bit=32,e.prototype.init=function(){this.readFileHeader(),this.readInfoHeader(),this.readCoreHeader(),this.readColorPalette(),this.initDataPos(),this.initialized=!0},e.prototype.checkInit=function(){if(!this.initialized)throw new Error("not initialized")},e.prototype.isBitmap=function(){return this.checkInit(),"BM"==this.fileHeader.bfType},e.prototype.getData=function(){if(this.checkInit(),this.COMPRESSION_BI_RGB!==this.coreHeader.__copmression__)throw new Error("not supported compression: "+this.coreHeader.__copmression__);var e=this.coreHeader.__bitCount__,r=this.getWidth(),t=this.getHeight(),n=r*e/8;0!=n%4&&(n=4*(n/4+1));for(var o=[],a=this.dataPos,i=0;i<t;++i){var s=a+n*(t-(i+1)),h=this.buffer.slice(s,s+n),c=this.mapColor(h,e);o.push(c)}return o},e.prototype.getWidth=function(){return this.checkInit(),this.coreHeader.__width__},e.prototype.getHeight=function(){return this.checkInit(),this.coreHeader.__height__},e.prototype.read=function(e,r,t){for(var n=[],o=r,a=r+t;o<a;++o)n.push(e.readInt8(o));return new Buffer(n)},e.prototype.readFileHeader=function(){var e=this.read(this.buffer,0,2),r=this.read(this.buffer,2,4);this.read(this.buffer,6,2),this.read(this.buffer,8,2);var t=this.read(this.buffer,10,4);this.fileHeader={bfType:e.toString("ascii"),_bfType:e,bfSize:r.readUInt16LE(0),_bfSize:r,bfReserved1:0,bfReserved2:0,bfOffBits:t.readUInt16LE(0),_bfOffBits:t}},e.prototype.readInfoHeader=function(){this.infoHeader=this.read(this.buffer,14,4)},e.prototype.readCoreHeader=function(){var e=this.infoHeader.readUInt16LE(0);switch(e){case this.BITMAPCOREHEADER:return this.readCoreHeaderOS2_V1();case this.BITMAPINFOHEADER2:return this.readCoreHeaderOS2_V2();case this.BITMAPV4HEADER:return this.readCoreHeaderWINDOWS_V4();case this.BITMAPV5HEADER:return this.readCoreHeaderWINDOWS_V5();case this.BITMAPINFOHEADER:return this.readCoreHeaderWINDOWS_V3();default:throw new Error("unknown coreType: "+e)}},e.prototype.readCoreHeaderWINDOWS_V3=function(){var e=this.read(this.buffer,18,4),r=this.read(this.buffer,22,4),t=this.read(this.buffer,26,2),n=this.read(this.buffer,28,2),o=this.read(this.buffer,30,4),a=this.read(this.buffer,34,4),i=this.read(this.buffer,38,4),s=this.read(this.buffer,42,4),h=this.read(this.buffer,46,4),c=this.read(this.buffer,50,4);this.coreHeader={__copmression__:o.readUInt16LE(0),__bitCount__:n.readUInt8(0),__width__:e.readUInt16LE(0),__height__:r.readUInt16LE(0),biWidth:e.readUInt16LE(0),_biWidth:e,biHeight:r.readUInt16LE(0),_biHeight:r,biPlanes:t.readUInt8(0),_biPlanes:t,biBitCount:n.readUInt8(0),_biBitCount:n,biCopmression:o.readUInt16LE(0),_biCopmression:o,biSizeImage:a.readUInt16LE(0),_biSizeImage:a,biXPixPerMeter:i.readUInt16LE(0),_biXPixPerMeter:i,biYPixPerMeter:s.readUInt16LE(0),_biYPixPerMeter:s,biClrUsed:h.readUInt16LE(0),_biClrUsed:h,biCirImportant:c.readUInt16LE(0),_biCirImportant:c}},e.prototype.readCoreHeaderWINDOWS_V4=function(){throw new Error("not yet impl")},e.prototype.readCoreHeaderWINDOWS_V5=function(){throw new Error("not yet impl")},e.prototype.readCoreHeaderOS2_V1=function(){throw new Error("not yet impl")},e.prototype.readCoreHeaderOS2_V2=function(){throw new Error("not yet impl")},e.prototype.readColorPalette=function(){var e=this.coreHeader.__bitCount__;if(this.BITCOUNT_16bit!=e&&this.BITCOUNT_24bit!=e&&this.BITCOUNT_32bit!=e){var r=this.infoHeader.readUInt16LE(0);switch(r){case this.BITMAPCOREHEADER:return this.readColorPalette_RGBTRIPLE(e,26);case this.BITMAPINFOHEADER2:return this.readColorPalette_RGBTRIPLE(e,78);case this.BITMAPV4HEADER:return this.readColorPalette_RGBQUAD(e,122);case this.BITMAPV5HEADER:return this.readColorPalette_RGBQUAD(e,138);case this.BITMAPINFOHEADER:return this.readColorPalette_RGBQUAD(e,54);default:throw new Error("unknown colorPalette: "+r+","+e)}}},e.prototype.readColorPalette_RGBTRIPLE=function(e,r){throw new Error("not yet impl")},e.prototype.readColorPalette_RGBQUAD=function(e,r){if(this.BITCOUNT_2==e)return this.readRGBQUAD(1<<this.BITCOUNT_2,r);if(this.BITCOUNT_16==e)return this.readRGBQUAD(1<<this.BITCOUNT_16,r);if(this.BITCOUNT_256==e)return this.readRGBQUAD(1<<this.BITCOUNT_256,r);throw new Error("unknown bitCount: "+e)},e.prototype.readRGBQUAD=function(e,r){for(var t=[],n=r,o=r+4*e;n<o;n+=4)t.push({rgbBlue:this.read(this.buffer,n,1).readUInt8(0),rgbGreen:this.read(this.buffer,n+1,1).readUInt8(0),rgbRed:this.read(this.buffer,n+2,1).readUInt8(0),rgbReserved:this.read(this.buffer,n+3,1).readUInt8(0)});this.colorPalette=t},e.prototype.initDataPos=function(){var e=this.coreHeader.__bitCount__,r=!0;this.BITCOUNT_16bit==e&&(r=!0),this.BITCOUNT_24bit==e&&(r=!0),this.BITCOUNT_32bit==e&&(r=!0);var t=this.infoHeader.readUInt16LE(0);switch(t){case this.BITMAPCOREHEADER:this.dataPos=26,r&&(this.dataPos=this.dataPos+3*(1<<e));break;case this.BITMAPINFOHEADER2:this.dataPos=78,r&&(this.dataPos=this.dataPos+3*(1<<e));break;case this.BITMAPV4HEADER:this.dataPos=122,r&&(this.dataPos=this.dataPos+4*(1<<e));break;case this.BITMAPV5HEADER:this.dataPos=138,r&&(this.dataPos=this.dataPos+4*(1<<e));case this.BITMAPINFOHEADER:this.dataPos=54,r&&(this.dataPos=this.dataPos+4*(1<<e));break;default:throw new Error("unknown colorPalette: "+t+","+e)}},e.prototype.mapRGBA=function(e,r,t,n){var o=[],a=function(e){var r=e.toString(16);return e<15?"0"+r:r};return o.push(a(e)),o.push(a(r)),o.push(a(t)),"#"+o.join("")},e.prototype.mapColor=function(e,r){var t,n,o,a,i=e.length,s=[];if(this.BITCOUNT_2==r){for(var h=0;h<i;++h){var c=e[h].toString(2);c=new Array(8-c.length).join("0")+c;for(var u=0;u<c.length;++u){var f=parseInt(c.substring(u,u+1),10),l=this.colorPalette[f];s.push(this.mapRGBA(l.rgbRed,l.rgbGreen,l.rgbBlue,-1))}}return s}if(this.BITCOUNT_16==r){for(h=0;h<i;h+=2){[e.readUInt8(h),e.readUInt8(h+1)].forEach((function(e){var r=this.colorPalette[e];s.push(this.mapRGBA(r.rgbRed,r.rgbGreen,r.rgbBlue,-1))}))}return s}if(this.BITCOUNT_256==r){for(h=0;h<i;++h){f=e.readUInt16LE(h),l=this.colorPalette[f];s.push(this.mapRGBA(l.rgbRed,l.rgbGreen,l.rgbBlue,-1))}return s}if(this.BITCOUNT_16bit==r){for(h=0;h<i;h+=3)t=e[h],n=e[h+1],o=e[h+2],s.push(this.mapRGBA(o,n,t,-1));return s}if(this.BITCOUNT_24bit==r){for(h=0;h<i;h+=3)t=e[h],n=e[h+1],o=e[h+2],s.push(this.mapRGBA(o,n,t,-1));return s}if(this.BITCOUNT_32bit==r){for(h=0;h<i;h+=4)t=e[h],n=e[h+1],o=e[h+2],a=e[h+3],s.push(this.mapRGBA(o,n,t,a));return s}throw new Error("unknown bitCount: "+r)}}();var z=$.exports,X=_,q=e,K=v,Q=m,J=E,Z=function(e,r){for(var t=[],n=e,o=1;Array.isArray(n);)t.push(n.length),o*=n.length,n=n[0];return 0===t.length?G():(r||(r=G(new Float64Array(o),t)),F(r,e),r)},ee=Y.GifReader,re=z,te=r;const ne=({pixels:e=64e3,distance:r=.22,colorValidator:t=(e,r,t,n)=>(n??255)>250,hueDistance:n=.08333333333333333,saturationDistance:o=.2,lightnessDistance:a=.2,crossOrigin:i="",requestMode:s="cors"}={})=>[Math.max(e,1),Math.min(Math.max(r,0),1),t,Math.min(Math.max(n,0),1),Math.min(Math.max(o,0),1),Math.min(Math.max(a,0),1),i,s];class oe{constructor(e,r,t,n=e<<16|r<<8|t){this._count=1,this.__saturation=-1,this.__hue=-1,this.__lightness=-1,this.__intensity=-1,this._red=e,this._green=r,this._blue=t,this._hex=n}static distance(e,r){return(Math.abs(r._red-e._red)+Math.abs(r._green-e._green)+Math.abs(r._blue-e._blue))/765}clone(){const e=new oe(this._red,this._green,this._blue,this._hex);return e._count=this._count,e}updateHSL(){const e=this._red/255,r=this._green/255,t=this._blue/255,n=Math.max(e,r,t),o=Math.min(e,r,t);if(this.__lightness=(n+o)/2,n===o)this.__hue=0,this.__saturation=0,this.__intensity=0;else{const a=n-o;switch(this.__saturation=this.__lightness>.5?a/(2-n-o):a/(n+o),this.__intensity=this.__saturation*(2*(.5-Math.abs(.5-this.__lightness))),n){case e:this.__hue=((r-t)/a+(r<t?6:0))/6;break;case r:this.__hue=((t-e)/a+2)/6;break;case t:this.__hue=((e-r)/a+4)/6}}}get _hue(){return-1===this.__hue&&this.updateHSL(),this.__hue}get _saturation(){return-1===this.__saturation&&this.updateHSL(),this.__saturation}get _lightness(){return-1===this.__lightness&&this.updateHSL(),this.__lightness}get _intensity(){return-1===this.__intensity&&this.updateHSL(),this.__intensity}}class ae{constructor(){this._count=0,this._children={}}addColor(e,r,t,n){return this._count++,this._children[e]?this._children[e]._count++:this._children[e]=new oe(r,t,n,e),this._children[e]}getList(){return Object.keys(this._children).map((e=>this._children[e]))}createMainColor(){const e=this.getList().reduce(((e,r)=>e._count>=r._count?e:r)).clone();return e._count=this._count,e}}class ie{constructor(){this._count=0,this._children={}}getList(){return Object.keys(this._children).map((e=>this._children[e]))}addColor(e,r,t){const n=e<<16|r<<8|t,o=(e>>4&15)<<8|(r>>4&15)<<4|t>>4&15;return this._count++,this.getLeafGroup(o).addColor(n,e,r,t)}getLeafGroup(e){return this._children[e]||(this._children[e]=new ae),this._children[e]}getColors(e){const r=this.getList().map((e=>e.createMainColor()));r.sort(((e,r)=>r._count-e._count));const t=[];for(;r.length;){const n=r.shift();r.filter((r=>oe.distance(n,r)<e)).forEach((e=>{n._count+=e._count;const t=r.findIndex((r=>r===e));r.splice(t,1)})),t.push(n)}return t}}const se=({data:e,width:r,height:t},n,o,a)=>{const i=new ie,s=r&&t&&Math.floor(r*t/n)||1;let h=0;for(let r=0;r<e.length;r+=4*s){const t=e[r],n=e[r+1],o=e[r+2];a(t,n,o,e[r+3])?i.addColor(t,n,o):h++}return{colors:i.getColors(o),count:i._count+h}},he=(e,r)=>Math.abs(e-r);class ce{constructor(){this.colors=[],this._average=null}addColor(e){this.colors.push(e),this._average=null}isSamePalette(e,r,t,n){for(const i of this.colors){if(!(o=i._hue,a=e._hue,Math.min(he(o,a),he((o+.5)%1,(a+.5)%1))<r&&he(i._saturation,e._saturation)<t&&he(i._lightness,e._lightness)<n))return!1}var o,a;return!0}get average(){if(!this._average){const{r:e,g:r,b:t}=this.colors.reduce(((e,r)=>(e.r+=r._red,e.g+=r._green,e.b+=r._blue,e)),{r:0,g:0,b:0}),n=this.colors.reduce(((e,r)=>e+r._count),0);this._average=new oe(Math.round(e/this.colors.length),Math.round(r/this.colors.length),Math.round(t/this.colors.length)),this._average._count=n}return this._average}}class ue{constructor(e,r,t){this._groups=[],this._hue=e,this._saturation=r,this._lightness=t}addColor(e){const r=this._groups.find((r=>r.isSamePalette(e,this._hue,this._saturation,this._lightness)));if(r)r.addColor(e);else{const r=new ce;r.addColor(e),this._groups.push(r)}}getGroups(){return this._groups.map((e=>e.average))}}const fe=()=>"object"==typeof self&&self.constructor&&"DedicatedWorkerGlobalScope"===self.constructor.name,le=()=>"undefined"==typeof window&&"undefined"!=typeof process&&null!=process.versions&&null!=process.versions.node,pe=(e,r,t,n,o)=>{const a=((e,r,t,n,o)=>{const a=new ue(t,n,o);e.forEach((e=>a.addColor(e)));const i=a.getGroups();return i.sort(((e,t)=>(t._intensity+.1)*(.9-t._count/r)-(e._intensity+.1)*(.9-e._count/r))),i})(e,r,t,n,o);return a.map((e=>((e,r)=>({hex:`#${"0".repeat(6-e._hex.toString(16).length)}${e._hex.toString(16)}`,red:e._red,green:e._green,blue:e._blue,area:e._count/r,hue:e._hue,saturation:e._saturation,lightness:e._lightness,intensity:e._intensity}))(e,r)))},de=(e,r)=>{const t=e.width*e.height,n=t<r?e.width:Math.round(e.width*Math.sqrt(r/t)),o=t<r?e.height:Math.round(e.height*Math.sqrt(r/t)),a=((e,r)=>{if(fe())return new OffscreenCanvas(e,r);const t=document.createElement("canvas");return t.width=e,t.height=r,t})(n,o).getContext("2d");return a.drawImage(e,0,0,e.width,e.height,0,0,n,o),a.getImageData(0,0,n,o)},ge=(e,r={})=>{const[t,n,o,a,i,s]=ne(r),{colors:h,count:c}=se(e,t,n,o);return pe(h,c,a,i,s)},_e=async(e,r={})=>{if(le())return[];const[t,n,o,a,i,s,h]=ne(r);return e.crossOrigin=h,new Promise((r=>{const h=e=>{const h=de(e,t),{colors:c,count:u}=se(h,t,n,o);r(pe(c,u,a,i,s))};if(e.complete)h(e);else{const r=()=>{e.removeEventListener("load",r),h(e)};e.addEventListener("load",r)}}))},ve=async(e,r={})=>{if(le())return[];const[t,n,o,a,i,s]=ne(r),h=de(e,t),{colors:c,count:u}=se(h,t,n,o);return pe(c,u,a,i,s)},be=async(e,r={})=>{if(le())return[];if(fe()){const t=ne(r),n=await fetch(e,{mode:t[7]}),o=await n.blob(),a=await createImageBitmap(o),i=await ve(a,r);return a.close(),i}const t=new Image;return t.src=e,_e(t,r)};var ye=s(Object.freeze({__proto__:null,extractColors:(e,r)=>{if("undefined"!=typeof window&&void 0!==window.document){if(e instanceof Image)return _e(e,r);if(e instanceof ImageData||e instanceof Object&&e.data)return new Promise((t=>{t(ge(e,r))}));if("string"==typeof e)return be(e,r)}if(fe()){if(e instanceof ImageData||e instanceof Object&&e.data)return new Promise((t=>{t(ge(e,r))}));if("string"==typeof e)return be(e,r);if(e.src)return be(e.src,r)}if(le())return new Promise((t=>{t(ge(e,r))}));throw new Error("Can not analyse picture")},extractColorsFromImage:_e,extractColorsFromImageBitmap:ve,extractColorsFromImageData:ge,extractColorsFromSrc:be})),we={exports:{}};const me=r,Ee=e,Ie=o,Ae=a,ke={name:"dotenv",version:"16.4.5",description:"Loads environment variables from .env file",main:"lib/main.js",types:"lib/main.d.ts",exports:{".":{types:"./lib/main.d.ts",require:"./lib/main.js",default:"./lib/main.js"},"./config":"./config.js","./config.js":"./config.js","./lib/env-options":"./lib/env-options.js","./lib/env-options.js":"./lib/env-options.js","./lib/cli-options":"./lib/cli-options.js","./lib/cli-options.js":"./lib/cli-options.js","./package.json":"./package.json"},scripts:{"dts-check":"tsc --project tests/types/tsconfig.json",lint:"standard","lint-readme":"standard-markdown",pretest:"npm run lint && npm run dts-check",test:"tap tests/*.js --100 -Rspec","test:coverage":"tap --coverage-report=lcov",prerelease:"npm test",release:"standard-version"},repository:{type:"git",url:"git://github.com/motdotla/dotenv.git"},funding:"https://dotenvx.com",keywords:["dotenv","env",".env","environment","variables","config","settings"],readmeFilename:"README.md",license:"BSD-2-Clause",devDependencies:{"@definitelytyped/dtslint":"^0.0.133","@types/node":"^18.11.3",decache:"^4.6.1",sinon:"^14.0.1",standard:"^17.0.0","standard-markdown":"^7.1.0","standard-version":"^9.5.0",tap:"^16.3.0",tar:"^6.1.11",typescript:"^4.8.4"},engines:{node:">=12"},browser:{fs:!1}}.version,Te=/(?:^|^)\s*(?:export\s+)?([\w.-]+)(?:\s*=\s*?|:\s+?)(\s*'(?:\\'|[^'])*'|\s*"(?:\\"|[^"])*"|\s*`(?:\\`|[^`])*`|[^#\r\n]+)?\s*(?:#.*)?(?:$|$)/gm;function je(e){console.log(`[dotenv@${ke}][DEBUG] ${e}`)}function Be(e){return e&&e.DOTENV_KEY&&e.DOTENV_KEY.length>0?e.DOTENV_KEY:process.env.DOTENV_KEY&&process.env.DOTENV_KEY.length>0?process.env.DOTENV_KEY:""}function Oe(e,r){let t;try{t=new URL(r)}catch(e){if("ERR_INVALID_URL"===e.code){const e=new Error("INVALID_DOTENV_KEY: Wrong format. Must be in valid uri format like dotenv://:key_1234@dotenvx.com/vault/.env.vault?environment=development");throw e.code="INVALID_DOTENV_KEY",e}throw e}const n=t.password;if(!n){const e=new Error("INVALID_DOTENV_KEY: Missing key part");throw e.code="INVALID_DOTENV_KEY",e}const o=t.searchParams.get("environment");if(!o){const e=new Error("INVALID_DOTENV_KEY: Missing environment part");throw e.code="INVALID_DOTENV_KEY",e}const a=`DOTENV_VAULT_${o.toUpperCase()}`,i=e.parsed[a];if(!i){const e=new Error(`NOT_FOUND_DOTENV_ENVIRONMENT: Cannot locate environment ${a} in your .env.vault file.`);throw e.code="NOT_FOUND_DOTENV_ENVIRONMENT",e}return{ciphertext:i,key:n}}function Pe(e){let r=null;if(e&&e.path&&e.path.length>0)if(Array.isArray(e.path))for(const t of e.path)me.existsSync(t)&&(r=t.endsWith(".vault")?t:`${t}.vault`);else r=e.path.endsWith(".vault")?e.path:`${e.path}.vault`;else r=Ee.resolve(process.cwd(),".env.vault");return me.existsSync(r)?r:null}function xe(e){return"~"===e[0]?Ee.join(Ie.homedir(),e.slice(1)):e}const Ce={configDotenv:function(e){const r=Ee.resolve(process.cwd(),".env");let t="utf8";const n=Boolean(e&&e.debug);e&&e.encoding?t=e.encoding:n&&je("No encoding is specified. UTF-8 is used by default");let o,a=[r];if(e&&e.path)if(Array.isArray(e.path)){a=[];for(const r of e.path)a.push(xe(r))}else a=[xe(e.path)];const i={};for(const r of a)try{const n=Ce.parse(me.readFileSync(r,{encoding:t}));Ce.populate(i,n,e)}catch(e){n&&je(`Failed to load ${r} ${e.message}`),o=e}let s=process.env;return e&&null!=e.processEnv&&(s=e.processEnv),Ce.populate(s,i,e),o?{parsed:i,error:o}:{parsed:i}},_configVault:function(e){var r;r="Loading env from encrypted .env.vault",console.log(`[dotenv@${ke}][INFO] ${r}`);const t=Ce._parseVault(e);let n=process.env;return e&&null!=e.processEnv&&(n=e.processEnv),Ce.populate(n,t,e),{parsed:t}},_parseVault:function(e){const r=Pe(e),t=Ce.configDotenv({path:r});if(!t.parsed){const e=new Error(`MISSING_DATA: Cannot parse ${r} for an unknown reason`);throw e.code="MISSING_DATA",e}const n=Be(e).split(","),o=n.length;let a;for(let e=0;e<o;e++)try{const r=Oe(t,n[e].trim());a=Ce.decrypt(r.ciphertext,r.key);break}catch(r){if(e+1>=o)throw r}return Ce.parse(a)},config:function(e){if(0===Be(e).length)return Ce.configDotenv(e);const r=Pe(e);return r?Ce._configVault(e):(t=`You set DOTENV_KEY but you are missing a .env.vault file at ${r}. Did you forget to build it?`,console.log(`[dotenv@${ke}][WARN] ${t}`),Ce.configDotenv(e));var t},decrypt:function(e,r){const t=Buffer.from(r.slice(-64),"hex");let n=Buffer.from(e,"base64");const o=n.subarray(0,12),a=n.subarray(-16);n=n.subarray(12,-16);try{const e=Ae.createDecipheriv("aes-256-gcm",t,o);return e.setAuthTag(a),`${e.update(n)}${e.final()}`}catch(e){const r=e instanceof RangeError,t="Invalid key length"===e.message,n="Unsupported state or unable to authenticate data"===e.message;if(r||t){const e=new Error("INVALID_DOTENV_KEY: It must be 64 characters long (or more)");throw e.code="INVALID_DOTENV_KEY",e}if(n){const e=new Error("DECRYPTION_FAILED: Please check your DOTENV_KEY");throw e.code="DECRYPTION_FAILED",e}throw e}},parse:function(e){const r={};let t,n=e.toString();for(n=n.replace(/\r\n?/gm,"\n");null!=(t=Te.exec(n));){const e=t[1];let n=t[2]||"";n=n.trim();const o=n[0];n=n.replace(/^(['"`])([\s\S]*)\1$/gm,"$2"),'"'===o&&(n=n.replace(/\\n/g,"\n"),n=n.replace(/\\r/g,"\r")),r[e]=n}return r},populate:function(e,r,t={}){const n=Boolean(t&&t.debug),o=Boolean(t&&t.override);if("object"!=typeof r){const e=new Error("OBJECT_REQUIRED: Please check the processEnv argument being passed to populate");throw e.code="OBJECT_REQUIRED",e}for(const t of Object.keys(r))Object.prototype.hasOwnProperty.call(e,t)?(!0===o&&(e[t]=r[t]),n&&je(!0===o?`"${t}" is already defined and WAS overwritten`:`"${t}" is already defined and was NOT overwritten`)):e[t]=r[t]}};we.exports.configDotenv=Ce.configDotenv,we.exports._configVault=Ce._configVault,we.exports._parseVault=Ce._parseVault,we.exports.config=Ce.config,we.exports.decrypt=Ce.decrypt,we.exports.parse=Ce.parse,we.exports.populate=Ce.populate,we.exports=Ce,we.exports.config();const{createHmac:De}=i;const Ne=e=>Buffer.from(e,"hex");var Ue=class e{static baseUrl="s3://s3-daily-drip-015812eb-e529-49ee-b23a-d95053fe9ef9";static proxyUrl="https://images.dailydrip.news";static getImage(r,t,n){let o="";t&&t.forEach((e=>{o+=`/${e.key}`,e.params.forEach((e=>{o+=`:${e}`}))}));let a=o+"/"+btoa(this.baseUrl+r);return null!=n&&(a+="."+n),`${e.proxyUrl}${function(e){const r=De("sha256",Ne(process.env.IMGPROXY_KEY));r.update(Ne(process.env.IMGPROXY_SALT)),r.update(e);return`/${r.digest("base64url")}${e}`}(a)}`}};const Me=function(e,r){var t=q.extname(e);switch(t.toUpperCase()){case".PNG":!function(e,r){te.readFile(e,(function(e,t){e?r(e):K.parse(t,(function(e,t){e?r(e):r(void 0,X(new Uint8Array(t.data),[0|t.height,0|t.width,4],[4*t.width|0,4,1],0))}))}))}(e,r);break;case".PPM":!function(e,r){J.parse(te.createReadStream(e),(function(e,t){if(e)r(e);else{var n=[t.length,t[0].length,t[0][0].length],o=new Uint8Array(n[0]*n[1]*n[2]),a=X(o,n);Z(t,a),r(void 0,a)}}))}(e,r);break;case".JPE":case".JPG":case".JPEG":!function(e,r){te.readFile(e,(function(e,t){if(e)r(e);else{var n;try{n=Q.decode(t)}catch(e){return void r(e)}if(n){var o=[n.height,n.width,4],a=X(n.data,o);r(void 0,a)}else r(new Error("Error decoding jpeg"))}}))}(e,r);break;case".GIF":!function(e,r){te.readFile(e,(function(e,t){if(e)r(e);else{var n;try{n=new ee(t)}catch(e){return void r(e)}if(n.numFrames()>0){var o=[n.numFrames(),n.height,n.width,4],a=new Uint8Array(o[0]*o[1]*o[2]*o[3]),i=X(a,o);try{for(var s=0;s<n.numFrames();++s)n.decodeAndBlitFrameRGBA(s,a.subarray(i.index(s,0,0,0),i.index(s+1,0,0,0)))}catch(e){return void r(e)}r(void 0,i)}else{o=[n.height,n.width,4],a=new Uint8Array(o[0]*o[1]*o[2]),i=X(a,o);try{n.decodeAndBlitFrameRGBA(0,a)}catch(e){return void r(e)}r(void 0,i)}}}))}(e,r);break;case".BMP":!function(e,r){te.readFile(e,(function(e,t){if(e)r(e);else{var n=new re(t);try{n.init()}catch(e){return void r(e)}var o=n.getData(),a=[o.getHeight(),o.getWidth(),4],i=new Uint8Array(a[0]*a[1]*a[2]),s=X(i,a);Z(o,s),r(void 0,s)}}))}(e,r);break;default:process.nextTick((function(){r(new Error("Unsupported file type: "+t))}))}},{extractColors:Re}=ye,Se=Ue;function Ve(e){const r={pixels:1e5,distance:.18,saturationDistance:.2,colorValidator:(e,r,t,n=255)=>!function(e,r,t){if(e==r&&e==t&&0==e||e+r+t<20)return!0;{const n=(e+r+t)/3,o=((e-n)**2+(r-n)**2+(t-n)**2)/3;return Math.sqrt(o)/n<=.05}}(e,r,t)&&n>250,lightnessDistance:.2,hueDistance:.083};Me(function(e){const r=JSON.parse(e.focalPoint),t="/characters/"+e.game+"/"+e.id+"/gachaSplash.webp";return Se.getImage(t,[{key:"gravity",params:["fp",r[0],r[1]]},{key:"crop",params:["1000","1000"]}],"png")}(e),((e,t)=>{if(!e){const e=[...t.data],[n,o]=t.shape;Re({data:e,width:n,height:o},r).then((e=>({colors:e.sort(((e,r)=>r.area-e.area))}))).catch(console.log)}}))}modules.exports={id:"operation-extract-colors",handler:({character:e})=>({data:Ve(e)})},module.exports={};
